(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1984],{64335:function(Ar,ne,J){"use strict";var Ie=J(67294),ge=(0,Ie.createContext)({});ne.Z=ge},21349:function(Ar,ne,J){"use strict";var Ie=J(84305),ge=J(39559),v=J(53645),Oe=J.n(v),H=J(67294),ce=J(94184),he=J.n(ce),Fe=J(64335),ye=function(ft){var xt=(0,H.useContext)(Fe.Z),Jt=ft.children,ur=ft.contentWidth,It=ft.className,er=ft.style,jt=(0,H.useContext)(ge.ZP.ConfigContext),ct=jt.getPrefixCls,pt=ft.prefixCls||ct("pro"),ir=ur||xt.contentWidth,Y="".concat(pt,"-grid-content");return H.createElement("div",{className:he()(Y,It,{wide:ir==="Fixed"}),style:er},H.createElement("div",{className:"".concat(pt,"-grid-content-children")},Jt))};ne.Z=ye},77041:function(Ar,ne,J){"use strict";J.d(ne,{zP:function(){return JM},JE:function(){return cM},ns:function(){return QM}});var Ie={};J.r(Ie),J.d(Ie,{add:function(){return Dr},adjoint:function(){return Yp},clone:function(){return Oh},copy:function(){return up},create:function(){return ml},determinant:function(){return Pd},equals:function(){return Wt},exactEquals:function(){return Bn},frob:function(){return gr},fromQuat:function(){return At},fromQuat2:function(){return Od},fromRotation:function(){return Ta},fromRotationTranslation:function(){return Lh},fromRotationTranslationScale:function(){return Mt},fromRotationTranslationScaleOrigin:function(){return rr},fromScaling:function(){return uh},fromTranslation:function(){return lp},fromValues:function(){return la},fromXRotation:function(){return cp},fromYRotation:function(){return Zl},fromZRotation:function(){return Af},frustum:function(){return qt},getRotation:function(){return De},getScaling:function(){return ue},getTranslation:function(){return z},identity:function(){return xo},invert:function(){return oh},lookAt:function(){return br},mul:function(){return Qt},multiply:function(){return gl},multiplyScalar:function(){return Mr},multiplyScalarAndAdd:function(){return $r},ortho:function(){return Ur},orthoNO:function(){return Cr},orthoZO:function(){return vr},perspective:function(){return dr},perspectiveFromFieldOfView:function(){return Sr},perspectiveNO:function(){return sr},perspectiveZO:function(){return mr},rotate:function(){return Id},rotateX:function(){return Rh},rotateY:function(){return Jc},rotateZ:function(){return kh},scale:function(){return Qc},set:function(){return gc},str:function(){return Ut},sub:function(){return yn},subtract:function(){return or},targetTo:function(){return rt},translate:function(){return sh},transpose:function(){return Ys}});var ge=J(67294),v=(0,ge.createContext)({});function Oe(){return(0,ge.useContext)(v)}var H={},ce={},he=function(i){return ce[i]},Fe=function(i,r){ce[i]=r},ye=function(i){return H[i]},Je=function(i,r){H[i]=r},ft={},xt={},Jt=34,ur=10,It=13;function er(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function jt(e,i){var r=er(e);return function(n,a){return i(r(n),a,e)}}function ct(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function pt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function ir(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function Y(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":ir(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(a?"T"+pt(i,2)+":"+pt(r,2)+":"+pt(n,2)+"."+pt(a,3)+"Z":n?"T"+pt(i,2)+":"+pt(r,2)+":"+pt(n,2)+"Z":r||i?"T"+pt(i,2)+":"+pt(r,2)+"Z":"")}function Xt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(I,L){var F,W,$=a(I,function(te,Ae){if(F)return F(te,Ae-1);W=te,F=L?jt(te,L):er(te)});return $.columns=W||[],$}function a(I,L){var F=[],W=I.length,$=0,te=0,Ae,Xe=W<=0,tt=!1;I.charCodeAt(W-1)===ur&&--W,I.charCodeAt(W-1)===It&&--W;function lt(){if(Xe)return xt;if(tt)return tt=!1,ft;var Nt,Kt=$,fr;if(I.charCodeAt(Kt)===Jt){for(;$++<W&&I.charCodeAt($)!==Jt||I.charCodeAt(++$)===Jt;);return(Nt=$)>=W?Xe=!0:(fr=I.charCodeAt($++))===ur?tt=!0:fr===It&&(tt=!0,I.charCodeAt($)===ur&&++$),I.slice(Kt+1,Nt-1).replace(/""/g,'"')}for(;$<W;){if((fr=I.charCodeAt(Nt=$++))===ur)tt=!0;else if(fr===It)tt=!0,I.charCodeAt($)===ur&&++$;else if(fr!==r)continue;return I.slice(Kt,Nt)}return Xe=!0,I.slice(Kt,W)}for(;(Ae=lt())!==xt;){for(var Ot=[];Ae!==ft&&Ae!==xt;)Ot.push(Ae),Ae=lt();L&&(Ot=L(Ot,te++))==null||F.push(Ot)}return F}function s(I,L){return I.map(function(F){return L.map(function(W){return A(F[W])}).join(e)})}function p(I,L){return L==null&&(L=ct(I)),[L.map(A).join(e)].concat(s(I,L)).join(`
`)}function m(I,L){return L==null&&(L=ct(I)),s(I,L).join(`
`)}function y(I){return I.map(E).join(`
`)}function E(I){return I.map(A).join(e)}function A(I){return I==null?"":I instanceof Date?Y(I):i.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:n,parseRows:a,format:p,formatBody:m,formatRows:y,formatRow:E,formatValue:A}}var st=Xt(","),Ye=st.parse,bt=st.parseRows,$e=st.format,Yt=st.formatBody,Er=st.formatRows,Hr=st.formatRow,nn=st.formatValue,C=J(96156),Se=J(85061),ke=J(38163),_t=J.n(ke);function ht(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lt(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ht(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ht(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,m=[];return e.forEach(function(y,E){var A=[];if(r&&n&&(A=[parseFloat(y[r]),parseFloat(y[n])]),r&&n&&a&&s){var I=[parseFloat(y[r]),parseFloat(y[n])],L=[parseFloat(y[a]),parseFloat(y[s])];A=[I,L]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var W={type:F,coordinates:(0,Se.Z)(y[p])};_t()(W,!0),A=W.coordinates}var $=Lt(Lt({},y),{},{_id:E,coordinates:A});m.push($)}),{dataArray:m}}var xr=[{lng1:100,lat1:30,lng2:130,lat2:30}],Kn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function mn(e,i){var r=Ye(e);return Ht(r,i)}var di=63710088e-1,Gn={centimeters:di*100,centimetres:di*100,degrees:di/111325,feet:di*3.28084,inches:di*39.37,kilometers:di/1e3,kilometres:di/1e3,meters:di,metres:di,miles:di/1609.344,millimeters:di*1e3,millimetres:di*1e3,nauticalmiles:di/1852,radians:1,yards:di*1.0936},ni={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/di,yards:1.0936133},vi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Hn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function mi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ca(i).geometry;case"LineString":return fa(i).geometry;case"Polygon":return Li(i).geometry;case"MultiPoint":return Fi(i).geometry;case"MultiLineString":return ya(i).geometry;case"MultiPolygon":return ra(i).geometry;default:throw new Error(e+" is invalid")}}function ca(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!An(e[0])||!An(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Hn(n,i,r)}function Gi(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return ca(n,i)}),r)}function Li(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return Hn(m,i,r)}function $i(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return Li(n,i)}),r)}function fa(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Hn(n,i,r)}function ko(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return fa(n,i)}),r)}function Oa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function ya(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Hn(n,i,r)}function Fi(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Hn(n,i,r)}function ra(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Hn(n,i,r)}function Qi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Hn(n,i,r)}function Es(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function le(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function ii(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function yo(e,i){return Bt(ii(e,i))}function Qs(e){var i=e%360;return i<0&&(i+=360),i}function Bt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function $t(e){var i=e%360;return i*Math.PI/180}function Pr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return le(ii(e,i),r)}function ln(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=vi[i];if(!n)throw new Error("invalid original units");var a=vi[r];if(!a)throw new Error("invalid final units");return e/n*a}function An(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Nn(e){return!!e&&e.constructor===Object}function _i(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!An(i))throw new Error("bbox must only contain numbers")})}function fi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function En(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ti(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ti(e[0]);throw new Error("coordinates must only contain numbers")}function eo(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function ps(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Go(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Da(e){return e.type==="Feature"?e.geometry:e}function _a(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,p,m,y,E,A=0,I=0,L,F=e.type,W=F==="FeatureCollection",$=F==="Feature",te=W?e.features.length:1,Ae=0;Ae<te;Ae++){E=W?e.features[Ae].geometry:$?e.geometry:e,L=E?E.type==="GeometryCollection":!1,m=L?E.geometries.length:1;for(var Xe=0;Xe<m;Xe++){var tt=0,lt=0;if(p=L?E.geometries[Xe]:E,p!==null){y=p.coordinates;var Ot=p.type;switch(A=r&&(Ot==="Polygon"||Ot==="MultiPolygon")?1:0,Ot){case null:break;case"Point":if(i(y,I,Ae,tt,lt)===!1)return!1;I++,tt++;break;case"LineString":case"MultiPoint":for(n=0;n<y.length;n++){if(i(y[n],I,Ae,tt,lt)===!1)return!1;I++,Ot==="MultiPoint"&&tt++}Ot==="LineString"&&tt++;break;case"Polygon":case"MultiLineString":for(n=0;n<y.length;n++){for(a=0;a<y[n].length-A;a++){if(i(y[n][a],I,Ae,tt,lt)===!1)return!1;I++}Ot==="MultiLineString"&&tt++,Ot==="Polygon"&&lt++}Ot==="Polygon"&&tt++;break;case"MultiPolygon":for(n=0;n<y.length;n++){for(lt=0,a=0;a<y[n].length;a++){for(s=0;s<y[n][a].length-A;s++){if(i(y[n][a][s],I,Ae,tt,lt)===!1)return!1;I++}lt++}tt++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(V(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function q(e,i,r,n){var a=r;return V(e,function(s,p,m,y,E){p===0&&r===void 0?a=s:a=i(a,s,p,m,y,E)},n),a}function ee(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function fe(e,i,r){var n=r;return ee(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Me(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Ue(e,i,r){var n=r;return Me(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Ke(e){var i=[];return V(e,function(r){i.push(r)}),i}function oe(e,i){var r,n,a,s,p,m,y,E,A,I,L=0,F=e.type==="FeatureCollection",W=e.type==="Feature",$=F?e.features.length:1;for(r=0;r<$;r++){for(m=F?e.features[r].geometry:W?e.geometry:e,E=F?e.features[r].properties:W?e.properties:{},A=F?e.features[r].bbox:W?e.bbox:void 0,I=F?e.features[r].id:W?e.id:void 0,y=m?m.type==="GeometryCollection":!1,p=y?m.geometries.length:1,a=0;a<p;a++){if(s=y?m.geometries[a]:m,s===null){if(i(null,L,E,A,I)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,L,E,A,I)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],L,E,A,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}L++}}function Re(e,i,r){var n=r;return oe(e,function(a,s,p,m,y){s===0&&r===void 0?n=a:n=i(n,a,s,p,m,y)}),n}function ut(e,i){oe(e,function(r,n,a,s,p){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return i(Hn(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var y;switch(m){case"MultiPoint":y="Point";break;case"MultiLineString":y="LineString";break;case"MultiPolygon":y="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var A=r.coordinates[E],I={type:y,coordinates:A};if(i(Hn(I,a),n,E)===!1)return!1}})}function cr(e,i,r){var n=r;return ut(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function Tt(e,i){ut(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var m,y=0,E=0,A=0;if(V(r,function(I,L,F,W,$){if(m===void 0||n>y||W>E||$>A){m=I,y=n,E=W,A=$,s=0;return}var te=lineString([m,I],r.properties);if(i(te,n,a,$,s)===!1)return!1;s++,m=I})===!1)return!1}}})}function Rt(e,i,r){var n=r,a=!1;return Tt(e,function(s,p,m,y,E){a===!1&&r===void 0?n=s:n=i(n,s,p,m,y,E),a=!0}),n}function hr(e,i){if(!e)throw new Error("geojson is required");ut(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<p.length;m++)if(i(lineString(p[m],r.properties),n,a,m)===!1)return!1;break}}})}function gn(e,i,r){var n=r;return hr(e,function(a,s,p,m){s===0&&r===void 0?n=a:n=i(n,a,s,p,m)}),n}function cn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":p=p||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=y.length+s-1),lineString([y[s],y[s+1]],p,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s-1),lineString([y[a][s],y[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s-1),lineString([y[n][s],y[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s-1),lineString([y[n][a][s],y[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Et(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":p=p||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var y=m.coordinates;switch(m.type){case"Point":return point(y,p,i);case"MultiPoint":return n<0&&(n=y.length+n),point(y[n],p,i);case"LineString":return s<0&&(s=y.length+s),point(y[s],p,i);case"Polygon":return a<0&&(a=y.length+a),s<0&&(s=y[a].length+s),point(y[a][s],p,i);case"MultiLineString":return n<0&&(n=y.length+n),s<0&&(s=y[n].length+s),point(y[n][s],p,i);case"MultiPolygon":return n<0&&(n=y.length+n),a<0&&(a=y[n].length+a),s<0&&(s=y[n][a].length-s),point(y[n][a][s],p,i)}throw new Error("geojson is invalid")}function Qr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qr(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wr(e,i){var r=[],n={};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),_t()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return ut(e,function(s,p){var m=Mi(s),y=p,E=Lr(Lr({},s.properties),{},{coordinates:m,_id:y});r.push(E)}),{dataArray:r,featureKeys:n}}function hi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Jr(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Tn=J(28481),Zi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function si(e){this.message=e}si.prototype=new Error,si.prototype.name="InvalidCharacterError";function Si(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new si("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Zi.indexOf(s);return r}function gi(e){e=String(e);for(var i,r,n,a,s="",p=0,m=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Zi.charAt(i>>18&63)+Zi.charAt(i>>12&63)+Zi.charAt(i>>6&63)+Zi.charAt(i&63)}return m?s.slice(0,m-3)+"===".substring(m):s}var vt=J(6610),kt=J(5991),Ca=function(){function e(i,r){(0,vt.Z)(this,e),this.buffers=i,this.type=r}return(0,kt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),bi;typeof window=="undefined"?bi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:bi=window;var Ci=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Di=Ci?my.getSystemInfoSync().pixelRatio:bi.devicePixelRatio,Fr=J(10379),xn=J(46070),Ct=J(77608),Ji=(0,kt.Z)(function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"cancelBubble",void 0),(0,C.Z)(this,"cancelable",void 0),(0,C.Z)(this,"target",void 0),(0,C.Z)(this,"currentTarget",void 0),(0,C.Z)(this,"preventDefault",void 0),(0,C.Z)(this,"stopPropagation",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),de=J(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Wi(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Wi(e,i){if(!!e){if(typeof e=="string")return hu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hu(e,i)}}function hu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Fa=new WeakMap,wa=function(){function e(){(0,vt.Z)(this,e),Fa.set(this,{})}return(0,kt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Fa.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Fa.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Fa.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var m=p.length;m--;m>0)if(p[m]===n){p.splice(m,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Fa.get(this)[r.type];if(n){var a=Ko(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(m){a.e(m)}finally{a.f()}}}}]),e}();function Ga(e){var i=ea();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function ea(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mo=function(e){(0,Fr.Z)(r,e);var i=Ga(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,kt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(wa);function Ho(e){var i=bu();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ho=function(e){(0,Fr.Z)(r,e);var i=Ho(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"className",void 0),(0,C.Z)((0,de.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,kt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Mo),Lo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ta,Ha,Do,Wa;if(Lo){var Ss=my.getSystemInfoSync();ta=Ss.screenWidth,Ha=Ss.screenHeight,Do=Ss.windowWidth,Wa=Ss.windowHeight}else{var bl=bi.innerWidth,ds=bi.innerHeight;ta=bl,Ha=ds,Do=bl,Wa=ds}var Q={width:ta,height:Ha,availWidth:Do,availHeight:Wa,availLeft:0,availTop:0},me=Q.availWidth,He=Q.availHeight,wt={style:[]};function Tr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return wt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return wt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function In(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:me+"px",height:He+"px",margin:"0px",padding:"0px"})}function wi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=me,e.clientHeight=He),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function to(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=me,e.offsetHeight=He)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=me,e.scrollHeight=He)}function Ba(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Wo(e){var i=vs();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function uo(){}var Po=function(e){(0,Fr.Z)(r,e);var i=Wo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"className",void 0),(0,C.Z)((0,de.Z)(n),"children",void 0),(0,C.Z)((0,de.Z)(n),"focus",void 0),(0,C.Z)((0,de.Z)(n),"blur",void 0),(0,C.Z)((0,de.Z)(n),"insertBefore",void 0),(0,C.Z)((0,de.Z)(n),"appendChild",void 0),(0,C.Z)((0,de.Z)(n),"removeChild",void 0),(0,C.Z)((0,de.Z)(n),"remove",void 0),(0,C.Z)((0,de.Z)(n),"innerHTML",void 0),(0,C.Z)((0,de.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=uo,n.blur=uo,n.insertBefore=uo,n.appendChild=uo,n.removeChild=uo,n.remove=uo,n.innerHTML="",n.tagName=a.toUpperCase(),Tr((0,de.Z)(n),s),In((0,de.Z)(n)),Ba((0,de.Z)(n)),wi((0,de.Z)(n)),to((0,de.Z)(n)),Ra((0,de.Z)(n)),n}return(0,kt.Z)(r)}(ho);function ms(e){var i=Cs();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Cs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ps=function(e){(0,Fr.Z)(r,e);var i=ms(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,kt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Po);function Js(e){var i=gs();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ha=function(e){(0,Fr.Z)(r,e);var i=Js(r);function r(){return(0,vt.Z)(this,r),i.call(this,"video")}return(0,kt.Z)(r)}(Ps),va={},is={};function sf(e,i){va=e,va.id=i,"tagName"in va||(va.tagName="CANVAS"),va.type="canvas",Mixin.parentNode(va),Mixin.style(va),Mixin.classList(va),Mixin.clientRegion(va),Mixin.offsetRegion(va),va.focus=function(){},va.blur=function(){}}function El(e,i){var r=1024,n=1024;is={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in is||(is.tagName="CANVAS"),Mixin.parentNode(is),Mixin.style(is),Mixin.classList(is),Mixin.clientRegion(is),Mixin.offsetRegion(is),is.getContext=function(a){if(a==="2d")return e},is.focus=function(){},is.blur=function(){}}function Ns(){return va}function Ql(){return is}var Zu=(0,kt.Z)(function e(){(0,vt.Z)(this,e);var i=Ns(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Tr(r),Ba(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),zs={href:"",protocol:"",host:""};function tl(e){var i=_();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T=function(e){(0,Fr.Z)(r,e);var i=tl(r);function r(){return(0,vt.Z)(this,r),i.call(this,"body",0)}return(0,kt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(Po),N=function(e){(0,Fr.Z)(r,e);var i=tl(r);function r(){return(0,vt.Z)(this,r),i.call(this,"html",0)}return(0,kt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Po),R={},X={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:zs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Zu:i==="video"?new ha:new Po(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Ji(i)}};X.documentElement=new N,X.head=new Po("head"),X.body=new T;var ve=Object,je=J(90484),at=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"_w",void 0),(0,C.Z)(this,"_h",void 0),(0,C.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,je.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,kt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),ot=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",tr,ar,Mn;if(ot){var ei=my.getSystemInfoSync();tr=ei.system,ar=ei.platform,Mn=ei.language}else{var Rn={versions:function(){var e=bi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(bi.navigator.browserLanguage||bi.navigator.language).toLowerCase()};Rn.versions.android?ar="android":Rn.versions.trident?ar="IE":Rn.versions.presto?ar="Opera":Rn.versions.webKit?ar="webKit":Rn.versions.gecko?ar="Firefox":Rn.versions.mobile?ar="mobile":Rn.versions.ios?ar="ios":Rn.versions.iPhone?ar="iPhone":Rn.versions.iPad?ar="ipad":Rn.versions.webApp?ar="webApp":Rn.versions.weixin?ar="weixin":Rn.versions.qq&&(ar="qq"),tr=bi.navigator.userAgent,Mn=Rn.language}var Vi=tr.toLowerCase().indexOf("android")!==-1,sa=Vi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ba="Mozilla/5.0 (".concat(sa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Mn),Bi={platform:ar,language:Mn,appVersion:"5.0 (".concat(sa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ba},ys={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},eu=0,Vu=0;function uf(e){var i=Date.now(),r=Math.max(eu+23,i);return Vu=setTimeout(function(){e(eu=r)},r-i),Vu}function rl(e){var i=Ns();return i.requestAnimationFrame?i.requestAnimationFrame(e):uf(e)}function Ic(e){var i=Ns();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Eu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,vt.Z)(this,e),(0,C.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,kt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Su(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function Su(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return gi(i)}var Cu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},lo={};function Bf(e){var i=Nf();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Nf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Oc=new Map,wu=new Map,tu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function lf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Sl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,lf.call(this,"readystatechange",i)}var Oi=function(e){(0,Fr.Z)(r,e);var i=Bf(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"onabort",void 0),(0,C.Z)((0,de.Z)(n),"onerror",void 0),(0,C.Z)((0,de.Z)(n),"onload",void 0),(0,C.Z)((0,de.Z)(n),"onloadstart",void 0),(0,C.Z)((0,de.Z)(n),"onprogress",void 0),(0,C.Z)((0,de.Z)(n),"ontimeout",void 0),(0,C.Z)((0,de.Z)(n),"onloadend",void 0),(0,C.Z)((0,de.Z)(n),"onreadystatechange",void 0),(0,C.Z)((0,de.Z)(n),"readyState",void 0),(0,C.Z)((0,de.Z)(n),"response",void 0),(0,C.Z)((0,de.Z)(n),"responseText",void 0),(0,C.Z)((0,de.Z)(n),"_responseType",void 0),(0,C.Z)((0,de.Z)(n),"responseXML",void 0),(0,C.Z)((0,de.Z)(n),"status",void 0),(0,C.Z)((0,de.Z)(n),"statusText",void 0),(0,C.Z)((0,de.Z)(n),"upload",void 0),(0,C.Z)((0,de.Z)(n),"withCredentials",void 0),(0,C.Z)((0,de.Z)(n),"timeout",void 0),(0,C.Z)((0,de.Z)(n),"_url",void 0),(0,C.Z)((0,de.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,kt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=wu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Oc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Oc.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=$o.get("requestHeader");p[a]=s,$o.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};m.target=m.target||p,s.call(p,m)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(wa);(0,C.Z)(Oi,"UNSEND",void 0),(0,C.Z)(Oi,"OPENED",void 0),(0,C.Z)(Oi,"HEADERS_RECEIVED",void 0),(0,C.Z)(Oi,"LOADING",void 0),(0,C.Z)(Oi,"DONE",void 0),Oi.UNSEND=0,Oi.OPENED=1,Oi.HEADERS_RECEIVED=2,Oi.LOADING=3,Oi.DONE=4;function Cl(e){var i=Eh();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Eh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nl=function(e){(0,Fr.Z)(r,e);var i=Cl(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this,n),(0,C.Z)((0,de.Z)(a),"touches",void 0),(0,C.Z)((0,de.Z)(a),"targetTouches",void 0),(0,C.Z)((0,de.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Ns(),a.currentTarget=Ns(),a}return(0,kt.Z)(r)}(Ji);function Rc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,m=p===void 0?0:p,y=i.clientY,E=y===void 0?0:y;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=m,e.y=E)}function zf(e){return function(i){var r=new nl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Rc(n)}),r.touches.forEach(function(n){return Rc(n)}),r.targetTouches.forEach(function(n){return Rc(n)}),X.dispatchEvent(r)}}function Sh(e){return function(i){i.type=e,X.dispatchEvent(i)}}var Uf=zf("touchstart"),kc=zf("touchmove"),Jl=zf("touchend"),ec=Sh("mapCameaParams");function wl(e){var i=il();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Al=function(e){(0,Fr.Z)(r,e);var i=wl(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this,n),(0,C.Z)((0,de.Z)(a),"buttons",void 0),(0,C.Z)((0,de.Z)(a),"which",void 0),(0,C.Z)((0,de.Z)(a),"pointerId",void 0),(0,C.Z)((0,de.Z)(a),"bubbles",void 0),(0,C.Z)((0,de.Z)(a),"button",void 0),(0,C.Z)((0,de.Z)(a),"width",void 0),(0,C.Z)((0,de.Z)(a),"height",void 0),(0,C.Z)((0,de.Z)(a),"pressure",void 0),(0,C.Z)((0,de.Z)(a),"isPrimary",void 0),(0,C.Z)((0,de.Z)(a),"pointerType",void 0),(0,C.Z)((0,de.Z)(a),"altKey",void 0),(0,C.Z)((0,de.Z)(a),"ctrlKey",void 0),(0,C.Z)((0,de.Z)(a),"metaKey",void 0),(0,C.Z)((0,de.Z)(a),"shiftKey",void 0),a.target=Ns(),a.currentTarget=Ns(),a}return(0,kt.Z)(r)}(Ji),ju=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Us=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],cf="touch";function ff(e,i,r){for(var n=new Al(e),a=0;a<ju.length;a++){var s=ju[a];n[s]=i[s]||Us[a]}return n.type=e,n.target=Ns(),n.currentTarget=Ns(),n.buttons=Zf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=tc(i),n.pointerType=cf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Zf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var ru=null;function tc(e){return ru===e.identifier}function Lc(e){ru===null&&(ru=e.identifier)}function hf(e){ru===e.identifier&&(ru=null)}function Tl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Lc(a):(e==="pointerup"||e==="pointercancel")&&hf(a);var s=ff(e,a,i);X.dispatchEvent(s)}}}var tp=Tl("pointerdown"),pf=Tl("pointermove"),Ml=Tl("pointerup");function df(e){var i=vf();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pl=function(e){(0,Fr.Z)(r,e);var i=df(r);function r(n){return(0,vt.Z)(this,r),i.call(this,n)}return(0,kt.Z)(r)}(Ji);function Dc(e){return function(i){i.type=e,X.dispatchEvent(i)}}var Ch=Dc("mousedown"),wh=Dc("mousemove"),rc=Dc("mouseup"),Ah=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Il=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Hi=Ah||Il,nc={atob:Si,btoa:gi,devicePixelRatio:Di,Blob:Ca,document:X,Element:ho,Event:Ji,EventTarget:wa,HTMLCanvasElement:ve,HTMLElement:Po,HTMLMediaElement:Ps,HTMLVideoElement:ha,Image:Zu,ImageData:at,navigator:Bi,Node:Mo,requestAnimationFrame:rl,cancelAnimationFrame:Ic,screen:Q,XMLHttpRequest:Oi,performance:ys,URL:Eu,WebGLRenderingContext:Cu,WebGL2RenderingContext:lo,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};X.addEventListener(i,r,n)},removeEventListener:function(i,r,n){X.removeEventListener(i,r)},dispatchEvent:function(i){X.dispatchEvent(i)},innerWidth:Q.availWidth,innerHeight:Q.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},na=Hi?nc:bi,Au=Hi?Oi:bi.XMLHttpRequest,ji=Hi?zs:bi.location;function Aa(e){var i=e;return typeof e=="string"&&(i=na.document.getElementById(e)),i}function _s(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Fc(e){return _s(e).split(/\s+/)}function Gu(e){var i,r,n=na==null||(i=na.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Na(e,i,r){var n=na.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function ic(e){var i=e.parentNode;i&&i.removeChild(e)}function Ol(e,i){if(e.classList!==void 0)for(var r=Fc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Bc(e,i)){var s=po(e);Tu(e,(s?s+" ":"")+i)}}function Hu(e,i){e.classList!==void 0?e.classList.remove(i):Tu(e,_s((" "+po(e)+" ").replace(" "+i+" "," ")))}function Bc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=po(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Tu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function po(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Rl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ac=Gu(["transform","WebkitTransform"]);function vo(e,i){e.style[ac]=i}function hn(){if(typeof Event=="function")na.dispatchEvent(new Event("resize"));else{var e=na.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,na,0),na.dispatchEvent(e)}}function co(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Wu(){var e,i=na.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,Tn.Z)(s,2),m=p[0],y=p[1];return m==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=Wu()<1?1:na.devicePixelRatio,Zs=J(14665);function ws(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var mf=J(51814);function zr(e,i,r){return(0,mf.Z)()?zr=Reflect.construct:zr=function(a,s,p){var m=[null];m.push.apply(m,s);var y=Function.bind.apply(a,m),E=new y;return p&&(0,Zs.Z)(E,p.prototype),E},zr.apply(null,arguments)}function oc(e){var i=typeof Map=="function"?new Map:void 0;return oc=function(n){if(n===null||!ws(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return zr(n,arguments,(0,Ct.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Zs.Z)(a,n)},oc(e)}function gf(e){var i=al();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ea=function(e){(0,Fr.Z)(r,e);var i=gf(r);function r(n,a,s){var p;return(0,vt.Z)(this,r),p=i.call(this,n),(0,C.Z)((0,de.Z)(p),"status",void 0),(0,C.Z)((0,de.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,kt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(oc(Error));function xs(e){var i=new Au;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var yf=function(i,r){var n=xs(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Ea("".concat(n.statusText),n.status,i.url)):r(new Ea(n.statusText,n.status,i.url))},n.send(),n},Mu=function(i,r){var n=xs(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ea(n.statusText,n.status,i.url))},n.send(),n};function Is(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Pu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Vf=function(i,r){return Mu(i,function(n,a){if(n)r(n);else if(a){var s=new na.Image;s.crossOrigin="anonymous";var p=na.URL||na.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var m=new na.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(m):Pu}})},ol=2*Math.PI*6378137/2;function jf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;_f(i,n)}),i}function _f(e,i){return Array.isArray(i[0])?i.forEach(function(r){_f(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function nu(e,i){return As(e,i)}function As(e,i){return Array.isArray(e[0])?e.map(function(r){return As(r,i)}):i(e)}function Ei(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=sl(e,i);var n=e[0],a=e[1],s=n*ol/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*ol/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Iu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/ol*180,s=n/ol*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function iu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Xo(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function sl(e,i){if(i===!1)return e;var r=iu(e[0]),n=Xo(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function as(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var m=.5/Math.PI,y=.5,E=-.5/Math.PI;return a=.5,s=n*(m*s+y),p=n*(E*p+a),[Math.floor(s),Math.floor(p)]}function Vs(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),m=p[0],y=p[1];m=(m/s-r)/i,y=(y/s-a)/n,y=(Math.atan(Math.pow(Math.E,y))-Math.PI/4)*2,a=Math.PI/180;var E=y/a,A=m/a;return[A,E]}function bs(e,i,r){var n=$t(i[1]-e[1]),a=$t(i[0]-e[0]),s=$t(e[1]),p=$t(i[1]),m=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return le(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function pu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,m=n*Math.log((1+s)/(1-s))/2;return[p,m]}function On(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Sn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Nc(e){return[[e[0],e[1]],[e[2],e[3]]]}function os(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function au(e,i){return e[0]*i[0]+e[1]*i[1]}function Fo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ou(e,i){return Math.acos(au(e,i)/(Fo(e)*Fo(i)))*180/Math.PI}function xf(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function bf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],m=e[s+1],y=os(p,m);n+=y;var E=[p[0]-m[0],p[1]-m[1]],A=xf(r,E);if(s>0){var I=a[s-1].rotation;I-A>360-I+A&&(A=A+360)}a.push({start:p,end:m,dis:y,rotation:A,duration:0})}return a.map(function(L){L.duration=i*(L.dis/n)}),a}}var ua=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,vt.Z)(this,e),(0,C.Z)(this,"limit",void 0),(0,C.Z)(this,"cache",void 0),(0,C.Z)(this,"destroy",void 0),(0,C.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,kt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function pa(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Th=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,vt.Z)(this,e),(0,C.Z)(this,"duration",16),(0,C.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,kt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Xu=J(2650);function du(e){return typeof e=="string"?!!Xu.ZP(e):!1}function Xi(e){var i=Xu.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function ro(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Os(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function js(e){var i=na.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],m=0;m<e.colors.length;++m){var y=(e.positions[m]-s)/(p-s);n.addColorStop(y,e.colors[m])}return r.fillStyle=n,r.fillRect(0,0,256,1),a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),Hi?{data:a,width:256,height:1}:new ImageData(a,256,1)}var ul;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(ul||(ul={}));var Ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kl(e,i,r){var n=e.classList;for(var a in Ru)Ru.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function mo(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}function sc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Ll(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Ef(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ll(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ef(e)/e.length}function cl(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var uc={min:Ll,max:sc,mean:ll,sum:Ef,mode:cl};function ku(e,i){return e.map(function(r){return r[i]})}function Gs(e,i){return uc[e](i)}function zc(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){Uc(e,function(m){p(m)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Uc(e,i){var r=e,n=[];if(typeof r=="string")Vf({url:r},function(p,m){n.push(m),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Vf({url:p},function(m,y){s++,n.push(y),s===a&&i(n)})})}return zc}function Gf(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,m={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return m}var lc=J(30236),l=J.n(lc),f=J(47037),c=J.n(f),d=J(23560),b=J.n(d),w=J(50361),P=J.n(w),k=J(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function U(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function m(A){try{E(n.next(A))}catch(I){p(I)}}function y(A){try{E(n.throw(A))}catch(I){p(I)}}function E(A){A.done?s(A.value):a(A.value).then(m,y)}E((n=n.apply(e,i||[])).next())})}function G(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function m(E){return function(A){return y([E,A])}}function y(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=E[0]&2?a.return:E[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,E[1])).done)return s;switch(a=0,s&&(E=[E[0]&2,s.value]),E[0]){case 0:case 1:s=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,a=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!s||E[1]>s[0]&&E[1]<s[3])){r.label=E[1];break}if(E[0]===6&&r.label<s[1]){r.label=s[1],s=E;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(E);break}s[2]&&r.ops.pop(),r.trys.pop();continue}E=i.call(e,r)}catch(A){E=[6,A],a=0}finally{n=s=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function ae(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(m){p={error:m}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function se(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(ae(arguments[i]));return e}function re(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function be(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Te=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});re(Te);var Ze=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});re(Ze);var xe=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof k=="object"&&typeof k.nextTick=="function";function a(m){setTimeout(m,0)}function s(m){return function(y){for(var E=[],A=arguments.length-1;A-- >0;)E[A]=arguments[A+1];return m(function(){return y.apply(void 0,E)})}}var p;r?p=setImmediate:n?p=k.nextTick:p=a,i.default=s(p)});re(xe);var Ve=xe.fallback,qe=xe.wrap,dt=xe.hasSetImmediate,Gt=xe.hasNextTick,Dt=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ze),n=a(xe);function a(y){return y&&y.__esModule?y:{default:y}}function s(y){return(0,zt.isAsync)(y)?function(){for(var E=[],A=arguments.length;A--;)E[A]=arguments[A];var I=E.pop(),L=y.apply(this,E);return p(L,I)}:(0,r.default)(function(E,A){var I;try{I=y.apply(this,E)}catch(L){return A(L)}if(I&&typeof I.then=="function")return p(I,A);A(null,I)})}function p(y,E){return y.then(function(A){m(E,null,A)},function(A){m(E,A&&A.message?A:new Error(A))})}function m(y,E,A){try{y(E,A)}catch(I){(0,n.default)(function(L){throw L},I)}}e.exports=i.default});re(Dt);var zt=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Dt);function n(y){return y&&y.__esModule?y:{default:y}}function a(y){return y[Symbol.toStringTag]==="AsyncFunction"}function s(y){return y[Symbol.toStringTag]==="AsyncGenerator"}function p(y){return typeof y[Symbol.asyncIterator]=="function"}function m(y){if(typeof y!="function")throw new Error("expected a function");return a(y)?(0,r.default)(y):y}i.default=m,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});re(zt);var pr=zt.isAsyncIterable,kr=zt.isAsyncGenerator,Ir=zt.isAsync,Kr=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,m=[],y=arguments.length;y--;)m[y]=arguments[y];return typeof m[a-1]=="function"?n.apply(this,m):new Promise(function(E,A){m[a-1]=function(I){for(var L=[],F=arguments.length-1;F-- >0;)L[F]=arguments[F+1];if(I)return A(I);E(L.length>1?L:L[0])},n.apply(p,m)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});re(Kr);var Dn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Te),n=s(zt),a=s(Kr);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,m,y){var E=(0,r.default)(m)?[]:{};p(m,function(A,I,L){(0,n.default)(A)(function(F){for(var W,$=[],te=arguments.length-1;te-- >0;)$[te]=arguments[te+1];$.length<2&&(W=$,$=W[0]),E[I]=$,L(F)})},function(A){return y(A,E)})},3),e.exports=i.default});re(Dn);var kn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var m=n;n=null,m.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});re(kn);var zn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});re(zn);var Pi=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=y;var r=a(Te),n=a(zn);function a(E){return E&&E.__esModule?E:{default:E}}function s(E){var A=-1,I=E.length;return function(){return++A<I?{value:E[A],key:A}:null}}function p(E){var A=-1;return function(){var L=E.next();return L.done?null:(A++,{value:L.value,key:A})}}function m(E){var A=E?Object.keys(E):[],I=-1,L=A.length;return function(){var W=A[++I];return I<L?{value:E[W],key:W}:null}}function y(E){if((0,r.default)(E))return s(E);var A=(0,n.default)(E);return A?p(A):m(E)}e.exports=i.default});re(Pi);var en=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});re(en);var $n=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});re($n);var ai=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n($n);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,m,y){var E=!1,A=!1,I=!1,L=0,F=0;function W(){L>=p||I||E||(I=!0,s.next().then(function(Ae){var Xe=Ae.value,tt=Ae.done;if(!(A||E)){if(I=!1,tt){E=!0,L<=0&&y(null);return}L++,m(Xe,F,$),F++,W()}}).catch(te))}function $(Ae,Xe){if(L-=1,!A){if(Ae)return te(Ae);if(Ae===!1){E=!0,A=!0;return}if(Xe===r.default||E&&L<=0)return E=!0,y(null);W()}}function te(Ae){A||(I=!1,E=!0,y(Ae))}W()}e.exports=i.default});re(ai);var Qn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=m(kn),n=m(Pi),a=m(en),s=m(ai),p=m($n);function m(y){return y&&y.__esModule?y:{default:y}}i.default=function(y){return function(E,A,I){if(I=(0,r.default)(I),y<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,zt.isAsyncGenerator)(E))return(0,s.default)(E,y,A,I);if((0,zt.isAsyncIterable)(E))return(0,s.default)(E[Symbol.asyncIterator](),y,A,I);var L=(0,n.default)(E),F=!1,W=!1,$=0,te=!1;function Ae(tt,lt){if(!W)if($-=1,tt)F=!0,I(tt);else if(tt===!1)F=!0,W=!0;else{if(lt===p.default||F&&$<=0)return F=!0,I(null);te||Xe()}}function Xe(){for(te=!0;$<y&&!F;){var tt=L();if(tt===null){F=!0,$<=0&&I(null);return}$+=1,A(tt.value,tt.key,(0,a.default)(Ae))}te=!1}Xe()}},e.exports=i.default});re(Qn);var Vn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Qn),n=s(zt),a=s(Kr);function s(m){return m&&m.__esModule?m:{default:m}}function p(m,y,E,A){return(0,r.default)(y)(m,(0,n.default)(E),A)}i.default=(0,a.default)(p,4),e.exports=i.default});re(Vn);var ui=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Vn),n=a(Kr);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m,y){return(0,r.default)(p,1,m,y)}i.default=(0,n.default)(s,3),e.exports=i.default});re(ui);var Wn=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Dn),n=a(ui);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m){return(0,r.default)(n.default,p,m)}e.exports=i.default}),jn=re(Wn),Sa=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,jn(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,se(n.args)),a(null,i)})},e}(),Ua=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=E(Te),n=E($n),a=E(Vn),s=E(kn),p=E(en),m=E(zt),y=E(Kr);function E(F){return F&&F.__esModule?F:{default:F}}function A(F,W,$){$=(0,s.default)($);var te=0,Ae=0,Xe=F.length,tt=!1;Xe===0&&$(null);function lt(Ot,Nt){Ot===!1&&(tt=!0),tt!==!0&&(Ot?$(Ot):(++Ae===Xe||Nt===n.default)&&$(null))}for(;te<Xe;te++)W(F[te],te,(0,p.default)(lt))}function I(F,W,$){return(0,a.default)(F,Infinity,W,$)}function L(F,W,$){var te=(0,r.default)(F)?A:I;return te(F,(0,m.default)(W),$)}i.default=(0,y.default)(L,3),e.exports=i.default});re(Ua);var Bo=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Ua),n=a(Dn);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,m){return(0,n.default)(r.default,p,m)}e.exports=i.default}),No=re(Bo),Xa=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return No(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return U(n,void 0,void 0,function(){return G(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),fo=be(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(kn),n=p(en),a=p(zt),s=p(Kr);function p(y){return y&&y.__esModule?y:{default:y}}function m(y,E){if(E=(0,r.default)(E),!Array.isArray(y))return E(new Error("First argument to waterfall must be an array of functions"));if(!y.length)return E();var A=0;function I(F){var W=(0,a.default)(y[A++]);W.apply(void 0,F.concat([(0,n.default)(L)]))}function L(F){for(var W=[],$=arguments.length-1;$-- >0;)W[$]=arguments[$+1];if(F!==!1){if(F||A===y.length)return E.apply(void 0,[F].concat(W));I(W)}}I([])}i.default=(0,s.default)(m),e.exports=i.default}),Ts=re(fo),ss=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Ts(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),ou=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return jn(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Za=J(26729),su=J.n(Za),Hs=J(69848),Dl=J.n(Hs);function fl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fl(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,m=p===void 0?0:p,y=i.zoom,E=y===void 0?2:y;if(e.pointIndex){var A=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=cc(A),e}var I=new(Dl())({radius:n,minZoom:m,maxZoom:s}),L={type:"FeatureCollection",features:[]};return L.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:vu({},F)}}),I.load(L.features),I}function cc(e){return e.map(function(i,r){return vu({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function uu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Fl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function lu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function _o(e){if(e.length===0)throw new Error("mean requires at least one data point");return lu(e)/e.length}var Lu={min:Fl,max:uu,mean:_o,sum:lu};function Yu(e,i){return e.map(function(r){return r[i]*1})}function Du(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yi(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Du(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Du(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Rs(e){var i=us();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function qu(e,i){if(Array.isArray(i))return i}var Zc=function(e){(0,Fr.Z)(r,e);var i=Rs(r);function r(n,a){var s;return(0,vt.Z)(this,r),s=i.call(this),(0,C.Z)((0,de.Z)(s),"data",void 0),(0,C.Z)((0,de.Z)(s),"extent",void 0),(0,C.Z)((0,de.Z)(s),"hooks",{init:new Sa}),(0,C.Z)((0,de.Z)(s),"parser",{type:"geojson"}),(0,C.Z)((0,de.Z)(s),"transforms",[]),(0,C.Z)((0,de.Z)(s),"cluster",!1),(0,C.Z)((0,de.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,C.Z)((0,de.Z)(s),"mapService",void 0),(0,C.Z)((0,de.Z)(s),"invalidExtent",!1),(0,C.Z)((0,de.Z)(s),"originData",void 0),(0,C.Z)((0,de.Z)(s),"rawData",void 0),(0,C.Z)((0,de.Z)(s),"cfg",{}),(0,C.Z)((0,de.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,kt.Z)(r,[{key:"setData",value:function(a,s){this.rawData=a,this.originData=a,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,m=p.method,y=m===void 0?"sum":m,E=p.field,A=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,A.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||b()(y))&&(A=A.map(function(I){var L=I.id;if(L){var F=s.clusterIndex.getLeaves(L,Infinity),W=F.map(function(Ae){return Ae.properties}),$;if(c()(y)&&E){var te=Yu(W,E);$=Lu[y](te)}b()(y)&&($=y(W)),I.properties.stat=$}else I.properties.point_count=1;return I})),this.data=he("geojson")({type:"FeatureCollection",features:A}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var m=a<this.originData.features.length?this.originData.features[a]:"null",y=P()(m);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(A){return A._id===a});y.properties=E}return y}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(m){return m[a]===name});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=On(Nc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=l()(this.cfg,a,qu);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Yi(Yi({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=he(s);this.data=p(this.originData,a),this.extent=jf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var m=p.type,y=ye(m)(a.data,p);Object.assign(a.data,y)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=hl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Za.EventEmitter);function Vc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function jc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ws(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Ws(e,i){if(!!e){if(typeof e=="string")return Bl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bl(e,i)}}function Bl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ks=6378e3;function pl(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*ks)*(256<<20)/2,p=Gc(r,a),m=p.gridHash,y=p.gridOffset,E=Hf(m,y,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:E}}function Gc(e,i){var r=Infinity,n=-Infinity,a,s=jc(e),p;try{for(s.s();!(p=s.n()).done;){var m=p.value;a=m.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(tt){s.e(tt)}finally{s.f()}var y=(r+n)/2,E=mu(i,y);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var A={},I=jc(e),L;try{for(I.s();!(L=I.n()).done;){var F=L.value,W=F.coordinates[1],$=F.coordinates[0];if(Number.isFinite(W)&&Number.isFinite($)){var te=Math.floor((W+90)/E.yOffset),Ae=Math.floor(($+180)/E.xOffset),Xe="".concat(te,"-").concat(Ae);A[Xe]=A[Xe]||{count:0,points:[]},A[Xe].count+=1,A[Xe].points.push(F)}}}catch(tt){I.e(tt)}finally{I.f()}return{gridHash:A,gridOffset:E}}function mu(e,i){var r=zo(e),n=Hc(i,e);return{yOffset:r,xOffset:n}}function zo(e){return e/ks*(180/Math.PI)}function Hc(e,i){return i/ks*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Hf(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),m=parseInt(p[0],10),y=parseInt(p[1],10),E={};if(r.field&&r.method){var A=ku(e[a].points,r.field);E[r.method]=uc[r.method](A)}return Object.assign(E,{_id:s,coordinates:as([-180+i.xOffset*(y+.5),-90+i.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),n.push(E),n},[])}var Nl=Math.PI/3,Wf=[0,Nl,2*Nl,3*Nl,4*Nl,5*Nl];function rp(e){return e[0]}function np(e){return e[1]}function fc(){var e=0,i=0,r=1,n=1,a=rp,s=np,p,m,y;function E(I){var L={},F=[],W,$=I.length;for(W=0;W<$;++W)if(!(isNaN(Ae=+a.call(null,te=I[W],W,I))||isNaN(Xe=+s.call(null,te,W,I)))){var te,Ae,Xe,tt=Math.round(Xe=Xe/y),lt=Math.round(Ae=Ae/m-(tt&1)/2),Ot=Xe-tt;if(Math.abs(Ot)*3>1){var Nt=Ae-lt,Kt=lt+(Ae<lt?-1:1)/2,fr=tt+(Xe<tt?-1:1),Zr=Ae-Kt,un=Xe-fr;Nt*Nt+Ot*Ot>Zr*Zr+un*un&&(lt=Kt+(tt&1?1:-1)/2,tt=fr)}var _r=lt+"-"+tt,wn=L[_r];wn?wn.push(te):(F.push(wn=L[_r]=[te]),wn.x=(lt+(tt&1)/2)*m,wn.y=tt*y)}return F}function A(I){var L=0,F=0;return Wf.map(function(W){var $=Math.sin(W)*I,te=-Math.cos(W)*I,Ae=$-L,Xe=te-F;return L=$,F=te,[Ae,Xe]})}return E.hexagon=function(I){return"m"+A(I==null?p:+I).join("l")+"z"},E.centers=function(){for(var I=[],L=Math.round(i/y),F=Math.round(e/m),W=L*y;W<n+p;W+=y,++L)for(var $=F*m+(L&1)*m/2;$<r+m/2;$+=m)I.push([$,W]);return I},E.mesh=function(){var I=A(p).slice(0,4).join("l");return E.centers().map(function(L){return"M"+L+"m"+I}).join("")},E.x=function(I){return arguments.length?(a=I,E):a},E.y=function(I){return arguments.length?(s=I,E):s},E.radius=function(I){return arguments.length?(p=+I,m=p*2*Math.sin(Nl),y=p*1.5,E):p},E.size=function(I){return arguments.length?(e=i=0,r=+I[0],n=+I[1],E):[r-e,n-i]},E.extent=function(I){return arguments.length?(e=+I[0][0],i=+I[0][1],r=+I[1][0],n=+I[1][1],E):[[e,i],[r,n]]},E.radius(1)}function Wc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wc(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Gp=6378e3;function zl(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,m=a/(2*Math.PI*Gp)*(256<<20)/2,y=r.map(function(L){var F=as(L.coordinates),W=(0,Tn.Z)(F,2),$=W[0],te=W[1];return Xf(Xf({},L),{},{coordinates:[$,te]})}),E=fc().radius(m).x(function(L){return L.coordinates[0]}).y(function(L){return L.coordinates[1]}),A=E(y),I={dataArray:A.map(function(L,F){var W;if(i.field&&p){var $=ku(L,i.field);L[p]=uc[p]($)}return W={},(0,C.Z)(W,i.method,L[p]),(0,C.Z)(W,"count",L.length),(0,C.Z)(W,"rawData",L),(0,C.Z)(W,"coordinates",[L.x,L.y]),(0,C.Z)(W,"_id",F),W}),radius:m,xOffset:m,yOffset:m,type:"hexagon"};return I}function Xc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ip(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xc(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bd(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var m=p[n];return ip(ip({},p),s[m])}),e}function Sf(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Fe("geojson",Wr),Fe("image",zc),Fe("csv",mn),Fe("json",Ht),Fe("raster",Gf),Je("cluster",hl),Je("filter",Vc),Je("join",bd),Je("map",Sf),Je("grid",pl),Je("hexagon",zl);var ap=xr,Ed=Kn,Sd=Zc,Cd=J(28660),Vr=J(86700),wd=J(84879),Zt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Ad=J(31745),Io=J.n(Ad);function Yf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function op(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yf(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Mh(e,i){if(!!e){if(typeof e=="string")return Cf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cf(e,i)}}function Cf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var hc=30;function Kf(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,m=p===void 0?{}:p,y=e.xOffset,E=y===void 0?0:y,A=e.yOffset,I=A===void 0?0:A,L=0,F=E;Array.from(i).forEach(function($,te){if(!m[$]){var Ae=r($,te);F+hc>s&&(F=0,L++),m[$]={x:F,y:I+L*hc,width:hc,height:hc,advance:Ae},F+=hc}});var W=n+a*2;return{mapping:m,xOffset:F,yOffset:I+L*W,canvasHeight:wf(I+(L+1)*W)}}function pc(e,i,r){var n=0,a=0,s=0,p=[],m={},y=qf(e),E;try{for(y.s();!(E=y.n()).done;){var A=E.value;if(!m[A.id]){var I=A.size;n+I+i>r&&(Yc(m,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:A,xOffset:n}),n=n+I+i,s=Math.max(s,I)}}}catch(F){y.e(F)}finally{y.f()}p.length>0&&Yc(m,p,a);var L=wf(s+a+i);return{mapping:m,canvasHeight:L}}function Yc(e,i,r){var n=qf(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,m=s.xOffset;e[p.id]=op(op({},p),{},{x:m,y:r,image:p.image,width:p.width,height:p.height})}}catch(y){n.e(y)}finally{n.f()}}function wf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var $f,Ul;function Qf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Jf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Jf(e,i){if(!!e){if(typeof e=="string")return eh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eh(e,i)}}function eh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qc(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xs=Td(),th="sans-serif",rh="normal",nh=24,ih=3,Ph=.25,dl=8,vc=1024,Hp=1,ah=1,Wp=3,mv=null;function Td(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function cu(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function sp(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Ih=($f=(0,Vr.b2)(),$f(Ul=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"fontAtlas",void 0),(0,C.Z)(this,"iconFontMap",void 0),(0,C.Z)(this,"iconFontGlyphs",{}),(0,C.Z)(this,"fontOptions",void 0),(0,C.Z)(this,"key",void 0),(0,C.Z)(this,"cache",new ua(Wp))}return(0,kt.Z)(e,[{key:"scale",get:function(){return ah}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:th,fontWeight:rh,characterSet:Xs,fontSize:nh,buffer:ih,sdf:!0,cutoff:Ph,radius:dl,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=dc(dc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,m=s.fontWeight,y=s.fontSize,E=s.buffer,A=s.sdf,I=s.radius,L=s.cutoff,F=s.iconfont,W=a&&a.data;W||(W=na.document.createElement("canvas"),W.width=vc);var $=W.getContext("2d");cu($,p,y,m);var te=Kf(dc({getFontWidth:function(xu){return $.measureText(xu).width},fontHeight:y*ah,buffer:E,characterSet:n,maxCanvasWidth:vc},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ae=te.mapping,Xe=te.canvasHeight,tt=te.xOffset,lt=te.yOffset,Ot=$.getImageData(0,0,W.width,W.height);if(W.height=Xe,$.putImageData(Ot,0,0),cu($,p,y,m),A){var Nt=new(Io())(y,E,I,L,p,m),Kt=$.getImageData(0,0,Nt.size,Nt.size),fr=Qf(n),Zr;try{for(fr.s();!(Zr=fr.n()).done;){var un=Zr.value;if(F){var _r=String.fromCharCode(parseInt(un.replace("&#x","").replace(";",""),16)),wn=Nt.draw(_r);sp(wn,Kt)}else sp(Nt.draw(un),Kt);$.putImageData(Kt,Ae[un].x,Ae[un].y)}}catch(qo){fr.e(qo)}finally{fr.f()}}else{var Ln=Qf(n),ci;try{for(Ln.s();!(ci=Ln.n()).done;){var Qa=ci.value;$.fillText(Qa,Ae[Qa].x,Ae[Qa].y+y*Hp)}}catch(qo){Ln.e(qo)}finally{Ln.f()}}return{xOffset:tt,yOffset:lt,mapping:Ae,data:W,width:W.width,height:W.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,m,y,E}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,m=new Set(Object.keys(p)),y=new Set(n);return y.forEach(function(E){m.has(E)||s.push(E)}),s}}]),e}())||Ul),Kc,Fu;function Xp(e){var i=Md();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Md(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vl=3,$c=1024,Ku=64,mc=(Kc=(0,Vr.b2)(),Kc(Fu=function(e){(0,Fr.Z)(r,e);var i=Xp(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"canvasHeight",128),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"canvas",void 0),(0,C.Z)((0,de.Z)(n),"iconData",void 0),(0,C.Z)((0,de.Z)(n),"iconMap",void 0),(0,C.Z)((0,de.Z)(n),"ctx",void 0),(0,C.Z)((0,de.Z)(n),"loadingImageCount",0),n}return(0,kt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=na.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,m=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Ku}),this.updateIconMap(),this.loadImage(s).then(function(y){m=y;var E=p.iconData.find(function(A){return A.id===a});E&&(E.image=m,E.width=m.width,E.height=m.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var m=this,y=p.getSceneConfig().canvas,E=y.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Ku}),this.updateIconMap(),this.loadImageMini(s,y).then(function(A){E=A;var I=m.iconData.find(function(L){return L.id===a});I&&(I.image=E,I.width=E.width,I.height=E.height),m.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=$c,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],m=p.x,y=p.y,E=p.image,A=p.width,I=A===void 0?64:A,L=p.height,F=L===void 0?64:L,W=Math.max(I,F),$=W/Ku,te=F/$,Ae=I/$;E&&a.ctx.drawImage(E,m+(Ku-Ae)/2,y+(Ku-te)/2,Ae,te)})}},{key:"updateIconMap",value:function(){var a=pc(this.iconData,vl,$c),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var m=new Image;m.crossOrigin="anonymous",m.onload=function(){s(m)},m.onerror=function(){p(new Error("Could not load image at "+a))},m.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,m){var y=s.createImage();y.crossOrigin="anonymous",y.onload=function(){p(y)},y.onerror=function(){m(new Error("Could not load image at "+a))},y.src=a})}}]),r}(Za.EventEmitter))||Fu),La=J(49685);function ml(){var e=new La.WT(16);return La.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Oh(e){var i=new La.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function up(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function la(e,i,r,n,a,s,p,m,y,E,A,I,L,F,W,$){var te=new La.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=p,te[7]=m,te[8]=y,te[9]=E,te[10]=A,te[11]=I,te[12]=L,te[13]=F,te[14]=W,te[15]=$,te}function gc(e,i,r,n,a,s,p,m,y,E,A,I,L,F,W,$,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=m,e[7]=y,e[8]=E,e[9]=A,e[10]=I,e[11]=L,e[12]=F,e[13]=W,e[14]=$,e[15]=te,e}function xo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ys(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],m=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=m}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function oh(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],m=i[5],y=i[6],E=i[7],A=i[8],I=i[9],L=i[10],F=i[11],W=i[12],$=i[13],te=i[14],Ae=i[15],Xe=r*m-n*p,tt=r*y-a*p,lt=r*E-s*p,Ot=n*y-a*m,Nt=n*E-s*m,Kt=a*E-s*y,fr=A*$-I*W,Zr=A*te-L*W,un=A*Ae-F*W,_r=I*te-L*$,wn=I*Ae-F*$,Ln=L*Ae-F*te,ci=Xe*Ln-tt*wn+lt*_r+Ot*un-Nt*Zr+Kt*fr;return ci?(ci=1/ci,e[0]=(m*Ln-y*wn+E*_r)*ci,e[1]=(a*wn-n*Ln-s*_r)*ci,e[2]=($*Kt-te*Nt+Ae*Ot)*ci,e[3]=(L*Nt-I*Kt-F*Ot)*ci,e[4]=(y*un-p*Ln-E*Zr)*ci,e[5]=(r*Ln-a*un+s*Zr)*ci,e[6]=(te*lt-W*Kt-Ae*tt)*ci,e[7]=(A*Kt-L*lt+F*tt)*ci,e[8]=(p*wn-m*un+E*fr)*ci,e[9]=(n*un-r*wn-s*fr)*ci,e[10]=(W*Nt-$*lt+Ae*Xe)*ci,e[11]=(I*lt-A*Nt-F*Xe)*ci,e[12]=(m*Zr-p*_r-y*fr)*ci,e[13]=(r*_r-n*Zr+a*fr)*ci,e[14]=($*tt-W*Ot-te*Xe)*ci,e[15]=(A*Ot-I*tt+L*Xe)*ci,e):null}function Yp(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],m=i[5],y=i[6],E=i[7],A=i[8],I=i[9],L=i[10],F=i[11],W=i[12],$=i[13],te=i[14],Ae=i[15];return e[0]=m*(L*Ae-F*te)-I*(y*Ae-E*te)+$*(y*F-E*L),e[1]=-(n*(L*Ae-F*te)-I*(a*Ae-s*te)+$*(a*F-s*L)),e[2]=n*(y*Ae-E*te)-m*(a*Ae-s*te)+$*(a*E-s*y),e[3]=-(n*(y*F-E*L)-m*(a*F-s*L)+I*(a*E-s*y)),e[4]=-(p*(L*Ae-F*te)-A*(y*Ae-E*te)+W*(y*F-E*L)),e[5]=r*(L*Ae-F*te)-A*(a*Ae-s*te)+W*(a*F-s*L),e[6]=-(r*(y*Ae-E*te)-p*(a*Ae-s*te)+W*(a*E-s*y)),e[7]=r*(y*F-E*L)-p*(a*F-s*L)+A*(a*E-s*y),e[8]=p*(I*Ae-F*$)-A*(m*Ae-E*$)+W*(m*F-E*I),e[9]=-(r*(I*Ae-F*$)-A*(n*Ae-s*$)+W*(n*F-s*I)),e[10]=r*(m*Ae-E*$)-p*(n*Ae-s*$)+W*(n*E-s*m),e[11]=-(r*(m*F-E*I)-p*(n*F-s*I)+A*(n*E-s*m)),e[12]=-(p*(I*te-L*$)-A*(m*te-y*$)+W*(m*L-y*I)),e[13]=r*(I*te-L*$)-A*(n*te-a*$)+W*(n*L-a*I),e[14]=-(r*(m*te-y*$)-p*(n*te-a*$)+W*(n*y-a*m)),e[15]=r*(m*L-y*I)-p*(n*L-a*I)+A*(n*y-a*m),e}function Pd(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],m=e[6],y=e[7],E=e[8],A=e[9],I=e[10],L=e[11],F=e[12],W=e[13],$=e[14],te=e[15],Ae=i*p-r*s,Xe=i*m-n*s,tt=i*y-a*s,lt=r*m-n*p,Ot=r*y-a*p,Nt=n*y-a*m,Kt=E*W-A*F,fr=E*$-I*F,Zr=E*te-L*F,un=A*$-I*W,_r=A*te-L*W,wn=I*te-L*$;return Ae*wn-Xe*_r+tt*un+lt*Zr-Ot*fr+Nt*Kt}function gl(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],m=i[4],y=i[5],E=i[6],A=i[7],I=i[8],L=i[9],F=i[10],W=i[11],$=i[12],te=i[13],Ae=i[14],Xe=i[15],tt=r[0],lt=r[1],Ot=r[2],Nt=r[3];return e[0]=tt*n+lt*m+Ot*I+Nt*$,e[1]=tt*a+lt*y+Ot*L+Nt*te,e[2]=tt*s+lt*E+Ot*F+Nt*Ae,e[3]=tt*p+lt*A+Ot*W+Nt*Xe,tt=r[4],lt=r[5],Ot=r[6],Nt=r[7],e[4]=tt*n+lt*m+Ot*I+Nt*$,e[5]=tt*a+lt*y+Ot*L+Nt*te,e[6]=tt*s+lt*E+Ot*F+Nt*Ae,e[7]=tt*p+lt*A+Ot*W+Nt*Xe,tt=r[8],lt=r[9],Ot=r[10],Nt=r[11],e[8]=tt*n+lt*m+Ot*I+Nt*$,e[9]=tt*a+lt*y+Ot*L+Nt*te,e[10]=tt*s+lt*E+Ot*F+Nt*Ae,e[11]=tt*p+lt*A+Ot*W+Nt*Xe,tt=r[12],lt=r[13],Ot=r[14],Nt=r[15],e[12]=tt*n+lt*m+Ot*I+Nt*$,e[13]=tt*a+lt*y+Ot*L+Nt*te,e[14]=tt*s+lt*E+Ot*F+Nt*Ae,e[15]=tt*p+lt*A+Ot*W+Nt*Xe,e}function sh(e,i,r){var n=r[0],a=r[1],s=r[2],p,m,y,E,A,I,L,F,W,$,te,Ae;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],m=i[1],y=i[2],E=i[3],A=i[4],I=i[5],L=i[6],F=i[7],W=i[8],$=i[9],te=i[10],Ae=i[11],e[0]=p,e[1]=m,e[2]=y,e[3]=E,e[4]=A,e[5]=I,e[6]=L,e[7]=F,e[8]=W,e[9]=$,e[10]=te,e[11]=Ae,e[12]=p*n+A*a+W*s+i[12],e[13]=m*n+I*a+$*s+i[13],e[14]=y*n+L*a+te*s+i[14],e[15]=E*n+F*a+Ae*s+i[15]),e}function Qc(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Id(e,i,r,n){var a=n[0],s=n[1],p=n[2],m=Math.hypot(a,s,p),y,E,A,I,L,F,W,$,te,Ae,Xe,tt,lt,Ot,Nt,Kt,fr,Zr,un,_r,wn,Ln,ci,Qa;return m<La.Ib?null:(m=1/m,a*=m,s*=m,p*=m,y=Math.sin(r),E=Math.cos(r),A=1-E,I=i[0],L=i[1],F=i[2],W=i[3],$=i[4],te=i[5],Ae=i[6],Xe=i[7],tt=i[8],lt=i[9],Ot=i[10],Nt=i[11],Kt=a*a*A+E,fr=s*a*A+p*y,Zr=p*a*A-s*y,un=a*s*A-p*y,_r=s*s*A+E,wn=p*s*A+a*y,Ln=a*p*A+s*y,ci=s*p*A-a*y,Qa=p*p*A+E,e[0]=I*Kt+$*fr+tt*Zr,e[1]=L*Kt+te*fr+lt*Zr,e[2]=F*Kt+Ae*fr+Ot*Zr,e[3]=W*Kt+Xe*fr+Nt*Zr,e[4]=I*un+$*_r+tt*wn,e[5]=L*un+te*_r+lt*wn,e[6]=F*un+Ae*_r+Ot*wn,e[7]=W*un+Xe*_r+Nt*wn,e[8]=I*Ln+$*ci+tt*Qa,e[9]=L*Ln+te*ci+lt*Qa,e[10]=F*Ln+Ae*ci+Ot*Qa,e[11]=W*Ln+Xe*ci+Nt*Qa,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Rh(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],m=i[6],y=i[7],E=i[8],A=i[9],I=i[10],L=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+E*n,e[5]=p*a+A*n,e[6]=m*a+I*n,e[7]=y*a+L*n,e[8]=E*a-s*n,e[9]=A*a-p*n,e[10]=I*a-m*n,e[11]=L*a-y*n,e}function Jc(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],m=i[2],y=i[3],E=i[8],A=i[9],I=i[10],L=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-E*n,e[1]=p*a-A*n,e[2]=m*a-I*n,e[3]=y*a-L*n,e[8]=s*n+E*a,e[9]=p*n+A*a,e[10]=m*n+I*a,e[11]=y*n+L*a,e}function kh(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],m=i[2],y=i[3],E=i[4],A=i[5],I=i[6],L=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+E*n,e[1]=p*a+A*n,e[2]=m*a+I*n,e[3]=y*a+L*n,e[4]=E*a-s*n,e[5]=A*a-p*n,e[6]=I*a-m*n,e[7]=L*a-y*n,e}function lp(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function uh(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ta(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),m,y,E;return p<La.Ib?null:(p=1/p,n*=p,a*=p,s*=p,m=Math.sin(i),y=Math.cos(i),E=1-y,e[0]=n*n*E+y,e[1]=a*n*E+s*m,e[2]=s*n*E-a*m,e[3]=0,e[4]=n*a*E-s*m,e[5]=a*a*E+y,e[6]=s*a*E+n*m,e[7]=0,e[8]=n*s*E+a*m,e[9]=a*s*E-n*m,e[10]=s*s*E+y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function cp(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zl(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Af(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lh(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],m=n+n,y=a+a,E=s+s,A=n*m,I=n*y,L=n*E,F=a*y,W=a*E,$=s*E,te=p*m,Ae=p*y,Xe=p*E;return e[0]=1-(F+$),e[1]=I+Xe,e[2]=L-Ae,e[3]=0,e[4]=I-Xe,e[5]=1-(A+$),e[6]=W+te,e[7]=0,e[8]=L+Ae,e[9]=W-te,e[10]=1-(A+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Od(e,i){var r=new La.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],m=i[4],y=i[5],E=i[6],A=i[7],I=n*n+a*a+s*s+p*p;return I>0?(r[0]=(m*p+A*n+y*s-E*a)*2/I,r[1]=(y*p+A*a+E*n-m*s)*2/I,r[2]=(E*p+A*s+m*a-y*n)*2/I):(r[0]=(m*p+A*n+y*s-E*a)*2,r[1]=(y*p+A*a+E*n-m*s)*2,r[2]=(E*p+A*s+m*a-y*n)*2),Lh(e,i,r),e}function z(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function ue(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],m=i[6],y=i[8],E=i[9],A=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,m),e[2]=Math.hypot(y,E,A),e}function De(e,i){var r=new La.WT(3);ue(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,m=i[1]*a,y=i[2]*s,E=i[4]*n,A=i[5]*a,I=i[6]*s,L=i[8]*n,F=i[9]*a,W=i[10]*s,$=p+A+W,te=0;return $>0?(te=Math.sqrt($+1)*2,e[3]=.25*te,e[0]=(I-F)/te,e[1]=(L-y)/te,e[2]=(m-E)/te):p>A&&p>W?(te=Math.sqrt(1+p-A-W)*2,e[3]=(I-F)/te,e[0]=.25*te,e[1]=(m+E)/te,e[2]=(L+y)/te):A>W?(te=Math.sqrt(1+A-p-W)*2,e[3]=(L-y)/te,e[0]=(m+E)/te,e[1]=.25*te,e[2]=(I+F)/te):(te=Math.sqrt(1+W-p-A)*2,e[3]=(m-E)/te,e[0]=(L+y)/te,e[1]=(I+F)/te,e[2]=.25*te),e}function Mt(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=i[3],y=a+a,E=s+s,A=p+p,I=a*y,L=a*E,F=a*A,W=s*E,$=s*A,te=p*A,Ae=m*y,Xe=m*E,tt=m*A,lt=n[0],Ot=n[1],Nt=n[2];return e[0]=(1-(W+te))*lt,e[1]=(L+tt)*lt,e[2]=(F-Xe)*lt,e[3]=0,e[4]=(L-tt)*Ot,e[5]=(1-(I+te))*Ot,e[6]=($+Ae)*Ot,e[7]=0,e[8]=(F+Xe)*Nt,e[9]=($-Ae)*Nt,e[10]=(1-(I+W))*Nt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function rr(e,i,r,n,a){var s=i[0],p=i[1],m=i[2],y=i[3],E=s+s,A=p+p,I=m+m,L=s*E,F=s*A,W=s*I,$=p*A,te=p*I,Ae=m*I,Xe=y*E,tt=y*A,lt=y*I,Ot=n[0],Nt=n[1],Kt=n[2],fr=a[0],Zr=a[1],un=a[2],_r=(1-($+Ae))*Ot,wn=(F+lt)*Ot,Ln=(W-tt)*Ot,ci=(F-lt)*Nt,Qa=(1-(L+Ae))*Nt,qo=(te+Xe)*Nt,xu=(W+tt)*Kt,el=(te-Xe)*Kt,Uu=(1-(L+$))*Kt;return e[0]=_r,e[1]=wn,e[2]=Ln,e[3]=0,e[4]=ci,e[5]=Qa,e[6]=qo,e[7]=0,e[8]=xu,e[9]=el,e[10]=Uu,e[11]=0,e[12]=r[0]+fr-(_r*fr+ci*Zr+xu*un),e[13]=r[1]+Zr-(wn*fr+Qa*Zr+el*un),e[14]=r[2]+un-(Ln*fr+qo*Zr+Uu*un),e[15]=1,e}function At(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,m=n+n,y=a+a,E=r*p,A=n*p,I=n*m,L=a*p,F=a*m,W=a*y,$=s*p,te=s*m,Ae=s*y;return e[0]=1-I-W,e[1]=A+Ae,e[2]=L-te,e[3]=0,e[4]=A-Ae,e[5]=1-E-W,e[6]=F+$,e[7]=0,e[8]=L+te,e[9]=F-$,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qt(e,i,r,n,a,s,p){var m=1/(r-i),y=1/(a-n),E=1/(s-p);return e[0]=s*2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*y,e[6]=0,e[7]=0,e[8]=(r+i)*m,e[9]=(a+n)*y,e[10]=(p+s)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*E,e[15]=0,e}function sr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var dr=sr;function mr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function Sr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),m=Math.tan(i.rightDegrees*Math.PI/180),y=2/(p+m),E=2/(a+s);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((p-m)*y*.5),e[9]=(a-s)*E*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Cr(e,i,r,n,a,s,p){var m=1/(i-r),y=1/(n-a),E=1/(s-p);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*y,e[14]=(p+s)*E,e[15]=1,e}var Ur=Cr;function vr(e,i,r,n,a,s,p){var m=1/(i-r),y=1/(n-a),E=1/(s-p);return e[0]=-2*m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(i+r)*m,e[13]=(a+n)*y,e[14]=s*E,e[15]=1,e}function br(e,i,r,n){var a,s,p,m,y,E,A,I,L,F,W=i[0],$=i[1],te=i[2],Ae=n[0],Xe=n[1],tt=n[2],lt=r[0],Ot=r[1],Nt=r[2];return Math.abs(W-lt)<La.Ib&&Math.abs($-Ot)<La.Ib&&Math.abs(te-Nt)<La.Ib?xo(e):(A=W-lt,I=$-Ot,L=te-Nt,F=1/Math.hypot(A,I,L),A*=F,I*=F,L*=F,a=Xe*L-tt*I,s=tt*A-Ae*L,p=Ae*I-Xe*A,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),m=I*p-L*s,y=L*a-A*p,E=A*s-I*a,F=Math.hypot(m,y,E),F?(F=1/F,m*=F,y*=F,E*=F):(m=0,y=0,E=0),e[0]=a,e[1]=m,e[2]=A,e[3]=0,e[4]=s,e[5]=y,e[6]=I,e[7]=0,e[8]=p,e[9]=E,e[10]=L,e[11]=0,e[12]=-(a*W+s*$+p*te),e[13]=-(m*W+y*$+E*te),e[14]=-(A*W+I*$+L*te),e[15]=1,e)}function rt(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=n[0],y=n[1],E=n[2],A=a-r[0],I=s-r[1],L=p-r[2],F=A*A+I*I+L*L;F>0&&(F=1/Math.sqrt(F),A*=F,I*=F,L*=F);var W=y*L-E*I,$=E*A-m*L,te=m*I-y*A;return F=W*W+$*$+te*te,F>0&&(F=1/Math.sqrt(F),W*=F,$*=F,te*=F),e[0]=W,e[1]=$,e[2]=te,e[3]=0,e[4]=I*te-L*$,e[5]=L*W-A*te,e[6]=A*$-I*W,e[7]=0,e[8]=A,e[9]=I,e[10]=L,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function Ut(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function gr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Dr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function or(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Mr(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function $r(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function Bn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Wt(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],m=e[5],y=e[6],E=e[7],A=e[8],I=e[9],L=e[10],F=e[11],W=e[12],$=e[13],te=e[14],Ae=e[15],Xe=i[0],tt=i[1],lt=i[2],Ot=i[3],Nt=i[4],Kt=i[5],fr=i[6],Zr=i[7],un=i[8],_r=i[9],wn=i[10],Ln=i[11],ci=i[12],Qa=i[13],qo=i[14],xu=i[15];return Math.abs(r-Xe)<=La.Ib*Math.max(1,Math.abs(r),Math.abs(Xe))&&Math.abs(n-tt)<=La.Ib*Math.max(1,Math.abs(n),Math.abs(tt))&&Math.abs(a-lt)<=La.Ib*Math.max(1,Math.abs(a),Math.abs(lt))&&Math.abs(s-Ot)<=La.Ib*Math.max(1,Math.abs(s),Math.abs(Ot))&&Math.abs(p-Nt)<=La.Ib*Math.max(1,Math.abs(p),Math.abs(Nt))&&Math.abs(m-Kt)<=La.Ib*Math.max(1,Math.abs(m),Math.abs(Kt))&&Math.abs(y-fr)<=La.Ib*Math.max(1,Math.abs(y),Math.abs(fr))&&Math.abs(E-Zr)<=La.Ib*Math.max(1,Math.abs(E),Math.abs(Zr))&&Math.abs(A-un)<=La.Ib*Math.max(1,Math.abs(A),Math.abs(un))&&Math.abs(I-_r)<=La.Ib*Math.max(1,Math.abs(I),Math.abs(_r))&&Math.abs(L-wn)<=La.Ib*Math.max(1,Math.abs(L),Math.abs(wn))&&Math.abs(F-Ln)<=La.Ib*Math.max(1,Math.abs(F),Math.abs(Ln))&&Math.abs(W-ci)<=La.Ib*Math.max(1,Math.abs(W),Math.abs(ci))&&Math.abs($-Qa)<=La.Ib*Math.max(1,Math.abs($),Math.abs(Qa))&&Math.abs(te-qo)<=La.Ib*Math.max(1,Math.abs(te),Math.abs(qo))&&Math.abs(Ae-xu)<=La.Ib*Math.max(1,Math.abs(Ae),Math.abs(xu))}var Qt=gl,yn=or,jr,yr,Yr=(jr=(0,Vr.b2)(),jr(yr=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"overridedViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredProjectionMatrix",void 0),(0,C.Z)(this,"viewMatrixInverse",void 0),(0,C.Z)(this,"cameraPosition",void 0)}return(0,kt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=ml(),oh(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Tn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=lp(ml(),[r,n,0]);this.jitteredProjectionMatrix=gl(ml(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=gl(ml(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||yr),qr,pi;function ti(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Xr(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Xr(e,i){if(!!e){if(typeof e=="string")return tn(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tn(e,i)}}function tn(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Xn=(qr=(0,Vr.b2)(),qr(pi=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"controlCorners",void 0),(0,C.Z)(this,"controlContainer",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"controls",[]),(0,C.Z)(this,"unAddControls",[])}return(0,kt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Zt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Zt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=ti(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Na("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=p.map(function(y){return n+y}).join(" ");r[p.join("")]=Na("div",m,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ic(this.controlCorners[r]);this.controlContainer&&ic(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||pi),oi,Ri,no=(oi=(0,Vr.b2)(),oi(Ri=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"markers",[]),(0,C.Z)(this,"markerLayers",[]),(0,C.Z)(this,"unAddMarkers",[]),(0,C.Z)(this,"unAddMarkerLayers",[])}return(0,kt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Zt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Ri),io,Ii,Qo=(io=(0,Vr.b2)(),io(Ii=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"popup",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"unAddPopup",void 0)}return(0,kt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Zt.IMapService)}}]),e}())||Ii),Va=J(82492),Uo=J.n(Va),bo={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Yo=bo,Oo,Jo;function ao(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function li(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ao(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ao(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zo={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},qi={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},es=(Oo=(0,Vr.b2)(),Oo(Jo=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"sceneConfigCache",{}),(0,C.Z)(this,"layerConfigCache",{})}return(0,kt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Yo[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=li(li({},Zo),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=li({},Uo()({},this.sceneConfigCache[r],qi,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Jo);function Or(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function rn(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,m){return m(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function ia(){var e=new La.WT(4);return La.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Ro(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function yl(e,i,r,n){var a=new La.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Ce(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Ft(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function gt(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function pn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ni(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function _e(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function ie(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function ze(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function nt(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function St(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function We(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Le(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Qe(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function pe(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function Ne(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function Ee(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function it(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function yt(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function lr(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Br(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function Nr(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function an(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],m=r[1]*n[2]-r[2]*n[1],y=r[1]*n[3]-r[3]*n[1],E=r[2]*n[3]-r[3]*n[2],A=i[0],I=i[1],L=i[2],F=i[3];return e[0]=I*E-L*y+F*m,e[1]=-(A*E)+L*p-F*s,e[2]=A*y-I*p+F*a,e[3]=-(A*m)+I*s-L*a,e}function Rr(e,i,r,n){var a=i[0],s=i[1],p=i[2],m=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=m+n*(r[3]-m),e}function Cn(e,i){i=i||1;var r,n,a,s,p,m;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,m=a*a+s*s;while(m>=1);var y=Math.sqrt((1-p)/m);return e[0]=i*r,e[1]=i*n,e[2]=i*a*y,e[3]=i*s*y,e}function on(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function bn(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],m=r[1],y=r[2],E=r[3],A=E*n+m*s-y*a,I=E*a+y*n-p*s,L=E*s+p*a-m*n,F=-p*n-m*a-y*s;return e[0]=A*E+F*-p+I*-y-L*-m,e[1]=I*E+F*-m+L*-p-A*-y,e[2]=L*E+F*-y+A*-m-I*-p,e[3]=i[3],e}function _n(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function dn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Yn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function xa(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],m=i[1],y=i[2],E=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))}var ls=null,za=null,da=null,Vl=null,Ls=null,_l=null,Bu=null,qp=function(){var e=ia();return function(i,r,n,a,s,p){var m,y;for(r||(r=4),n||(n=0),a?y=Math.min(a*r+n,i.length):y=i.length,m=n;m<y;m+=r)e[0]=i[m],e[1]=i[m+1],e[2]=i[m+2],e[3]=i[m+3],s(e,e,p),i[m]=e[0],i[m+1]=e[1],i[m+2]=e[2],i[m+3]=e[3];return i}}(),qs=Math.PI/180,yc=512,Tf=4003e4;function Rd(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,m=p===void 0?!1:p,y=e.flipY,E=y===void 0?!1:y;s=s!==void 0?s:Math.pow(2,a);var A={},I=yc*s,L=Math.cos(r*qs),F=I/360,W=F/L,$=I/Tf/L;if(A.pixelsPerMeter=[$,-$,$],A.metersPerPixel=[1/$,-1/$,1/$],A.pixelsPerDegree=[F,-W,$],A.degreesPerPixel=[1/F,-1/W,1/$],m){var te=qs*Math.tan(r*qs)/L,Ae=F*te/2,Xe=I/Tf*te,tt=Xe/W*$;A.pixelsPerDegree2=[0,-Ae,Xe],A.pixelsPerMeter2=[tt,0,tt],E&&(A.pixelsPerDegree2[1]=-A.pixelsPerDegree2[1],A.pixelsPerMeter2[1]=-A.pixelsPerMeter2[1])}return E&&(A.pixelsPerMeter[1]=-A.pixelsPerMeter[1],A.metersPerPixel[1]=-A.metersPerPixel[1],A.pixelsPerDegree[1]=-A.pixelsPerDegree[1],A.degreesPerPixel[1]=-A.degreesPerPixel[1]),A}var Ya;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Ya||(Ya={}));var jl={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},_c,fp,hp,pp,lh,ef=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],gv=(_c=(0,Vr.b2)(),fp=(0,Vr.f3)(Zt.ICameraService),_c(hp=(pp=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"needRefresh",!0),Or(this,"cameraService",lh,this),(0,C.Z)(this,"coordinateSystem",void 0),(0,C.Z)(this,"viewportCenter",void 0),(0,C.Z)(this,"viewportCenterProjection",void 0),(0,C.Z)(this,"pixelsPerDegree",void 0),(0,C.Z)(this,"pixelsPerDegree2",void 0),(0,C.Z)(this,"pixelsPerMeter",void 0)}return(0,kt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Rd({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,m=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=m,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ya.LNGLAT||this.coordinateSystem===Ya.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ya.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Ya.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=Rd({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),m=p.pixelsPerMeter,y=p.pixelsPerDegree,E=p.pixelsPerDegree2,A=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),L=gl([],I,A),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=on([],[F[0],F[1],0,1],L),A=this.cameraService.getViewMatrixUncentered()||A,L=gl([],I,A),L=gl([],L,ef),this.cameraService.setViewProjectionMatrix(L),this.pixelsPerMeter=m,this.pixelsPerDegree=y,this.pixelsPerDegree2=E}}]),e}(),lh=rn(pp.prototype,"cameraService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp))||hp),yv=J(20396),dp=J.n(yv),ma;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ma||(ma={}));var tf,kd,t,o,u;function h(e){var i=g();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function g(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},S=(tf=(0,Vr.b2)(),kd=(0,Vr.f3)(Zt.IMapService),tf(t=(o=function(e){(0,Fr.Z)(r,e);var i=h(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Or((0,de.Z)(n),"mapService",u,(0,de.Z)(n)),(0,C.Z)((0,de.Z)(n),"hammertime",void 0),(0,C.Z)((0,de.Z)(n),"lastClickTime",0),(0,C.Z)((0,de.Z)(n),"lastClickXY",[-1,-1]),(0,C.Z)((0,de.Z)(n),"clickTimer",void 0),(0,C.Z)((0,de.Z)(n),"$containter",void 0),(0,C.Z)((0,de.Z)(n),"onDrag",function(m){var y=n.interactionEvent(m);y.type=x[y.type],n.emit(ma.Drag,y)}),(0,C.Z)((0,de.Z)(n),"onHammer",function(m){m.srcEvent.stopPropagation();var y=n.interactionEvent(m);n.emit(ma.Hover,y)}),(0,C.Z)((0,de.Z)(n),"onTouch",function(m){var y=m.touches[0];n.onHover({x:y.pageX,y:y.pageY,type:"touch"})}),(0,C.Z)((0,de.Z)(n),"onHover",function(m){var y=m.clientX,E=m.clientY,A=y,I=E,L=m.type,F=n.mapService.getMapContainer();if(F)if(Hi)A=A-F.left-0,I=I-F.top-0;else{var W=F.getBoundingClientRect(),$=W.top,te=W.left;A=A-te-F.clientLeft,I=I-$-F.clientTop}var Ae=n.mapService.containerToLngLat([A,I]);if(L==="click"){if(!Hi&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(A,I,Ae);return}if(L==="touch"){n.isDoubleTap(A,I,Ae);return}L!=="click"&&L!=="dblclick"&&n.emit(ma.Hover,{x:A,y:I,lngLat:Ae,type:L,target:m})}),n}return(0,kt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ma.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(ma.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(ma.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(ma.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Hi)na.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(dp()).Manager(a);s.add(new(dp()).Tap({event:"dblclick",taps:2})),s.add(new(dp()).Tap({event:"click"})),s.add(new(dp()).Pan({threshold:0,pointers:0})),s.add(new(dp()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Hi)na.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,m,y;p==="touch"?(y=Math.floor(a.pointers[0].clientY),m=Math.floor(a.pointers[0].clientX)):(y=Math.floor(a.srcEvent.y),m=Math.floor(a.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var A=E.getBoundingClientRect(),I=A.top,L=A.left;m-=L,y-=I}var F=this.mapService.containerToLngLat([m,y]);return{x:m,y,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var m=this,y=new Date().getTime(),E="click";y-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(ma.Hover,{x:a,y:s,lngLat:p,type:E})):(this.lastClickTime=y,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){E="click",m.emit(ma.Hover,{x:a,y:s,lngLat:p,type:E})},400))}}]),r}(su()),u=rn(o.prototype,"mapService",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o))||t),M=J(92137),D=J(87757),B=J.n(D),Z=0;function j(e){if(Hi)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Z++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function K(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var O;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(O||(O={}));var we,Pe,Ge,Be,et,mt,Pt,Vt,nr,wr,Gr;function Fn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fn(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Un=(we=(0,Vr.b2)(),Pe=(0,Vr.f3)(Zt.IRendererService),Ge=(0,Vr.f3)(Zt.IGlobalConfigService),Be=(0,Vr.f3)(Zt.IInteractionService),et=(0,Vr.f3)(Zt.ILayerService),we(mt=(Pt=function(){function e(){var i=this;(0,vt.Z)(this,e),Or(this,"rendererService",Vt,this),Or(this,"configService",nr,this),Or(this,"interactionService",wr,this),Or(this,"layerService",Gr,this),(0,C.Z)(this,"pickingFBO",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0),(0,C.Z)(this,"alreadyInPicking",!1),(0,C.Z)(this,"pickBufferScale",1),(0,C.Z)(this,"lastPickTime",new Date().getTime()),(0,C.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,m=n.lngLat,y=n.type,E=n.target,A=!1,I=i.rendererService,L=I.getViewportSize,F=I.readPixels,W=I.getContainer,$=i.getContainerSize(W()),te=$.width,Ae=$.height;te*=ka,Ae*=ka;var Xe=r.getLayerConfig(),tt=Xe.enableHighlight,lt=Xe.enableSelect,Ot=s*ka,Nt=p*ka;if(Ot>te-1*ka||Ot<0||Nt>Ae-1*ka||Nt<0)return!1;var Kt;if(Kt=F({x:Math.floor(Ot/i.pickBufferScale),y:Math.floor((Ae-(p+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Kt[0]!==0||Kt[1]!==0||Kt[2]!==0){var fr=ro(Kt),Zr=r.getSource().getFeatureById(fr);fr!==r.getCurrentPickId()&&y==="mousemove"&&(y="mouseenter");var un={x:s,y:p,type:y,lngLat:m,featureId:fr,feature:Zr,target:E};Zr&&(A=!0,r.setCurrentPickId(fr),i.triggerHoverOnLayer(r,un))}else{var _r={x:s,y:p,lngLat:m,type:r.getCurrentPickId()!==null&&y==="mousemove"?"mouseout":"un"+y,featureId:null,target:E,feature:null};i.triggerHoverOnLayer(r,sn(sn({},_r),{},{type:"unpick"})),i.triggerHoverOnLayer(r,_r),r.setCurrentPickId(null)}if(tt&&i.highlightPickedFeature(r,Kt),lt&&y==="click"&&((a=Kt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var wn=ro(Kt);r.getCurrentSelectedId()===null||wn!==r.getCurrentSelectedId()?(i.selectFeature(r,Kt),r.setCurrentSelectedId(wn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return A})}return(0,kt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,m=n.getContainer,y=this.getContainerSize(m()),E=y.width,A=y.height;E*=ka,A*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(E/this.pickBufferScale),height:Math.round(A/this.pickBufferScale),wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.interactionService.on(ma.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,M.Z)(B().mark(function n(a,s,p){var m=this,y,E,A,I;return B().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:y=this.rendererService,E=y.useFramebuffer,A=y.clear,I=y.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){A({framebuffer:m.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var W=m.pickBox(a,s);p(W)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(_r){var wn=_r<0?0:_r;return Math.floor(wn*ka/a.pickBufferScale)}),p=(0,Tn.Z)(s,4),m=p[0],y=p[1],E=p[2],A=p[3],I=this.rendererService,L=I.getViewportSize,F=I.readPixels,W=I.getContainer,$=this.getContainerSize(W()),te=$.width,Ae=$.height;if(te*=ka,Ae*=ka,m>(te-1)*ka/this.pickBufferScale||E<0||y>(Ae-1)*ka/this.pickBufferScale||A<0)return[];var Xe,tt=Math.min(te/this.pickBufferScale,E)-m,lt=Math.min(Ae/this.pickBufferScale,A)-y;Xe=F({x:m,y:Math.floor(Ae/this.pickBufferScale-(A+1)),width:tt,height:lt,data:new Uint8Array(tt*lt*4),framebuffer:this.pickingFBO});for(var Ot=[],Nt={},Kt=0;Kt<Xe.length/4;Kt=Kt+1){var fr=Xe.slice(Kt*4,Kt*4+4),Zr=ro(fr);if(Zr!==-1&&!Nt[Zr]){var un=r.getSource().getFeatureById(Zr);Ot.push(sn(sn({},un),{},{pickedFeatureIdx:Zr})),Nt[Zr]=!0}}return Ot}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,M.Z)(B().mark(function n(a){var s;return B().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){m.next=2;break}return m.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){m.next=7;break}return m.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,M.Z)(B().mark(function n(a){var s=this,p,m,y,E,A;return B().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:p=this.rendererService,m=p.getViewportSize,y=p.useFramebuffer,E=p.clear,A=p.getContainer,this.resizePickingFBO(),y(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(W){return W.needPick(a.type)}).reverse().some(function(W){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),W.hooks.beforePickingEncode.call(),W.renderModels(!0),W.hooks.afterPickingEncode.call();var $=s.pickFromPickingFBO(W,a);return $&&!W.getLayerConfig().enablePropagation})});case 3:case"end":return L.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){K(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,Tn.Z)(n,3),s=a[0],p=a[1],m=a[2];r.hooks.beforeHighlight.call([s,p,m])}},{key:"selectFeature",value:function(r,n){var a=(0,Tn.Z)(n,3),s=a[0],p=a[1],m=a[2];r.hooks.beforeSelect.call([s,p,m])}}]),e}(),Vt=rn(Pt.prototype,"rendererService",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nr=rn(Pt.prototype,"configService",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wr=rn(Pt.prototype,"interactionService",[Be],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gr=rn(Pt.prototype,"layerService",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt))||mt),fn=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,vt.Z)(this,e),(0,C.Z)(this,"autoStart",void 0),(0,C.Z)(this,"startTime",0),(0,C.Z)(this,"oldTime",0),(0,C.Z)(this,"running",!1),(0,C.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,kt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Ai,Jn,Pn,ki,xi,zi,Zn,aa,qa;function Eo(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=go(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function go(e,i){if(!!e){if(typeof e=="string")return Ka(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ka(e,i)}}function Ka(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var So=(Ai=(0,Vr.b2)(),Jn=(0,Vr.f3)(Zt.IRendererService),Pn=(0,Vr.f3)(Zt.IMapService),ki=(0,Vr.f3)(Zt.IGlobalConfigService),Ai(xi=(zi=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"clock",new fn),(0,C.Z)(this,"alreadyInRendering",!1),(0,C.Z)(this,"layers",[]),(0,C.Z)(this,"layerList",[]),(0,C.Z)(this,"layerRenderID",void 0),(0,C.Z)(this,"sceneInited",!1),(0,C.Z)(this,"animateInstanceCount",0),(0,C.Z)(this,"shaderPicking",!0),(0,C.Z)(this,"enableRender",!0),Or(this,"renderService",Zn,this),Or(this,"mapService",aa,this),Or(this,"configService",qa,this)}return(0,kt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,M.Z)(B().mark(function n(){var a,s,p;return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){y.next=2;break}return y.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Eo(this.layerList),y.prev=5,a.s();case 7:if((s=a.n()).done){y.next=20;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.getLayerConfig().enableMultiPassRenderer){y.next=16;break}return y.next=14,p.renderMultiPass();case 14:y.next=17;break;case 16:p.render();case 17:p.hooks.afterRender.call();case 18:y.next=7;break;case 20:y.next=25;break;case 22:y.prev=22,y.t0=y.catch(5),a.e(y.t0);case 25:return y.prev=25,a.f(),y.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return y.stop()}},n,this,[[5,22,25,28]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).forEach(function(a){r.layerList.push(a)})}),this.layerList.sort(function(n,a){return n.zIndex-a.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=na.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=Xi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){na.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Zn=rn(zi.prototype,"renderService",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa=rn(zi.prototype,"mapService",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa=rn(zi.prototype,"configService",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi))||xi),Co=J(81253),ts=J(14293),wo=J.n(ts),cs=function(){function e(i){var r=this;(0,vt.Z)(this,e),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"scale",void 0),(0,C.Z)(this,"descriptor",void 0),(0,C.Z)(this,"featureBufferLayout",[]),(0,C.Z)(this,"needRescale",!1),(0,C.Z)(this,"needRemapping",!1),(0,C.Z)(this,"needRegenerateVertices",!1),(0,C.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,C.Z)(this,"vertexAttribute",void 0),(0,C.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var m,y=(m=r.scale)===null||m===void 0?void 0:m.scalers[p].func,E=y(s);return E})}),this.setProps(i)}return(0,kt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Se.Z)(r));if(!wo()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ds=["buffer","update","name"],oo,rs,Ui,Ma,ga,Ki;function Fs(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fs(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fs(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fs(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function so(e){return new Promise(function(i){return setTimeout(i,e)})}var Vo=(oo={},(0,C.Z)(oo,O.FLOAT,4),(0,C.Z)(oo,O.UNSIGNED_BYTE,1),(0,C.Z)(oo,O.UNSIGNED_SHORT,2),oo),Ms=(rs=(0,Vr.b2)(),Ui=(0,Vr.f3)(Zt.IRendererService),rs(Ma=(ga=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"attributesAndIndices",void 0),Or(this,"rendererService",Ki,this),(0,C.Z)(this,"attributes",[]),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,kt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new cs(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(fs(fs({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(lt){return lt.name===r});if(p&&p.descriptor){var m=p.descriptor,y=m.update,E=m.buffer,A=m.size,I=A===void 0?0:A,L=Vo[E.type||O.FLOAT];if(y){var F=this.featureLayout,W=F.elements,$=F.sizePerElement,te=W.slice(a,s);if(!te.length)return;var Ae=te[0].offset,Xe=Ae*I*L,tt=te.map(function(lt,Ot){for(var Nt=lt.featureIdx,Kt=lt.vertices,fr=lt.normals,Zr=Kt.length/$,un=[],_r=0;_r<Zr;_r++){var wn=fr?fr.slice(_r*3,_r*3+3):[];un.push.apply(un,(0,Se.Z)(y(n[Nt],Nt,Kt.slice(_r*$,_r*$+$),Ot,wn)))}return un}).reduce(function(lt,Ot){return lt.push.apply(lt,(0,Se.Z)(Ot)),lt},[]);p.vertexAttribute.updateBuffer({data:tt,offset:Xe})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(Xe){return Xe.resetDescriptor(),Xe.descriptor}),m=0,y=[],E=[],A=[],I=3;r.forEach(function(Xe,tt){var lt=s.triangulation(Xe,a),Ot=lt.indices,Nt=lt.vertices,Kt=lt.normals,fr=lt.size;Ot.forEach(function(wn){E.push(wn+m)}),I=fr;var Zr=Nt.length/fr;s.featureLayout.sizePerElement=I,s.featureLayout.elements.push({featureIdx:tt,vertices:Nt,normals:Kt,offset:m}),m+=Zr;for(var un=function(Ln){var ci=(Kt==null?void 0:Kt.slice(Ln*3,Ln*3+3))||[],Qa=Nt.slice(Ln*fr,Ln*fr+fr);p.forEach(function(qo,xu){if(qo&&qo.update){var el;(el=qo.buffer.data).push.apply(el,(0,Se.Z)(qo.update(Xe,tt,Qa,Ln,ci)))}})},_r=0;_r<Zr;_r++)un(_r)});var L=this.rendererService,F=L.createAttribute,W=L.createBuffer,$=L.createElements,te={};p.forEach(function(Xe,tt){if(Xe){var lt=Xe.buffer,Ot=Xe.update,Nt=Xe.name,Kt=(0,Co.Z)(Xe,Ds),fr=F(fs({buffer:W(lt)},Kt));te[Xe.name||""]=fr,s.attributes[tt].vertexAttribute=fr}});var Ae=$({data:E,type:O.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:te,elements:Ae},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ki=rn(ga.prototype,"rendererService",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga))||Ma),oa=J(67709),xc=J.n(oa),gu,Gl,Ao,Hl,$u,ch,Mf,fh,bc,hh,vp,ph,Dh,mp,gp,Ec,Fh,ns,rf,dh,yp,_p,Bh,Nh,xp,zh,Uh,Zh,bp,vh,Ep,mh,Vh;function gh(e){var i=Sp();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jh=(gu=(0,Vr.b2)(),Gl=(0,Vr.f3)(Zt.SceneID),Ao=(0,Vr.f3)(Zt.IIconService),Hl=(0,Vr.f3)(Zt.IFontService),$u=(0,Vr.f3)(Zt.IControlService),ch=(0,Vr.f3)(Zt.IGlobalConfigService),Mf=(0,Vr.f3)(Zt.IMapService),fh=(0,Vr.f3)(Zt.ICoordinateSystemService),bc=(0,Vr.f3)(Zt.IRendererService),hh=(0,Vr.f3)(Zt.ILayerService),vp=(0,Vr.f3)(Zt.ICameraService),ph=(0,Vr.f3)(Zt.IInteractionService),Dh=(0,Vr.f3)(Zt.IPickingService),mp=(0,Vr.f3)(Zt.IShaderModuleService),gp=(0,Vr.f3)(Zt.IMarkerService),Ec=(0,Vr.f3)(Zt.IPopupService),gu(Fh=(ns=function(e){(0,Fr.Z)(r,e);var i=gh(r);function r(){var n;return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"destroyed",!1),(0,C.Z)((0,de.Z)(n),"loaded",!1),(0,C.Z)((0,de.Z)(n),"loadFont",!1),(0,C.Z)((0,de.Z)(n),"fontFamily",""),Or((0,de.Z)(n),"id",rf,(0,de.Z)(n)),Or((0,de.Z)(n),"iconService",dh,(0,de.Z)(n)),Or((0,de.Z)(n),"fontService",yp,(0,de.Z)(n)),Or((0,de.Z)(n),"controlService",_p,(0,de.Z)(n)),Or((0,de.Z)(n),"configService",Bh,(0,de.Z)(n)),Or((0,de.Z)(n),"map",Nh,(0,de.Z)(n)),Or((0,de.Z)(n),"coordinateSystemService",xp,(0,de.Z)(n)),Or((0,de.Z)(n),"rendererService",zh,(0,de.Z)(n)),Or((0,de.Z)(n),"layerService",Uh,(0,de.Z)(n)),Or((0,de.Z)(n),"cameraService",Zh,(0,de.Z)(n)),Or((0,de.Z)(n),"interactionService",bp,(0,de.Z)(n)),Or((0,de.Z)(n),"pickingService",vh,(0,de.Z)(n)),Or((0,de.Z)(n),"shaderModuleService",Ep,(0,de.Z)(n)),Or((0,de.Z)(n),"markerService",mh,(0,de.Z)(n)),Or((0,de.Z)(n),"popupService",Vh,(0,de.Z)(n)),(0,C.Z)((0,de.Z)(n),"inited",!1),(0,C.Z)((0,de.Z)(n),"initPromise",void 0),(0,C.Z)((0,de.Z)(n),"rendering",!1),(0,C.Z)((0,de.Z)(n),"$container",void 0),(0,C.Z)((0,de.Z)(n),"canvas",void 0),(0,C.Z)((0,de.Z)(n),"markerContainer",void 0),(0,C.Z)((0,de.Z)(n),"hooks",void 0),(0,C.Z)((0,de.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),hn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,C.Z)((0,de.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new Xa},n}return(0,kt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,M.Z)(B().mark(function p(){return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(E){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&E()}),s.map.version!=="GAODE2.x"?s.map.init():E()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){y.next=6;break}return y.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(ma.Drag,s.addSceneEvent.bind(s));case 13:case"end":return y.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,M.Z)(B().mark(function p(){var m,y;return B().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(m=j(s.configService.getSceneConfig(s.id).id||""),s.$container=m,!m){A.next=11;break}return s.canvas=Na("canvas","",m),s.setCanvas(),A.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:xc()(s.$container,s.handleWindowResized),na.matchMedia&&((y=na.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||y===void 0||y.addListener(s.handleWindowResized)),A.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return A.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,M.Z)(B().mark(function p(){return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,new Promise(function(E){s.map.onCameraChanged(function(A){s.cameraService.init(),s.cameraService.update(A),s.map.version!=="GAODE2.x"&&E()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(ma.Drag,s.addSceneEvent.bind(s));case 5:case"end":return y.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,M.Z)(B().mark(function p(){var m;return B().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(m=a.canvas,s.$container=m||null,!s.$container){E.next=7;break}return E.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return E.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"render",value:function(){var n=(0,M.Z)(B().mark(function s(){return B().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.rendering||this.destroyed)){m.next=2;break}return m.abrupt("return");case 2:if(this.rendering=!0,this.inited){m.next=15;break}return m.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){m.next=10;break}return m.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return m.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var m=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return m}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Na("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,oa.unbind)(this.$container,this.handleWindowResized),na.matchMedia){var m;(m=na.matchMedia("screen and (min-resolution: 2dppx)"))===null||m===void 0||m.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=ka,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E&&(E.width=m*p,E.height=y*p),this.rendererService.viewport({x:0,y:0,width:p*m,height:p*y})}},{key:"setCanvas",value:function(){var a,s,p=ka,m=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,y=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E.width=m*p,E.height=y*p,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Za.EventEmitter),rf=rn(ns.prototype,"id",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dh=rn(ns.prototype,"iconService",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=rn(ns.prototype,"fontService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=rn(ns.prototype,"controlService",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bh=rn(ns.prototype,"configService",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=rn(ns.prototype,"map",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=rn(ns.prototype,"coordinateSystemService",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=rn(ns.prototype,"rendererService",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=rn(ns.prototype,"layerService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zh=rn(ns.prototype,"cameraService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=rn(ns.prototype,"interactionService",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=rn(ns.prototype,"pickingService",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ep=rn(ns.prototype,"shaderModuleService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=rn(ns.prototype,"markerService",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vh=rn(ns.prototype,"popupService",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ns))||Fh),Ld=J(44908),Dd=J.n(Ld);function Fd(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var _v=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Kp(e){var i={};return e=e.replace(_v,function(r,n,a){var s=a.split(":"),p=s[0].trim(),m="";switch(s.length>1&&(m=s[1].trim()),n){case"bool":m=m==="true";break;case"float":case"int":m=Number(m);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":m?m=m.replace("[","").replace("]","").split(",").reduce(function(y,E){return y.push(Number(E.trim())),y},[]):m=new Array(Fd(n)).fill(0);break;default:}return i[p]=m,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var xv,Gh;function To(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?To(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):To(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var bv="#define PI 3.14159265359",Pf=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Bd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ev=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,$p=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float selected = v_PickingResult.a;

  if (selected == SELECT) {
    // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
    vec4 selectColor = u_SelectColor * COLOR_SCALE;
    return selectColor;
  } else if (selected == HIGHLIGHT) {
    // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Sc=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
    // \u9009\u4E2D\u6001
    v_PickingResult.a = SELECT;
  } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
    // \u9AD8\u4EAE\u6001
    v_PickingResult.a = HIGHLIGHT;
  } else {
    v_PickingResult.a = NORMAL;
  }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Qp=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Cp=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Jp=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,ed=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Nd=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Sv=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,wp=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Cv=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,wv=/precision\s+(high|low|medium)p\s+float/,Av=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Tv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Mv=(xv=(0,Vr.b2)(),xv(Gh=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"moduleCache",{}),(0,C.Z)(this,"rawContentCache",{})}return(0,kt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:bv,fs:bv}),this.registerModule("decode",{vs:Pf,fs:""}),this.registerModule("projection",{vs:Cp,fs:""}),this.registerModule("project",{vs:Qp,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Jp}),this.registerModule("lighting",{vs:Ev,fs:""}),this.registerModule("light",{vs:Bd,fs:""}),this.registerModule("picking",{vs:Sc,fs:$p}),this.registerModule("styleMapping",{vs:ed,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Cv,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Nd,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Sv,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:wp,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,m=Kp(a),y=m.content,E=m.uniforms,A=Kp(s),I=A.content,L=A.uniforms;this.rawContentCache[r]={fs:I,uniforms:yu(yu(yu({},E),L),p),vs:y}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),m=p.content,y=p.includeList,E=this.processModule(s,[],"fs"),A=E.content,I=E.includeList,L=A,F=Dd()(y.concat(I).concat(r)).reduce(function(W,$){return yu(yu({},W),n.rawContentCache[$].uniforms)},{});return wv.test(A)||(L=Av+A),this.moduleCache[r]={fs:L.trim(),uniforms:F,vs:m.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(Tv,function(m,y){var E=y.split(" "),A=E[0].replace(/"/g,"");if(n.indexOf(A)>-1)return"";var I=s.rawContentCache[A][a];n.push(A);var L=s.processModule(I,n,a),F=L.content;return F});return{content:p,includeList:n}}}]),e}())||Gh),Ks=J(66213),Wl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Wl||(Wl={}));var zd,Xl,td=(zd=(0,Vr.b2)(),zd(Xl=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"shaderModuleService",void 0),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"config",void 0)}return(0,kt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Wl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Zt.IRendererService),this.cameraService=r.getContainer().get(Zt.ICameraService),this.mapService=r.getContainer().get(Zt.IMapService),this.interactionService=r.getContainer().get(Zt.IInteractionService),this.layerService=r.getContainer().get(Zt.ILayerService),this.shaderModuleService=r.getContainer().get(Zt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||Xl),Ud,If;function Hh(e){var i=Wh();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Wh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xh=(Ud=(0,Vr.b2)(),Ud(If=function(e){(0,Fr.Z)(r,e);var i=Hh(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Ks.Z)((0,Ct.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(td))||If),yh,Zd,Vd,rd,jd;function Gd(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function Hd(e,i){if(!!e){if(typeof e=="string")return Cc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cc(e,i)}}function Cc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Pv=(yh=(0,Vr.b2)(),Zd=(0,Vr.f3)(Zt.IPostProcessor),yh(Vd=(rd=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"passes",[]),Or(this,"postProcessor",jd,this),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"renderFlag",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0)}return(0,kt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,M.Z)(B().mark(function n(){var a,s,p;return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a=Gd(this.passes),y.prev=1,a.s();case 3:if((s=a.n()).done){y.next=9;break}return p=s.value,y.next=7,p.render(this.layer);case 7:y.next=3;break;case 9:y.next=14;break;case 11:y.prev=11,y.t0=y.catch(1),a.e(y.t0);case 14:return y.prev=14,a.f(),y.finish(14);case 17:return y.next=19,this.postProcessor.render(this.layer);case 19:case"end":return y.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Wl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),jd=rn(rd.prototype,"postProcessor",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd))||Vd),nd,id;function Wd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ad(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wd(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Iv(e){var i=Ov();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Ov(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xd=(nd=(0,Vr.b2)(),nd(id=function(e){(0,Fr.Z)(r,e);var i=Iv(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"pickingFBO",void 0),(0,C.Z)((0,de.Z)(n),"layer",void 0),(0,C.Z)((0,de.Z)(n),"width",0),(0,C.Z)((0,de.Z)(n),"height",0),(0,C.Z)((0,de.Z)(n),"alreadyInRendering",!1),(0,C.Z)((0,de.Z)(n),"pickFromPickingFBO",function(m){var y=m.x,E=m.y,A=m.lngLat,I=m.type;if(!(!n.layer.isVisible()||!n.layer.needPick(I))){var L=n.rendererService,F=L.getViewportSize,W=L.readPixels,$=L.useFramebuffer,te=F(),Ae=te.width,Xe=te.height,tt=n.layer.getLayerConfig(),lt=tt.enableHighlight,Ot=tt.enableSelect,Nt=y*ka,Kt=E*ka;if(!(Nt>Ae||Nt<0||Kt>Xe||Kt<0)){var fr;$(n.pickingFBO,function(){var Zr;if(fr=W({x:Math.round(Nt),y:Math.round(Xe-(E+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),fr[0]!==0||fr[1]!==0||fr[2]!==0){var un=ro(fr),_r=n.layer.getSource().getFeatureById(un),wn={x:y,y:E,type:I,lngLat:A,featureId:un,feature:_r};_r&&(n.layer.setCurrentPickId(un),n.triggerHoverOnLayer(wn))}else{var Ln={x:y,y:E,lngLat:A,type:n.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(ad(ad({},Ln),{},{type:"unpick"})),n.triggerHoverOnLayer(Ln),n.layer.setCurrentPickId(null)}lt&&n.highlightPickedFeature(fr),Ot&&I==="click"&&((Zr=fr)===null||Zr===void 0?void 0:Zr.toString())!==[0,0,0,0].toString()&&n.selectFeature(fr)})}}}),n}return(0,kt.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Ks.Z)((0,Ct.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,m=p.createTexture2D,y=p.createFramebuffer,E=p.getViewportSize,A=E(),I=A.width,L=A.height;this.pickingFBO=y({color:m({width:I,height:L,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.interactionService.on(ma.Hover,this.pickFromPickingFBO),this.interactionService.on(ma.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ma.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,m=p.getViewportSize,y=p.useFramebuffer,E=p.clear,A=m(),I=A.width,L=A.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==L)&&(this.pickingFBO.resize({width:I,height:L}),this.width=I,this.height=L),y(this.pickingFBO,function(){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,Tn.Z)(a,3),p=s[0],m=s[1],y=s[2];this.layer.hooks.beforeHighlight.call([p,m,y]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,Tn.Z)(a,3),p=s[0],m=s[1],y=s[2];this.layer.hooks.beforeSelect.call([p,m,y]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=Os(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=Os(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(td))||id),Rv=J(11700),Ap=J.n(Rv),kv=J(68929),od=J.n(kv),Lv,Yd,Dv,qd,Fv;function Bv(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bv(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Sm=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nf=(Lv=(0,Vr.b2)(),Yd=(0,Vr.f3)(Zt.IShaderModuleService),Lv(Dv=(qd=function(){function e(){(0,vt.Z)(this,e),Or(this,"shaderModuleService",Fv,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"config",void 0),(0,C.Z)(this,"quad",Sm),(0,C.Z)(this,"enabled",!0),(0,C.Z)(this,"renderToScreen",!1),(0,C.Z)(this,"model",void 0),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"optionsToUpdate",{})}return(0,kt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Wl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Zt.IRendererService),this.shaderModuleService=r.getContainer().get(Zt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,m=a.createModel,y=this.setupShaders(),E=y.vs,A=y.fs,I=y.uniforms;this.model=m({vs:E,fs:A,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:O.FLOAT}),size:2})},uniforms:Tp(Tp({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,m=p.useFramebuffer,y=p.getViewportSize,E=p.clear,A=y(),I=A.width,L=A.height;m(this.renderToScreen?null:s.getWriteFBO(),function(){E({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Tp({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[I,L]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Tp(Tp({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){wo()(r[a])||(n["u_".concat(Ap()(od()(a)))]=r[a])}),n}}]),e}(),Fv=rn(qd.prototype,"shaderModuleService",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd))||Dv),Nv,Yl;function Mp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mp(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pp(e){var i=zv();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function zv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yx=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);
  // float lum = luminance(baseColor);
  // baseColor.a *= lum;

  // gl_FragColor = baseColor;

  // if(u_BloomFinal > 0.0) { // 
  //   gl_FragColor = baseColor; //-- 
  // }

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    // float lum = luminance(inbloomColor);
    // vec4 bloom = vec4(lum);
    // inbloomColor.a *= lum;
    // gl_FragColor = inbloomColor * u_intensity + texture2D(u_Texture2, v_UV);
    // gl_FragColor = inbloomColor * 0.5 + texture2D(u_Texture2, v_UV);
    // gl_FragColor = baseColor;
    // gl_FragColor = inbloomColor;
    // vec4 mixColor = mix(baseColor, inbloomColor, max(u_intensity - 0.3, 0.0));
    // mixColor.a = max(baseColor.a, mixColor.a);
    gl_FragColor = mix(inbloomColor, baseColor, max(1.0 - u_intensity, u_baseRadio));
    // gl_FragColor = mixColor;
    // gl_FragColor = baseColor;
    
    if(baselum <= 0.0) {
      // float lum = luminance(inbloomColor);
      // inbloomColor.rgb *= lum;
      gl_FragColor += inbloomColor * u_intensity;
    }
    // gl_FragColor = inbloomColor * baseColor + baseColor;
    // gl_FragColor = baseColor + bloom * 0.5;
  } else {
    gl_FragColor = inbloomColor;
  }
  // gl_FragColor = inbloomColor;

  // float h = 0.01;
  
  // vec4 color11 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color12 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color13 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y + 1.0 * h) );

  // vec4 color21 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y) );
  // vec4 color23 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y) );

  // vec4 color31 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y-1.0*h) );
  // vec4 color32 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y-1.0*h) );
  // vec4 color33 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y-1.0*h) );

  // vec4 bloomColor =
  //   color11 + 
  //   color12 + 
  //   color13 + 
  //   color21 + 
  //   color21 + 
  //   color23 + 
  //   color31 + 
  //   color32 + 
  //   color33;

  //   if(baseColor.a > 0.0) {
      
  //     gl_FragColor.r = min(bloomColor.r, baseColor.r);
  //     gl_FragColor.g = min(bloomColor.g, baseColor.g);
  //     gl_FragColor.b = min(bloomColor.b, baseColor.b);
  //     gl_FragColor.a = min(bloomColor.a, baseColor.a);

  //     gl_FragColor = mix(inbloomColor, gl_FragColor, 0.7);
  //   } else {
  //     gl_FragColor = bloomColor/9.0;
  //   } 
}`,_x=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xx=(Nv=(0,Vr.b2)(),Nv(Yl=function(e){(0,Fr.Z)(r,e);var i=Pp(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:_x,fs:yx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:Kd(Kd({},m),{},{u_ViewportSize:[E,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wo()(a.bloomRadius)||(s.u_radius=a.bloomRadius),wo()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),wo()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(nf))||Yl),u0,l0;function c0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function f0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?c0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bx(e){var i=Ex();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Ex(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Cx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ax=(u0=(0,Vr.b2)(),u0(l0=function(e){(0,Fr.Z)(r,e);var i=bx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Cx,fs:Sx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:f0(f0({},m),{},{u_ViewportSize:[E,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wo()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(nf))||l0),h0,p0;function d0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function v0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tx(e){var i=Mx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Mx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Px=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Ix=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ox=(h0=(0,Vr.b2)(),h0(p0=function(e){(0,Fr.Z)(r,e);var i=Tx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Ix,fs:Px});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:v0(v0({},m),{},{u_ViewportSize:[E,A]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wo()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(nf))||p0),m0,g0;function y0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?y0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Rx(e){var i=kx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Dx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Fx=(m0=(0,Vr.b2)(),m0(g0=function(e){(0,Fr.Z)(r,e);var i=Rx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Dx,fs:Lx});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:_0(_0({},m),{},{u_ViewportSize:[E,A]})}}}]),r}(nf))||g0),x0,b0;function Bx(e){var i=Nx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Nx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ux=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zx=(x0=(0,Vr.b2)(),x0(b0=function(e){(0,Fr.Z)(r,e);var i=Bx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Ux,fs:zx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(nf))||b0),E0,S0;function C0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function w0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?C0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vx(e){var i=jx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Hx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Wx=(E0=(0,Vr.b2)(),E0(S0=function(e){(0,Fr.Z)(r,e);var i=Vx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Hx,fs:Gx});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:w0(w0({},m),{},{u_ViewportSize:[E,A]})}}}]),r}(nf))||S0),A0,T0;function M0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?M0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xx(e){var i=Yx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Yx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Kx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$x=(A0=(0,Vr.b2)(),A0(T0=function(e){(0,Fr.Z)(r,e);var i=Xx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Kx,fs:qx});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,m=a.uniforms,y=this.rendererService.getViewportSize(),E=y.width,A=y.height;return{vs:s,fs:p,uniforms:P0(P0({},m),{},{u_ViewportSize:[E,A]})}}}]),r}(nf))||T0),I0,O0;function Qx(e){var i=Jx();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,tb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,rb=(I0=(0,Vr.b2)(),I0(O0=function(e){(0,Fr.Z)(r,e);var i=Qx(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:tb,fs:eb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(nf))||O0),R0,k0;function nb(e){var i=ib();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ob=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,sb=(R0=(0,Vr.b2)(),R0(k0=function(e){(0,Fr.Z)(r,e);var i=nb(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:ab,fs:ob}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(nf))||k0),L0,D0,F0,B0,sd,N0,ub=(L0=(0,Vr.b2)(),D0=(0,Vr.f3)(Zt.IRendererService),F0=(0,Vr.zY)(),L0(B0=(sd=function(){function e(){(0,vt.Z)(this,e),Or(this,"rendererService",N0,this),(0,C.Z)(this,"passes",[]),(0,C.Z)(this,"readFBO",void 0),(0,C.Z)(this,"writeFBO",void 0)}return(0,kt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,m=s.height;return a({x:0,y:0,width:p,height:m,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,M.Z)(B().mark(function p(){return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return y.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,M.Z)(B().mark(function n(a,s){var p,m;return B().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,this.getReadFBOTex();case 2:p=E.sent,m=0;case 4:if(!(m<4)){E.next=11;break}return E.next=7,s.render(a,p);case 7:this.swap(),m++,E.next=4;break;case 11:case"end":return E.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,M.Z)(B().mark(function n(a){var s,p;return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:s=0;case 1:if(!(s<this.passes.length)){y.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){y.next=9;break}return y.next=7,this.renderBloomPass(a,p);case 7:y.next=12;break;case 9:return y.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,y.next=1;break;case 15:case"end":return y.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),N0=rn(sd.prototype,"rendererService",[D0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rn(sd.prototype,"init",[F0],Object.getOwnPropertyDescriptor(sd.prototype,"init"),sd.prototype),sd))||B0),z0,U0;function lb(e){var i=cb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fb=(z0=(0,Vr.b2)(),z0(U0=function(e){(0,Fr.Z)(r,e);var i=lb(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Ks.Z)((0,Ct.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,m=s.clear,y=a.multiPassRenderer.getPostProcessor().getReadFBO();p(y,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:y}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(E){E.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(td))||U0),Z0,V0,j0,Cm,G0;function H0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function W0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?H0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hb(e){var i=pb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,X0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,vb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Y0(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var mb=1,gb=(Z0=(0,Vr.b2)(),V0=(0,Vr.f3)(Zt.IShaderModuleService),Z0(j0=(Cm=function(e){(0,Fr.Z)(r,e);var i=hb(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Or((0,de.Z)(n),"shaderModuleService",G0,(0,de.Z)(n)),(0,C.Z)((0,de.Z)(n),"haltonSequence",[]),(0,C.Z)((0,de.Z)(n),"accumulatingId",0),(0,C.Z)((0,de.Z)(n),"frame",0),(0,C.Z)((0,de.Z)(n),"timer",void 0),(0,C.Z)((0,de.Z)(n),"sampleRenderTarget",void 0),(0,C.Z)((0,de.Z)(n),"prevRenderTarget",void 0),(0,C.Z)((0,de.Z)(n),"outputRenderTarget",void 0),(0,C.Z)((0,de.Z)(n),"copyRenderTarget",void 0),(0,C.Z)((0,de.Z)(n),"blendModel",void 0),(0,C.Z)((0,de.Z)(n),"outputModel",void 0),(0,C.Z)((0,de.Z)(n),"copyModel",void 0),n}return(0,kt.Z)(r,[{key:"getType",value:function(){return Wl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Ks.Z)((0,Ct.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,m=p.createFramebuffer,y=p.createTexture2D;this.sampleRenderTarget=m({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.prevRenderTarget=m({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.outputRenderTarget=m({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})}),this.copyRenderTarget=m({color:y({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([Y0(E,2),Y0(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",db),this.outputModel=this.createTriangleModel("copy-pass",X0,{blend:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE_MINUS_SRC_ALPHA,srcAlpha:O.ONE,dstAlpha:O.ONE_MINUS_SRC_ALPHA},equation:{rgb:O.FUNC_ADD,alpha:O.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",X0)}},{key:"render",value:function(a){var s=this,p=this.rendererService,m=p.clear,y=p.getViewportSize,E=p.useFramebuffer,A=y(),I=A.width,L=A.height;this.sampleRenderTarget.resize({width:I,height:L}),this.prevRenderTarget.resize({width:I,height:L}),this.outputRenderTarget.resize({width:I,height:L}),this.copyRenderTarget.resize({width:I,height:L}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();E(F,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var W=function $(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),na.requestAnimationFrame(function(){$(te)}))};this.accumulatingId=mb++,this.timer=na.setTimeout(function(){W(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,m=p.clear,y=p.getViewportSize,E=p.useFramebuffer,A=y(),I=A.width,L=A.height,F=a.getLayerConfig(),W=F.jitterScale,$=W===void 0?1:W,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/I*$,(te[1]*2-1)/L*$),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ae=a.getLayerConfig();E(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ae.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&m({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),E(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Xe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Xe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,na.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:vb,fs:s});var m=this.shaderModuleService.getModule(a),y=m.vs,E=m.fs,A=m.uniforms,I=this.rendererService,L=I.createAttribute,F=I.createBuffer,W=I.createModel;return W(W0({vs:y,fs:E,attributes:{a_Position:L({buffer:F({data:[-4,-4,4,-4,0,4],type:O.FLOAT}),size:2})},uniforms:W0({},A),depth:{enable:!1},count:3},p))}}]),r}(td),G0=rn(Cm.prototype,"shaderModuleService",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm))||j0),$d=new Vr.W2;$d.bind(Zt.IGlobalConfigService).to(es).inSingletonScope(),(0,Vr.GW)((0,Vr.b2)(),Za.EventEmitter),$d.bind(Zt.IEventEmitter).to(Za.EventEmitter);var q0=(0,wd.Z)($d,!1),wm=function(i){var r=q0.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},SP=function(i){var r=q0.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},ql=$d,yb=0;function _b(){var e=new Vr.W2;return e.parent=$d,e.bind(Zt.SceneID).toConstantValue("".concat(yb++)),e.bind(Zt.IShaderModuleService).to(Mv).inSingletonScope(),e.bind(Zt.ILayerService).to(So).inSingletonScope(),e.bind(Zt.ISceneService).to(jh).inSingletonScope(),e.bind(Zt.ICameraService).to(Yr).inSingletonScope(),e.bind(Zt.ICoordinateSystemService).to(gv).inSingletonScope(),e.bind(Zt.IInteractionService).to(S).inSingletonScope(),e.bind(Zt.IPickingService).to(Un).inSingletonScope(),e.bind(Zt.IControlService).to(Xn).inSingletonScope(),e.bind(Zt.IMarkerService).to(no).inSingletonScope(),e.bind(Zt.IIconService).to(mc).inSingletonScope(),e.bind(Zt.IFontService).to(Ih).inSingletonScope(),e.bind(Zt.IPopupService).to(Qo).inSingletonScope(),e.bind(Zt.INormalPass).to(Xh).whenTargetNamed("clear"),e.bind(Zt.INormalPass).to(Xd).whenTargetNamed("pixelPicking"),e.bind(Zt.INormalPass).to(fb).whenTargetNamed("render"),e.bind(Zt.INormalPass).to(gb).whenTargetNamed("taa"),e.bind(Zt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Zt.INormalPass,r)}}),e.bind(Zt.IPostProcessingPass).to(Zx).whenTargetNamed("copy"),e.bind(Zt.IPostProcessingPass).to(xx).whenTargetNamed("bloom"),e.bind(Zt.IPostProcessingPass).to(Ax).whenTargetNamed("blurH"),e.bind(Zt.IPostProcessingPass).to(Ox).whenTargetNamed("blurV"),e.bind(Zt.IPostProcessingPass).to(rb).whenTargetNamed("noise"),e.bind(Zt.IPostProcessingPass).to(sb).whenTargetNamed("sepia"),e.bind(Zt.IPostProcessingPass).to(Fx).whenTargetNamed("colorHalftone"),e.bind(Zt.IPostProcessingPass).to(Wx).whenTargetNamed("hexagonalPixelate"),e.bind(Zt.IPostProcessingPass).to($x).whenTargetNamed("ink"),e.bind(Zt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Zt.IPostProcessingPass,r);return n.setName(r),n}}),e}function xb(e){var i=new Vr.W2;return i.parent=e,i.bind(Zt.IStyleAttributeService).to(Ms).inSingletonScope(),i.bind(Zt.IMultiPassRenderer).to(Pv).inSingletonScope(),i.bind(Zt.IPostProcessor).to(ub).inSingletonScope(),i}var CP=J(74691),bb=null;function wP(e){return bb.indexOf(e)}var Eb=2,AP=4,Sb=64,TP=128,Cb=256,wb=512,MP=8192,PP=16384,IP=32768,Ab=null,K0=131072,OP=262144,Tb=524288,RP=1048576,Mb=2097152,kP=4194304,Pb=8388608,Ib=16777216,Ob=null;function Uv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function LP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,m=e.stroke,y=e.strokeWidth,E=e.strokeOpacity,A=[],I=[],L=[],F=[Uv(i[0],i[1]),Uv(i[2],i[3])],W=[Uv(m[0],m[1]),Uv(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function($){var te=_slicedToArray($,2),Ae=te[0],Xe=te[1];A.push([].concat(F,[(Ae+1)*Pb+(Xe+1)*Mb+getShapeIndex(s)*K0+r,(n+512)*Tb+(a+512)*Sb])),I.push([].concat(W,[y,E])),L.push([p,0,0,0])}),{packedBuffer:A,packedBuffer2:I,packedBuffer3:L}}function DP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Ob+r*Ib+n*K0+r*Ab+n*wb+r*Cb+n*Eb+r}var wc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(wc||(wc={}));var $s;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})($s||($s={}));var Yh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Yh||(Yh={}));var qn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(qn||(qn={}));var Rb=["mapload","mapchange"],Ip={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Am=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],qh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(qh||(qh={}));function $0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kb(e){var i=Lb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Lb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Db=0,Zv=function(e){(0,Fr.Z)(r,e);var i=kb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this),(0,C.Z)((0,de.Z)(a),"controlOption",void 0),(0,C.Z)((0,de.Z)(a),"container",void 0),(0,C.Z)((0,de.Z)(a),"sceneContainer",void 0),(0,C.Z)((0,de.Z)(a),"mapsService",void 0),(0,C.Z)((0,de.Z)(a),"renderService",void 0),(0,C.Z)((0,de.Z)(a),"layerService",void 0),(0,C.Z)((0,de.Z)(a),"controlService",void 0),(0,C.Z)((0,de.Z)(a),"isShow",void 0),a.controlOption=Q0(Q0({},a.getDefault()),n||{}),a}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{position:qh.TOPRIGHT,name:"".concat(Db++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:qh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Zt.IMapService),this.renderService=a.get(Zt.IRendererService),this.layerService=a.get(Zt.ILayerService),this.controlService=a.get(Zt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,m=this.controlService.controlCorners[p];return Ol(s,"l7-control"),p.indexOf("bottom")!==-1?m.insertBefore(s,m.firstChild):m.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Ol(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Hu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ic(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Za.EventEmitter);function Fb(e){var i=Bb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FP=function(e){(0,Fr.Z)(r,e);var i=Fb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this,n),(0,C.Z)((0,de.Z)(a),"layerControlInputs",void 0),(0,C.Z)((0,de.Z)(a),"layers",void 0),(0,C.Z)((0,de.Z)(a),"lastZIndex",void 0),(0,C.Z)((0,de.Z)(a),"handlingClick",void 0),(0,C.Z)((0,de.Z)(a),"layersLink",void 0),(0,C.Z)((0,de.Z)(a),"baseLayersList",void 0),(0,C.Z)((0,de.Z)(a),"separator",void 0),(0,C.Z)((0,de.Z)(a),"overlaysList",void 0),(0,C.Z)((0,de.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),pa(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,de.Z)(a)),a}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:qh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Ol(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Ol(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):Hu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Hu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Na("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var m=this.form=Na("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Na("a",a+"-toggle",s);var y=this.layersLink;y.title="Layers",p||this.expand(),this.baseLayersList=Na("div",a+"-base",m),this.separator=Na("div",a+"-separator",m),this.overlaysList=Na("div",a+"-overlays",m),s.appendChild(m)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,m=p===void 0?{}:p,y=s.overlayers,E=y===void 0?{}:y;Object.keys(m).forEach(function(A,I){a.addLayer(m[A],A,!1)}),Object.keys(E).forEach(function(A,I){a.addLayer(E[A],A,!0)})}},{key:"update",value:function(){if(!this.container)return this;Rl(this.baseLayersList),Rl(this.overlaysList),this.layerControlInputs=[];var a,s,p,m,y=0;for(p=0;p<this.layers.length;p++)m=this.layers[p],this.addItem(m),s=s||m.overlay,a=a||!m.overlay,y+=m.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&y>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,m=this.mapsService.getZoom(),y=a.length-1;y>=0;y--)if(s=a[y],p=this.layerService.getLayer(s.layerId),p&&p.inited){var E=p.getMinZoom(),A=p.getMaxZoom();s.disabled=m<E||m>A}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var m=this.controlOption,y=m.sortLayers,E=m.sortFunction,A=m.autoZIndex;y&&this.layers.sort(function(I,L){return E(I.layer,L.layer,I.name,L.name)}),A&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",m=document.createElement("div");return m.innerHTML=p,m.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),m=p&&p.inited&&a.layer.isVisible(),y;a.overlay?(y=document.createElement("input"),y.type="checkbox",y.className="l7-control-layers-selector",y.defaultChecked=m):y=this.createRadioElement("l7-base-layers",m),this.layerControlInputs.push(y),y.layerId=a.layer.id,y.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+a.name;var A=document.createElement("div");s.appendChild(A),A.appendChild(y),A.appendChild(E);var I=a.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,m=[],y=[];this.handlingClick=!0;for(var E=a.length-1;E>=0;E--)s=a[E],p=this.layerService.getLayer(s.layerId),s.checked?m.push(p):s.checked||y.push(p);y.forEach(function(A){A.hide()}),m.forEach(function(A){A.show()}),this.handlingClick=!1}}]),r}(Zv);function Nb(e){var i=zb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function zb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ub=function(e){(0,Fr.Z)(r,e);var i=Nb(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{position:qh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Na("div",a),p=Na("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(Zv);function Zb(e){var i=Vb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BP=function(e){(0,Fr.Z)(r,e);var i=Zb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this,n),(0,C.Z)((0,de.Z)(a),"mScale",void 0),(0,C.Z)((0,de.Z)(a),"iScale",void 0),pa(["update"],(0,de.Z)(a)),a}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{position:qh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Na("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,m=a.containerToLngLat([0,p]),y=a.containerToLngLat([s,p]),E=bs([m.lng,m.lat],[y.lng,y.lat]);this.updateScales(E)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,m=s.imperial;p&&a&&this.updateMetric(a),m&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,m,y;s>5280?(p=s/5280,m=this.getRoundNum(p),this.updateScale(this.iScale,m+" mi",m/p)):(y=this.getRoundNum(s),this.updateScale(this.iScale,y+" ft",y/s))}},{key:"updateScale",value:function(a,s,p){var m=this.controlOption.maxWidth;a.style.width=Math.round(m*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,m=p.metric,y=p.imperial;m&&(this.mScale=Na("div",a,s)),y&&(this.iScale=Na("div",a,s))}}]),r}(Zv);function jb(e){var i=Gb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Gb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NP=function(e){(0,Fr.Z)(r,e);var i=jb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this,n),(0,C.Z)((0,de.Z)(a),"disabled",void 0),(0,C.Z)((0,de.Z)(a),"zoomInButton",void 0),(0,C.Z)((0,de.Z)(a),"zoomOutButton",void 0),pa(["updateDisabled","zoomIn","zoomOut"],(0,de.Z)(a)),a}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{position:qh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Na("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,m,y){var E=Na("a",p,m);return E.innerHTML=a,E.title=s,E.href="javascript:void(0)",E.addEventListener("click",y),E}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Hu(this.zoomInButton,s),Hu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Ol(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Ol(this.zoomInButton,s)}}]),r}(Zv);function J0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J0(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hb(e){var i=Wb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tg=function(e){(0,Fr.Z)(r,e);var i=Hb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this),(0,C.Z)((0,de.Z)(a),"markerOption",void 0),(0,C.Z)((0,de.Z)(a),"defaultMarker",void 0),(0,C.Z)((0,de.Z)(a),"popup",void 0),(0,C.Z)((0,de.Z)(a),"mapsService",void 0),(0,C.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,C.Z)((0,de.Z)(a),"lngLat",void 0),(0,C.Z)((0,de.Z)(a),"scene",void 0),(0,C.Z)((0,de.Z)(a),"added",!1),(0,C.Z)((0,de.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=eg(eg({},a.getDefault()),n),pa(["update","onMove","onUp","addDragHandler","onMapClick"],(0,de.Z)(a)),a.init(),a}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:ul.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Zt.IMapService),this.sceneSerive=a.get(Zt.ISceneService);var s=this.markerOption,p=s.element,m=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&ic(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&ic(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),vo(s,"".concat(Ru[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,m=this.lngLat,y=m.lng,E=m.lat,A=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([y,E]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var L=this.mapsService.getContainer(),F=0,W=0;if(L&&(F=L.scrollWidth,W=L.scrollHeight),Math.abs(A[0][0])>180||Math.abs(A[1][0])>180){if(I.x>F){var $=this.mapsService.lngLatToContainer([y-360,E]);I.x=$.x}if(I.x<0){var te=this.mapsService.lngLatToContainer([y+360,E]);I.x=te.x}}(I.x>F||I.x<0||I.y>W||I.y<0)&&(s.style.display="none"),s.style.left=I.x+p[0]+"px",s.style.top=I.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,m=p.color,y=p.anchor;if(!s){this.defaultMarker=!0,s=Na("div"),this.markerOption.element=s;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var A=document.createElementNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),A.setAttributeNS(null,"fill",m),E.appendChild(A),s.appendChild(E)}Ol(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var L,F,W=((L=a.markerOption)===null||L===void 0?void 0:L.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[I]);s&&(s.style[I]=W)}),s.addEventListener("click",function(I){a.onMapClick(I)}),s.addEventListener("click",this.eventHandle),kl(s,y,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Za.EventEmitter);function rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ng(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rg(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xb(e){var i=Yb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zP=function(e){(0,Fr.Z)(r,e);var i=Xb(r);function r(n){var a,s;return(0,vt.Z)(this,r),s=i.call(this),(0,C.Z)((0,de.Z)(s),"markers",[]),(0,C.Z)((0,de.Z)(s),"markerLayerOption",void 0),(0,C.Z)((0,de.Z)(s),"clusterIndex",void 0),(0,C.Z)((0,de.Z)(s),"points",[]),(0,C.Z)((0,de.Z)(s),"clusterMarkers",[]),(0,C.Z)((0,de.Z)(s),"mapsService",void 0),(0,C.Z)((0,de.Z)(s),"scene",void 0),(0,C.Z)((0,de.Z)(s),"zoom",void 0),(0,C.Z)((0,de.Z)(s),"bbox",void 0),s.markerLayerOption=Uo()(s.getDefault(),n),pa(["update"],(0,de.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,kt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Zt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;s&&this.addPoint(a,this.markers.length),this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),m=p.lng,y=p.lat,E={geometry:{type:"Point",coordinates:[m,y]},properties:ng(ng({},a.getExtData()),{},{marker_id:s})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,m=p===void 0?0:p,y=a.maxZoom;this.clusterIndex=new(Dl())({radius:s,minZoom:m,maxZoom:y}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,m=a[0].concat(a[1]),y=this.clusterIndex.getClusters(m,s);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],y.forEach(function(E){var A,I=p.markerLayerOption.clusterOption,L=I.field,F=I.method;if(E.properties&&(A=E.properties)!==null&&A!==void 0&&A.cluster_id){var W,$=p.getLeaves((W=E.properties)===null||W===void 0?void 0:W.cluster_id);if(E.properties.clusterData=$,L&&F){var te=$==null?void 0:$.map(function(Ot){var Nt=(0,C.Z)({},L,Ot.properties[L]);return Nt}),Ae=ku(te,L),Xe=Gs(F,Ae),tt="point_"+F;E.properties[tt]=Xe.toFixed(2)}}var lt=p.clusterMarker(E);p.clusterMarkers.push(lt),lt.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,m=p.element,y=m===void 0?this.generateElement.bind(this):m,E=new tg({element:y(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Sn(this.bbox,s))&&(this.bbox=On(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(a){var s=Na("div","l7-marker-cluster"),p=Na("div","",s),m=Na("span","",p),y=this.markerLayerOption.clusterOption,E=y.field,A=y.method;a.properties.point_count=a.properties.point_count||1;var I=E&&A?a.properties["point_"+A]||a.properties[E]:a.properties.point_count;return m.textContent=I,s}}]),r}(Za.EventEmitter);function ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ig(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qb(e){var i=Kb();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var og=function(e){(0,Fr.Z)(r,e);var i=qb(r);function r(n){var a;return(0,vt.Z)(this,r),a=i.call(this),(0,C.Z)((0,de.Z)(a),"popupOption",void 0),(0,C.Z)((0,de.Z)(a),"mapsService",void 0),(0,C.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,C.Z)((0,de.Z)(a),"lngLat",void 0),(0,C.Z)((0,de.Z)(a),"content",void 0),(0,C.Z)((0,de.Z)(a),"closeButton",void 0),(0,C.Z)((0,de.Z)(a),"timeoutInstance",void 0),(0,C.Z)((0,de.Z)(a),"container",void 0),(0,C.Z)((0,de.Z)(a),"tip",void 0),(0,C.Z)((0,de.Z)(a),"scene",void 0),a.popupOption=ag(ag({},a.getdefault()),n),pa(["update","onClickClose","remove"],(0,de.Z)(a)),a}return(0,kt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Zt.IMapService),this.sceneSerive=a.get(Zt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),m;for(p.innerHTML=a;m=p.firstChild,!!m;)s.appendChild(m);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ic(this.content),this.content=Na("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Na("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var m=window.document.createElement(a);return s!==void 0&&(m.className=s),p&&p.appendChild(m),m}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ul.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,m=p.className,y=p.maxWidth,E=p.anchor;if(!(!this.mapsService||!s||!this.content)){var A=this.mapsService.getMarkerContainer();if(!this.container&&A){this.container=this.creatDom("div","l7-popup",A),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),m&&m.split(" ").forEach(function(L){return a.container.classList.add(L)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(L){a.container.addEventListener(L,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}y&&this.container.style.maxWidth!==y&&(this.container.style.maxWidth=y),this.updatePosition(),vo(this.container,"".concat(Ru[E])),kl(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,m=this.popupOption.offsets,y=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=y.x+m[0]+"px",this.container.style.top=y.y-m[1]+"px"}}}]),r}(Za.EventEmitter);function $b(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}$b(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Qb=J(88307),Jb=J.n(Qb),eE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"attribute",void 0),(0,C.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,m=r.size,y=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:y||0},m&&(this.attribute.size=m)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),_h,Qd,xh,Ac,Jd,Kh,ev,Vv,Of,Op,_u,Rf,kf,jv,tE=(_h={},(0,C.Z)(_h,O.POINTS,"points"),(0,C.Z)(_h,O.LINES,"lines"),(0,C.Z)(_h,O.LINE_LOOP,"line loop"),(0,C.Z)(_h,O.LINE_STRIP,"line strip"),(0,C.Z)(_h,O.TRIANGLES,"triangles"),(0,C.Z)(_h,O.TRIANGLE_FAN,"triangle fan"),(0,C.Z)(_h,O.TRIANGLE_STRIP,"triangle strip"),_h),sg=(Qd={},(0,C.Z)(Qd,O.STATIC_DRAW,"static"),(0,C.Z)(Qd,O.DYNAMIC_DRAW,"dynamic"),(0,C.Z)(Qd,O.STREAM_DRAW,"stream"),Qd),Tm=(xh={},(0,C.Z)(xh,O.BYTE,"int8"),(0,C.Z)(xh,O.UNSIGNED_INT,"int16"),(0,C.Z)(xh,O.INT,"int32"),(0,C.Z)(xh,O.UNSIGNED_BYTE,"uint8"),(0,C.Z)(xh,O.UNSIGNED_SHORT,"uint16"),(0,C.Z)(xh,O.UNSIGNED_INT,"uint32"),(0,C.Z)(xh,O.FLOAT,"float"),xh),rE=(Ac={},(0,C.Z)(Ac,O.ALPHA,"alpha"),(0,C.Z)(Ac,O.LUMINANCE,"luminance"),(0,C.Z)(Ac,O.LUMINANCE_ALPHA,"luminance alpha"),(0,C.Z)(Ac,O.RGB,"rgb"),(0,C.Z)(Ac,O.RGBA,"rgba"),(0,C.Z)(Ac,O.RGBA4,"rgba4"),(0,C.Z)(Ac,O.RGB5_A1,"rgb5 a1"),(0,C.Z)(Ac,O.RGB565,"rgb565"),(0,C.Z)(Ac,O.DEPTH_COMPONENT,"depth"),(0,C.Z)(Ac,O.DEPTH_STENCIL,"depth stencil"),Ac),nE=(Jd={},(0,C.Z)(Jd,O.DONT_CARE,"dont care"),(0,C.Z)(Jd,O.NICEST,"nice"),(0,C.Z)(Jd,O.FASTEST,"fast"),Jd),ug=(Kh={},(0,C.Z)(Kh,O.NEAREST,"nearest"),(0,C.Z)(Kh,O.LINEAR,"linear"),(0,C.Z)(Kh,O.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,C.Z)(Kh,O.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,C.Z)(Kh,O.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,C.Z)(Kh,O.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Kh),lg=(ev={},(0,C.Z)(ev,O.REPEAT,"repeat"),(0,C.Z)(ev,O.CLAMP_TO_EDGE,"clamp"),(0,C.Z)(ev,O.MIRRORED_REPEAT,"mirror"),ev),iE=(Vv={},(0,C.Z)(Vv,O.NONE,"none"),(0,C.Z)(Vv,O.BROWSER_DEFAULT_WEBGL,"browser"),Vv),aE=(Of={},(0,C.Z)(Of,O.NEVER,"never"),(0,C.Z)(Of,O.ALWAYS,"always"),(0,C.Z)(Of,O.LESS,"less"),(0,C.Z)(Of,O.LEQUAL,"lequal"),(0,C.Z)(Of,O.GREATER,"greater"),(0,C.Z)(Of,O.GEQUAL,"gequal"),(0,C.Z)(Of,O.EQUAL,"equal"),(0,C.Z)(Of,O.NOTEQUAL,"notequal"),Of),cg=(Op={},(0,C.Z)(Op,O.FUNC_ADD,"add"),(0,C.Z)(Op,O.MIN_EXT,"min"),(0,C.Z)(Op,O.MAX_EXT,"max"),(0,C.Z)(Op,O.FUNC_SUBTRACT,"subtract"),(0,C.Z)(Op,O.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Op),Gv=(_u={},(0,C.Z)(_u,O.ZERO,"zero"),(0,C.Z)(_u,O.ONE,"one"),(0,C.Z)(_u,O.SRC_COLOR,"src color"),(0,C.Z)(_u,O.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,C.Z)(_u,O.SRC_ALPHA,"src alpha"),(0,C.Z)(_u,O.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,C.Z)(_u,O.DST_COLOR,"dst color"),(0,C.Z)(_u,O.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,C.Z)(_u,O.DST_ALPHA,"dst alpha"),(0,C.Z)(_u,O.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,C.Z)(_u,O.CONSTANT_COLOR,"constant color"),(0,C.Z)(_u,O.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,C.Z)(_u,O.CONSTANT_ALPHA,"constant alpha"),(0,C.Z)(_u,O.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,C.Z)(_u,O.SRC_ALPHA_SATURATE,"src alpha saturate"),_u),oE=(Rf={},(0,C.Z)(Rf,O.NEVER,"never"),(0,C.Z)(Rf,O.ALWAYS,"always"),(0,C.Z)(Rf,O.LESS,"less"),(0,C.Z)(Rf,O.LEQUAL,"lequal"),(0,C.Z)(Rf,O.GREATER,"greater"),(0,C.Z)(Rf,O.GEQUAL,"gequal"),(0,C.Z)(Rf,O.EQUAL,"equal"),(0,C.Z)(Rf,O.NOTEQUAL,"notequal"),Rf),ud=(kf={},(0,C.Z)(kf,O.ZERO,"zero"),(0,C.Z)(kf,O.KEEP,"keep"),(0,C.Z)(kf,O.REPLACE,"replace"),(0,C.Z)(kf,O.INVERT,"invert"),(0,C.Z)(kf,O.INCR,"increment"),(0,C.Z)(kf,O.DECR,"decrement"),(0,C.Z)(kf,O.INCR_WRAP,"increment wrap"),(0,C.Z)(kf,O.DECR_WRAP,"decrement wrap"),kf),sE=(jv={},(0,C.Z)(jv,O.FRONT,"front"),(0,C.Z)(jv,O.BACK,"back"),jv),uE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:sg[a||O.STATIC_DRAW],type:Tm[s||O.UNSIGNED_BYTE]})}return(0,kt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),lE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:sg[a||O.STATIC_DRAW],type:Tm[s||O.UNSIGNED_BYTE],count:p})}return(0,kt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),cE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,m=r.depth,y=r.stencil,E={width:n,height:a};Array.isArray(p)&&(E.colors=p.map(function(A){return A.get()})),s&&typeof s!="boolean"&&(E.color=s.get()),this.framebuffer=i.framebuffer(E)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),fE=J(36719),hE=J.n(fE),pE=J(68630),dE=J.n(pE);function fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Lf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fg(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var vE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"reGl",void 0),(0,C.Z)(this,"destroyed",!1),(0,C.Z)(this,"drawCommand",void 0),(0,C.Z)(this,"drawPickCommand",void 0),(0,C.Z)(this,"drawParams",void 0),(0,C.Z)(this,"options",void 0),(0,C.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,m=r.primitive,y=r.count,E=r.elements,A=r.depth,I=r.blend,L=r.stencil,F=r.cull,W=r.instances,$={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(tt){$[tt]=i.prop(tt)}));var te={};Object.keys(s).forEach(function(tt){te[tt]=s[tt].get()});var Ae={attributes:te,frag:a,uniforms:$,vert:n,blend:{},primitive:tE[m===void 0?O.TRIANGLES:m]};W&&(Ae.instances=W),y&&(Ae.count=y),E&&(Ae.elements=E.get()),this.initDepthDrawParams({depth:A},Ae),this.initBlendDrawParams({blend:I},Ae),this.initStencilDrawParams({stencil:L},Ae),this.initCullDrawParams({cull:F},Ae),this.drawCommand=i(Ae);var Xe=P()(Ae);Xe.blend=Lf(Lf({},Xe.blend),{},{enable:!1}),Xe.stencil=Lf(Lf({},Xe.stencil),{},{enable:!1}),this.drawPickCommand=i(Xe),this.drawParams=Ae}return(0,kt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=Lf(Lf({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Lf(Lf({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var m=(0,je.Z)(a[p]);m==="boolean"||m==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:aE[a.func||O.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,m=a.equation,y=a.color,E=y===void 0?[0,0,0,0]:y;n.blend={enable:!!s,func:{srcRGB:Gv[p&&p.srcRGB||O.SRC_ALPHA],srcAlpha:Gv[p&&p.srcAlpha||O.SRC_ALPHA],dstRGB:Gv[p&&p.dstRGB||O.ONE_MINUS_SRC_ALPHA],dstAlpha:Gv[p&&p.dstAlpha||O.ONE_MINUS_SRC_ALPHA]},equation:{rgb:cg[m&&m.rgb||O.FUNC_ADD],alpha:cg[m&&m.alpha||O.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,m=p===void 0?-1:p,y=a.func,E=y===void 0?{cmp:O.ALWAYS,ref:0,mask:-1}:y,A=a.opFront,I=A===void 0?{fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}:A,L=a.opBack,F=L===void 0?{fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}:L;n.stencil={enable:!!s,mask:m,func:Lf(Lf({},E),{},{cmp:oE[E.cmp]}),opFront:{fail:ud[I.fail],zfail:ud[I.zfail],zpass:ud[I.zpass]},opBack:{fail:ud[F.fail],zfail:ud[F.zfail],zpass:ud[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,m=p===void 0?O.BACK:p;n.cull={enable:!!s,face:sE[m]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||hE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}dE()(n)&&Object.keys(n).forEach(function(m){p.extractUniformsRecursively(m,n[m],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(m,y){Object.keys(m).forEach(function(E){p.extractUniformsRecursively(E,m[E],a,"".concat(s&&s+".").concat(r,"[").concat(y,"]"))})})}}]),e}(),mE=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"texture",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?O.UNSIGNED_BYTE:a,p=r.width,m=r.height,y=r.flipY,E=y===void 0?!1:y,A=r.format,I=A===void 0?O.RGBA:A,L=r.mipmap,F=L===void 0?!1:L,W=r.wrapS,$=W===void 0?O.CLAMP_TO_EDGE:W,te=r.wrapT,Ae=te===void 0?O.CLAMP_TO_EDGE:te,Xe=r.aniso,tt=Xe===void 0?0:Xe,lt=r.alignment,Ot=lt===void 0?1:lt,Nt=r.premultiplyAlpha,Kt=Nt===void 0?!1:Nt,fr=r.mag,Zr=fr===void 0?O.NEAREST:fr,un=r.min,_r=un===void 0?O.NEAREST:un,wn=r.colorSpace,Ln=wn===void 0?O.BROWSER_DEFAULT_WEBGL:wn,ci=r.x,Qa=ci===void 0?0:ci,qo=r.y,xu=qo===void 0?0:qo,el=r.copy,Uu=el===void 0?!1:el;this.width=p,this.height=m;var xd={width:p,height:m,type:Tm[s],format:rE[I],wrapS:lg[$],wrapT:lg[Ae],mag:ug[Zr],min:ug[_r],alignment:Ot,flipY:E,colorSpace:iE[Ln],premultiplyAlpha:Kt,aniso:tt,x:Qa,y:xu,copy:Uu};n&&(xd.data=n),typeof F=="number"?xd.mipmap=nE[F]:typeof F=="boolean"&&(xd.mipmap=F),this.texture=i.texture(xd)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),hg,pg,gE=(hg=(0,Vr.b2)(),hg(pg=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,C.Z)(this,"extensionObject",void 0),(0,C.Z)(this,"gl",void 0),(0,C.Z)(this,"$container",void 0),(0,C.Z)(this,"canvas",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDirty",void 0),(0,C.Z)(this,"createModel",function(r){return new vE(i.gl,r)}),(0,C.Z)(this,"createAttribute",function(r){return new eE(i.gl,r)}),(0,C.Z)(this,"createBuffer",function(r){return new uE(i.gl,r)}),(0,C.Z)(this,"createElements",function(r){return new lE(i.gl,r)}),(0,C.Z)(this,"createTexture2D",function(r){return new mE(i.gl,r)}),(0,C.Z)(this,"createFramebuffer",function(r){return new cE(i.gl,r)}),(0,C.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,C.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,m=p===void 0?null:p,y={color:n,depth:a,stencil:s};y.framebuffer=m===null?m:m.get(),i.gl.clear(y)}),(0,C.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,C.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,m=r.height,y={x:a,y:s,width:p,height:m};return n&&(y.framebuffer=n.get()),i.gl.read(y)}),(0,C.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,C.Z)(this,"getContainer",function(){if(Hi)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,C.Z)(this,"getCanvas",function(){return i.canvas}),(0,C.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,C.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,kt.Z)(e,[{key:"init",value:function(){var i=(0,M.Z)(B().mark(function n(a,s){var p=this;return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return this.canvas=a,y.next=3,new Promise(function(E,A){Jb()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(L,F){(L||!F)&&A(L),E(F)}})});case 3:this.gl=y.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return y.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||pg);function dg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dg(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var yE=function(){function e(i){(0,vt.Z)(this,e),(0,C.Z)(this,"sceneService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"controlService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"markerService",void 0),(0,C.Z)(this,"popupService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=_b();this.container=p,n.setContainer(p,r,a,s),p.bind(Zt.IRendererService).to(gE).inSingletonScope(),this.sceneService=p.get(Zt.ISceneService),this.mapService=p.get(Zt.IMapService),this.iconService=p.get(Zt.IIconService),this.fontService=p.get(Zt.IFontService),this.controlService=p.get(Zt.IControlService),this.layerService=p.get(Zt.ILayerService),this.markerService=p.get(Zt.IMarkerService),this.interactionService=p.get(Zt.IInteractionService),this.popupService=p.get(Zt.IPopupService),Hi?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,kt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=xb(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,Tn.Z)(a,2),p=s[0],m=s[1];n.fontService.addIconFont(p,m)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Hi?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Am.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Am.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Am.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||vg(vg({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Zt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Aa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new Ub({position:a}))}}]),e}(),_E=J(13218),Nu=J.n(_E),mg,gg,yg,Mm,_g;function xg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var xE=(mg=(0,Vr.b2)(),gg=(0,Vr.f3)(Zt.IGlobalConfigService),mg(yg=(Mm=function(){function e(){(0,vt.Z)(this,e),Or(this,"configService",_g,this),(0,C.Z)(this,"enabled",void 0)}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,m=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var y=r.getLayerConfig(),E=y.enableMultiPassRenderer,A=y.passes,I=A===void 0?[]:A;a.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=a.createMultiPassRenderer(r,I,p,m),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var y=s.getViewportSize(),E=y.width,A=y.height;r.multiPassRenderer.resize(E,A)}})}},{key:"createMultiPassRenderer",value:function(r,n,a,s){var p=r.multiPassRenderer,m=r.getLayerConfig(),y=m.enablePicking,E=m.enableTAA;return E?p.add(s("taa")):p.add(s("render")),xg(n).forEach(function(A){var I=(0,Tn.Z)(A,2),L=I[0],F=I[1];p.add(a(L),F)}),p.add(a("copy")),p}}]),e}(),_g=rn(Mm.prototype,"configService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mm))||yg),$h,bg=($h={},(0,C.Z)($h,wc.additive,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:1,dstAlpha:1}}),(0,C.Z)($h,wc.none,{enable:!1}),(0,C.Z)($h,wc.normal,{enable:!0,func:{srcRGB:O.SRC_ALPHA,dstRGB:O.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,C.Z)($h,wc.subtractive,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:O.ZERO,dstAlpha:O.ONE_MINUS_SRC_COLOR},equation:{rgb:O.FUNC_SUBTRACT,alpha:O.FUNC_SUBTRACT}}),(0,C.Z)($h,wc.max,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MAX_EXT}}),(0,C.Z)($h,wc.min,{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MIN_EXT}}),$h),bE=J(81763),Pa=J.n(bE),EE=J(1469),Rp=J.n(EE),UP=1024;function Qu(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function SE(e,i){e.opacity&&Hv("opacity",i,e.opacity),e.strokeWidth&&Hv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Hv("strokeOpacity",i,e.strokeOpacity),e.stroke&&CE("stroke",i,e.stroke),e.offsets&&Eg("offsets",i,e.offsets),e.textOffset&&Eg("textOffset",i,e.textOffset),e.thetaOffset&&Hv("thetaOffset",i,e.thetaOffset)}function Hv(e,i,r){c()(r)?Qu(e,i,r,function(n){return n}):Pa()(r)?Qu(e,i,[r],void 0):Rp()(r)&&r.length===2?c()(r[0])&&b()(r[1])||c()(r[0])&&Rp()(r[1])&&Pa()(r[1][0])&&Pa()(r[1][1])?Qu(e,i,r[0],r[1]):Qu(e,i,[1],void 0):Qu(e,i,[1],void 0)}function Eg(e,i,r){c()(r)?Qu(e,i,r,function(n){return n}):Rp()(r)&&r.length===2&&c()(r[0])&&b()(r[1])?Qu(e,i,r[0],r[1]):Rp()(r)&&r.length===2&&Pa()(r[0])&&Pa()(r[1])?Qu(e,i,r,void 0):Qu(e,i,[0,0],void 0)}function CE(e,i,r){c()(r)?Qu(e,i,r,void 0):Rp()(r)&&r.length===2&&(c()(r[0])&&b()(r[1])||c()(r[0])&&Rp()(r[1])&&r[1].length>0)?Qu(e,i,r[0],r[1]):Qu(e,i,"#fff",void 0)}var wE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function AE(e,i,r){typeof i=="string"&&typeof r=="string"&&i!==r&&wE.map(function(n){n.includes(i)&&n.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var TE=["passes"],ME=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Sg,Pm,Cg;function PE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=IE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function IE(e,i){if(!!e){if(typeof e=="string")return wg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wg(e,i)}}function wg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ag(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OE(e){var i=RE();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function RE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tg=0,kp=(Sg=wm(Zt.IGlobalConfigService),Pm=function(e){(0,Fr.Z)(r,e);var i=OE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,vt.Z)(this,r),n=i.call(this),(0,C.Z)((0,de.Z)(n),"id","".concat(Tg++)),(0,C.Z)((0,de.Z)(n),"name","".concat(Tg)),(0,C.Z)((0,de.Z)(n),"type",void 0),(0,C.Z)((0,de.Z)(n),"visible",!0),(0,C.Z)((0,de.Z)(n),"zIndex",0),(0,C.Z)((0,de.Z)(n),"minZoom",void 0),(0,C.Z)((0,de.Z)(n),"maxZoom",void 0),(0,C.Z)((0,de.Z)(n),"inited",!1),(0,C.Z)((0,de.Z)(n),"layerModelNeedUpdate",!1),(0,C.Z)((0,de.Z)(n),"pickedFeatureID",null),(0,C.Z)((0,de.Z)(n),"selectedFeatureID",null),(0,C.Z)((0,de.Z)(n),"styleNeedUpdate",!1),(0,C.Z)((0,de.Z)(n),"rendering",void 0),(0,C.Z)((0,de.Z)(n),"clusterZoom",0),(0,C.Z)((0,de.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,C.Z)((0,de.Z)(n),"hooks",{init:new ou,afterInit:new ou,beforeRender:new ou,beforeRenderData:new ss,afterRender:new Sa,beforePickingEncode:new Sa,afterPickingEncode:new Sa,beforeHighlight:new Sa(["pickedColor"]),afterHighlight:new Sa,beforeSelect:new Sa(["pickedColor"]),afterSelect:new Sa,beforeDestroy:new Sa,afterDestroy:new Sa}),(0,C.Z)((0,de.Z)(n),"models",[]),(0,C.Z)((0,de.Z)(n),"multiPassRenderer",void 0),(0,C.Z)((0,de.Z)(n),"plugins",void 0),(0,C.Z)((0,de.Z)(n),"sourceOption",void 0),(0,C.Z)((0,de.Z)(n),"layerModel",void 0),(0,C.Z)((0,de.Z)(n),"sceneContainer",void 0),(0,C.Z)((0,de.Z)(n),"layerChildren",[]),Or((0,de.Z)(n),"configService",Cg,(0,de.Z)(n)),(0,C.Z)((0,de.Z)(n),"shaderModuleService",void 0),(0,C.Z)((0,de.Z)(n),"cameraService",void 0),(0,C.Z)((0,de.Z)(n),"coordinateService",void 0),(0,C.Z)((0,de.Z)(n),"iconService",void 0),(0,C.Z)((0,de.Z)(n),"fontService",void 0),(0,C.Z)((0,de.Z)(n),"pickingService",void 0),(0,C.Z)((0,de.Z)(n),"rendererService",void 0),(0,C.Z)((0,de.Z)(n),"layerService",void 0),(0,C.Z)((0,de.Z)(n),"interactionService",void 0),(0,C.Z)((0,de.Z)(n),"mapService",void 0),(0,C.Z)((0,de.Z)(n),"styleAttributeService",void 0),(0,C.Z)((0,de.Z)(n),"layerSource",void 0),(0,C.Z)((0,de.Z)(n),"postProcessingPassFactory",void 0),(0,C.Z)((0,de.Z)(n),"normalPassFactory",void 0),(0,C.Z)((0,de.Z)(n),"animateOptions",{enable:!1}),(0,C.Z)((0,de.Z)(n),"container",void 0),(0,C.Z)((0,de.Z)(n),"encodedData",void 0),(0,C.Z)((0,de.Z)(n),"configSchema",void 0),(0,C.Z)((0,de.Z)(n),"currentPickId",null),(0,C.Z)((0,de.Z)(n),"rawConfig",void 0),(0,C.Z)((0,de.Z)(n),"needUpdateConfig",void 0),(0,C.Z)((0,de.Z)(n),"pendingStyleAttributes",[]),(0,C.Z)((0,de.Z)(n),"scaleOptions",{}),(0,C.Z)((0,de.Z)(n),"animateStartTime",void 0),(0,C.Z)((0,de.Z)(n),"aniamateStatus",!1),(0,C.Z)((0,de.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,C.Z)((0,de.Z)(n),"isDestroied",!1),(0,C.Z)((0,de.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,m=s.fitBoundsOptions;p&&n.fitBounds(m),n.emit("dataUpdate"),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,kt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=zu(zu({},this.needUpdateConfig),a);else{var s=this.container.get(Zt.SceneID);SE(a,this),this.configService.setLayerConfig(s,this.id,zu(zu(zu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Zt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.iconService=this.container.get(Zt.IIconService),this.fontService=this.container.get(Zt.IFontService),this.rendererService=this.container.get(Zt.IRendererService),this.layerService=this.container.get(Zt.ILayerService),this.interactionService=this.container.get(Zt.IInteractionService),this.pickingService=this.container.get(Zt.IPickingService),this.mapService=this.container.get(Zt.IMapService),this.cameraService=this.container.get(Zt.ICameraService),this.coordinateService=this.container.get(Zt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Zt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Zt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Zt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Zt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Zt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(E){var A=E.attributeName,I=E.attributeField,L=E.attributeValues,F=E.updateOptions;a.styleAttributeService.updateStyleAttribute(A,{scale:zu({field:I},a.splitValuesAndCallbackInAttribute(L,a.getLayerConfig()[A]))},F)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Zt.ILayerPlugin);var p=PE(this.plugins),m;try{for(p.s();!(m=p.n()).done;){var y=m.value;y.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(E){p.e(E)}finally{p.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(zu(zu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var m,y,E,A=(m=this.styleAttributeService)===null||m===void 0||(y=m.getLayerStyleAttribute("shape"))===null||y===void 0||(E=y.scale)===null||E===void 0?void 0:E.field,I=a;return this.updateStyleAttribute("shape",a,s,p),AE(this,A,I),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Nu()(a)?(s.enable=!0,s=zu(zu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){p.layerSource.setData(a,s)}),this}},{key:"style",value:function(a){var s=this,p=a.passes,m=(0,Co.Z)(a,TE);return p&&xg(p).forEach(function(y){var E=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(y[0]);E&&E.updateOptions(y[1])}),this.rawConfig=zu(zu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(a,s){return Nu()(a)?this.scaleOptions=zu(zu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,M.Z)(B().mark(function s(){return B().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.getEncodedData().length===0){m.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){m.next=6;break}return m.next=4,this.multiPassRenderer.render();case 4:m.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return m.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Nu()(a)?!0:a,Nu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Nu()(a)){var m=a.x,y=m===void 0?0:m,E=a.y,A=E===void 0?0:E;this.updateLayerConfig({highlightColor:Nu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Nu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:y,y:A})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Nu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Nu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Os(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Nu()(a)?!0:a,Nu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Nu()(a)){var m=a.x,y=m===void 0?0:m,E=a.y,A=E===void 0?0:E;this.updateLayerConfig({selectColor:Nu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Nu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:y,y:A})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Nu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Nu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Os(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,m=s.minZoom,y=m===void 0?-Infinity:m,E=s.maxZoom,A=E===void 0?Infinity:E;return!!p&&a>=y&&a<=A}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,m=p.some(function(y){return Math.abs(y)===Infinity});return m?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(s){if(s.ticks){var p=s.ticks().map(function(E){return(0,C.Z)({value:E},a,s(E))});return p}else if(s.invertExtent){var m=s.range().map(function(E){return(0,C.Z)({value:s.invertExtent(E)},a,E)});return m}else if(s!=null&&s.domain){var y=s.domain().map(function(E){return{value:E||"\u65E0",color:s(E)}});return y}}else return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,m=a.fragmentShader,y=a.triangulation,E=a.segmentNumber,A=(0,Co.Z)(a,ME);this.shaderModuleService.registerModule(s,{vs:p,fs:m});var I=this.shaderModuleService.getModule(s),L=I.vs,F=I.fs,W=I.uniforms,$=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,y,E),Ae=te.attributes,Xe=te.elements;return $(zu({attributes:Ae,uniforms:W,fs:F,vs:L,elements:Xe,blend:bg[wc.normal]},A))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,m=p===void 0?!0:p,y=s.enableSelect,E=y===void 0?!0:y,A=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&E&&(A=!0),a==="mousemove"&&(m||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(A=!0),this.isVisible()&&A}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,M.Z)(B().mark(function s(p){return B().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,p.render();case 2:case"end":return y.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,m){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:zu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},m):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:m})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:b()(a)?void 0:a||s,callback:b()(a)?a:void 0}}}]),r}(Za.EventEmitter),Cg=rn(Pm.prototype,"configService",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm),kE=J(18446),ld=J.n(kE),Mg,Im,Pg;function LE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=DE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function DE(e,i){if(!!e){if(typeof e=="string")return Ig(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ig(e,i)}}function Ig(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var hs=(Mg=wm(Zt.IGlobalConfigService),Im=function(){function e(i){(0,vt.Z)(this,e),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"createTexture2D",void 0),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"dataTexture",void 0),(0,C.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,C.Z)(this,"rowCount",void 0),(0,C.Z)(this,"cacheStyleProperties",void 0),(0,C.Z)(this,"cellLength",void 0),(0,C.Z)(this,"cellProperties",void 0),(0,C.Z)(this,"cellTypeLayout",void 0),(0,C.Z)(this,"stylePropertyesExist",void 0),(0,C.Z)(this,"dataTextureTest",void 0),Or(this,"configService",Pg,this),(0,C.Z)(this,"shaderModuleService",void 0),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"styleAttributeService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Zt.IRendererService),this.shaderModuleService=i.getContainer().get(Zt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Zt.IStyleAttributeService),this.mapService=i.getContainer().get(Zt.IMapService),this.iconService=i.getContainer().get(Zt.IIconService),this.fontService=i.getContainer().get(Zt.IFontService),this.cameraService=i.getContainer().get(Zt.ICameraService),this.layerService=i.getContainer().get(Zt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:O.NEAREST,min:O.NEAREST,width:1,height:1}))}return(0,kt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return ld()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),ld()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),ld()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),ld()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),ld()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),ld()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Pa()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Pa()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Pa()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Pa()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return c()(r)?!!(0,Xu.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Xi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Rp()(r)&&r.length===2&&Pa()(r[0])&&Pa()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=LE(a),p;try{for(s.s();!(p=s.n()).done;){var m=p.value,y=m.attr,E=m.count,A=n[y];A!==void 0?y==="stroke"?r.push.apply(r,(0,Se.Z)(Xi(A))):y==="offsets"?this.isOffsetStatic(A)?r.push(-A[0],A[1]):r.push(0,0):r.push(Pa()(A)?A:1):this.patchMod(r,E)}}catch(I){s.e(I)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),m=p*this.DATA_TEXTURE_WIDTH,y=[],E=0;E<s;E++){var A=n[E];this.patchData(y,A,a)}for(var I=y.length;I<m;I++)y.push(-1);return{data:y,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return bg[wc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Pg=rn(Im.prototype,"configService",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im),FE=J(9187),Df=J.n(FE),Og=100,ZP=36,VP=40;function Rg(e){return e/180*Math.acos(-1)}function kg(e){var i=Rg(e[0])+Math.PI/2,r=Rg(e[1]),n=Og+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function jP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,m=2+p,y=2*m,E=[],A=[],I=[],L=[],F=[],W=[],$=0;$<=m;$++){for(var te=$/m,Ae=te*Math.PI,Xe=0;Xe<=y;Xe++){var tt=Xe/y,lt=tt*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Ae),mat4.identity(r),mat4.rotateY(r,r,lt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),I.push(s.slice()),L.push.apply(L,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),W.push([tt,1-te]),L.push(tt,1-te)}if($>0)for(var Ot=I.length,Nt=Ot-2*(y+1);Nt+y+2<Ot;Nt++)E.push([Nt,Nt+1,Nt+y+1]),A.push(Nt,Nt+1,Nt+y+1),E.push([Nt+y+1,Nt+1,Nt+y+2]),A.push(Nt+y+1,Nt+1,Nt+y+2)}return{cells:E,positions:I,uvs:W,positionsArr:L,indicesArr:A,normalArr:F}}var yi=J(31437),Wv=yi.create(),GP=yi.create(),Bs=yi.create(),Qh=yi.create(),cd=yi.create();function Om(e,i,r,n,a){yi.add(e,r,n),yi.normalize(e,e),i=yi.fromValues(-e[1],e[0]);var s=yi.fromValues(-r[1],r[0]);return[a/yi.dot(i,s),i]}function Jh(e,i){return yi.set(e,-i[1],i[0])}function fd(e,i,r){return yi.sub(e,i,r),yi.normalize(e,e),e}function Rm(e,i){return e[0]===i[0]&&e[1]===i[1]}function HP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Lg=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,vt.Z)(this,e),(0,C.Z)(this,"complex",void 0),(0,C.Z)(this,"join",void 0),(0,C.Z)(this,"cap",void 0),(0,C.Z)(this,"miterLimit",void 0),(0,C.Z)(this,"thickness",void 0),(0,C.Z)(this,"normal",void 0),(0,C.Z)(this,"lastFlip",-1),(0,C.Z)(this,"miter",yi.fromValues(0,0)),(0,C.Z)(this,"started",!1),(0,C.Z)(this,"dash",!1),(0,C.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,kt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,m=1;m<s;m++){var y,E,A,I=r[m-1];I.push((y=n[m-1][2])!==null&&y!==void 0?y:0);var L=n[m-1],F=r[m];F.push((E=n[m][2])!==null&&E!==void 0?E:0);var W=n[m],$=m<r.length-1?[].concat((0,Se.Z)(r[m+1]),[(A=n[m+1][2])!==null&&A!==void 0?A:0]):null,te=m<n.length-1?n[m+1]:null,Ae=this.segment_gaode2(a,p,I,F,$,L,W,te);p+=Ae}if(this.dash)for(var Xe=0;Xe<a.positions.length/6;Xe++)a.positions[Xe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,m=1;m<s;m++){var y,E,A,I=r[m-1];I.push((y=n[m-1][2])!==null&&y!==void 0?y:0);var L=n[m-1],F=r[m];F.push((E=n[m][2])!==null&&E!==void 0?E:0);var W=n[m],$=m<r.length-1?[].concat((0,Se.Z)(r[m+1]),[(A=n[m+1][2])!==null&&A!==void 0?A:0]):null,te=m<n.length-1?n[m+1]:null,Ae=this.simpleSegment(a,p,I,F,$,L,W,te);p+=Ae}if(this.dash)for(var Xe=0;Xe<a.positions.length/6;Xe++)a.positions[Xe*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var m=r[p-1],y=r[p],E=p<r.length-1?r[p+1]:null,A=this.segment(n,s,m,y,E);s+=A}if(this.dash)for(var I=0;I<n.positions.length/6;I++)n.positions[I*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var m=r[p-1],y=r[p],E=p<r.length-1?r[p+1]:null,A=this.simpleSegment(n,s,m,y,E);s+=A}if(this.dash)for(var I=0;I<n.positions.length/6;I++)n.positions[I*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,m,y,E){var A=0,I=r.indices,L=r.positions,F=r.normals,W=this.cap==="square",$=this.join==="bevel",te=as([y[0],y[1]]),Ae=as([m[0],m[1]]);fd(Bs,s,a);var Xe=0;if(this.dash&&(Xe=this.lineSegmentDistance(te,Ae),this.totalDistance+=Xe),this.normal||(this.normal=yi.create(),Jh(this.normal,Bs)),!this.started)if(this.started=!0,W){var tt=yi.create(),lt=yi.create();yi.add(tt,this.normal,Bs),yi.add(lt,this.normal,Bs),F.push(lt[0],lt[1],0),F.push(tt[0],tt[1],0),L.push(a[0],a[1],a[2]|0,this.totalDistance-Xe,-this.thickness,a[2]|0),L.push(a[0],a[1],a[2]|0,this.totalDistance-Xe,this.thickness,a[2]|0)}else this.extrusions(L,F,a,this.normal,this.thickness,this.totalDistance-Xe);if(I.push(n+0,n+1,n+2),p){Rm(s,p)&&yi.add(p,s,yi.normalize(p,yi.subtract(p,s,a))),fd(Qh,p,s);var Kt=Om(cd,yi.create(),Bs,Qh,this.thickness),fr=(0,Tn.Z)(Kt,2),Zr=fr[0],un=fr[1],_r=yi.dot(cd,this.normal)<0?-1:1,wn=$;if(!wn&&this.join==="miter"){var Ln=Zr;Ln>this.miterLimit&&(wn=!0)}wn?(F.push(this.normal[0],this.normal[1],0),F.push(un[0],un[1],0),L.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),L.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*_r,s[2]|0),I.push.apply(I,(0,Se.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),I.push(n+2,n+3,n+4),Jh(Wv,Qh),yi.copy(this.normal,Wv),F.push(this.normal[0],this.normal[1],0),L.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*_r,s[2]|0),A+=3):(this.extrusions(L,F,s,un,Zr,this.totalDistance),I.push.apply(I,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,yi.copy(this.normal,un),A+=2),this.lastFlip=_r}else{if(Jh(this.normal,Bs),W){var Ot=yi.create(),Nt=yi.create();yi.sub(Nt,Bs,this.normal),yi.add(Ot,Bs,this.normal),F.push(Nt[0],Nt[1],0),F.push(Ot[0],Ot[1],0),L.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),L.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(L,F,s,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),A+=2}return A}},{key:"simpleSegment",value:function(r,n,a,s,p){var m=0,y=r.indices,E=r.positions,A=r.normals,I=as([s[0],s[1]]),L=as([a[0],a[1]]);fd(Bs,I,L);var F=0;if(this.dash&&(F=this.lineSegmentDistance(I,L),this.totalDistance+=F),this.normal||(this.normal=yi.create(),Jh(this.normal,Bs)),this.started||(this.started=!0,this.extrusions(E,A,a,this.normal,this.thickness,this.totalDistance-F)),y.push(n+0,n+1,n+2),!p)Jh(this.normal,Bs),this.extrusions(E,A,s,this.normal,this.thickness,this.totalDistance),y.push.apply(y,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2;else{var W=as([p[0],p[1]]);Rm(I,W)&&yi.add(W,I,yi.normalize(W,yi.subtract(W,I,L))),fd(Qh,W,I);var $=Om(cd,yi.create(),Bs,Qh,this.thickness),te=(0,Tn.Z)($,2),Ae=te[0],Xe=te[1],tt=yi.dot(cd,this.normal)<0?-1:1;this.extrusions(E,A,s,Xe,Ae,this.totalDistance),y.push.apply(y,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),tt=-1,yi.copy(this.normal,Xe),m+=2,this.lastFlip=tt}return m}},{key:"segment",value:function(r,n,a,s,p){var m=0,y=r.indices,E=r.positions,A=r.normals,I=this.cap==="square",L=this.join==="bevel",F=as([s[0],s[1]]),W=as([a[0],a[1]]);fd(Bs,F,W);var $=0;if(this.dash&&($=this.lineSegmentDistance(F,W),this.totalDistance+=$),this.normal||(this.normal=yi.create(),Jh(this.normal,Bs)),!this.started)if(this.started=!0,I){var te=yi.create(),Ae=yi.create();yi.add(te,this.normal,Bs),yi.add(Ae,this.normal,Bs),A.push(Ae[0],Ae[1],0),A.push(te[0],te[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance-$,-this.thickness,a[2]|0),E.push(a[0],a[1],a[2]|0,this.totalDistance-$,this.thickness,a[2]|0)}else this.extrusions(E,A,a,this.normal,this.thickness,this.totalDistance-$);if(y.push(n+0,n+1,n+2),p){var lt=as([p[0],p[1]]);Rm(F,lt)&&yi.add(lt,F,yi.normalize(lt,yi.subtract(lt,F,W))),fd(Qh,lt,F);var Ot=Om(cd,yi.create(),Bs,Qh,this.thickness),Nt=(0,Tn.Z)(Ot,2),Kt=Nt[0],fr=Nt[1],Zr=yi.dot(cd,this.normal)<0?-1:1,un=L;if(!un&&this.join==="miter"){var _r=Kt;_r>this.miterLimit&&(un=!0)}un?(A.push(this.normal[0],this.normal[1],0),A.push(fr[0],fr[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Zr,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Zr,s[2]|0),y.push.apply(y,(0,Se.Z)(this.lastFlip!==-Zr?[n,n+2,n+3]:[n+2,n+1,n+3])),y.push(n+2,n+3,n+4),Jh(Wv,Qh),yi.copy(this.normal,Wv),A.push(this.normal[0],this.normal[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Zr,s[2]|0),m+=3):(this.extrusions(E,A,s,fr,Kt,this.totalDistance),y.push.apply(y,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Zr=-1,yi.copy(this.normal,fr),m+=2),this.lastFlip=Zr}else{if(Jh(this.normal,Bs),I){var Xe=yi.create(),tt=yi.create();yi.sub(tt,Bs,this.normal),yi.add(Xe,Bs,this.normal),A.push(tt[0],tt[1],0),A.push(Xe[0],Xe[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(E,A,s,this.normal,this.thickness,this.totalDistance);y.push.apply(y,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),m+=2}return m}},{key:"extrusions",value:function(r,n,a,s,p,m){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,m,-p,a[2]|0),r.push(a[0],a[1],a[2]|0,m,p,a[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Lp(e){if(Pa()(e[0]))return e;if(Pa()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Pa()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function BE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,m=0,y=0;y<e.length;y+=2){var E=e[y],A=e[y+1];E&&A&&(i=Math.max(E,i),r=Math.max(A,r),n=Math.min(E,n),a=Math.min(A,a),s+=E,p+=A,m++)}return{center:[s/m,p/m],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var ja=J(77160);function NE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Df().flatten(e),s=a.vertices,p=a.dimensions,m=[],y=[],E=0;E<s.length/p;E++)p===2?m.push(s[E*2],s[E*2+1],1):m.push(s[E*3],s[E*3+1],1);var A=Df()(a.vertices,a.holes,a.dimensions);y.push.apply(y,(0,Se.Z)(A));for(var I=function(W){var $=a.vertices.slice(W*p,(W+1)*p),te=a.vertices.slice((W+1)*p,(W+2)*p);te.length===0&&(te=a.vertices.slice(0,p));var Ae=m.length/3;m.push($[0],$[1],1,te[0],te[1],1,$[0],$[1],0,te[0],te[1],0),y.push.apply(y,(0,Se.Z)([0,2,1,2,3,1].map(function(Xe){return Xe+Ae})))},L=0;L<n;L++)I(L);return{positions:m,index:y}}function zE(e){var i=Df().flatten(e),r=Df()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Dg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Df().flatten(e),p=s.vertices,m=s.dimensions,y=[],E=[],A=[],I=0;I<p.length/m;I++)m===2?y.push(p[I*2],p[I*2+1],1,-1,-1):y.push(p[I*3],p[I*3+1],1,-1,-1),A.push(0,0,1);var L=Df()(s.vertices,s.holes,s.dimensions);E.push.apply(E,(0,Se.Z)(L));for(var F=function(te){var Ae=s.vertices.slice(te*m,(te+1)*m),Xe=s.vertices.slice((te+1)*m,(te+2)*m);Xe.length===0&&(Xe=s.vertices.slice(0,m));var tt=y.length/5;y.push(Ae[0],Ae[1],1,0,0,Xe[0],Xe[1],1,.1,0,Ae[0],Ae[1],0,0,.8,Xe[0],Xe[1],0,.1,.8);var lt=UE([Xe[0],Xe[1],1],[Ae[0],Ae[1],0],[Ae[0],Ae[1],1],i);A.push.apply(A,(0,Se.Z)(lt).concat((0,Se.Z)(lt),(0,Se.Z)(lt),(0,Se.Z)(lt))),E.push.apply(E,(0,Se.Z)([1,2,0,3,2,1].map(function(Ot){return Ot+tt})))},W=0;W<a;W++)F(W);return{positions:y,index:E,normals:A}}function UE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=ja.create(),s=ja.create(),p=ja.create();n&&(e=Ei(e),i=Ei(i),r=Ei(r));var m=ja.fromValues.apply(ja,(0,Se.Z)(e)),y=ja.fromValues.apply(ja,(0,Se.Z)(i)),E=ja.fromValues.apply(ja,(0,Se.Z)(r));ja.sub(a,E,y),ja.sub(s,m,y),ja.cross(p,a,s);var A=ja.create();return ja.normalize(A,p),A}var Tc,Dp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Dp||(Dp={}));var Fp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Fp||(Fp={}));function tv(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var m=Math.sin(p+Math.PI/4),y=Math.cos(p+Math.PI/4);return[m,y,0]});return s}function Fg(){return tv(30)}function Bg(){return tv(4)}function Ng(){return tv(3)}function zg(){return tv(6,1)}function Ug(){return tv(5)}var hd=(Tc={},(0,C.Z)(Tc,Fp.CIRCLE,Fg),(0,C.Z)(Tc,Fp.HEXAGON,zg),(0,C.Z)(Tc,Fp.TRIANGLE,Ng),(0,C.Z)(Tc,Fp.SQUARE,Bg),(0,C.Z)(Tc,Fp.PENTAGON,Ug),(0,C.Z)(Tc,Dp.CYLINDER,Fg),(0,C.Z)(Tc,Dp.HEXAGONCOLUMN,zg),(0,C.Z)(Tc,Dp.TRIANGLECOLUMN,Ng),(0,C.Z)(Tc,Dp.SQUARECOLUMN,Bg),(0,C.Z)(Tc,Dp.PENTAGONCOLUMN,Ug),Tc),Xv={};function Zg(e){var i=Lp(e.coordinates);return{vertices:[].concat((0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function ZE(e){var i=Lp(e.coordinates),r=kg(i);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Vg(e){var i=e.shape,r=XE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function jg(e){var i=Lp(e.coordinates);return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}function Gg(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Lg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var m=0;m<s.length;m++){var y=s[m],E=p[m];a.extrude_gaode2(y,E)}}else{var A=i;Array.isArray(A[0][0])||(A=[i]),A.forEach(function(L){a.extrude(L)})}var I=a.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function VE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Lg({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var m=0;m<s.length;m++){var y=s[m],E=p[m];a.simpleExtrude_gaode2(y,E)}}else{var A=i;Array.isArray(A[0][0])||(A=[i]),A.forEach(function(L){a.simpleExtrude(L)})}var I=a.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function jE(e){var i=e.coordinates,r=Df().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Df()(n,s,a),vertices:n,size:a}}function GE(e){var i=e.coordinates,r=Df().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Df()(n,s,a),vertices:HE(n),size:a+4}}function HE(e){for(var i=[],r=BE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],m=e[s+1];i.push.apply(i,[p,m,0].concat((0,Se.Z)(n),[a]))}return i}function Hg(e){var i=e.coordinates,r=Dg(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function Wg(e){var i=e.shape,r=qE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Xg(e){var i=e.coordinates,r=[].concat((0,Se.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Se.Z)(i[1]),[0,1,0],(0,Se.Z)(i[0]),[0,0,1],(0,Se.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Yv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(E){a.push(E,1,E,n[0][0],n[0][1],n[1][0],n[1][1],E,-1,E,n[0][0],n[0][1],n[1][0],n[1][1]),E!==r-1&&s.push.apply(s,(0,Se.Z)([0,1,2,1,3,2].map(function(A){return E*2+A})))},m=0;m<r;m++)p(m);return{vertices:a,indices:s,size:7}}function WE(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=qv(-1,1),a=qv(1,1),s=qv(-1,-1),p=qv(1,-1),m=[].concat((0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(s),(0,Se.Z)(i),(0,Se.Z)(p),(0,Se.Z)(i),(0,Se.Z)(a)),y=[0,1,2,3,0,2];return{vertices:m,indices:y,size:5}}function XE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Xv&&Xv[e])return Xv[e];var r=hd[e]?hd[e]():hd.cylinder(),n=Dg([r],i);return Xv[e]=n,n}function WP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,m,y=vec3.create(),E=vec3.create(),A=vec3.create(),I=0,L=i.length;I<L;I+=3){s=i[I+0]*3,p=i[I+1]*3,m=i[I+2]*3;var F=[e[s],e[s+1]],W=[e[p],e[p+1]],$=[e[m],e[m+1]];n&&(F=lngLatToMeters(F),W=lngLatToMeters(W),$=lngLatToMeters($));var te=F,Ae=_slicedToArray(te,2),Xe=Ae[0],tt=Ae[1],lt=vec3.fromValues(Xe,tt,e[s+2]),Ot=W,Nt=_slicedToArray(Ot,2),Kt=Nt[0],fr=Nt[1],Zr=vec3.fromValues(Kt,fr,e[p+2]),un=$,_r=_slicedToArray(un,2),wn=_r[0],Ln=_r[1],ci=vec3.fromValues(wn,Ln,e[m+2]);vec3.sub(y,ci,Zr),vec3.sub(E,lt,Zr),vec3.cross(A,y,E),a[s]+=y[0],a[s+1]+=y[1],a[s+2]+=y[2],a[p]+=y[0],a[p+1]+=y[1],a[p+2]+=y[2],a[m]+=y[0],a[m+1]+=y[1],a[m+2]+=y[2]}return YE(a),a}function YE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function XP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function qE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=hd[e]?hd[e]():hd.circle(),n=i.indexOf(e)===-1?zE([r]):NE([r]);return n}function qv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function YP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function qP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function KE(e){var i=$E();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,e2=function(e){(0,Fr.Z)(r,e);var i=KE(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"cityCenter",void 0),(0,C.Z)((0,de.Z)(n),"cityMinSize",void 0),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.baseColor,y=m===void 0?"rgb(16,16,16)":m,E=a.brightColor,A=E===void 0?"rgb(255,176,38)":E,I=a.windowColor,L=I===void 0?"rgb(30,60,89)":I,F=a.time,W=F===void 0?0:F,$=a.sweep,te=$===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:$;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:Xi(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:p,u_baseColor:Xi(y),u_brightColor:Xi(A),u_windowColor:Xi(L),u_time:this.layer.getLayerAnimateTime()||W}}},{key:"calCityGeo",value:function(){var a=(0,Tn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],y=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(m+s)/2,(y+p)/2]);var E=this.mapService.lngLatToCoord([m,y]),A=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-A[0],2)+Math.pow(E[1]-A[1],2))/4}else{var I=m-s,L=y-p;this.cityCenter=[(m+s)/2,(y+p)/2],this.cityMinSize=Math.sqrt(Math.pow(I,2)+Math.pow(L,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:JE,fragmentShader:QE,triangulation:Hg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?10:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){var E=s.size;return[m[3],m[4]]}}})}}]),r}(hs);function t2(e){var i=r2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function r2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n2=function(e){(0,Fr.Z)(r,e);var i=t2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new e2(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(kp);function i2(e){var i=a2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o2=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,s2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,u2=function(e){(0,Fr.Z)(r,e);var i=i2(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:o2,fragmentShader:s2,triangulation:Wg,depth:{enable:!1},primitive:O.TRIANGLES,blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:qn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs);function l2(e){var i=c2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function c2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,h2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,p2=function(e){(0,Fr.Z)(r,e);var i=l2(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:f2,fragmentShader:h2,triangulation:Vg,depth:{enable:!0},blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:qn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs);function d2(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,m=e/2,y=i/2,E=0;E<p;E++)for(var A=E-y,I=0;I<s;I++){var L=I-m;n.push(L/m,-A/y,0),a.push(I/e),a.push(1-E/i)}for(var F=0;F<i;F++)for(var W=0;W<e;W++){var $=W+s*F,te=W+s*(F+1),Ae=W+1+s*(F+1),Xe=W+1+s*F;r.push($,te,Xe),r.push(te,Ae,Xe)}return{vertices:n,indices:r,uvs:a}}var Yg,qg;function Kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $g(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kg(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v2(e){var i=m2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,y2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,_2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,x2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,b2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,E2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Qg=(Yg=(0,Vr.b2)(),Yg(qg=function(e){(0,Fr.Z)(r,e);var i=v2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"colorTexture",void 0),(0,C.Z)((0,de.Z)(n),"heatmapFramerBuffer",void 0),(0,C.Z)((0,de.Z)(n),"intensityModel",void 0),(0,C.Z)((0,de.Z)(n),"colorModel",void 0),(0,C.Z)((0,de.Z)(n),"shapeType",void 0),n}return(0,kt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,m=s.useFramebuffer;m(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,m=s.clear,y=s.getViewportSize,E=s.createTexture2D,A=s.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),L=(I==null||(a=I.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=L,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=L==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=y(),W=F.width,$=F.height;return this.heatmapFramerBuffer=p({color:E({width:Math.floor(W/4),height:Math.floor($/4),wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.LINEAR,mag:O.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:qn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){return[m[3],m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?1:E;return[A]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:b2,fragmentShader:x2,triangulation:WE,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:O.ONE,srcAlpha:1,dstRGB:O.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.shaderModuleService.registerModule("heatmapColor",{vs:E2,fs:_2});var E=this.shaderModuleService.getModule("heatmapColor"),A=E.vs,I=E.fs,L=E.uniforms,F=this.rendererService,W=F.createAttribute,$=F.createElements,te=F.createBuffer,Ae=F.createModel;return Ae({vs:A,fs:I,attributes:{a_Position:W({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:O.FLOAT}),size:3}),a_Uv:W({buffer:te({data:[0,1,1,1,0,0,1,0],type:O.FLOAT}),size:2})},uniforms:$g({},L),depth:{enable:!1},blend:this.getBlend(),count:6,elements:$({data:[0,2,1,2,3,1],type:O.UNSIGNED_INT,count:6}),stencil:mo(p,y)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,m=p===void 0?10:p,y=a.radius,E=y===void 0?5:y;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:E,u_intensity:m}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=ml();oh(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.rendererService.getViewportSize,A=E(),I=A.width,L=A.height,F=d2(I/4,L/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:y2,fs:g2});var W=this.shaderModuleService.getModule("heatmap3dColor"),$=W.vs,te=W.fs,Ae=W.uniforms,Xe=this.rendererService,tt=Xe.createAttribute,lt=Xe.createElements,Ot=Xe.createBuffer,Nt=Xe.createModel;return Nt({vs:$,fs:te,attributes:{a_Position:tt({buffer:Ot({data:F.vertices,type:O.FLOAT}),size:3}),a_Uv:tt({buffer:Ot({data:F.uvs,type:O.FLOAT}),size:2})},primitive:O.TRIANGLES,uniforms:$g({},Ae),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:O.SRC_ALPHA,srcAlpha:1,dstRGB:O.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:lt({data:F.indices,type:O.UNSIGNED_INT,count:F.indices.length}),stencil:mo(p,y)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,m=js(p);this.colorTexture=a({data:new Uint8Array(m.data),width:m.width,height:m.height,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.NEAREST,mag:O.NEAREST,flipY:!1})}}]),r}(hs))||qg);function S2(e){var i=C2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function C2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,A2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,T2=function(e){(0,Fr.Z)(r,e);var i=S2(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,m=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:m||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:A2,fragmentShader:w2,triangulation:Wg,depth:{enable:!1},primitive:O.TRIANGLES,blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:qn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p){var m=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[m[0],m[1],0]}}})}}]),r}(hs),M2={heatmap:Qg,heatmap3d:Qg,grid:u2,grid3d:p2,hexagon:T2},P2=M2;function I2(e){var i=O2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R2=function(e){(0,Fr.Z)(r,e);var i=I2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","HeatMapLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new P2[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),m=p.shape3d,y=this.getSource(),E=y.data.type,A=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return A==="heatmap"||A==="heatmap3d"?"heatmap":E==="hexagon"?(m==null?void 0:m.indexOf(A))===-1?"hexagon":"grid3d":E==="grid"?(m==null?void 0:m.indexOf(A))===-1?"grid":"grid3d":"heatmap"}}]),r}(kp);function k2(e){var i=L2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,F2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,B2=function(e){(0,Fr.Z)(r,e);var i=k2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,m=p===void 0?!1:p,y=s.maskInside,E=y===void 0?!0:y,A=this.layer.getSource(),I=this.rendererService.createTexture2D;if(this.texture=I({height:0,width:0}),Hi){var L=this.layerService.sceneService.getSceneConfig().canvas,F=L.createImage();F.crossOrigin="anonymous",F.src=A.data.originData,F.onload=function(){a.texture=I({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else A.data.images.then(function(W){a.texture=I({data:W[0],width:W[0].width,height:W[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:F2,fragmentShader:D2,triangulation:Xg,primitive:O.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:mo(m,E)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){return[m[3],m[4]]}}})}}]),r}(hs),N2={image:B2},z2=N2;function U2(e){var i=Z2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function Z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V2=function(e){(0,Fr.Z)(r,e);var i=U2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","ImageLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new z2[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(kp);function j2(e){var i=G2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function G2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,W2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,X2={solid:0,dash:1},Y2=function(e){(0,Fr.Z)(r,e);var i=j2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,A=a.lineType,I=A===void 0?"solid":A,L=a.dashArray,F=L===void 0?[10,5]:L,W=a.forward,$=W===void 0?!0:W,te=a.lineTexture,Ae=te===void 0?!1:te,Xe=a.iconStep,tt=Xe===void 0?100:Xe,lt=a.segmentNumber,Ot=lt===void 0?30:lt,Nt=a.thetaOffset,Kt=Nt===void 0?.314:Nt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Kt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Kt});var fr=this.layer.getEncodedData(),Zr=this.calDataFrame(this.cellLength,fr,this.cellProperties),un=Zr.data,_r=Zr.width,wn=Zr.height;this.rowCount=wn,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:O.LUMINANCE,type:O.FLOAT,width:_r,height:wn}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Ln=0,ci=[0,0,0,0],Qa=[0,0,0,0];return p&&m&&(ci=Xi(p),Qa=Xi(m),Ln=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Pa()(Kt)?Kt:0,u_opacity:Pa()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Ot,u_line_type:X2[I||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:$?1:-1,u_texture:this.texture,u_line_texture:Ae?1:0,u_icon_step:tt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ln,u_sourceColor:ci,u_targetColor:Qa}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,A=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:W2,fragmentShader:H2,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:mo(y,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){var A=p.size,I=A===void 0?1:A;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:qn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.iconService.getIconMap(),I=p.texture,L=A[I]||{x:0,y:0},F=L.x,W=L.y;return[F,W]}}})}}]),r}(hs);function q2(e){var i=K2();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function K2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Q2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,J2={solid:0,dash:1},eS=function(e){(0,Fr.Z)(r,e);var i=q2(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,A=a.lineType,I=A===void 0?"solid":A,L=a.dashArray,F=L===void 0?[10,5]:L,W=a.lineTexture,$=W===void 0?!1:W,te=a.iconStep,Ae=te===void 0?100:te,Xe=a.segmentNumber,tt=Xe===void 0?30:Xe,lt=a.globalArcHeight,Ot=lt===void 0?10:lt;F.length===2&&F.push(0,0);var Nt=0,Kt=[0,0,0,0],fr=[0,0,0,0];if(p&&m&&(Kt=Xi(p),fr=Xi(m),Nt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Zr=this.layer.getEncodedData(),un=this.calDataFrame(this.cellLength,Zr,this.cellProperties),_r=un.data,wn=un.width,Ln=un.height;this.rowCount=Ln,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:O.LUMINANCE,type:O.FLOAT,width:wn,height:Ln}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Og,u_global_height:Ot,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:tt,u_line_type:J2[I]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:$?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Nt,u_sourceColor:Kt,u_targetColor:fr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,A=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Q2,fragmentShader:$2,triangulation:Yv,blend:this.getBlend(),segmentNumber:p,stencil:mo(y,A)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){var A=p.size,I=A===void 0?1:A;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:qn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.iconService.getIconMap(),I=p.texture,L=A[I]||{x:0,y:0},F=L.x,W=L.y;return[F,W]}}})}}]),r}(hs);function tS(e){var i=rS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,iS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,aS=function(e){(0,Fr.Z)(r,e);var i=tS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.forward,E=y===void 0?!0:y,A=a.segmentNumber,I=A===void 0?30:A,L=a.thetaOffset,F=L===void 0?.314:L,W=0,$=[0,0,0,0],te=[0,0,0,0];return p&&m&&($=Xi(p),te=Xi(m),W=1),{u_thetaOffset:F,u_opacity:Pa()(s)?s:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:W,u_sourceColor:$,u_targetColor:te}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:iS,fragmentShader:nS,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:qn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(s,p,m,y){return[m[3],m[4],m[5],m[6]]}}})}}]),r}(hs);function oS(e){var i=sS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function sS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,lS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,cS={solid:0,dash:1},fS=function(e){(0,Fr.Z)(r,e);var i=oS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,A=a.lineType,I=A===void 0?"solid":A,L=a.dashArray,F=L===void 0?[10,5]:L,W=a.lineTexture,$=W===void 0?!1:W,te=a.iconStep,Ae=te===void 0?100:te,Xe=a.segmentNumber,tt=Xe===void 0?30:Xe;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var lt=0,Ot=[0,0,0,0],Nt=[0,0,0,0];if(p&&m&&(Ot=Xi(p),Nt=Xi(m),lt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Kt=this.layer.getEncodedData(),fr=this.calDataFrame(this.cellLength,Kt,this.cellProperties),Zr=fr.data,un=fr.width,_r=fr.height;this.rowCount=_r,this.dataTexture=this.cellLength>0&&Zr.length>0?this.createTexture2D({flipY:!0,data:Zr,format:O.LUMINANCE,type:O.FLOAT,width:un,height:_r}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:tt,u_line_type:cS[I]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:$?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:lt,u_sourceColor:Ot,u_targetColor:Nt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:lS,fragmentShader:uS,triangulation:Yv,depth:{enable:!1},blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){var A=p.size,I=A===void 0?1:A;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:qn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(p,m,y,E){return[y[3],y[4],y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.iconService.getIconMap(),I=p.texture,L=A[I]||{x:0,y:0},F=L.x,W=L.y;return[F,W]}}})}}]),r}(hs);function hS(e){var i=pS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function pS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dS=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,mS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,gS=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Jg=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,yS={solid:0,dash:1},ey=function(e){(0,Fr.Z)(r,e);var i=hS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,A=a.lineType,I=A===void 0?"solid":A,L=a.dashArray,F=L===void 0?[10,5,0,0]:L,W=a.lineTexture,$=W===void 0?!1:W,te=a.iconStep,Ae=te===void 0?100:te,Xe=a.vertexHeightScale,tt=Xe===void 0?20:Xe,lt=a.borderWidth,Ot=lt===void 0?0:lt,Nt=a.borderColor,Kt=Nt===void 0?"#ccc":Nt;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var fr=0,Zr=[0,0,0,0],un=[0,0,0,0];if(p&&m&&(Zr=Xi(p),un=Xi(m),fr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var _r=this.layer.getEncodedData(),wn=this.calDataFrame(this.cellLength,_r,this.cellProperties),Ln=wn.data,ci=wn.width,Qa=wn.height;this.rowCount=Qa,this.dataTexture=this.cellLength>0&&Ln.length>0?this.createTexture2D({flipY:!0,data:Ln,format:O.LUMINANCE,type:O.FLOAT,width:ci,height:Qa}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_line_type:yS[I],u_dash_array:F,u_texture:this.texture,u_line_texture:$?1:0,u_icon_step:Ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ot,u_borderColor:Xi(Kt),u_linearColor:fr,u_sourceColor:Zr,u_targetColor:un,u_vertexScale:tt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.getShaders(),A=E.frag,I=E.vert,L=E.type;return[this.layer.buildLayerModel({moduleName:"line"+L,vertexShader:I,fragmentShader:A,triangulation:Gg,primitive:O.TRIANGLES,blend:this.getBlend(),depth:{enable:!1},stencil:mo(p,y)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,m=a.lineType,y=a.dashArray;return m==="dash"&&y?{frag:dS,vert:vS,type:"dash"}:s&&p?{frag:mS,vert:Jg,type:"linear"}:{frag:gS,vert:Jg,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:qn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){return[y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:qn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){return[y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=p.size,I=A===void 0?1:A;return Array.isArray(I)?[I[0],I[1]]:[I,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,m,y,E,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:qn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){return[y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.iconService.getIconMap(),I=p.texture,L=A[I]||{x:0,y:0},F=L.x,W=L.y;return[F,W]}}})}}]),r}(hs);function _S(e){var i=xS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=`
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,ES=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,SS=function(e){(0,Fr.Z)(r,e);var i=_S(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.vertexHeightScale,E=y===void 0?20:y,A=0,I=[0,0,0,0],L=[0,0,0,0];if(p&&m&&(I=Xi(p),L=Xi(m),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,F,this.cellProperties),$=W.data,te=W.width,Ae=W.height;this.rowCount=Ae,this.dataTexture=this.cellLength>0&&$.length>0?this.createTexture2D({flipY:!0,data:$,format:O.LUMINANCE,type:O.FLOAT,width:te,height:Ae}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(s)?s:1,u_linearColor:A,u_sourceColor:I,u_targetColor:L,u_vertexScale:E}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simpleline",vertexShader:ES,fragmentShader:bS,triangulation:VE,primitive:O.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:qn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:qn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){var E=s.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:qn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){return[m[4]]}}})}}]),r}(hs);function CS(e){var i=wS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AS=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,TS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,MS=function(e){(0,Fr.Z)(r,e);var i=CS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,m=a.targetColor,y=a.textureBlend,E=y===void 0?"normal":y,A=a.heightfixed,I=A===void 0?!1:A,L=a.lineTexture,F=L===void 0?!1:L,W=a.iconStep,$=W===void 0?100:W,te=a.iconStepCount,Ae=te===void 0?1:te;this.rendererService.getDirty()&&this.texture.bind();var Xe=0,tt=[0,0,0,0],lt=[0,0,0,0];if(p&&m&&(tt=Xi(p),lt=Xi(m),Xe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Ot=this.layer.getEncodedData(),Nt=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Kt=Nt.data,fr=Nt.width,Zr=Nt.height;this.rowCount=Zr,this.dataTexture=this.cellLength>0&&Kt.length>0?this.createTexture2D({flipY:!0,data:Kt,format:O.LUMINANCE,type:O.FLOAT,width:fr,height:Zr}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_heightfixed:Number(I),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:Ae,u_icon_step:$,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Xe,u_sourceColor:tt,u_targetColor:lt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:TS,fragmentShader:AS,triangulation:Gg,primitive:O.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.lineType,m=p===void 0?"solid":p;this.styleAttributeService.registerStyleAttribute({name:"distance",type:qn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(E,A,I,L){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:qn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(E,A,I,L){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(E,A,I,L){var F=E.size,W=F===void 0?1:F;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(E,A,I,L,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:qn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(E,A,I,L){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(E,A,I,L){var F=a.iconService.getIconMap(),W=E.texture,$=F[W]||{x:0,y:0},te=$.x,Ae=$.y;return[te,Ae]}}})}}]),r}(hs),PS={arc:Y2,arcmini:aS,arc3d:eS,greatcircle:fS,wall:MS,line:ey,simple:SS},IS=PS;function OS(e){var i=RS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function RS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kS=function(e){(0,Fr.Z)(r,e);var i=OS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","LineLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new IS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(kp);function LS(e){var i=DS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,BS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    offset = project_pixel(offset);
  }

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,ty=function(e){(0,Fr.Z)(r,e);var i=LS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"raiseCount",0),(0,C.Z)((0,de.Z)(n),"raiserepeat",0),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,m=a.opacity,y=m===void 0?1:m,E=a.sourceColor,A=a.targetColor,I=a.pickLight,L=I===void 0?!1:I,F=a.heightfixed,W=F===void 0?!1:F,$=a.opacityLinear,te=$===void 0?{enable:!1,dir:"up"}:$,Ae=a.lightEnable,Xe=Ae===void 0?!0:Ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var tt=this.layer.getEncodedData(),lt=this.calDataFrame(this.cellLength,tt,this.cellProperties),Ot=lt.data,Nt=lt.width,Kt=lt.height;this.rowCount=Kt,this.dataTexture=this.cellLength>0&&Ot.length>0?this.createTexture2D({flipY:!0,data:Ot,format:O.LUMINANCE,type:O.FLOAT,width:Nt,height:Kt}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}var fr=0,Zr=[0,0,0,0],un=[0,0,0,0];if(E&&A&&(Zr=Xi(E),un=Xi(A),fr=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var _r=p.speed,wn=_r===void 0?.01:_r,Ln=p.repeat,ci=Ln===void 0?!1:Ln;this.raiseCount+=wn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(L),u_heightfixed:Number(W),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(y)?y:1,u_linearColor:fr,u_sourceColor:Zr,u_targetColor:un,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Xe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,m=a.animateOption.repeat,y=m===void 0?1:m;return this.raiserepeat=y,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:BS,fragmentShader:FS,triangulation:Vg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?O.FRONT:O.BACK},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,m,y,E){var A=p.size;if(A){var I=[];return Array.isArray(A)&&(I=A.length===2?[A[0],A[0],A[1]]:A),Array.isArray(A)||(I=[A,A,A]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,m,y,E,A){return A}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:qn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(p,m){var y=Lp(p.coordinates);return a?kg([y[0],y[1]]):[y[0],y[1],0]}}})}}]),r}(hs),Bp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(Bp||(Bp={}));function NS(e){var i=zS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ry=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  float r = v_radius / (v_radius + strokeWidth);

  // 'circle'
  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);
 
  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float PI = 3.14159;
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);

  // TODO: \u6839\u636E\u53E0\u52A0\u6C34\u6CE2\u6548\u679C
  gl_FragColor = vec4(v_color.xyz, v_color.a * opacity * intensity);

  // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6
  if(d < 0.5) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,US=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,km=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ny=function(e){(0,Fr.Z)(r,e);var i=NS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"meter2coord",1),(0,C.Z)((0,de.Z)(n),"isMeter",!1),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.strokeOpacity,y=m===void 0?1:m,E=a.strokeWidth,A=E===void 0?0:E,I=a.stroke,L=I===void 0?"rgba(0,0,0,0)":I,F=a.offsets,W=F===void 0?[0,0]:F,$=a.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:y,strokeWidth:A,stroke:L,offsets:W})){this.judgeStyleAttributes({opacity:p,strokeOpacity:y,strokeWidth:A,stroke:L,offsets:W});var te=this.layer.getEncodedData(),Ae=this.calDataFrame(this.cellLength,te,this.cellProperties),Xe=Ae.data,tt=Ae.width,lt=Ae.height;this.rowCount=lt,this.dataTexture=this.cellLength>0&&Xe.length>0?this.createTexture2D({flipY:!0,data:Xe,format:O.LUMINANCE,type:O.FLOAT,width:tt,height:lt}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:$==="additive"?1:0,u_globel:this.mapService.version===Bp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1,u_stroke_opacity:Pa()(y)?y:1,u_stroke_width:Pa()(A)?A:0,u_stroke_color:this.getStrokeColor(L),u_offsets:this.isOffsetStatic(W)?W:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Zg)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,m=this.mapService.version;return p==="meter"&&m!==Bp.L7MAP&&m!==Bp.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Tn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],m=a[2],y=a[3],E=[(s+m)/2,(p+y)/2],A=this.mapService.version;if(A===Bp.MAPBOX&&window.mapboxgl.MercatorCoordinate){var I=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:E[0],lat:E[1]},0),L=1,F=L*I.meterInMercatorCoordinateUnits(),W=new window.mapboxgl.MercatorCoordinate(I.x-F,I.y,I.z),$=W.toLngLat();this.meter2coord=E[0]-$.lng;return}var te=this.mapService.meterToCoord(E,[s,p]),Ae=this.mapService.meterToCoord(E,[m===s?m+.1:m,y===p?p+.1:y]);this.meter2coord=(te+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=a.animateOption,A=E===void 0?{enable:!1}:E,I=this.getShaders(A),L=I.frag,F=I.vert,W=I.type,$=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill-"+W,vertexShader:F,fragmentShader:L,triangulation:$?ZE:Zg,depth:{enable:$},blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:ry,vert:km,type:"wave"};default:return{frag:ry,vert:km,type:"wave"}}else return{frag:US,vert:km,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:qn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(m,y,E,A){var I;if(s){var L=(0,Tn.Z)(E,3),F=L[0],W=L[1],$=L[2],te=ja.fromValues(0,0,1),Ae=ja.fromValues(F,0,$),Xe=F>=0?ja.angle(te,Ae):Math.PI*2-ja.angle(te,Ae),tt=Math.PI*2-Math.asin(W/100),lt=ml();Jc(lt,lt,Xe),Rh(lt,lt,tt);var Ot=ja.fromValues(1,1,0);ja.transformMat4(Ot,Ot,lt),ja.normalize(Ot,Ot);var Nt=ja.fromValues(-1,1,0);ja.transformMat4(Nt,Nt,lt),ja.normalize(Nt,Nt);var Kt=ja.fromValues(-1,-1,0);ja.transformMat4(Kt,Kt,lt),ja.normalize(Kt,Kt);var fr=ja.fromValues(1,-1,0);ja.transformMat4(fr,fr,lt),ja.normalize(fr,fr),I=[].concat((0,Se.Z)(Ot),(0,Se.Z)(Nt),(0,Se.Z)(Kt),(0,Se.Z)(fr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Zr=A%4*3;return[I[Zr],I[Zr+1],I[Zr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(m,y,E,A){var I=m.size,L=I===void 0?5:I;return Array.isArray(L)?[L[0]*a.meter2coord]:[L*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:qn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(m,y,E,A){var I=m.shape,L=I===void 0?2:I,F=a.layer.getLayerConfig().shape2d,W=F.indexOf(L);return[W]}}})}}]),r}(hs);function ZS(e){var i=VS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,GS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,HS=function(e){(0,Fr.Z)(r,e);var i=ZS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:GS,fragmentShader:jS,triangulation:jg,primitive:O.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){var A=p.size;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.fontService.mapping,I=p.shape,L=a.fontService.getGlyph(I),F=A[L],W=F.x,$=F.y;return[W,$]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:O.LINEAR,min:O.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,m=p===void 0?"normal":p,y=s.fontFamily,E=y===void 0?"sans-serif":y,A=this.layer.getEncodedData(),I=[];A.forEach(function(L){var F=L.shape,W=F===void 0?"":F;W=W.toString();var $=a.fontService.getGlyph(W);I.indexOf($)===-1&&I.push($)}),this.fontService.setFontOptions({characterSet:I,fontWeight:m,fontFamily:E,fontSize:48})}}]),r}(hs);function WS(e){var i=XS();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,qS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,iy=function(e){(0,Fr.Z)(r,e);var i=WS(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"updateTexture",function(){var m=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=m({data:n.iconService.getCanvas(),mag:O.LINEAR,min:O.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,m=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:m})){this.judgeStyleAttributes({opacity:s,offsets:m});var y=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,y,this.cellProperties),A=E.data,I=E.width,L=E.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:O.LUMINANCE,type:O.FLOAT,width:I,height:L}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Pa()(s)?s:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:qS,fragmentShader:YS,triangulation:jg,primitive:O.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(p,m,y,E){var A=p.size,I=A===void 0?5:A;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(p,m,y,E){var A=a.iconService.getIconMap(),I=p.shape,L=A[I]||{x:0,y:0},F=L.x,W=L.y;return[F,W]}}})}}]),r}(hs);function KS(e){var i=$S();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QS=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,JS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function eC(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var ay=function(e){(0,Fr.Z)(r,e);var i=KS(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:y})){this.judgeStyleAttributes({opacity:p,offsets:y});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),I=A.data,L=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:O.LUMINANCE,type:O.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:JS,fragmentShader:QS,triangulation:eC,depth:{enable:!1},primitive:O.POINTS,blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:wc.additive}}}]),r}(hs);function tC(e){var i=rC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,iC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function aC(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var oC=function(e){(0,Fr.Z)(r,e);var i=tC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.offsets,y=m===void 0?[0,0]:m,E=a.blend,A=a.strokeOpacity,I=A===void 0?1:A,L=a.strokeWidth,F=L===void 0?0:L,W=a.stroke,$=W===void 0?"#fff":W;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:y})){this.judgeStyleAttributes({opacity:p,offsets:y});var te=this.layer.getEncodedData(),Ae=this.calDataFrame(this.cellLength,te,this.cellProperties),Xe=Ae.data,tt=Ae.width,lt=Ae.height;this.rowCount=lt,this.dataTexture=this.cellLength>0&&Xe.length>0?this.createTexture2D({flipY:!0,data:Xe,format:O.LUMINANCE,type:O.FLOAT,width:tt,height:lt}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_additive:E==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1,u_offsets:this.isOffsetStatic(y)?y:[0,0],u_stroke_opacity:Pa()(I)?I:1,u_stroke_width:Pa()(F)?F:0,u_stroke_color:this.getStrokeColor($)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:iC,fragmentShader:nC,triangulation:aC,depth:{enable:!1},primitive:O.POINTS,blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:wc.additive}}}]),r}(hs);function sC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=uC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function uC(e,i){if(!!e){if(typeof e=="string")return oy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oy(e,i)}}function oy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var lC=function(){function e(i,r,n){(0,vt.Z)(this,e),(0,C.Z)(this,"boxCells",[]),(0,C.Z)(this,"xCellCount",void 0),(0,C.Z)(this,"yCellCount",void 0),(0,C.Z)(this,"boxKeys",void 0),(0,C.Z)(this,"bboxes",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"xScale",void 0),(0,C.Z)(this,"yScale",void 0),(0,C.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,kt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,m){this.boxCells[p].push(m)}},{key:"queryHitTest",value:function(r,n,a,s,p,m){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var y=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var E=0;E<this.boxKeys.length;E++)y.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return m?y.filter(m):y}var A={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,y,A,m),p?y.length>0:y}},{key:"queryCell",value:function(r,n,a,s,p,m,y,E){var A=y.seenUids,I=this.boxCells[p];if(I!==null){var L=this.bboxes,F=sC(I),W;try{for(F.s();!(W=F.n()).done;){var $=W.value;if(!A.box[$]){A.box[$]=!0;var te=$*4;if(r<=L[te+2]&&n<=L[te+3]&&a>=L[te+0]&&s>=L[te+1]&&(!E||E(this.boxKeys[$]))){if(y.hitTest)return m.push(!0),!0;m.push({key:this.boxKeys[$],x1:L[te],y1:L[te+1],x2:L[te+2],y2:L[te+3]})}}}}catch(Ae){F.e(Ae)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,m,y,E){for(var A=this.convertToXCellCoord(r),I=this.convertToYCellCoord(n),L=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),W=A;W<=L;W++)for(var $=I;$<=F;$++){var te=this.xCellCount*$+W;if(p.call(this,r,n,a,s,te,m,y,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),cC=lC,fC=function(){function e(i,r){(0,vt.Z)(this,e),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"grid",void 0),(0,C.Z)(this,"viewportPadding",100),(0,C.Z)(this,"screenRightBoundary",void 0),(0,C.Z)(this,"screenBottomBoundary",void 0),(0,C.Z)(this,"gridRightBoundary",void 0),(0,C.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new cC(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,kt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=yl(n,a,0,1),p=ia(),m=la.apply(Ie,(0,Se.Z)(r));return on(p,s,m),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function sy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=hC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function hC(e,i){if(!!e){if(typeof e=="string")return uy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uy(e,i)}}function uy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ly(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function cy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var m=i[p].advance*s.scale,y=(e[n].x+m)*a,E=r;E<=n;E++)e[E].x-=y}}function fy(e,i,r,n,a,s,p){var m=(i-r)*a,y=(-n*p+.5)*s,E=sy(e),A;try{for(E.s();!(A=E.n()).done;){var I=A.value;I.x+=m,I.y+=y}}catch(L){E.e(L)}finally{E.f()}}function pC(e,i,r,n,a,s,p){var m=-8,y=0,E=m,A=0,I=e.positionedGlyphs,L=s==="right"?1:s==="left"?0:.5,F=I.length;r.forEach(function(Xe){if(Xe.split("").forEach(function(lt){var Ot=i[lt],Nt=0;Ot&&(I.push({glyph:lt,x:y,y:E+Nt,vertical:!1,scale:1,metrics:Ot}),y+=Ot.advance+p)}),I.length!==F){var tt=y-p;A=Math.max(tt,A),cy(I,i,F,I.length-1,L)}y=0,E-=n+5});var W=ly(a),$=W.horizontalAlign,te=W.verticalAlign;fy(I,L,$,te,A,n,r.length);var Ae=E-m;e.top+=-te*Ae,e.bottom=e.top-Ae,e.left+=-$*A,e.right=e.left+A}function dC(e,i,r,n,a,s,p){var m=-8,y=0,E=m,A=0,I=e.positionedGlyphs,L=s==="right"?1:s==="left"?0:.5,F=I.length;r.forEach(function(Xe){var tt=i[Xe],lt=0;if(tt&&(I.push({glyph:Xe,x:y,y:E+lt,vertical:!1,scale:1,metrics:tt}),y+=tt.advance+p),I.length!==F){var Ot=y-p;A=Math.max(Ot,A),cy(I,i,F,I.length-1,L)}y=0,E-=n+5});var W=ly(a),$=W.horizontalAlign,te=W.verticalAlign;fy(I,L,$,te,A,n,r.length);var Ae=E-m;e.top+=-te*Ae,e.bottom=e.top-Ae,e.left+=-$*A,e.right=e.left+A}function vC(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],m=arguments.length>7?arguments[7]:void 0,y=e.split(`
`),E=[],A={positionedGlyphs:E,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:y.length,text:e};return m?dC(A,i,y,r,n,a,s):pC(A,i,y,r,n,a,s),E.length?A:!1}function mC(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=sy(a),m;try{for(p.s();!(m=p.n()).done;){var y=m.value,E=y.metrics,A=4,I=E.advance*y.scale/2,L=r?[y.x+I,y.y]:[0,0],F=r?[0,0]:[y.x+I+i[0],y.y+i[1]],W=(0-A)*y.scale-I+F[0],$=(0-A)*y.scale+F[1],te=W+E.width*y.scale,Ae=$+E.height*y.scale,Xe={x:W,y:$},tt={x:te,y:$},lt={x:W,y:Ae},Ot={x:te,y:Ae};s.push({tl:Xe,tr:tt,bl:lt,br:Ot,tex:E,glyphOffset:L})}}catch(Nt){p.e(Nt)}finally{p.f()}return s}function gC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,m;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,m=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw m}}}}function yC(e,i){if(!!e){if(typeof e=="string")return hy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hy(e,i)}}function hy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _C(e){var i=xC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var py=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function vy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(m,y){n.push.apply(n,(0,Se.Z)(p).concat([m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y],(0,Se.Z)(p),[m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y],(0,Se.Z)(p),[m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y],(0,Se.Z)(p),[m.tex.x,m.tex.y,m.bl.x,m.bl.y])),a.push(0+y*4,1+y*4,2+y*4,2+y*4,3+y*4,0+y*4)}),{vertices:n,indices:a,size:7}}var gy=function(e){(0,Fr.Z)(r,e);var i=_C(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"glyphInfo",void 0),(0,C.Z)((0,de.Z)(n),"glyphInfoMap",{}),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"currentZoom",-1),(0,C.Z)((0,de.Z)(n),"extent",void 0),(0,C.Z)((0,de.Z)(n),"textureHeight",0),(0,C.Z)((0,de.Z)(n),"textCount",0),(0,C.Z)((0,de.Z)(n),"preTextStyle",{}),(0,C.Z)((0,de.Z)(n),"buildModels",function(){var m=n.layer.getLayerConfig(),y=m.mask,E=y===void 0?!1:y,A=m.maskInside,I=A===void 0?!0:A;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:dy,fragmentShader:py,triangulation:vy.bind((0,de.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:mo(E,I)})]}),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.stroke,y=m===void 0?"#fff":m,E=a.strokeWidth,A=E===void 0?0:E,I=a.textAnchor,L=I===void 0?"center":I,F=a.textAllowOverlap,W=F===void 0?!1:F,$=a.halo,te=$===void 0?.5:$,Ae=a.gamma,Xe=Ae===void 0?2:Ae,tt=this.fontService,lt=tt.canvas,Ot=tt.mapping;if(Object.keys(Ot).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:L,textAllowOverlap:W},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:A,stroke:y})){this.judgeStyleAttributes({opacity:p,strokeWidth:A,stroke:y});var Nt=this.layer.getEncodedData(),Kt=this.calDataFrame(this.cellLength,Nt,this.cellProperties),fr=Kt.data,Zr=Kt.width,un=Kt.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&fr.length>0?this.createTexture2D({flipY:!0,data:fr,format:O.LUMINANCE,type:O.FLOAT,width:Zr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1,u_stroke_width:Pa()(A)?A:0,u_stroke_color:this.getStrokeColor(y),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Xe,u_sdf_map_size:[lt.width,lt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,m=a.textAllowOverlap,y=m===void 0?!0:m;return this.preTextStyle={textAnchor:p,textAllowOverlap:y},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,m=this.mapService.getZoom(),y=this.mapService.getBounds(),E=Sn(this.extent,y);return!p&&(Math.abs(this.currentZoom-m)>1||!E)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:qn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.rotate,A=E===void 0?0:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:qn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){return[m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?12:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:qn.Attribute,descriptor:{name:"a_tex",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){return[m[3],m[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return On(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,E=this.layer.getEncodedData(),A=[];E.forEach(function(I){var L=I.shape,F=L===void 0?"":L;F=F.toString();var W=gC(F),$;try{for(W.s();!($=W.n()).done;){var te=$.value;A.indexOf(te)===-1&&A.push(te)}}catch(Ae){W.e(Ae)}finally{W.f()}}),this.fontService.setFontOptions({characterSet:A,fontWeight:p,fontFamily:y,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,m=a.fontFamily,y=m===void 0?"sans-serif":m,E=this.layer.getEncodedData(),A=[];E.forEach(function(I){var L=I.shape,F=L===void 0?"":L;F="".concat(F),A.indexOf(F)===-1&&A.push(F)}),this.fontService.setFontOptions({characterSet:A,fontWeight:p,fontFamily:y,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,m=this.layer.getLayerConfig(),y=m.spacing,E=y===void 0?2:y,A=m.textAnchor,I=A===void 0?"center":A,L=this.layer.getEncodedData();this.glyphInfo=L.map(function(F){var W=F.shape,$=W===void 0?"":W,te=F.id,Ae=F.size,Xe=Ae===void 0?1:Ae,tt=F.textOffset,lt=tt===void 0?[0,0]:tt,Ot=vC($.toString(),p,Xe,I,"left",E,lt,a),Nt=mC(Ot,lt,!1);return F.shaping=Ot,F.glyphQuads=Nt,F.centroid=Lp(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Lp(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[te]={shaping:Ot,glyphQuads:Nt,centroid:Lp(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,m=p===void 0?[4,4]:p,y=s.textAllowOverlap,E=y===void 0?!1:y;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var A=this.rendererService.getViewportSize(),I=A.width,L=A.height,F=new fC(I,L),W=this.glyphInfo.filter(function($){var te=$.shaping,Ae=$.id,Xe=Ae===void 0?0:Ae,tt=$.version==="GAODE2.x"?$.originCentroid:$.centroid,lt=$.size,Ot=lt/24,Nt=a.mapService.lngLatToContainer(tt),Kt=F.placeCollisionBox({x1:te.left*Ot-m[0],x2:te.right*Ot+m[0],y1:te.top*Ot-m[1],y2:te.bottom*Ot+m[1],anchorPointX:Nt.x,anchorPointY:Nt.y}),fr=Kt.box;return fr&&fr.length?(F.insertCollisionBox(fr,Xe),!0):!1});W.forEach(function($){a.glyphInfoMap[$.id]=$})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:O.LINEAR,min:O.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:dy,fragmentShader:py,triangulation:vy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:mo(p,y)})]}}]),r}(hs),bC={fill:ny,image:iy,normal:ay,simplePoint:oC,extrude:ty,text:gy,icon:HS},EC=bC;function SC(e){var i=CC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=function(e){(0,Fr.Z)(r,e);var i=SC(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","PointLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new EC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),E=a.find(function(I){return I.hasOwnProperty("shape")});if(E){var A=E.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":(p==null?void 0:p.indexOf(A))!==-1?"fill":(m==null?void 0:m.indexOf(A))!==-1?"extrude":y.hasOwnProperty(A)?"image":this.fontService.getGlyph(A)!==""?"icon":"text"}else return"normal"}}]),r}(kp);function AC(e){var i=TC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,PC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,IC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,OC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,RC=function(e){(0,Fr.Z)(r,e);var i=AC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.heightfixed,y=m===void 0?!1:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),I=A.data,L=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:O.LUMINANCE,type:O.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_heightfixed:Number(y),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=s===void 0?!1:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,A=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:p?IC:OC,fragmentShader:p?PC:MC,triangulation:Hg,stencil:mo(y,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:qn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(s,p,m,y,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:qn.Attribute,descriptor:{name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(s,p,m,y){var E=s.size,A=E===void 0?10:E;return Array.isArray(A)?[A[0]]:[A]}}})}}]),r}(hs);function kC(e){var i=LC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,FC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,BC=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,NC=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,zC=function(e){(0,Fr.Z)(r,e);var i=kC(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.opacityLinear,y=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),I=A.data,L=A.width,F=A.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:O.LUMINANCE,type:O.FLOAT,width:L,height:F}):this.createTexture2D({flipY:!0,data:[1],format:O.LUMINANCE,type:O.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Pa()(p)?p:1,u_opacitylinear:Number(y.enable),u_dir:y.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,m=a.mask,y=m===void 0?!1:m,E=a.maskInside,A=E===void 0?!0:E;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?BC:NC,fragmentShader:p.enable?FC:DC,triangulation:p.enable?GE:jE,blend:this.getBlend(),depth:{enable:!1},stencil:mo(y,A)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:qn.Attribute,descriptor:{name:"a_linear",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:function(y,E,A,I,L){return[A[3],A[4],A[5]]}}})}}]),r}(hs),UC={fill:zC,line:ey,extrude:RC,text:gy,point_fill:ny,point_image:iy,point_normal:ay,point_extrude:ty},ZC=UC;function VC(e){var i=jC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yy=function(e){(0,Fr.Z)(r,e);var i=VC(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ZC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,m=s.shape3d,y=this.iconService.getIconMap(),E=a.find(function(I){return I.hasOwnProperty("shape")});if(E){var A=E.shape;return A==="dot"?"point_normal":(p==null?void 0:p.indexOf(A))!==-1?"point_fill":(m==null?void 0:m.indexOf(A))!==-1?"point_extrude":y.hasOwnProperty(A)?"point_image":"text"}else return"fill"}}]),r}(kp);function GC(e){var i=HC();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,XC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,_y=function(e){(0,Fr.Z)(r,e);var i=GC(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"texture",void 0),(0,C.Z)((0,de.Z)(n),"colorTexture",void 0),n}return(0,kt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,m=a.clampLow,y=m===void 0?!0:m,E=a.clampHigh,A=E===void 0?!0:E,I=a.noDataValue,L=I===void 0?-9999999:I,F=a.domain,W=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:W,u_clampLow:y,u_clampHigh:typeof A!="undefined"?A:y,u_noDataValue:L,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,m=a.maskInside,y=m===void 0?!0:m,E=this.layer.getSource(),A=this.rendererService.createTexture2D,I=E.data.dataArray[0];this.texture=A({data:I.data,width:I.width,height:I.height,format:O.LUMINANCE,type:O.FLOAT});var L=this.layer.getLayerConfig(),F=L.rampColors,W=js(F);return this.colorTexture=A({data:W.data,width:W.width,height:W.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:XC,fragmentShader:WC,triangulation:Xg,primitive:O.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:mo(p,y)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:qn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:function(s,p,m,y){return[m[3],m[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,m=js(p);this.colorTexture=a({data:m.data,width:m.width,height:m.height,flipY:!1})}}]),r}(hs),YC={raster:_y,raster3d:_y},qC=YC;function KC(e){var i=$C();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function $C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=function(e){(0,Fr.Z)(r,e);var i=KC(r);function r(){var n;(0,vt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,C.Z)((0,de.Z)(n),"type","RasterLayer"),n}return(0,kt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new qC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(kp),xy,by,Ey,Sy,Cy,rv,wy,Ay,Ty;function My(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function JC(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?My(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):My(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ew=(xy=(0,Vr.b2)(),by=(0,Vr.f3)(Zt.IGlobalConfigService),Ey=(0,Vr.f3)(Zt.IMapService),Sy=(0,Vr.f3)(Zt.IFontService),xy(Cy=(rv=function(){function e(){(0,vt.Z)(this,e),Or(this,"configService",wy,this),Or(this,"mapService",Ay,this),Or(this,"fontService",Ty,this)}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,A=m.filter(function(L){return L.needRemapping}),I=E;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(I=E.filter(function(L){return a.applyAttributeMapping(y,L,p)[0]})),A.length&&(y!=null&&y.needRemapping?(r.setEncodedData(a.mapping(m,I,void 0,p)),y.needRemapping=!1):r.setEncodedData(a.mapping(A,I,r.getEncodedData(),p)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),m=s.getLayerStyleAttributes()||[],y=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,A=E;y!=null&&y.scale&&(A=E.filter(function(I){return a.applyAttributeMapping(y,I,p)[0]})),r.setEncodedData(this.mapping(m,A,void 0,p))}},{key:"mapping",value:function(r,n,a,s){var p=this,m=n.map(function(y,E){var A=a?a[E]:{},I=JC({id:y._id,coordinates:y.coordinates},A);return r.filter(function(L){return L.scale!==void 0}).forEach(function(L){var F=p.applyAttributeMapping(L,y,s);L.needRemapping=!1,L.name==="color"&&(F=F.map(function(W){return Xi(W)})),I[L.name]=Array.isArray(F)&&F.length===1?F[0]:F,L.name==="shape"&&(I.shape=p.fontService.getIconFontKey(I[L.name]))}),I});return m.length>0&&this.mapService.version==="GAODE2.x"&&(typeof m[0].coordinates[0]=="number"?m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=P()(y.coordinates),y.coordinates=p.mapService.lngLatToCoord(y.coordinates)}):m.filter(function(y){return!y.originCoordinates}).map(function(y){y.version="GAODE2.x",y.originCoordinates=P()(y.coordinates),y.coordinates=p.mapService.lngLatToCoords(y.coordinates)})),m}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],m=[];p.forEach(function(E){var A,I=E.field;(n.hasOwnProperty(I)||((A=r.scale)===null||A===void 0?void 0:A.type)==="variable")&&m.push(n[I])});var y=r.mapping?r.mapping(m):[];return r.name==="color"&&!du(y[0])?[a]:y}}]),e}(),wy=rn(rv.prototype,"configService",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=rn(rv.prototype,"mapService",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=rn(rv.prototype,"fontService",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv))||Cy),Py,Iy,tw=(Py=(0,Vr.b2)(),Py(Iy=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"mapService",void 0)}return(0,kt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Zt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:ap,options:Ed},p=s.data,m=s.options;r.setSource(new Sd(p,m))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,m=p===void 0?0:p,y=s.maxZoom,E=y===void 0?16:y,A=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return a&&(I||Math.abs(r.clusterZoom-A)>=1)?(m!==Math.floor(A)&&n.updateClusterData(Math.floor(A)),r.clusterZoom=A,!0):!1}}]),e}())||Iy);function Lm(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Oy(e){return e.length===1&&(e=rw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function rw(e){return function(i,r){return Lm(e(i),r)}}var Ry=Oy(Lm),nw=Ry.right,KP=Ry.left,Kv=nw;function iw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var ky=Array.prototype,$P=ky.slice,QP=ky.map,Dm=Math.sqrt(50),Fm=Math.sqrt(10),Bm=Math.sqrt(2);function Ly(e,i,r){var n,a=-1,s,p,m;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(m=$v(e,i,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),i=Math.floor(i/m),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*m;else for(e=Math.floor(e*m),i=Math.ceil(i*m),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/m;return n&&p.reverse(),p}function $v(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Dm?10:s>=Fm?5:s>=Bm?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Dm?10:s>=Fm?5:s>=Bm?2:1)}function Nm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Dm?a*=10:s>=Fm?a*=5:s>=Bm&&(a*=2),i<e?-a:a}function JP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,m,y=new Array(p);for(s=0;s<p;++s)y[s]=e(a[s],s,a);var E=i(y),A=E[0],I=E[1],L=r(y,A,I);Array.isArray(L)||(L=tickStep(A,I,L),L=range(Math.ceil(A/L)*L,I,L));for(var F=L.length;L[0]<=A;)L.shift(),--F;for(;L[F-1]>I;)L.pop(),--F;var W=new Array(F+1),$;for(s=0;s<=F;++s)$=W[s]=[],$.x0=s>0?L[s-1]:A,$.x1=s<F?L[s]:I;for(s=0;s<p;++s)m=y[s],A<=m&&m<=I&&W[bisect(L,m,0,F)].push(a[s]);return W}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function e5(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function aw(e){return e===null?NaN:+e}function ow(e,i,r){if(r==null&&(r=aw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),m=+r(e[s+1],s+1,e);return p+(m-p)*(a-s)}}var Mc="$";function Qv(){}Qv.prototype=Dy.prototype={constructor:Qv,has:function(e){return Mc+e in this},get:function(e){return this[Mc+e]},set:function(e,i){return this[Mc+e]=i,this},remove:function(e){var i=Mc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Mc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Mc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Mc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Mc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Mc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Mc)return!1;return!0},each:function(e){for(var i in this)i[0]===Mc&&e(this[i],i.slice(1),this)}};function Dy(e,i){var r=new Qv;if(e instanceof Qv)e.each(function(m,y){r.set(y,m)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var zm=Dy;function t5(){var e=[],i=[],r,n,a;function s(m,y,E,A){if(y>=e.length)return r!=null&&m.sort(r),n!=null?n(m):m;for(var I=-1,L=m.length,F=e[y++],W,$,te=map(),Ae,Xe=E();++I<L;)(Ae=te.get(W=F($=m[I])+""))?Ae.push($):te.set(W,[$]);return te.each(function(tt,lt){A(Xe,lt,s(tt,y,E,A))}),Xe}function p(m,y){if(++y>e.length)return m;var E,A=i[y-1];return n!=null&&y>=e.length?E=m.entries():(E=[],m.each(function(I,L){E.push({key:L,values:p(I,y)})})),A!=null?E.sort(function(I,L){return A(I.key,L.key)}):E}return a={object:function(m){return s(m,0,sw,uw)},map:function(m){return s(m,0,Fy,By)},entries:function(m){return p(s(m,0,Fy,By),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return i[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return n=m,a}}}function sw(){return{}}function uw(e,i,r){e[i]=r}function Fy(){return map()}function By(e,i,r){e.set(i,r)}function Jv(){}var Np=zm.prototype;Jv.prototype=lw.prototype={constructor:Jv,has:Np.has,add:function(e){return e+="",this[Mc+e]=e,this},remove:Np.remove,clear:Np.clear,values:Np.keys,size:Np.size,empty:Np.empty,each:Np.each};function lw(e,i){var r=new Jv;if(e instanceof Jv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var r5=null,Ny=Array.prototype,em=Ny.map,zp=Ny.slice;function ep(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function n5(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var zy={name:"implicit"};function tm(){var e=zm(),i=[],r=[],n=zy;function a(s){var p=s+"",m=e.get(p);if(!m){if(n!==zy)return n;e.set(p,m=i.push(s))}return r[(m-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=zm();for(var p=-1,m=s.length,y,E;++p<m;)e.has(E=(y=s[p])+"")||e.set(E,i.push(y));return a},a.range=function(s){return arguments.length?(r=zp.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return tm(i,r).unknown(n)},ep.apply(a,arguments),a}function Uy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,m=0,y=0,E=.5;delete e.unknown;function A(){var I=i().length,L=n[1]<n[0],F=n[L-0],W=n[1-L];a=(W-F)/Math.max(1,I-m+y*2),p&&(a=Math.floor(a)),F+=(W-F-a*(I-m))*E,s=a*(1-m),p&&(F=Math.round(F),s=Math.round(s));var $=sequence(I).map(function(te){return F+a*te});return r(L?$.reverse():$)}return e.domain=function(I){return arguments.length?(i(I),A()):i()},e.range=function(I){return arguments.length?(n=[+I[0],+I[1]],A()):n.slice()},e.rangeRound=function(I){return n=[+I[0],+I[1]],p=!0,A()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(I){return arguments.length?(p=!!I,A()):p},e.padding=function(I){return arguments.length?(m=Math.min(1,y=+I),A()):m},e.paddingInner=function(I){return arguments.length?(m=Math.min(1,I),A()):m},e.paddingOuter=function(I){return arguments.length?(y=+I,A()):y},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),A()):E},e.copy=function(){return Uy(i(),n).round(p).paddingInner(m).paddingOuter(y).align(E)},initRange.apply(A(),arguments)}function Zy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Zy(i())},e}function i5(){return Zy(Uy.apply(null,arguments).paddingInner(1))}var cw=J(26257),fw=J(73626);function hw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function pw(e){return function(){return e}}function Um(e){return+e}var Vy=[0,1];function Pc(e){return e}function Zm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:pw(isNaN(i)?NaN:.5)}function jy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function dw(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=Zm(a,n),s=r(p,s)):(n=Zm(n,a),s=r(s,p)),function(m){return s(n(m))}}function vw(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=Zm(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(m){var y=Kv(e,m,1,n)-1;return s[y](a[y](m))}}function rm(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Vm(){var e=Vy,i=Vy,r=cw.Z,n,a,s,p=Pc,m,y,E;function A(){return m=Math.min(e.length,i.length)>2?vw:dw,y=E=null,I}function I(L){return isNaN(L=+L)?s:(y||(y=m(e.map(n),i,r)))(n(p(L)))}return I.invert=function(L){return p(a((E||(E=m(i,e.map(n),fw.Z)))(L)))},I.domain=function(L){return arguments.length?(e=em.call(L,Um),p===Pc||(p=jy(e)),A()):e.slice()},I.range=function(L){return arguments.length?(i=zp.call(L),A()):i.slice()},I.rangeRound=function(L){return i=zp.call(L),r=hw,A()},I.clamp=function(L){return arguments.length?(p=L?jy(e):Pc,I):p!==Pc},I.interpolate=function(L){return arguments.length?(r=L,A()):r},I.unknown=function(L){return arguments.length?(s=L,I):s},function(L,F){return n=L,a=F,A()}}function Gy(e,i){return Vm()(e,i)}var mw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function nm(e){if(!(i=mw.exec(e)))throw new Error("invalid format: "+e);var i;return new jm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}nm.prototype=jm.prototype;function jm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}jm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function gw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function im(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function pd(e){return e=im(Math.abs(e)),e?e[1]:NaN}function yw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pd(i)/3)))*3-pd(Math.abs(e)))}function _w(e,i){return function(r,n){for(var a=r.length,s=[],p=0,m=e[0],y=0;a>0&&m>0&&(y+m+1>n&&(m=Math.max(1,n-y)),s.push(r.substring(a-=m,a+m)),!((y+=m+1)>n));)m=e[p=(p+1)%e.length];return s.reverse().join(i)}}function xw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function bw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var Hy;function Ew(e,i){var r=im(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(Hy=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+im(e,Math.max(0,i+s-1))[0]}function Wy(e,i){var r=im(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var Xy={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:gw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return Wy(e*100,i)},r:Wy,s:Ew,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Yy(e){return e}var qy=Array.prototype.map,Ky=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Sw(e){var i=e.grouping===void 0||e.thousands===void 0?Yy:_w(qy.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Yy:xw(qy.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",y=e.nan===void 0?"NaN":e.nan+"";function E(I){I=nm(I);var L=I.fill,F=I.align,W=I.sign,$=I.symbol,te=I.zero,Ae=I.width,Xe=I.comma,tt=I.precision,lt=I.trim,Ot=I.type;Ot==="n"?(Xe=!0,Ot="g"):Xy[Ot]||(tt===void 0&&(tt=12),lt=!0,Ot="g"),(te||L==="0"&&F==="=")&&(te=!0,L="0",F="=");var Nt=$==="$"?r:$==="#"&&/[boxX]/.test(Ot)?"0"+Ot.toLowerCase():"",Kt=$==="$"?n:/[%p]/.test(Ot)?p:"",fr=Xy[Ot],Zr=/[defgprs%]/.test(Ot);tt=tt===void 0?6:/[gprs]/.test(Ot)?Math.max(1,Math.min(21,tt)):Math.max(0,Math.min(20,tt));function un(_r){var wn=Nt,Ln=Kt,ci,Qa,qo;if(Ot==="c")Ln=fr(_r)+Ln,_r="";else{_r=+_r;var xu=_r<0||1/_r<0;if(_r=isNaN(_r)?y:fr(Math.abs(_r),tt),lt&&(_r=bw(_r)),xu&&+_r==0&&W!=="+"&&(xu=!1),wn=(xu?W==="("?W:m:W==="-"||W==="("?"":W)+wn,Ln=(Ot==="s"?Ky[8+Hy/3]:"")+Ln+(xu&&W==="("?")":""),Zr){for(ci=-1,Qa=_r.length;++ci<Qa;)if(qo=_r.charCodeAt(ci),48>qo||qo>57){Ln=(qo===46?a+_r.slice(ci+1):_r.slice(ci))+Ln,_r=_r.slice(0,ci);break}}}Xe&&!te&&(_r=i(_r,Infinity));var el=wn.length+_r.length+Ln.length,Uu=el<Ae?new Array(Ae-el+1).join(L):"";switch(Xe&&te&&(_r=i(Uu+_r,Uu.length?Ae-Ln.length:Infinity),Uu=""),F){case"<":_r=wn+_r+Ln+Uu;break;case"=":_r=wn+Uu+_r+Ln;break;case"^":_r=Uu.slice(0,el=Uu.length>>1)+wn+_r+Ln+Uu.slice(el);break;default:_r=Uu+wn+_r+Ln;break}return s(_r)}return un.toString=function(){return I+""},un}function A(I,L){var F=E((I=nm(I),I.type="f",I)),W=Math.max(-8,Math.min(8,Math.floor(pd(L)/3)))*3,$=Math.pow(10,-W),te=Ky[8+W/3];return function(Ae){return F($*Ae)+te}}return{format:E,formatPrefix:A}}var am,Gm,$y;Cw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Cw(e){return am=Sw(e),Gm=am.format,$y=am.formatPrefix,am}function ww(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,pd(i)-pd(e))+1}function Aw(e){return Math.max(0,-pd(Math.abs(e)))}function Tw(e,i,r,n){var a=Nm(e,i,r),s;switch(n=nm(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=yw(a,p))&&(n.precision=s),$y(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=ww(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=Aw(a))&&(n.precision=s-(n.type==="%")*2);break}}return Gm(n)}function om(e){var i=e.domain;return e.ticks=function(r){var n=i();return Ly(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return Tw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],m=n[s],y;return m<p&&(y=p,p=m,m=y,y=a,a=s,s=y),y=$v(p,m,r),y>0?(p=Math.floor(p/y)*y,m=Math.ceil(m/y)*y,y=$v(p,m,r)):y<0&&(p=Math.ceil(p*y)/y,m=Math.floor(m*y)/y,y=$v(p,m,r)),y>0?(n[a]=Math.floor(p/y)*y,n[s]=Math.ceil(m/y)*y,i(n)):y<0&&(n[a]=Math.ceil(p*y)/y,n[s]=Math.floor(m*y)/y,i(n)),e},e}function Qy(){var e=Gy(Pc,Pc);return e.copy=function(){return rm(e,Qy())},ep.apply(e,arguments),om(e)}function Jy(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=em.call(n,Um),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return Jy(e).unknown(i)},e=arguments.length?em.call(e,Um):[0,1],om(r)}function e_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function t_(e){return Math.log(e)}function r_(e){return Math.exp(e)}function Mw(e){return-Math.log(-e)}function Pw(e){return-Math.exp(-e)}function Iw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Ow(e){return e===10?Iw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function Rw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function n_(e){return function(i){return-e(-i)}}function kw(e){var i=e(t_,r_),r=i.domain,n=10,a,s;function p(){return a=Rw(n),s=Ow(n),r()[0]<0?(a=n_(a),s=n_(s),e(Mw,Pw)):e(t_,r_),i}return i.base=function(m){return arguments.length?(n=+m,p()):n},i.domain=function(m){return arguments.length?(r(m),p()):r()},i.ticks=function(m){var y=r(),E=y[0],A=y[y.length-1],I;(I=A<E)&&(L=E,E=A,A=L);var L=a(E),F=a(A),W,$,te,Ae=m==null?10:+m,Xe=[];if(!(n%1)&&F-L<Ae){if(L=Math.round(L)-1,F=Math.round(F)+1,E>0){for(;L<F;++L)for($=1,W=s(L);$<n;++$)if(te=W*$,!(te<E)){if(te>A)break;Xe.push(te)}}else for(;L<F;++L)for($=n-1,W=s(L);$>=1;--$)if(te=W*$,!(te<E)){if(te>A)break;Xe.push(te)}}else Xe=Ly(L,F,Math.min(F-L,Ae)).map(s);return I?Xe.reverse():Xe},i.tickFormat=function(m,y){if(y==null&&(y=n===10?".0e":","),typeof y!="function"&&(y=Gm(y)),m===Infinity)return y;m==null&&(m=10);var E=Math.max(1,n*m/i.ticks().length);return function(A){var I=A/s(Math.round(a(A)));return I*n<n-.5&&(I*=n),I<=E?y(A):""}},i.nice=function(){return r(e_(r(),{floor:function(m){return s(Math.floor(a(m)))},ceil:function(m){return s(Math.ceil(a(m)))}}))},i}function i_(){var e=kw(Vm()).domain([1,10]);return e.copy=function(){return rm(e,i_()).base(e.base())},ep.apply(e,arguments),e}function a_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function o_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Lw(e){var i=1,r=e(a_(i),o_(i));return r.constant=function(n){return arguments.length?e(a_(i=+n),o_(i)):i},linearish(r)}function Dw(){var e=Lw(transformer());return e.copy=function(){return copy(e,Dw()).constant(e.constant())},initRange.apply(e,arguments)}function s_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Fw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Bw(e){return e<0?-e*e:e*e}function Nw(e){var i=e(Pc,Pc),r=1;function n(){return r===1?e(Pc,Pc):r===.5?e(Fw,Bw):e(s_(r),s_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},om(i)}function Hm(){var e=Nw(Vm());return e.copy=function(){return rm(e,Hm()).exponent(e.exponent())},ep.apply(e,arguments),e}function a5(){return Hm.apply(null,arguments).exponent(.5)}function u_(){var e=[],i=[],r=[],n;function a(){var p=0,m=Math.max(1,i.length);for(r=new Array(m-1);++p<m;)r[p-1]=ow(e,p/m);return s}function s(p){return isNaN(p=+p)?n:i[Kv(r,p)]}return s.invertExtent=function(p){var m=i.indexOf(p);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var m=0,y=p.length,E;m<y;++m)E=p[m],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(Lm),a()},s.range=function(p){return arguments.length?(i=zp.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return u_().domain(e).range(i).unknown(n)},ep.apply(s,arguments)}function l_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(y){return y<=y?a[Kv(n,y,0,r)]:s}function m(){var y=-1;for(n=new Array(r);++y<r;)n[y]=((y+1)*i-(y-r)*e)/(r+1);return p}return p.domain=function(y){return arguments.length?(e=+y[0],i=+y[1],m()):[e,i]},p.range=function(y){return arguments.length?(r=(a=zp.call(y)).length-1,m()):a.slice()},p.invertExtent=function(y){var E=a.indexOf(y);return E<0?[NaN,NaN]:E<1?[e,n[0]]:E>=r?[n[r-1],i]:[n[E-1],n[E]]},p.unknown=function(y){return arguments.length&&(s=y),p},p.thresholds=function(){return n.slice()},p.copy=function(){return l_().domain([e,i]).range(a).unknown(s)},ep.apply(om(p),arguments)}function c_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Kv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=zp.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=zp.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return c_().domain(e).range(i).unknown(r)},ep.apply(a,arguments)}var Wm=new Date,Xm=new Date;function Ju(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),m=a.ceil(s);return s-p<m-s?p:m},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,m){var y=[],E;if(s=a.ceil(s),m=m==null?1:Math.floor(m),!(s<p)||!(m>0))return y;do y.push(E=new Date(+s)),i(s,m),e(s);while(E<s&&s<p);return y},a.filter=function(s){return Ju(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,m){if(p>=p)if(m<0)for(;++m<=0;)for(;i(p,-1),!s(p););else for(;--m>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return Wm.setTime(+s),Xm.setTime(+p),e(Wm),e(Xm),Math.floor(r(Wm,Xm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var Ym=Ju(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ym.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ju(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var dd=Ym,o5=Ym.range,f_=Ju(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),zw=f_,s5=f_.range,sm=1e3,nv=6e4,h_=36e5,p_=864e5,d_=6048e5;function Up(e){return Ju(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*nv)/d_})}var qm=Up(0),um=Up(1),Uw=Up(2),Zw=Up(3),vd=Up(4),Vw=Up(5),jw=Up(6),u5=qm.range,l5=um.range,c5=Uw.range,f5=Zw.range,h5=vd.range,p5=Vw.range,d5=jw.range,v_=Ju(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*nv)/p_},function(e){return e.getDate()-1}),Km=v_,v5=v_.range,m_=Ju(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sm-e.getMinutes()*nv)},function(e,i){e.setTime(+e+i*h_)},function(e,i){return(i-e)/h_},function(e){return e.getHours()}),Gw=m_,m5=m_.range,g_=Ju(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sm)},function(e,i){e.setTime(+e+i*nv)},function(e,i){return(i-e)/nv},function(e){return e.getMinutes()}),Hw=g_,g5=g_.range,y_=Ju(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*sm)},function(e,i){return(i-e)/sm},function(e){return e.getUTCSeconds()}),Ww=y_,y5=y_.range,lm=Ju(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});lm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ju(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):lm};var Xw=lm,_5=lm.range;function Zp(e){return Ju(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/d_})}var __=Zp(0),cm=Zp(1),Yw=Zp(2),qw=Zp(3),md=Zp(4),Kw=Zp(5),$w=Zp(6),x5=__.range,b5=cm.range,E5=Yw.range,S5=qw.range,C5=md.range,w5=Kw.range,A5=$w.range,x_=Ju(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/p_},function(e){return e.getUTCDate()-1}),b_=x_,T5=x_.range,$m=Ju(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});$m.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ju(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var iv=$m,M5=$m.range;function Qm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Jm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function av(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function Qw(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,m=e.months,y=e.shortMonths,E=ov(a),A=sv(a),I=ov(s),L=sv(s),F=ov(p),W=sv(p),$=ov(m),te=sv(m),Ae=ov(y),Xe=sv(y),tt={a:xu,A:el,b:Uu,B:xd,c:null,d:T_,e:T_,f:bA,g:OA,G:kA,H:yA,I:_A,j:xA,L:M_,m:EA,M:SA,p:vP,q:mP,Q:L_,s:D_,S:CA,u:wA,U:AA,V:TA,w:MA,W:PA,x:null,X:null,y:IA,Y:RA,Z:LA,"%":k_},lt={a:gP,A:yP,b:_P,B:xP,c:null,d:I_,e:I_,f:NA,g:YA,G:KA,H:DA,I:FA,j:BA,L:O_,m:zA,M:UA,p:bP,q:EP,Q:L_,s:D_,S:ZA,u:VA,U:jA,V:GA,w:HA,W:WA,x:null,X:null,y:XA,Y:qA,Z:$A,"%":k_},Ot={a:un,A:_r,b:wn,B:Ln,c:ci,d:w_,e:w_,f:dA,g:C_,G:S_,H:A_,I:A_,j:cA,L:pA,m:lA,M:fA,p:Zr,q:uA,Q:mA,s:gA,S:hA,u:nA,U:iA,V:aA,w:rA,W:oA,x:Qa,X:qo,y:C_,Y:S_,Z:sA,"%":vA};tt.x=Nt(r,tt),tt.X=Nt(n,tt),tt.c=Nt(i,tt),lt.x=Nt(r,lt),lt.X=Nt(n,lt),lt.c=Nt(i,lt);function Nt(ri,Ia){return function(Ja){var vn=[],xl=-1,jo=0,Kl=ri.length,$l,jp,gx;for(Ja instanceof Date||(Ja=new Date(+Ja));++xl<Kl;)ri.charCodeAt(xl)===37&&(vn.push(ri.slice(jo,xl)),(jp=E_[$l=ri.charAt(++xl)])!=null?$l=ri.charAt(++xl):jp=$l==="e"?" ":"0",(gx=Ia[$l])&&($l=gx(Ja,jp)),vn.push($l),jo=xl+1);return vn.push(ri.slice(jo,xl)),vn.join("")}}function Kt(ri,Ia){return function(Ja){var vn=av(1900,void 0,1),xl=fr(vn,ri,Ja+="",0),jo,Kl;if(xl!=Ja.length)return null;if("Q"in vn)return new Date(vn.Q);if("s"in vn)return new Date(vn.s*1e3+("L"in vn?vn.L:0));if(Ia&&!("Z"in vn)&&(vn.Z=0),"p"in vn&&(vn.H=vn.H%12+vn.p*12),vn.m===void 0&&(vn.m="q"in vn?vn.q:0),"V"in vn){if(vn.V<1||vn.V>53)return null;"w"in vn||(vn.w=1),"Z"in vn?(jo=Jm(av(vn.y,0,1)),Kl=jo.getUTCDay(),jo=Kl>4||Kl===0?cm.ceil(jo):cm(jo),jo=b_.offset(jo,(vn.V-1)*7),vn.y=jo.getUTCFullYear(),vn.m=jo.getUTCMonth(),vn.d=jo.getUTCDate()+(vn.w+6)%7):(jo=Qm(av(vn.y,0,1)),Kl=jo.getDay(),jo=Kl>4||Kl===0?um.ceil(jo):um(jo),jo=Km.offset(jo,(vn.V-1)*7),vn.y=jo.getFullYear(),vn.m=jo.getMonth(),vn.d=jo.getDate()+(vn.w+6)%7)}else("W"in vn||"U"in vn)&&("w"in vn||(vn.w="u"in vn?vn.u%7:"W"in vn?1:0),Kl="Z"in vn?Jm(av(vn.y,0,1)).getUTCDay():Qm(av(vn.y,0,1)).getDay(),vn.m=0,vn.d="W"in vn?(vn.w+6)%7+vn.W*7-(Kl+5)%7:vn.w+vn.U*7-(Kl+6)%7);return"Z"in vn?(vn.H+=vn.Z/100|0,vn.M+=vn.Z%100,Jm(vn)):Qm(vn)}}function fr(ri,Ia,Ja,vn){for(var xl=0,jo=Ia.length,Kl=Ja.length,$l,jp;xl<jo;){if(vn>=Kl)return-1;if($l=Ia.charCodeAt(xl++),$l===37){if($l=Ia.charAt(xl++),jp=Ot[$l in E_?Ia.charAt(xl++):$l],!jp||(vn=jp(ri,Ja,vn))<0)return-1}else if($l!=Ja.charCodeAt(vn++))return-1}return vn}function Zr(ri,Ia,Ja){var vn=E.exec(Ia.slice(Ja));return vn?(ri.p=A[vn[0].toLowerCase()],Ja+vn[0].length):-1}function un(ri,Ia,Ja){var vn=F.exec(Ia.slice(Ja));return vn?(ri.w=W[vn[0].toLowerCase()],Ja+vn[0].length):-1}function _r(ri,Ia,Ja){var vn=I.exec(Ia.slice(Ja));return vn?(ri.w=L[vn[0].toLowerCase()],Ja+vn[0].length):-1}function wn(ri,Ia,Ja){var vn=Ae.exec(Ia.slice(Ja));return vn?(ri.m=Xe[vn[0].toLowerCase()],Ja+vn[0].length):-1}function Ln(ri,Ia,Ja){var vn=$.exec(Ia.slice(Ja));return vn?(ri.m=te[vn[0].toLowerCase()],Ja+vn[0].length):-1}function ci(ri,Ia,Ja){return fr(ri,i,Ia,Ja)}function Qa(ri,Ia,Ja){return fr(ri,r,Ia,Ja)}function qo(ri,Ia,Ja){return fr(ri,n,Ia,Ja)}function xu(ri){return p[ri.getDay()]}function el(ri){return s[ri.getDay()]}function Uu(ri){return y[ri.getMonth()]}function xd(ri){return m[ri.getMonth()]}function vP(ri){return a[+(ri.getHours()>=12)]}function mP(ri){return 1+~~(ri.getMonth()/3)}function gP(ri){return p[ri.getUTCDay()]}function yP(ri){return s[ri.getUTCDay()]}function _P(ri){return y[ri.getUTCMonth()]}function xP(ri){return m[ri.getUTCMonth()]}function bP(ri){return a[+(ri.getUTCHours()>=12)]}function EP(ri){return 1+~~(ri.getUTCMonth()/3)}return{format:function(ri){var Ia=Nt(ri+="",tt);return Ia.toString=function(){return ri},Ia},parse:function(ri){var Ia=Kt(ri+="",!1);return Ia.toString=function(){return ri},Ia},utcFormat:function(ri){var Ia=Nt(ri+="",lt);return Ia.toString=function(){return ri},Ia},utcParse:function(ri){var Ia=Kt(ri+="",!0);return Ia.toString=function(){return ri},Ia}}}var E_={"-":"",_:" ","0":"0"},fu=/^\s*\d+/,Jw=/^%/,eA=/[\\^$*+?|[\]().{}]/g;function $a(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function tA(e){return e.replace(eA,"\\$&")}function ov(e){return new RegExp("^(?:"+e.map(tA).join("|")+")","i")}function sv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function rA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function nA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function iA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function aA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function oA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function S_(e,i,r){var n=fu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function C_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function sA(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function uA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function lA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function w_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function cA(e,i,r){var n=fu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function A_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function fA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function hA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function pA(e,i,r){var n=fu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function dA(e,i,r){var n=fu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function vA(e,i,r){var n=Jw.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function mA(e,i,r){var n=fu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function gA(e,i,r){var n=fu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function T_(e,i){return $a(e.getDate(),i,2)}function yA(e,i){return $a(e.getHours(),i,2)}function _A(e,i){return $a(e.getHours()%12||12,i,2)}function xA(e,i){return $a(1+Km.count(dd(e),e),i,3)}function M_(e,i){return $a(e.getMilliseconds(),i,3)}function bA(e,i){return M_(e,i)+"000"}function EA(e,i){return $a(e.getMonth()+1,i,2)}function SA(e,i){return $a(e.getMinutes(),i,2)}function CA(e,i){return $a(e.getSeconds(),i,2)}function wA(e){var i=e.getDay();return i===0?7:i}function AA(e,i){return $a(qm.count(dd(e)-1,e),i,2)}function P_(e){var i=e.getDay();return i>=4||i===0?vd(e):vd.ceil(e)}function TA(e,i){return e=P_(e),$a(vd.count(dd(e),e)+(dd(e).getDay()===4),i,2)}function MA(e){return e.getDay()}function PA(e,i){return $a(um.count(dd(e)-1,e),i,2)}function IA(e,i){return $a(e.getFullYear()%100,i,2)}function OA(e,i){return e=P_(e),$a(e.getFullYear()%100,i,2)}function RA(e,i){return $a(e.getFullYear()%1e4,i,4)}function kA(e,i){var r=e.getDay();return e=r>=4||r===0?vd(e):vd.ceil(e),$a(e.getFullYear()%1e4,i,4)}function LA(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+$a(i/60|0,"0",2)+$a(i%60,"0",2)}function I_(e,i){return $a(e.getUTCDate(),i,2)}function DA(e,i){return $a(e.getUTCHours(),i,2)}function FA(e,i){return $a(e.getUTCHours()%12||12,i,2)}function BA(e,i){return $a(1+b_.count(iv(e),e),i,3)}function O_(e,i){return $a(e.getUTCMilliseconds(),i,3)}function NA(e,i){return O_(e,i)+"000"}function zA(e,i){return $a(e.getUTCMonth()+1,i,2)}function UA(e,i){return $a(e.getUTCMinutes(),i,2)}function ZA(e,i){return $a(e.getUTCSeconds(),i,2)}function VA(e){var i=e.getUTCDay();return i===0?7:i}function jA(e,i){return $a(__.count(iv(e)-1,e),i,2)}function R_(e){var i=e.getUTCDay();return i>=4||i===0?md(e):md.ceil(e)}function GA(e,i){return e=R_(e),$a(md.count(iv(e),e)+(iv(e).getUTCDay()===4),i,2)}function HA(e){return e.getUTCDay()}function WA(e,i){return $a(cm.count(iv(e)-1,e),i,2)}function XA(e,i){return $a(e.getUTCFullYear()%100,i,2)}function YA(e,i){return e=R_(e),$a(e.getUTCFullYear()%100,i,2)}function qA(e,i){return $a(e.getUTCFullYear()%1e4,i,4)}function KA(e,i){var r=e.getUTCDay();return e=r>=4||r===0?md(e):md.ceil(e),$a(e.getUTCFullYear()%1e4,i,4)}function $A(){return"+0000"}function k_(){return"%"}function L_(e){return+e}function D_(e){return Math.floor(+e/1e3)}var gd,F_,QA,JA,eT;tT({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function tT(e){return gd=Qw(e),F_=gd.format,QA=gd.parse,JA=gd.utcFormat,eT=gd.utcParse,gd}var uv=1e3,lv=uv*60,cv=lv*60,fv=cv*24,rT=fv*7,B_=fv*30,e0=fv*365;function nT(e){return new Date(e)}function iT(e){return e instanceof Date?+e:+new Date(+e)}function N_(e,i,r,n,a,s,p,m,y){var E=Gy(Pc,Pc),A=E.invert,I=E.domain,L=y(".%L"),F=y(":%S"),W=y("%I:%M"),$=y("%I %p"),te=y("%a %d"),Ae=y("%b %d"),Xe=y("%B"),tt=y("%Y"),lt=[[p,1,uv],[p,5,5*uv],[p,15,15*uv],[p,30,30*uv],[s,1,lv],[s,5,5*lv],[s,15,15*lv],[s,30,30*lv],[a,1,cv],[a,3,3*cv],[a,6,6*cv],[a,12,12*cv],[n,1,fv],[n,2,2*fv],[r,1,rT],[i,1,B_],[i,3,3*B_],[e,1,e0]];function Ot(Kt){return(p(Kt)<Kt?L:s(Kt)<Kt?F:a(Kt)<Kt?W:n(Kt)<Kt?$:i(Kt)<Kt?r(Kt)<Kt?te:Ae:e(Kt)<Kt?Xe:tt)(Kt)}function Nt(Kt,fr,Zr,un){if(Kt==null&&(Kt=10),typeof Kt=="number"){var _r=Math.abs(Zr-fr)/Kt,wn=Oy(function(Ln){return Ln[2]}).right(lt,_r);wn===lt.length?(un=Nm(fr/e0,Zr/e0,Kt),Kt=e):wn?(wn=lt[_r/lt[wn-1][2]<lt[wn][2]/_r?wn-1:wn],un=wn[1],Kt=wn[0]):(un=Math.max(Nm(fr,Zr,Kt),1),Kt=m)}return un==null?Kt:Kt.every(un)}return E.invert=function(Kt){return new Date(A(Kt))},E.domain=function(Kt){return arguments.length?I(em.call(Kt,iT)):I().map(nT)},E.ticks=function(Kt,fr){var Zr=I(),un=Zr[0],_r=Zr[Zr.length-1],wn=_r<un,Ln;return wn&&(Ln=un,un=_r,_r=Ln),Ln=Nt(Kt,un,_r,fr),Ln=Ln?Ln.range(un,_r+1):[],wn?Ln.reverse():Ln},E.tickFormat=function(Kt,fr){return fr==null?Ot:y(fr)},E.nice=function(Kt,fr){var Zr=I();return(Kt=Nt(Kt,Zr[0],Zr[Zr.length-1],fr))?I(e_(Zr,Kt)):E},E.copy=function(){return rm(E,N_(e,i,r,n,a,s,p,m,y))},E}function aT(){return ep.apply(N_(dd,zw,qm,Km,Gw,Hw,Ww,Xw,F_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function P5(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function fm(){var e=0,i=1,r,n,a,s,p=identity,m=!1,y;function E(A){return isNaN(A=+A)?y:p(a===0?.5:(A=(s(A)-r)*a,m?Math.max(0,Math.min(1,A)):A))}return E.domain=function(A){return arguments.length?(r=s(e=+A[0]),n=s(i=+A[1]),a=r===n?0:1/(n-r),E):[e,i]},E.clamp=function(A){return arguments.length?(m=!!A,E):m},E.interpolator=function(A){return arguments.length?(p=A,E):p},E.unknown=function(A){return arguments.length?(y=A,E):y},function(A){return s=A,r=A(e),n=A(i),a=r===n?0:1/(n-r),E}}function hm(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function oT(){var e=linearish(fm()(identity));return e.copy=function(){return hm(e,oT())},initInterpolator.apply(e,arguments)}function sT(){var e=loggish(fm()).domain([1,10]);return e.copy=function(){return hm(e,sT()).base(e.base())},initInterpolator.apply(e,arguments)}function uT(){var e=symlogish(fm());return e.copy=function(){return hm(e,uT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function z_(){var e=powish(fm());return e.copy=function(){return hm(e,z_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function I5(){return z_.apply(null,arguments).exponent(.5)}function lT(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return lT(i).domain(e)},initInterpolator.apply(r,arguments)}function pm(){var e=0,i=.5,r=1,n,a,s,p,m,y=identity,E,A=!1,I;function L(F){return isNaN(F=+F)?I:(F=.5+((F=+E(F))-a)*(F<a?p:m),y(A?Math.max(0,Math.min(1,F)):F))}return L.domain=function(F){return arguments.length?(n=E(e=+F[0]),a=E(i=+F[1]),s=E(r=+F[2]),p=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),L):[e,i,r]},L.clamp=function(F){return arguments.length?(A=!!F,L):A},L.interpolator=function(F){return arguments.length?(y=F,L):y},L.unknown=function(F){return arguments.length?(I=F,L):I},function(F){return E=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),m=a===s?0:.5/(s-a),L}}function cT(){var e=linearish(pm()(identity));return e.copy=function(){return copy(e,cT())},initInterpolator.apply(e,arguments)}function fT(){var e=loggish(pm()).domain([.1,1,10]);return e.copy=function(){return copy(e,fT()).base(e.base())},initInterpolator.apply(e,arguments)}function hT(){var e=symlogish(pm());return e.copy=function(){return copy(e,hT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function U_(){var e=powish(pm());return e.copy=function(){return copy(e,U_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function O5(){return U_.apply(null,arguments).exponent(.5)}var af,Z_,V_,j_,t0,G_,pT=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,dT=(af={},(0,C.Z)(af,$s.LINEAR,Qy),(0,C.Z)(af,$s.POWER,Hm),(0,C.Z)(af,$s.LOG,i_),(0,C.Z)(af,$s.IDENTITY,Jy),(0,C.Z)(af,$s.TIME,aT),(0,C.Z)(af,$s.QUANTILE,u_),(0,C.Z)(af,$s.QUANTIZE,l_),(0,C.Z)(af,$s.THRESHOLD,c_),(0,C.Z)(af,$s.CAT,tm),af),vT=(Z_=(0,Vr.b2)(),V_=(0,Vr.f3)(Zt.IGlobalConfigService),Z_(j_=(t0=function(){function e(){(0,vt.Z)(this,e),Or(this,"configService",G_,this),(0,C.Z)(this,"scaleCache",{}),(0,C.Z)(this,"scaleOptions",{})}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;m.length!==0&&a.caculateScalesForAttributes(p||[],m)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),m=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],m),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var m=r.getSource().data.dataArray;if(m.length===0)return;var y=p.filter(function(E){return E.needRescale});y.length&&a.caculateScalesForAttributes(y,m)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,m=s.name;p.names=a.parseFields(s.scale.field||[]);var y=[];p.names.forEach(function(E){y.push(a.getOrCreateScale(E,s,n))}),y.some(function(E){return E.type===Yh.VARIABLE})?(p.type=Yh.VARIABLE,y.forEach(function(E){if(!p.callback){var A;if(p.values&&p.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&p.values.length>2){var L=E.scale.ticks(p.values.length);m==="color"&&E.scale.domain(L)}E.scale.range(p.values)}else((A=E.option)===null||A===void 0?void 0:A.type)==="cat"&&E.scale.range(E.option.domain)}})):(p.type=Yh.CONSTANT,p.defaultValues=y.map(function(E,A){return E.scale(p.names[A])})),p.scalers=y.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),m=(s=n.scale)===null||s===void 0?void 0:s.values,y=this.createScale(r,n.name,m,a);return y}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:c()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,m,y=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],E={field:r,scale:void 0,type:Yh.VARIABLE,option:y};if(!s||!s.length)return y&&y.type?E.scale=this.createDefaultScale(y):(E.scale=tm([r]),E.type=Yh.CONSTANT),E;var A=(m=s.find(function(F){return!wo()(F[r])}))===null||m===void 0?void 0:m[r];if(this.isNumber(r)||wo()(A)&&!y)E.scale=tm([r]),E.type=Yh.CONSTANT;else{var I=y&&y.type||this.getDefaultType(A);a==="text"&&(I=$s.CAT);var L=this.createDefaultScaleConfig(I,r,s);Object.assign(L,y),E.scale=this.createDefaultScale(L),E.option=L}return E}},{key:"getDefaultType",value:function(r){var n=$s.LINEAR;return typeof r=="string"&&(n=pT.test(r)?$s.TIME:$s.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(m){return m[n]}))||[];return r!==$s.CAT&&r!==$s.QUANTILE?s.domain=iw(p):r===$s.CAT?s.domain=Dd()(p):r===$s.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=dT[n]();return a&&s.domain(a),s}}]),e}(),G_=rn(t0.prototype,"configService",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t0))||j_),H_,W_,X_,Y_,dm,q_,K_;function $_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$_(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var gT=(H_=(0,Vr.b2)(),W_=(0,Vr.f3)(Zt.ICameraService),X_=(0,Vr.f3)(Zt.IRendererService),H_(Y_=(dm=function(){function e(){(0,vt.Z)(this,e),Or(this,"cameraService",q_,this),Or(this,"rendererService",K_,this)}return(0,kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(mT({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),q_=rn(dm.prototype,"cameraService",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K_=rn(dm.prototype,"rendererService",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm))||Y_),Q_,J_,yT=(Q_=(0,Vr.b2)(),Q_(J_=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||J_),e1,t1,_T=(e1=(0,Vr.b2)(),e1(t1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||t1),r1,n1,xT=["type"];function i1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?i1(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var a1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},bT={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},ET={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ST={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},R5=null;function CT(e){var i={u_DirectionalLights:new Array(3).fill(hv({},ET)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(hv({},ST)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[bT]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,Co.Z)(r,xT),m=a1[s].lights,y=a1[s].num,E=i[y];i[m][E]=hv(hv({},i[m][E]),p),i[y]++}),i}var wT=(r1=(0,Vr.b2)(),r1(n1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(hv({},CT()))})})}}]),e}())||n1),o1,s1,vm={NONE:0,ENCODE:1,HIGHLIGHT:2},AT=(o1=(0,Vr.b2)(),o1(s1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:qn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:O.FLOAT},size:3,update:function(y,E){var A=y.id;return p?Os(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),m=p.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:vm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),m=p.enablePicking;m&&r.isVisible()&&r.models.forEach(function(y){return y.addUniforms({u_PickingStage:vm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var m=r.getLayerConfig(),y=m.highlightColor,E=m.activeMix,A=E===void 0?0:E,I=m.enableSelect,L=typeof y=="string"?Xi(y):y||[1,0,0,1],F=r.getLayerConfig(),W=F.selectColor,$=typeof W=="string"?Xi(W):W||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ro(new Uint8Array(p))});var te=r.getCurrentSelectedId();r.models.forEach(function(Ae){return Ae.addUniforms({u_PickingStage:vm.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:L.map(function(Xe){return Xe*255}),u_activeMix:A,u_CurrentSelectedId:te?Os(r.getCurrentSelectedId()):[0,0,0],u_SelectColor:$.map(function(Xe){return Xe*255}),u_EnableSelect:+(I||!1)})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var m=r.getLayerConfig(),y=m.selectColor,E=m.selectMix,A=E===void 0?0:E,I=typeof y=="string"?Xi(y):y||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:ro(new Uint8Array(p))}),r.models.forEach(function(L){return L.addUniforms({u_PickingStage:vm.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:I.map(function(F){return F*255}),u_activeMix:A,u_CurrentSelectedId:p,u_SelectColor:I.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||s1),u1,l1,TT=(u1=(0,Vr.b2)(),u1(l1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:qn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:O.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:qn.Attribute,descriptor:{name:"filter",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:qn.Attribute,descriptor:{name:"a_Color",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:qn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:function(a,s,p,m){return[s]}}})}}]),e}())||l1),c1,f1,h1,p1,d1,v1,yd,m1,g1,y1,_1,MT=(c1=(0,Vr.b2)(),f1=(0,Vr.f3)(Zt.ICameraService),h1=(0,Vr.f3)(Zt.ICoordinateSystemService),p1=(0,Vr.f3)(Zt.IRendererService),d1=(0,Vr.f3)(Zt.IMapService),c1(v1=(yd=function(){function e(){(0,vt.Z)(this,e),Or(this,"cameraService",m1,this),Or(this,"coordinateSystemService",g1,this),Or(this,"rendererService",y1,this),Or(this,"mapService",_1,this)}return(0,kt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var m=n.rendererService.getViewportSize(),y=m.width,E=m.height;r.models.forEach(function(A){var I;A.addUniforms((I={},(0,C.Z)(I,Ip.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,C.Z)(I,Ip.ViewMatrix,n.cameraService.getViewMatrix()),(0,C.Z)(I,Ip.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,C.Z)(I,Ip.Zoom,n.cameraService.getZoom()),(0,C.Z)(I,Ip.ZoomScale,n.cameraService.getZoomScale()),(0,C.Z)(I,Ip.FocalDistance,n.cameraService.getFocalDistance()),(0,C.Z)(I,Ip.CameraPosition,n.cameraService.getCameraPosition()),(0,C.Z)(I,jl.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,C.Z)(I,jl.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,C.Z)(I,jl.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,C.Z)(I,jl.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,C.Z)(I,jl.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,C.Z)(I,jl.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,C.Z)(I,jl.Mvp,s),(0,C.Z)(I,"u_SceneCenterMKT",p),(0,C.Z)(I,"u_ViewportSize",[y,E]),(0,C.Z)(I,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,C.Z)(I,"u_DevicePixelRatio",na.devicePixelRatio),(0,C.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,C.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),m1=rn(yd.prototype,"cameraService",[f1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g1=rn(yd.prototype,"coordinateSystemService",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y1=rn(yd.prototype,"rendererService",[p1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_1=rn(yd.prototype,"mapService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd))||v1),x1,b1,PT=(x1=(0,Vr.b2)(),x1(b1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||b1),E1,S1,IT=(E1=(0,Vr.b2)(),E1(S1=function(){function e(){(0,vt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),m=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(y){return y.needRegenerateVertices=!1});return}s.filter(function(y){return y.needRegenerateVertices}).forEach(function(y){a.updateAttributeByFeatureRange(y.name,r.getEncodedData(),y.featureRange.startIndex,y.featureRange.endIndex),y.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||S1);ql.bind(Zt.ILayerPlugin).to(tw).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(TT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(vT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(ew).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(_T).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(IT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(PT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(xE).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(MT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(gT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(wT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(AT).inRequestScope(),ql.bind(Zt.ILayerPlugin).to(yT).inRequestScope();var k5="2.7.12";function C1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function L5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?C1(Object(r),!0).forEach(function(n){OT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function D5(e,i){return DT(e)||LT(e,i)||kT(e,i)||RT()}function RT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kT(e,i){if(!!e){if(typeof e=="string")return w1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w1(e,i)}}function w1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function LT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function DT(e){if(Array.isArray(e))return e}var F5=null,B5=null,A1,r0,T1;function M1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?M1(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var FT=(A1=wm(Zt.IGlobalConfigService),r0=function(){function e(i){(0,vt.Z)(this,e),Or(this,"configService",T1,this),(0,C.Z)(this,"config",void 0),this.config=i}return(0,kt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Zt.MapConfig).toConstantValue(P1(P1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Zt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),T1=rn(r0.prototype,"configService",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0),BT=J(6158),pv=J.n(BT);function dv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mm(e,i){var r=on([],i,e);return Le(r,r,1/r[3]),r}function N5(e,i){var r=e%i;return r<0?i+r:r}function z5(e,i,r){return r*i+(1-r)*e}function Vp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var of=Math.PI,I1=of/4,bh=of/180,O1=180/of,n0=512,i0=4003e4,NT=1.5;function R1(e){return Math.pow(2,e)}function zT(e){return Math.log2(e)}function gm(e,i){var r=(0,Tn.Z)(e,2),n=r[0],a=r[1];Vp(Number.isFinite(n)&&Number.isFinite(i)),Vp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=n0;var s=n*bh,p=a*bh,m=i*(s+of)/(2*of),y=i*(of-Math.log(Math.tan(I1+p*.5)))/(2*of);return[m,y]}function a0(e,i){var r=(0,Tn.Z)(e,2),n=r[0],a=r[1];i*=n0;var s=n/i*(2*of)-of,p=2*(Math.atan(Math.exp(of-a/i*(2*of)))-I1);return[s*O1,p*O1]}function U5(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*bh);return zT(i0*r)-9}function k1(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:R1(n),Vp(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var m={},y=n0*a,E=Math.cos(i*bh),A=y/360,I=A/E,L=y/i0/E;if(m.pixelsPerMeter=[L,-L,L],m.metersPerPixel=[1/L,-1/L,1/L],m.pixelsPerDegree=[A,-I,L],m.degreesPerPixel=[1/A,-1/I,1/L],p){var F=bh*Math.tan(i*bh)/E,W=A*F/2,$=y/i0*F,te=$/I*L;m.pixelsPerDegree2=[0,-W,$],m.pixelsPerMeter2=[te,0,te]}return m}function Z5(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),m=p[0],y=p[1],E=p[2],A=1,I=k1({longitude:n,latitude:a,scale:A,highPrecision:!0}),L=I.pixelsPerMeter,F=I.pixelsPerMeter2,W=gm(e,A);W[0]+=m*(L[0]+F[0]*y),W[1]+=y*(L[1]+F[1]*y);var $=a0(W,A),te=(s||0)+(E||0);return Number.isFinite(s)||Number.isFinite(E)?[$[0],$[1],te]:$}function UT(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,m=e.flipY,y=m===void 0?!1:m,E=dv();return sh(E,E,[0,0,-a]),Qc(E,E,[1,1,1/i]),Rh(E,E,-r*bh),kh(E,E,n*bh),y&&Qc(E,E,[1,-1,1]),p&&sh(E,E,ja.negate([],p)),E}function ZT(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?NT:n,s=e.pitch,p=s===void 0?0:s,m=e.nearZMultiplier,y=m===void 0?1:m,E=e.farZMultiplier,A=E===void 0?1:E,I=p*bh,L=Math.atan(.5/a),F=Math.sin(L)*a/Math.sin(Math.PI/2-I-L),W=Math.cos(Math.PI/2-I)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:y,far:W*A}}function VT(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,m=ZT({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),y=m.fov,E=m.aspect,A=m.near,I=m.far,L=dr([],y,E,A,I);return L}function jT(e,i){var r=(0,Tn.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Vp(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),mm(i,[n,a,p,1])}function L1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Tn.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Vp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var m=mm(i,[a,s,p,1]);return m}var y=mm(i,[a,s,0,1]),E=mm(i,[a,s,1,1]),A=y[2],I=E[2],L=A===I?0:((r||0)-A)/(I-A);return yi.lerp([],y,E,L)}var D1=dv(),GT=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?D1:a,p=i.projectionMatrix,m=p===void 0?D1:p;(0,vt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=m;var y=dv();gl(y,y,this.projectionMatrix),gl(y,y,this.viewMatrix),this.viewProjectionMatrix=y;var E=dv();Qc(E,E,[this.width/2,-this.height/2,1]),sh(E,E,[1,-1,0]),gl(E,E,this.viewProjectionMatrix);var A=oh(dv(),E);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,kt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Wt(r.projectionMatrix,this.projectionMatrix)&&Wt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),m=jT(p,this.pixelProjectionMatrix),y=(0,Tn.Z)(m,2),E=y[0],A=y[1],I=s?A:this.height-A;return r.length===2?[E,I]:[E,I,m[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,m=(0,Tn.Z)(r,3),y=m[0],E=m[1],A=m[2],I=s?E:this.height-E,L=p&&p*this.pixelsPerMeter,F=L1([y,I,A],this.pixelUnprojectionMatrix,L),W=this.unprojectPosition(F),$=(0,Tn.Z)(W,3),te=$[0],Ae=$[1],Xe=$[2];return Number.isFinite(A)?[te,Ae,Xe]:Number.isFinite(p)?[te,Ae,p]:[te,Ae]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,Tn.Z)(n,2),s=a[0],p=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[s,p,m]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,Tn.Z)(n,2),s=a[0],p=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[s,p,m]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function HT(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,m=p===void 0?24:p,y=e.padding,E=y===void 0?0:y,A=e.offset,I=A===void 0?[0,0]:A,L=(0,Tn.Z)(n,2),F=(0,Tn.Z)(L[0],2),W=F[0],$=F[1],te=(0,Tn.Z)(L[1],2),Ae=te[0],Xe=te[1];if(Number.isFinite(E)){var tt=E;E={top:tt,bottom:tt,left:tt,right:tt}}else Vp(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var lt=new F1({width:i,height:r,longitude:0,latitude:0,zoom:0}),Ot=lt.project([W,Xe]),Nt=lt.project([Ae,$]),Kt=[Math.max(Math.abs(Nt[0]-Ot[0]),s),Math.max(Math.abs(Nt[1]-Ot[1]),s)],fr=[i-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Vp(fr[0]>0&&fr[1]>0);var Zr=fr[0]/Kt[0],un=fr[1]/Kt[1],_r=(E.right-E.left)/2/Zr,wn=(E.bottom-E.top)/2/un,Ln=[(Nt[0]+Ot[0])/2+_r,(Nt[1]+Ot[1])/2+wn],ci=lt.unproject(Ln),Qa=lt.zoom+Math.log2(Math.abs(Math.min(Zr,un)));return{longitude:ci[0],latitude:ci[1],zoom:Math.min(Qa,m)}}var F1=function(e){(0,Fr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,m=p===void 0?0:p,y=n.longitude,E=y===void 0?0:y,A=n.zoom,I=A===void 0?0:A,L=n.pitch,F=L===void 0?0:L,W=n.bearing,$=W===void 0?0:W,te=n.altitude,Ae=te===void 0?1.5:te,Xe=n.nearZMultiplier,tt=n.farZMultiplier;(0,vt.Z)(this,i),a=a||1,s=s||1;var lt=R1(I);Ae=Math.max(.75,Ae);var Ot=gm([E,m],lt);Ot[2]=0;var Nt=VT({width:a,height:s,pitch:F,bearing:$,altitude:Ae,nearZMultiplier:Xe||1/s,farZMultiplier:tt||1.01}),Kt=UT({height:s,center:Ot,pitch:F,bearing:$,altitude:Ae,flipY:!0});return r=(0,xn.Z)(this,(0,Ct.Z)(i).call(this,{width:a,height:s,viewMatrix:Kt,projectionMatrix:Nt})),r.latitude=m,r.longitude=E,r.zoom=I,r.pitch=F,r.bearing=$,r.altitude=Ae,r.scale=lt,r.center=Ot,r.pixelsPerMeter=k1((0,de.Z)((0,de.Z)(r))).pixelsPerMeter[2],Object.freeze((0,de.Z)((0,de.Z)(r))),r}return(0,kt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return gm(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a0(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=L1(s,this.pixelUnprojectionMatrix),m=gm(a,this.scale),y=yi.add([],m,yi.negate([],p)),E=yi.add([],this.center,y);return a0(E,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,m=HT(Object.assign({width:s,height:p,bounds:n},a)),y=m.longitude,E=m.latitude,A=m.zoom;return new i({width:s,height:p,longitude:y,latitude:E,zoom:A})}}]),i}(GT),WT=function(){function e(){(0,vt.Z)(this,e),(0,C.Z)(this,"viewport",void 0)}return(0,kt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,m=r.viewportHeight,y=r.viewportWidth;this.viewport=new F1({width:y,height:m,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),B1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},XT=["id","attributionControl","style","token","rotation","mapInstance"],N1,z1,U1,Z1,V1,j1,_d,G1,H1,W1,X1;function Y1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function YT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Y1(Object(r),!0).forEach(function(n){(0,C.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qT(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}qT(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=pv();var q1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},KT=0,$T=12,K1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",QT=(N1=(0,Vr.b2)(),z1=(0,Vr.f3)(Zt.MapConfig),U1=(0,Vr.f3)(Zt.IGlobalConfigService),Z1=(0,Vr.f3)(Zt.ICoordinateSystemService),V1=(0,Vr.f3)(Zt.IEventEmitter),N1(j1=(_d=function(){function e(){var i=this;(0,vt.Z)(this,e),(0,C.Z)(this,"version",Bp.MAPBOX),(0,C.Z)(this,"map",void 0),(0,C.Z)(this,"dragging",!1),(0,C.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Or(this,"config",G1,this),Or(this,"configService",H1,this),Or(this,"coordinateSystemService",W1,this),Or(this,"eventEmitter",X1,this),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"markerContainer",void 0),(0,C.Z)(this,"cameraChangedCallback",void 0),(0,C.Z)(this,"$mapContainer",void 0),(0,C.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?$T:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Ya.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Ya.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,kt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Na("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Rb.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(q1[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(q1[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,m=a.y,y=m===void 0?0:m,E=a.z,A=E===void 0?0:E;return{x:p,y,z:A}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},m=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),y=m.meterInMercatorCoordinateUnits(),E=ml();return sh(E,E,ja.fromValues(m.x-p.x,m.y-p.y,m.z||0-p.z)),Qc(E,E,ja.fromValues(y*s[0],-y*s[1],y*s[2])),Rh(E,E,a[0]),Jc(E,E,a[1]),kh(E,E,a[2]),E}},{key:"init",value:function(){var i=(0,M.Z)(B().mark(function n(){var a=this,s,p,m,y,E,A,I,L,F,W,$,te,Ae;return B().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:s=this.config,p=s.id,m=p===void 0?"map":p,y=s.attributionControl,E=y===void 0?!1:y,A=s.style,I=A===void 0?"light":A,L=s.token,F=L===void 0?K1:L,W=s.rotation,$=W===void 0?0:W,te=s.mapInstance,Ae=(0,Co.Z)(s,XT),this.viewport=new WT,!te&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),F===K1&&I!=="blank"&&!window.mapboxgl.accessToken&&!te&&console.warn(this.configService.getSceneWarninfo("MapToken")),!te&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=F),te?(this.map=te,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(m),this.map=new window.mapboxgl.Map(YT({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:$},Ae))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return a.dragging=!0,""}),this.map.on("dragend",function(){return a.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return tt.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(pv()).LngLat(r[0],r[1]),s=new(pv()).LngLat(n[0],n[1]),p=a.distanceTo(s),m=pv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),y=pv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),E=m.x,A=m.y,I=y.x,L=y.y,F=Math.sqrt(Math.pow(E-I,2)+Math.pow(A-L,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+KT++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:B1[r]?B1[r]:r}}]),e}(),G1=rn(_d.prototype,"config",[z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=rn(_d.prototype,"configService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=rn(_d.prototype,"coordinateSystemService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X1=rn(_d.prototype,"eventEmitter",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||j1);function JT(e){var i=eM();return function(){var n=(0,Ct.Z)(e),a;if(i){var s=(0,Ct.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,xn.Z)(this,a)}}function eM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function tM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}tM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var rM=function(e){(0,Fr.Z)(r,e);var i=JT(r);function r(){return(0,vt.Z)(this,r),i.apply(this,arguments)}return(0,kt.Z)(r,[{key:"getServiceConstructor",value:function(){return QT}}]),r}(FT);function $1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$1(Object(r),!0).forEach(function(n){nM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function iM(e,i){return uM(e)||sM(e,i)||oM(e,i)||aM()}function aM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oM(e,i){if(!!e){if(typeof e=="string")return J1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J1(e,i)}}function J1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function sM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function uM(e){if(Array.isArray(e))return e}var lM=ge.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,ge.createRef)(),m=(0,ge.useState)(),y=iM(m,2),E=y[0],A=y[1];return(0,ge.useEffect)(function(){var I=new yE(Q1(Q1({id:p.current},a),{},{map:new rM(n)}));return I.on("loaded",function(){A(I),s&&s(I)}),function(){I.destroy()}},[]),(0,ge.useEffect)(function(){E&&n.style&&E.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ge.useEffect)(function(){E&&n.zoom&&E.setZoom(n.zoom)},[n.zoom]),(0,ge.useEffect)(function(){E&&n.center&&E.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ge.useEffect)(function(){E&&n.pitch!==void 0&&E.setPitch(n.pitch||0)},[n.pitch]),(0,ge.useEffect)(function(){E&&n.rotation&&E.setRotation(n.rotation)},[n.rotation]),ge.createElement(v.Provider,{value:E},(0,ge.createElement)("div",{ref:p,style:i,className:r},E&&e.children))}),cM=lM;function ex(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function V5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ex(Object(r),!0).forEach(function(n){fM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function j5(e,i){return vM(e)||dM(e,i)||pM(e,i)||hM()}function hM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pM(e,i){if(!!e){if(typeof e=="string")return tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tx(e,i)}}function tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function dM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function vM(e){if(Array.isArray(e))return e}var G5=null,H5=null;function rx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function W5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rx(Object(r),!0).forEach(function(n){mM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function X5(e,i){return xM(e)||_M(e,i)||yM(e,i)||gM()}function gM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yM(e,i){if(!!e){if(typeof e=="string")return nx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nx(e,i)}}function nx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _M(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function xM(e){if(Array.isArray(e))return e}var Y5=null,q5=null;function K5(e,i){return CM(e)||SM(e,i)||EM(e,i)||bM()}function bM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EM(e,i){if(!!e){if(typeof e=="string")return ix(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ix(e,i)}}function ix(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function SM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function CM(e){if(Array.isArray(e))return e}var $5=null,Q5=null;function ax(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function J5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ax(Object(r),!0).forEach(function(n){wM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ax(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function eI(e,i){if(e==null)return{};var r=AM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function AM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var tI=null,ox=J(73935);function sx(e,i){return IM(e)||PM(e,i)||MM(e,i)||TM()}function TM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MM(e,i){if(!!e){if(typeof e=="string")return ux(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ux(e,i)}}function ux(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function PM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function IM(e){if(Array.isArray(e))return e}var lx=ge.useEffect,cx=ge.useState,OM=/\B([A-Z])/g,RM=function(i){return i.replace(OM,"-$1").toLowerCase()};function rI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=cx(),p=sx(s,2),m=p[0],y=p[1],E=useSceneValue(),A=cx(function(){return document.createElement("div")}),I=sx(A,1),L=I[0];return lx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(L.className=i),r){var W=Object.keys(r).map(function($){return"".concat(RM($),":").concat(r[$])}).join(";");L.style.cssText=W}return L},F.onRemove=function(){},y(F),E.addControl(F),function(){E.removeControl(F)}},[]),lx(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(n,L)}var fx=(0,ge.createContext)({});function nI(){return useContext(fx)}var Ff=J(96486),iI=ge.useEffect,kM=ge.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Ff.isEqual),aI=ge.useEffect,LM=ge.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Ff.isEqual),oI=ge.useEffect,DM=ge.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Ff.isEqual),FM=ge.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Ff.isEqual),BM=ge.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Ff.isEqual),sI=ge.useEffect,NM=ge.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Ff.isEqual),zM=ge.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Ff.isEqual),UM=ge.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Ff.isEqual),ZM=["data"];function VM(e,i){if(e==null)return{};var r=jM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function jM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var GM=ge.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=VM(n,ZM);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Ff.isEqual),uI=ge.useEffect,HM=ge.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Ff.isEqual);function WM(e,i){return KM(e)||qM(e,i)||YM(e,i)||XM()}function XM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YM(e,i){if(!!e){if(typeof e=="string")return hx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hx(e,i)}}function hx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function qM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,m;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(y){s=!0,m=y}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw m}}return n}}function KM(e){if(Array.isArray(e))return e}var vv=ge.useEffect,$M=ge.useState;function px(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,m=i.scale,y=i.active,E=i.select,A=i.filter,I=i.animate,L=i.options,F=i.onLayerLoaded,W=Oe(),$=$M(function(){var Xe;switch(e){case"polygonLayer":Xe=new yy(L);break;case"lineLayer":Xe=new kS(L);break;case"pointLayer":Xe=new wC(L);break;case"heatmapLayer":Xe=new R2(L);break;case"rasterLayer":Xe=new QC(L);break;case"imageLayer":Xe=new V2(L);break;case"citybuildingLayer":Xe=new n2(L);break;default:Xe=new yy(L)}return Xe.on("inited",function(){F&&F(Xe,W)}),Xe}),te=WM($,1),Ae=te[0];return vv(function(){return W.addLayer(Ae),function(){W.removeLayer(Ae)}},[]),vv(function(){Ae.inited&&L&&Ae.updateLayerConfig(L)},[L==null?void 0:L.minZoom,L==null?void 0:L.maxZoom,L==null?void 0:L.visible]),vv(function(){Ae.inited&&(L==null?void 0:L.zIndex)&&Ae.setIndex(L.zIndex)},[L==null?void 0:L.zIndex]),vv(function(){Ae.inited&&(L==null?void 0:L.blend)&&Ae.setBlend(L.blend)},[L==null?void 0:L.blend]),vv(function(){W.render()}),ge.createElement(fx.Provider,{value:Ae},ge.createElement(GM,{layer:Ae,source:r}),m&&ge.createElement(BM,{layer:Ae,scale:m}),n&&ge.createElement(DM,{layer:Ae,color:n}),p&&ge.createElement(UM,{layer:Ae,size:p}),a&&ge.createElement(zM,{layer:Ae,shape:a}),s&&ge.createElement(HM,{layer:Ae,style:s}),y&&ge.createElement(kM,{layer:Ae,active:y}),E&&ge.createElement(NM,{layer:Ae,select:E}),A&&ge.createElement(FM,{layer:Ae,filter:A}),I&&ge.createElement(LM,{layer:Ae,animate:I}),i.children)}var lI=null,cI=null,QM=ge.memo(function(i){return px("pointLayer",i)}),JM=ge.memo(function(i){return px("heatmapLayer",i)}),fI=null,hI=null,pI=null,dI=ge.useEffect,vI=null,mI=null;function ym(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ym=function(r){return typeof r}:ym=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ym(e)}function dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dx(Object(r),!0).forEach(function(n){eP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function vx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function rP(e,i,r){return i&&vx(e.prototype,i),r&&vx(e,r),e}function nP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&o0(e,i)}function o0(e,i){return o0=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},o0(e,i)}function iP(e){var i=sP();return function(){var n=xm(e),a;if(i){var s=xm(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return aP(this,a)}}function aP(e,i){if(i&&(ym(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oP(e)}function oP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function sP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xm(e){return xm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},xm(e)}var gI=function(e){nP(r,e);var i=iP(r);function r(n){var a;return tP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return rP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,m=s.children,y=s.option,E=s.lngLat,A=new og(_m(_m({},y),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&A.setLnglat(p),E&&A.setLnglat(E),m&&A.setDOMContent(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var s,p,m,y,E,A,I=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],L=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(y=m.lnglat)===null||y===void 0?void 0:y.lng,(E=this.props)===null||E===void 0||(A=E.lnglat)===null||A===void 0?void 0:A.lat],F=I.toString()!==L.toString();if(F){var W;this.popup.remove(),this.popup=new og(_m(_m({},this.props.option),{},{stopPropagation:(W=this.props.option)===null||W===void 0?void 0:W.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ge.createElement(v.Consumer,{},function(s){return s&&(a.scene=s),(0,ox.createPortal)(a.props.children,a.el)})}}]),r}(ge.PureComponent);function bm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bm=function(r){return typeof r}:bm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},bm(e)}function uP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function mx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function lP(e,i,r){return i&&mx(e.prototype,i),r&&mx(e,r),e}function cP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&s0(e,i)}function s0(e,i){return s0=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},s0(e,i)}function fP(e){var i=dP();return function(){var n=Em(e),a;if(i){var s=Em(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return hP(this,a)}}function hP(e,i){if(i&&(bm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pP(e)}function pP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Em(e){return Em=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Em(e)}var yI=function(e){cP(r,e);var i=fP(r);function r(n){var a;return uP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return lP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,m=a.option,y=a.onMarkerLoaded,E=new tg(m);s&&E.setLnglat(s),p&&E.setElement(this.el),this.marker=E,y&&y(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ge.createElement(v.Consumer,{},function(s){return s&&(a.scene=s),(0,ox.createPortal)(a.props.children,a.el)})}}]),r}(ge.PureComponent),_I=ge.useEffect,xI=null,bI=null,EI=ge.useEffect,SI=null},66213:function(Ar,ne,J){"use strict";J.d(ne,{Z:function(){return v}});var Ie=J(77608);function ge(Oe,H){for(;!Object.prototype.hasOwnProperty.call(Oe,H)&&(Oe=(0,Ie.Z)(Oe),Oe!==null););return Oe}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(H,ce,he){var Fe=ge(H,ce);if(!!Fe){var ye=Object.getOwnPropertyDescriptor(Fe,ce);return ye.get?ye.get.call(arguments.length<3?H:he):ye.value}},v.apply(this,arguments)}},31795:function(Ar,ne,J){var Ie=J(75752);Ar.exports.geometry=ge,Ar.exports.ring=Oe;function ge(ce){var he=0,Fe;switch(ce.type){case"Polygon":return v(ce.coordinates);case"MultiPolygon":for(Fe=0;Fe<ce.coordinates.length;Fe++)he+=v(ce.coordinates[Fe]);return he;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Fe=0;Fe<ce.geometries.length;Fe++)he+=ge(ce.geometries[Fe]);return he}}function v(ce){var he=0;if(ce&&ce.length>0){he+=Math.abs(Oe(ce[0]));for(var Fe=1;Fe<ce.length;Fe++)he-=Math.abs(Oe(ce[Fe]))}return he}function Oe(ce){var he,Fe,ye,Je,ft,xt,Jt,ur=0,It=ce.length;if(It>2){for(Jt=0;Jt<It;Jt++)Jt===It-2?(Je=It-2,ft=It-1,xt=0):Jt===It-1?(Je=It-1,ft=0,xt=1):(Je=Jt,ft=Jt+1,xt=Jt+2),he=ce[Je],Fe=ce[ft],ye=ce[xt],ur+=(H(ye[0])-H(he[0]))*Math.sin(H(Fe[1]));ur=ur*Ie.RADIUS*Ie.RADIUS/2}return ur}function H(ce){return ce*Math.PI/180}},38163:function(Ar,ne,J){var Ie=J(31795);Ar.exports=ge;function ge(Fe,ye){switch(Fe&&Fe.type||null){case"FeatureCollection":return Fe.features=Fe.features.map(v(ge,ye)),Fe;case"GeometryCollection":return Fe.geometries=Fe.geometries.map(v(ge,ye)),Fe;case"Feature":return Fe.geometry=ge(Fe.geometry,ye),Fe;case"Polygon":case"MultiPolygon":return Oe(Fe,ye);default:return Fe}}function v(Fe,ye){return function(Je){return Fe(Je,ye)}}function Oe(Fe,ye){return Fe.type==="Polygon"?Fe.coordinates=H(Fe.coordinates,ye):Fe.type==="MultiPolygon"&&(Fe.coordinates=Fe.coordinates.map(v(H,ye))),Fe}function H(Fe,ye){ye=!!ye,Fe[0]=ce(Fe[0],ye);for(var Je=1;Je<Fe.length;Je++)Fe[Je]=ce(Fe[Je],!ye);return Fe}function ce(Fe,ye){return he(Fe)===ye?Fe:Fe.reverse()}function he(Fe){return Ie.ring(Fe)>=0}},53645:function(){},9187:function(Ar){"use strict";Ar.exports=ne,Ar.exports.default=ne;function ne(C,Se,ke){ke=ke||2;var _t=Se&&Se.length,ht=_t?Se[0]*ke:C.length,Lt=J(C,0,ht,ke,!0),Ht=[];if(!Lt||Lt.next===Lt.prev)return Ht;var xr,Kn,mn,di,Gn,ni,vi;if(_t&&(Lt=he(C,Se,Lt,ke)),C.length>80*ke){xr=mn=C[0],Kn=di=C[1];for(var Hn=ke;Hn<ht;Hn+=ke)Gn=C[Hn],ni=C[Hn+1],Gn<xr&&(xr=Gn),ni<Kn&&(Kn=ni),Gn>mn&&(mn=Gn),ni>di&&(di=ni);vi=Math.max(mn-xr,di-Kn),vi=vi!==0?1/vi:0}return ge(Lt,Ht,ke,xr,Kn,vi),Ht}function J(C,Se,ke,_t,ht){var Lt,Ht;if(ht===nn(C,Se,ke,_t)>0)for(Lt=Se;Lt<ke;Lt+=_t)Ht=Yt(Lt,C[Lt],C[Lt+1],Ht);else for(Lt=ke-_t;Lt>=Se;Lt-=_t)Ht=Yt(Lt,C[Lt],C[Lt+1],Ht);return Ht&&pt(Ht,Ht.next)&&(Er(Ht),Ht=Ht.next),Ht}function Ie(C,Se){if(!C)return C;Se||(Se=C);var ke=C,_t;do if(_t=!1,!ke.steiner&&(pt(ke,ke.next)||ct(ke.prev,ke,ke.next)===0)){if(Er(ke),ke=Se=ke.prev,ke===ke.next)break;_t=!0}else ke=ke.next;while(_t||ke!==Se);return Se}function ge(C,Se,ke,_t,ht,Lt,Ht){if(!!C){!Ht&&Lt&&xt(C,_t,ht,Lt);for(var xr=C,Kn,mn;C.prev!==C.next;){if(Kn=C.prev,mn=C.next,Lt?Oe(C,_t,ht,Lt):v(C)){Se.push(Kn.i/ke),Se.push(C.i/ke),Se.push(mn.i/ke),Er(C),C=mn.next,xr=mn.next;continue}if(C=mn,C===xr){Ht?Ht===1?(C=H(Ie(C),Se,ke),ge(C,Se,ke,_t,ht,Lt,2)):Ht===2&&ce(C,Se,ke,_t,ht,Lt):ge(Ie(C),Se,ke,_t,ht,Lt,1);break}}}}function v(C){var Se=C.prev,ke=C,_t=C.next;if(ct(Se,ke,_t)>=0)return!1;for(var ht=C.next.next;ht!==C.prev;){if(er(Se.x,Se.y,ke.x,ke.y,_t.x,_t.y,ht.x,ht.y)&&ct(ht.prev,ht,ht.next)>=0)return!1;ht=ht.next}return!0}function Oe(C,Se,ke,_t){var ht=C.prev,Lt=C,Ht=C.next;if(ct(ht,Lt,Ht)>=0)return!1;for(var xr=ht.x<Lt.x?ht.x<Ht.x?ht.x:Ht.x:Lt.x<Ht.x?Lt.x:Ht.x,Kn=ht.y<Lt.y?ht.y<Ht.y?ht.y:Ht.y:Lt.y<Ht.y?Lt.y:Ht.y,mn=ht.x>Lt.x?ht.x>Ht.x?ht.x:Ht.x:Lt.x>Ht.x?Lt.x:Ht.x,di=ht.y>Lt.y?ht.y>Ht.y?ht.y:Ht.y:Lt.y>Ht.y?Lt.y:Ht.y,Gn=ur(xr,Kn,Se,ke,_t),ni=ur(mn,di,Se,ke,_t),vi=C.prevZ,Hn=C.nextZ;vi&&vi.z>=Gn&&Hn&&Hn.z<=ni;){if(vi!==C.prev&&vi!==C.next&&er(ht.x,ht.y,Lt.x,Lt.y,Ht.x,Ht.y,vi.x,vi.y)&&ct(vi.prev,vi,vi.next)>=0||(vi=vi.prevZ,Hn!==C.prev&&Hn!==C.next&&er(ht.x,ht.y,Lt.x,Lt.y,Ht.x,Ht.y,Hn.x,Hn.y)&&ct(Hn.prev,Hn,Hn.next)>=0))return!1;Hn=Hn.nextZ}for(;vi&&vi.z>=Gn;){if(vi!==C.prev&&vi!==C.next&&er(ht.x,ht.y,Lt.x,Lt.y,Ht.x,Ht.y,vi.x,vi.y)&&ct(vi.prev,vi,vi.next)>=0)return!1;vi=vi.prevZ}for(;Hn&&Hn.z<=ni;){if(Hn!==C.prev&&Hn!==C.next&&er(ht.x,ht.y,Lt.x,Lt.y,Ht.x,Ht.y,Hn.x,Hn.y)&&ct(Hn.prev,Hn,Hn.next)>=0)return!1;Hn=Hn.nextZ}return!0}function H(C,Se,ke){var _t=C;do{var ht=_t.prev,Lt=_t.next.next;!pt(ht,Lt)&&ir(ht,_t,_t.next,Lt)&&Ye(ht,Lt)&&Ye(Lt,ht)&&(Se.push(ht.i/ke),Se.push(_t.i/ke),Se.push(Lt.i/ke),Er(_t),Er(_t.next),_t=C=Lt),_t=_t.next}while(_t!==C);return Ie(_t)}function ce(C,Se,ke,_t,ht,Lt){var Ht=C;do{for(var xr=Ht.next.next;xr!==Ht.prev;){if(Ht.i!==xr.i&&jt(Ht,xr)){var Kn=$e(Ht,xr);Ht=Ie(Ht,Ht.next),Kn=Ie(Kn,Kn.next),ge(Ht,Se,ke,_t,ht,Lt),ge(Kn,Se,ke,_t,ht,Lt);return}xr=xr.next}Ht=Ht.next}while(Ht!==C)}function he(C,Se,ke,_t){var ht=[],Lt,Ht,xr,Kn,mn;for(Lt=0,Ht=Se.length;Lt<Ht;Lt++)xr=Se[Lt]*_t,Kn=Lt<Ht-1?Se[Lt+1]*_t:C.length,mn=J(C,xr,Kn,_t,!1),mn===mn.next&&(mn.steiner=!0),ht.push(It(mn));for(ht.sort(Fe),Lt=0;Lt<ht.length;Lt++)ke=ye(ht[Lt],ke),ke=Ie(ke,ke.next);return ke}function Fe(C,Se){return C.x-Se.x}function ye(C,Se){var ke=Je(C,Se);if(!ke)return Se;var _t=$e(ke,C),ht=Ie(ke,ke.next);return Ie(_t,_t.next),Se===ke?ht:Se}function Je(C,Se){var ke=Se,_t=C.x,ht=C.y,Lt=-Infinity,Ht;do{if(ht<=ke.y&&ht>=ke.next.y&&ke.next.y!==ke.y){var xr=ke.x+(ht-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(xr<=_t&&xr>Lt){if(Lt=xr,xr===_t){if(ht===ke.y)return ke;if(ht===ke.next.y)return ke.next}Ht=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Se);if(!Ht)return null;if(_t===Lt)return Ht;var Kn=Ht,mn=Ht.x,di=Ht.y,Gn=Infinity,ni;ke=Ht;do _t>=ke.x&&ke.x>=mn&&_t!==ke.x&&er(ht<di?_t:Lt,ht,mn,di,ht<di?Lt:_t,ht,ke.x,ke.y)&&(ni=Math.abs(ht-ke.y)/(_t-ke.x),Ye(ke,C)&&(ni<Gn||ni===Gn&&(ke.x>Ht.x||ke.x===Ht.x&&ft(Ht,ke)))&&(Ht=ke,Gn=ni)),ke=ke.next;while(ke!==Kn);return Ht}function ft(C,Se){return ct(C.prev,C,Se.prev)<0&&ct(Se.next,C,C.next)<0}function xt(C,Se,ke,_t){var ht=C;do ht.z===null&&(ht.z=ur(ht.x,ht.y,Se,ke,_t)),ht.prevZ=ht.prev,ht.nextZ=ht.next,ht=ht.next;while(ht!==C);ht.prevZ.nextZ=null,ht.prevZ=null,Jt(ht)}function Jt(C){var Se,ke,_t,ht,Lt,Ht,xr,Kn,mn=1;do{for(ke=C,C=null,Lt=null,Ht=0;ke;){for(Ht++,_t=ke,xr=0,Se=0;Se<mn&&(xr++,_t=_t.nextZ,!!_t);Se++);for(Kn=mn;xr>0||Kn>0&&_t;)xr!==0&&(Kn===0||!_t||ke.z<=_t.z)?(ht=ke,ke=ke.nextZ,xr--):(ht=_t,_t=_t.nextZ,Kn--),Lt?Lt.nextZ=ht:C=ht,ht.prevZ=Lt,Lt=ht;ke=_t}Lt.nextZ=null,mn*=2}while(Ht>1);return C}function ur(C,Se,ke,_t,ht){return C=32767*(C-ke)*ht,Se=32767*(Se-_t)*ht,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,C|Se<<1}function It(C){var Se=C,ke=C;do(Se.x<ke.x||Se.x===ke.x&&Se.y<ke.y)&&(ke=Se),Se=Se.next;while(Se!==C);return ke}function er(C,Se,ke,_t,ht,Lt,Ht,xr){return(ht-Ht)*(Se-xr)-(C-Ht)*(Lt-xr)>=0&&(C-Ht)*(_t-xr)-(ke-Ht)*(Se-xr)>=0&&(ke-Ht)*(Lt-xr)-(ht-Ht)*(_t-xr)>=0}function jt(C,Se){return C.next.i!==Se.i&&C.prev.i!==Se.i&&!st(C,Se)&&(Ye(C,Se)&&Ye(Se,C)&&bt(C,Se)&&(ct(C.prev,C,Se.prev)||ct(C,Se.prev,Se))||pt(C,Se)&&ct(C.prev,C,C.next)>0&&ct(Se.prev,Se,Se.next)>0)}function ct(C,Se,ke){return(Se.y-C.y)*(ke.x-Se.x)-(Se.x-C.x)*(ke.y-Se.y)}function pt(C,Se){return C.x===Se.x&&C.y===Se.y}function ir(C,Se,ke,_t){var ht=Xt(ct(C,Se,ke)),Lt=Xt(ct(C,Se,_t)),Ht=Xt(ct(ke,_t,C)),xr=Xt(ct(ke,_t,Se));return!!(ht!==Lt&&Ht!==xr||ht===0&&Y(C,ke,Se)||Lt===0&&Y(C,_t,Se)||Ht===0&&Y(ke,C,_t)||xr===0&&Y(ke,Se,_t))}function Y(C,Se,ke){return Se.x<=Math.max(C.x,ke.x)&&Se.x>=Math.min(C.x,ke.x)&&Se.y<=Math.max(C.y,ke.y)&&Se.y>=Math.min(C.y,ke.y)}function Xt(C){return C>0?1:C<0?-1:0}function st(C,Se){var ke=C;do{if(ke.i!==C.i&&ke.next.i!==C.i&&ke.i!==Se.i&&ke.next.i!==Se.i&&ir(ke,ke.next,C,Se))return!0;ke=ke.next}while(ke!==C);return!1}function Ye(C,Se){return ct(C.prev,C,C.next)<0?ct(C,Se,C.next)>=0&&ct(C,C.prev,Se)>=0:ct(C,Se,C.prev)<0||ct(C,C.next,Se)<0}function bt(C,Se){var ke=C,_t=!1,ht=(C.x+Se.x)/2,Lt=(C.y+Se.y)/2;do ke.y>Lt!=ke.next.y>Lt&&ke.next.y!==ke.y&&ht<(ke.next.x-ke.x)*(Lt-ke.y)/(ke.next.y-ke.y)+ke.x&&(_t=!_t),ke=ke.next;while(ke!==C);return _t}function $e(C,Se){var ke=new Hr(C.i,C.x,C.y),_t=new Hr(Se.i,Se.x,Se.y),ht=C.next,Lt=Se.prev;return C.next=Se,Se.prev=C,ke.next=ht,ht.prev=ke,_t.next=ke,ke.prev=_t,Lt.next=_t,_t.prev=Lt,_t}function Yt(C,Se,ke,_t){var ht=new Hr(C,Se,ke);return _t?(ht.next=_t.next,ht.prev=_t,_t.next.prev=ht,_t.next=ht):(ht.prev=ht,ht.next=ht),ht}function Er(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Hr(C,Se,ke){this.i=C,this.x=Se,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ne.deviation=function(C,Se,ke,_t){var ht=Se&&Se.length,Lt=ht?Se[0]*ke:C.length,Ht=Math.abs(nn(C,0,Lt,ke));if(ht)for(var xr=0,Kn=Se.length;xr<Kn;xr++){var mn=Se[xr]*ke,di=xr<Kn-1?Se[xr+1]*ke:C.length;Ht-=Math.abs(nn(C,mn,di,ke))}var Gn=0;for(xr=0;xr<_t.length;xr+=3){var ni=_t[xr]*ke,vi=_t[xr+1]*ke,Hn=_t[xr+2]*ke;Gn+=Math.abs((C[ni]-C[Hn])*(C[vi+1]-C[ni+1])-(C[ni]-C[vi])*(C[Hn+1]-C[ni+1]))}return Ht===0&&Gn===0?0:Math.abs((Gn-Ht)/Ht)};function nn(C,Se,ke,_t){for(var ht=0,Lt=Se,Ht=ke-_t;Lt<ke;Lt+=_t)ht+=(C[Ht]-C[Lt])*(C[Lt+1]+C[Ht+1]),Ht=Lt;return ht}ne.flatten=function(C){for(var Se=C[0][0].length,ke={vertices:[],holes:[],dimensions:Se},_t=0,ht=0;ht<C.length;ht++){for(var Lt=0;Lt<C[ht].length;Lt++)for(var Ht=0;Ht<Se;Ht++)ke.vertices.push(C[ht][Lt][Ht]);ht>0&&(_t+=C[ht-1].length,ke.holes.push(_t))}return ke}},67709:function(Ar){function ne(Ie){var ge=Ie.target||Ie.srcElement;ge.__resizeRAF__&&cancelAnimationFrame(ge.__resizeRAF__),ge.__resizeRAF__=requestAnimationFrame(function(){var v=ge.__resizeTrigger__,Oe=v&&v.__resizeListeners__;Oe&&Oe.forEach(function(H){H.call(v,Ie)})})}var J=function(ge,v){var Oe=this,H=Oe.document,ce,he=H.attachEvent;typeof navigator!="undefined"&&(ce=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Fe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ne)}if(!ge.__resizeListeners__)if(ge.__resizeListeners__=[],he)ge.__resizeTrigger__=ge,ge.attachEvent("onresize",ne);else{getComputedStyle(ge).position==="static"&&(ge.style.position="relative");var ye=ge.__resizeTrigger__=H.createElement("object");ye.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ye.setAttribute("class","resize-sensor"),ye.setAttribute("tabindex","-1"),ye.setAttribute("title",""),ye.__resizeElement__=ge,ye.onload=Fe,ye.type="text/html",ce&&ge.appendChild(ye),ye.data="about:blank",ce||ge.appendChild(ye)}ge.__resizeListeners__.push(v)};Ar.exports=typeof window=="undefined"?J:J.bind(window),Ar.exports.unbind=function(Ie,ge){var v=document.attachEvent,Oe=Ie.__resizeListeners__||[];if(ge){var H=Oe.indexOf(ge);H!==-1&&Oe.splice(H,1)}else Oe=Ie.__resizeListeners__=[];if(!Oe.length){if(v)Ie.detachEvent("onresize",ne);else if(Ie.__resizeTrigger__){var ce=Ie.__resizeTrigger__.contentDocument,he=ce&&ce.defaultView;he&&(he.removeEventListener("resize",ne),delete he.__resizeTrigger__),Ie.__resizeTrigger__=!Ie.removeChild(Ie.__resizeTrigger__)}delete Ie.__resizeListeners__}}},26729:function(Ar){"use strict";var ne=Object.prototype.hasOwnProperty,J="~";function Ie(){}Object.create&&(Ie.prototype=Object.create(null),new Ie().__proto__||(J=!1));function ge(ce,he,Fe){this.fn=ce,this.context=he,this.once=Fe||!1}function v(ce,he,Fe,ye,Je){if(typeof Fe!="function")throw new TypeError("The listener must be a function");var ft=new ge(Fe,ye||ce,Je),xt=J?J+he:he;return ce._events[xt]?ce._events[xt].fn?ce._events[xt]=[ce._events[xt],ft]:ce._events[xt].push(ft):(ce._events[xt]=ft,ce._eventsCount++),ce}function Oe(ce,he){--ce._eventsCount==0?ce._events=new Ie:delete ce._events[he]}function H(){this._events=new Ie,this._eventsCount=0}H.prototype.eventNames=function(){var he=[],Fe,ye;if(this._eventsCount===0)return he;for(ye in Fe=this._events)ne.call(Fe,ye)&&he.push(J?ye.slice(1):ye);return Object.getOwnPropertySymbols?he.concat(Object.getOwnPropertySymbols(Fe)):he},H.prototype.listeners=function(he){var Fe=J?J+he:he,ye=this._events[Fe];if(!ye)return[];if(ye.fn)return[ye.fn];for(var Je=0,ft=ye.length,xt=new Array(ft);Je<ft;Je++)xt[Je]=ye[Je].fn;return xt},H.prototype.listenerCount=function(he){var Fe=J?J+he:he,ye=this._events[Fe];return ye?ye.fn?1:ye.length:0},H.prototype.emit=function(he,Fe,ye,Je,ft,xt){var Jt=J?J+he:he;if(!this._events[Jt])return!1;var ur=this._events[Jt],It=arguments.length,er,jt;if(ur.fn){switch(ur.once&&this.removeListener(he,ur.fn,void 0,!0),It){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,Fe),!0;case 3:return ur.fn.call(ur.context,Fe,ye),!0;case 4:return ur.fn.call(ur.context,Fe,ye,Je),!0;case 5:return ur.fn.call(ur.context,Fe,ye,Je,ft),!0;case 6:return ur.fn.call(ur.context,Fe,ye,Je,ft,xt),!0}for(jt=1,er=new Array(It-1);jt<It;jt++)er[jt-1]=arguments[jt];ur.fn.apply(ur.context,er)}else{var ct=ur.length,pt;for(jt=0;jt<ct;jt++)switch(ur[jt].once&&this.removeListener(he,ur[jt].fn,void 0,!0),It){case 1:ur[jt].fn.call(ur[jt].context);break;case 2:ur[jt].fn.call(ur[jt].context,Fe);break;case 3:ur[jt].fn.call(ur[jt].context,Fe,ye);break;case 4:ur[jt].fn.call(ur[jt].context,Fe,ye,Je);break;default:if(!er)for(pt=1,er=new Array(It-1);pt<It;pt++)er[pt-1]=arguments[pt];ur[jt].fn.apply(ur[jt].context,er)}}return!0},H.prototype.on=function(he,Fe,ye){return v(this,he,Fe,ye,!1)},H.prototype.once=function(he,Fe,ye){return v(this,he,Fe,ye,!0)},H.prototype.removeListener=function(he,Fe,ye,Je){var ft=J?J+he:he;if(!this._events[ft])return this;if(!Fe)return Oe(this,ft),this;var xt=this._events[ft];if(xt.fn)xt.fn===Fe&&(!Je||xt.once)&&(!ye||xt.context===ye)&&Oe(this,ft);else{for(var Jt=0,ur=[],It=xt.length;Jt<It;Jt++)(xt[Jt].fn!==Fe||Je&&!xt[Jt].once||ye&&xt[Jt].context!==ye)&&ur.push(xt[Jt]);ur.length?this._events[ft]=ur.length===1?ur[0]:ur:Oe(this,ft)}return this},H.prototype.removeAllListeners=function(he){var Fe;return he?(Fe=J?J+he:he,this._events[Fe]&&Oe(this,Fe)):(this._events=new Ie,this._eventsCount=0),this},H.prototype.off=H.prototype.removeListener,H.prototype.addListener=H.prototype.on,H.prefixed=J,H.EventEmitter=H,Ar.exports=H},7375:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var J=Symbol.for("INJECTION");function Ie(ce,he,Fe,ye){function Je(){return ye&&!Reflect.hasMetadata(J,this,he)&&Reflect.defineMetadata(J,Fe(),this,he),Reflect.hasMetadata(J,this,he)?Reflect.getMetadata(J,this,he):Fe()}function ft(xt){Reflect.defineMetadata(J,xt,this,he)}Object.defineProperty(ce,he,{configurable:!0,enumerable:!0,get:Je,set:ft})}function ge(ce,he){return function(Fe){return function(ye,Je){var ft=function(){return ce.get(Fe)};Ie(ye,Je,ft,he)}}}ne.makePropertyInjectDecorator=ge;function v(ce,he){return function(Fe,ye){return function(Je,ft){var xt=function(){return ce.getNamed(Fe,ye)};Ie(Je,ft,xt,he)}}}ne.makePropertyInjectNamedDecorator=v;function Oe(ce,he){return function(Fe,ye,Je){return function(ft,xt){var Jt=function(){return ce.getTagged(Fe,ye,Je)};Ie(ft,xt,Jt,he)}}}ne.makePropertyInjectTaggedDecorator=Oe;function H(ce,he){return function(Fe){return function(ye,Je){var ft=function(){return ce.getAll(Fe)};Ie(ye,Je,ft,he)}}}ne.makePropertyMultiInjectDecorator=H},84879:function(Ar,ne,J){"use strict";var Ie;Ie={value:!0};var ge=J(7375);function v(Oe,H){H===void 0&&(H=!0);var ce=ge.makePropertyInjectDecorator(Oe,H),he=ge.makePropertyInjectNamedDecorator(Oe,H),Fe=ge.makePropertyInjectTaggedDecorator(Oe,H),ye=ge.makePropertyMultiInjectDecorator(Oe,H);return{lazyInject:ce,lazyInjectNamed:he,lazyInjectTagged:Fe,lazyMultiInject:ye}}ne.Z=v},99934:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagProperty=ne.tagParameter=ne.decorate=void 0;var Ie=J(16674),ge=J(6867);function v(ye,Je,ft,xt){var Jt=ge.TAGGED;H(Jt,ye,Je,xt,ft)}ne.tagParameter=v;function Oe(ye,Je,ft){var xt=ge.TAGGED_PROP;H(xt,ye.constructor,Je,ft)}ne.tagProperty=Oe;function H(ye,Je,ft,xt,Jt){var ur={},It=typeof Jt=="number",er=Jt!==void 0&&It?Jt.toString():ft;if(It&&ft!==void 0)throw new Error(Ie.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ye,Je)&&(ur=Reflect.getMetadata(ye,Je));var jt=ur[er];if(!Array.isArray(jt))jt=[];else for(var ct=0,pt=jt;ct<pt.length;ct++){var ir=pt[ct];if(ir.key===xt.key)throw new Error(Ie.DUPLICATED_METADATA+" "+ir.key.toString())}jt.push(xt),ur[er]=jt,Reflect.defineMetadata(ye,ur,Je)}function ce(ye,Je){Reflect.decorate(ye,Je)}function he(ye,Je){return function(ft,xt){Je(ft,xt,ye)}}function Fe(ye,Je,ft){typeof ft=="number"?ce([he(ft,ye)],Je):typeof ft=="string"?Reflect.decorate([ye],Je,ft):ce([ye],Je)}ne.decorate=Fe},5744:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.inject=ne.LazyServiceIdentifer=void 0;var Ie=J(16674),ge=J(6867),v=J(47738),Oe=J(99934),H=function(){function he(Fe){this._cb=Fe}return he.prototype.unwrap=function(){return this._cb()},he}();ne.LazyServiceIdentifer=H;function ce(he){return function(Fe,ye,Je){if(he===void 0)throw new Error(Ie.UNDEFINED_INJECT_ANNOTATION(Fe.name));var ft=new v.Metadata(ge.INJECT_TAG,he);typeof Je=="number"?Oe.tagParameter(Fe,ye,Je,ft):Oe.tagProperty(Fe,ye,ft)}}ne.inject=ce},64315:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.injectable=void 0;var Ie=J(16674),ge=J(6867);function v(){return function(Oe){if(Reflect.hasOwnMetadata(ge.PARAM_TYPES,Oe))throw new Error(Ie.DUPLICATED_INJECTABLE_DECORATOR);var H=Reflect.getMetadata(ge.DESIGN_PARAM_TYPES,Oe)||[];return Reflect.defineMetadata(ge.PARAM_TYPES,H,Oe),Oe}}ne.injectable=v},71693:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiInject=void 0;var Ie=J(6867),ge=J(47738),v=J(99934);function Oe(H){return function(ce,he,Fe){var ye=new ge.Metadata(Ie.MULTI_INJECT_TAG,H);typeof Fe=="number"?v.tagParameter(ce,he,Fe,ye):v.tagProperty(ce,he,ye)}}ne.multiInject=Oe},38085:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.named=void 0;var Ie=J(6867),ge=J(47738),v=J(99934);function Oe(H){return function(ce,he,Fe){var ye=new ge.Metadata(Ie.NAMED_TAG,H);typeof Fe=="number"?v.tagParameter(ce,he,Fe,ye):v.tagProperty(ce,he,ye)}}ne.named=Oe},6515:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.optional=void 0;var Ie=J(6867),ge=J(47738),v=J(99934);function Oe(){return function(H,ce,he){var Fe=new ge.Metadata(Ie.OPTIONAL_TAG,!0);typeof he=="number"?v.tagParameter(H,ce,he,Fe):v.tagProperty(H,ce,Fe)}}ne.optional=Oe},7014:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.postConstruct=void 0;var Ie=J(16674),ge=J(6867),v=J(47738);function Oe(){return function(H,ce,he){var Fe=new v.Metadata(ge.POST_CONSTRUCT,ce);if(Reflect.hasOwnMetadata(ge.POST_CONSTRUCT,H.constructor))throw new Error(Ie.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ge.POST_CONSTRUCT,Fe,H.constructor)}}ne.postConstruct=Oe},32052:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.tagged=void 0;var Ie=J(47738),ge=J(99934);function v(Oe,H){return function(ce,he,Fe){var ye=new Ie.Metadata(Oe,H);typeof Fe=="number"?ge.tagParameter(ce,he,Fe,ye):ge.tagProperty(ce,he,ye)}}ne.tagged=v},55638:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.targetName=void 0;var Ie=J(6867),ge=J(47738),v=J(99934);function Oe(H){return function(ce,he,Fe){var ye=new ge.Metadata(Ie.NAME_TAG,H);v.tagParameter(ce,he,Fe,ye)}}ne.targetName=Oe},86757:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.unmanaged=void 0;var Ie=J(6867),ge=J(47738),v=J(99934);function Oe(){return function(H,ce,he){var Fe=new ge.Metadata(Ie.UNMANAGED_TAG,!0);v.tagParameter(H,ce,he,Fe)}}ne.unmanaged=Oe},44290:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Binding=void 0;var Ie=J(28421),ge=J(37791),v=function(){function Oe(H,ce){this.id=ge.id(),this.activated=!1,this.serviceIdentifier=H,this.scope=ce,this.type=Ie.BindingTypeEnum.Invalid,this.constraint=function(he){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Oe.prototype.clone=function(){var H=new Oe(this.serviceIdentifier,this.scope);return H.activated=H.scope===Ie.BindingScopeEnum.Singleton?this.activated:!1,H.implementationType=this.implementationType,H.dynamicValue=this.dynamicValue,H.scope=this.scope,H.type=this.type,H.factory=this.factory,H.provider=this.provider,H.constraint=this.constraint,H.onActivation=this.onActivation,H.cache=this.cache,H},Oe}();ne.Binding=v},23184:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingCount=void 0;var J={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ne.BindingCount=J},16674:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.STACK_OVERFLOW=ne.CIRCULAR_DEPENDENCY_IN_FACTORY=ne.POST_CONSTRUCT_ERROR=ne.MULTIPLE_POST_CONSTRUCT_METHODS=ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ne.ARGUMENTS_LENGTH_MISMATCH=ne.INVALID_DECORATOR_OPERATION=ne.INVALID_TO_SELF_VALUE=ne.INVALID_FUNCTION_BINDING=ne.INVALID_MIDDLEWARE_RETURN=ne.NO_MORE_SNAPSHOTS_AVAILABLE=ne.INVALID_BINDING_TYPE=ne.NOT_IMPLEMENTED=ne.CIRCULAR_DEPENDENCY=ne.UNDEFINED_INJECT_ANNOTATION=ne.MISSING_INJECT_ANNOTATION=ne.MISSING_INJECTABLE_ANNOTATION=ne.NOT_REGISTERED=ne.CANNOT_UNBIND=ne.AMBIGUOUS_MATCH=ne.KEY_NOT_FOUND=ne.NULL_ARGUMENT=ne.DUPLICATED_METADATA=ne.DUPLICATED_INJECTABLE_DECORATOR=void 0,ne.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ne.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ne.NULL_ARGUMENT="NULL argument",ne.KEY_NOT_FOUND="Key Not Found",ne.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ne.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ne.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ne.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ne.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var J=function(Oe){return"@inject called with undefined this could mean that the class "+Oe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ne.UNDEFINED_INJECT_ANNOTATION=J,ne.CIRCULAR_DEPENDENCY="Circular dependency found:",ne.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ne.INVALID_BINDING_TYPE="Invalid binding type:",ne.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ne.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ne.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ne.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ne.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Ie=function(){for(var Oe=[],H=0;H<arguments.length;H++)Oe[H]=arguments[H];return"The number of constructor arguments in the derived class "+(Oe[0]+" must be >= than the number of constructor arguments of its base class.")};ne.ARGUMENTS_LENGTH_MISMATCH=Ie,ne.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ne.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ne.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ne.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ne.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ge=function(){for(var Oe=[],H=0;H<arguments.length;H++)Oe[H]=arguments[H];return"@postConstruct error in class "+Oe[0]+": "+Oe[1]};ne.POST_CONSTRUCT_ERROR=ge;var v=function(){for(var Oe=[],H=0;H<arguments.length;H++)Oe[H]=arguments[H];return"It looks like there is a circular dependency "+("in one of the '"+Oe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Oe[1]+"'.")};ne.CIRCULAR_DEPENDENCY_IN_FACTORY=v,ne.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.TargetTypeEnum=ne.BindingTypeEnum=ne.BindingScopeEnum=void 0;var J={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ne.BindingScopeEnum=J;var Ie={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ne.BindingTypeEnum=Ie;var ge={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ne.TargetTypeEnum=ge},6867:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.NON_CUSTOM_TAG_KEYS=ne.POST_CONSTRUCT=ne.DESIGN_PARAM_TYPES=ne.PARAM_TYPES=ne.TAGGED_PROP=ne.TAGGED=ne.MULTI_INJECT_TAG=ne.INJECT_TAG=ne.OPTIONAL_TAG=ne.UNMANAGED_TAG=ne.NAME_TAG=ne.NAMED_TAG=void 0,ne.NAMED_TAG="named",ne.NAME_TAG="name",ne.UNMANAGED_TAG="unmanaged",ne.OPTIONAL_TAG="optional",ne.INJECT_TAG="inject",ne.MULTI_INJECT_TAG="multi_inject",ne.TAGGED="inversify:tagged",ne.TAGGED_PROP="inversify:tagged_props",ne.PARAM_TYPES="inversify:paramtypes",ne.DESIGN_PARAM_TYPES="design:paramtypes",ne.POST_CONSTRUCT="post_construct";function J(){return[ne.INJECT_TAG,ne.MULTI_INJECT_TAG,ne.NAME_TAG,ne.UNMANAGED_TAG,ne.NAMED_TAG,ne.OPTIONAL_TAG]}ne.NON_CUSTOM_TAG_KEYS=J()},51389:function(Ar,ne,J){"use strict";var Ie=this&&this.__awaiter||function(jt,ct,pt,ir){function Y(Xt){return Xt instanceof pt?Xt:new pt(function(st){st(Xt)})}return new(pt||(pt=Promise))(function(Xt,st){function Ye(Yt){try{$e(ir.next(Yt))}catch(Er){st(Er)}}function bt(Yt){try{$e(ir.throw(Yt))}catch(Er){st(Er)}}function $e(Yt){Yt.done?Xt(Yt.value):Y(Yt.value).then(Ye,bt)}$e((ir=ir.apply(jt,ct||[])).next())})},ge=this&&this.__generator||function(jt,ct){var pt={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},ir,Y,Xt,st;return st={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(st[Symbol.iterator]=function(){return this}),st;function Ye($e){return function(Yt){return bt([$e,Yt])}}function bt($e){if(ir)throw new TypeError("Generator is already executing.");for(;pt;)try{if(ir=1,Y&&(Xt=$e[0]&2?Y.return:$e[0]?Y.throw||((Xt=Y.return)&&Xt.call(Y),0):Y.next)&&!(Xt=Xt.call(Y,$e[1])).done)return Xt;switch(Y=0,Xt&&($e=[$e[0]&2,Xt.value]),$e[0]){case 0:case 1:Xt=$e;break;case 4:return pt.label++,{value:$e[1],done:!1};case 5:pt.label++,Y=$e[1],$e=[0];continue;case 7:$e=pt.ops.pop(),pt.trys.pop();continue;default:if(Xt=pt.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&($e[0]===6||$e[0]===2)){pt=0;continue}if($e[0]===3&&(!Xt||$e[1]>Xt[0]&&$e[1]<Xt[3])){pt.label=$e[1];break}if($e[0]===6&&pt.label<Xt[1]){pt.label=Xt[1],Xt=$e;break}if(Xt&&pt.label<Xt[2]){pt.label=Xt[2],pt.ops.push($e);break}Xt[2]&&pt.ops.pop(),pt.trys.pop();continue}$e=ct.call(jt,pt)}catch(Yt){$e=[6,Yt],Y=0}finally{ir=Xt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(jt,ct){for(var pt=0,ir=ct.length,Y=jt.length;pt<ir;pt++,Y++)jt[Y]=ct[pt];return jt};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Container=void 0;var Oe=J(44290),H=J(16674),ce=J(28421),he=J(6867),Fe=J(51377),ye=J(86311),Je=J(31927),ft=J(15451),xt=J(37791),Jt=J(55800),ur=J(85700),It=J(80175),er=function(){function jt(ct){this._appliedMiddleware=[];var pt=ct||{};if(typeof pt!="object")throw new Error(""+H.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=ce.BindingScopeEnum.Transient;else if(pt.defaultScope!==ce.BindingScopeEnum.Singleton&&pt.defaultScope!==ce.BindingScopeEnum.Transient&&pt.defaultScope!==ce.BindingScopeEnum.Request)throw new Error(""+H.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+H.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+H.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=xt.id(),this._bindingDictionary=new It.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Fe.MetadataReader}return jt.merge=function(ct,pt){for(var ir=[],Y=2;Y<arguments.length;Y++)ir[Y-2]=arguments[Y];var Xt=new jt,st=v([ct,pt],ir).map(function($e){return ye.getBindingDictionary($e)}),Ye=ye.getBindingDictionary(Xt);function bt($e,Yt){$e.traverse(function(Er,Hr){Hr.forEach(function(nn){Yt.add(nn.serviceIdentifier,nn.clone())})})}return st.forEach(function($e){bt($e,Ye)}),Xt},jt.prototype.load=function(){for(var ct=[],pt=0;pt<arguments.length;pt++)ct[pt]=arguments[pt];for(var ir=this._getContainerModuleHelpersFactory(),Y=0,Xt=ct;Y<Xt.length;Y++){var st=Xt[Y],Ye=ir(st.id);st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},jt.prototype.loadAsync=function(){for(var ct=[],pt=0;pt<arguments.length;pt++)ct[pt]=arguments[pt];return Ie(this,void 0,void 0,function(){var ir,Y,Xt,st,Ye;return ge(this,function(bt){switch(bt.label){case 0:ir=this._getContainerModuleHelpersFactory(),Y=0,Xt=ct,bt.label=1;case 1:return Y<Xt.length?(st=Xt[Y],Ye=ir(st.id),[4,st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:bt.sent(),bt.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},jt.prototype.unload=function(){for(var ct=this,pt=[],ir=0;ir<arguments.length;ir++)pt[ir]=arguments[ir];var Y=function(Xt){return function(st){return st.moduleId===Xt}};pt.forEach(function(Xt){var st=Y(Xt.id);ct._bindingDictionary.removeByCondition(st)})},jt.prototype.bind=function(ct){var pt=this.options.defaultScope||ce.BindingScopeEnum.Transient,ir=new Oe.Binding(ct,pt);return this._bindingDictionary.add(ct,ir),new ft.BindingToSyntax(ir)},jt.prototype.rebind=function(ct){return this.unbind(ct),this.bind(ct)},jt.prototype.unbind=function(ct){try{this._bindingDictionary.remove(ct)}catch(pt){throw new Error(H.CANNOT_UNBIND+" "+Jt.getServiceIdentifierAsString(ct))}},jt.prototype.unbindAll=function(){this._bindingDictionary=new It.Lookup},jt.prototype.isBound=function(ct){var pt=this._bindingDictionary.hasKey(ct);return!pt&&this.parent&&(pt=this.parent.isBound(ct)),pt},jt.prototype.isBoundNamed=function(ct,pt){return this.isBoundTagged(ct,he.NAMED_TAG,pt)},jt.prototype.isBoundTagged=function(ct,pt,ir){var Y=!1;if(this._bindingDictionary.hasKey(ct)){var Xt=this._bindingDictionary.get(ct),st=ye.createMockRequest(this,ct,pt,ir);Y=Xt.some(function(Ye){return Ye.constraint(st)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(ct,pt,ir)),Y},jt.prototype.snapshot=function(){this._snapshots.push(ur.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},jt.prototype.restore=function(){var ct=this._snapshots.pop();if(ct===void 0)throw new Error(H.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ct.bindings,this._middleware=ct.middleware},jt.prototype.createChild=function(ct){var pt=new jt(ct||this.options);return pt.parent=this,pt},jt.prototype.applyMiddleware=function(){for(var ct=[],pt=0;pt<arguments.length;pt++)ct[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(ct);var ir=this._middleware?this._middleware:this._planAndResolve();this._middleware=ct.reduce(function(Y,Xt){return Xt(Y)},ir)},jt.prototype.applyCustomMetadataReader=function(ct){this._metadataReader=ct},jt.prototype.get=function(ct){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ct)},jt.prototype.getTagged=function(ct,pt,ir){return this._get(!1,!1,ce.TargetTypeEnum.Variable,ct,pt,ir)},jt.prototype.getNamed=function(ct,pt){return this.getTagged(ct,he.NAMED_TAG,pt)},jt.prototype.getAll=function(ct){return this._get(!0,!0,ce.TargetTypeEnum.Variable,ct)},jt.prototype.getAllTagged=function(ct,pt,ir){return this._get(!1,!0,ce.TargetTypeEnum.Variable,ct,pt,ir)},jt.prototype.getAllNamed=function(ct,pt){return this.getAllTagged(ct,he.NAMED_TAG,pt)},jt.prototype.resolve=function(ct){var pt=this.createChild();return pt.bind(ct).toSelf(),this._appliedMiddleware.forEach(function(ir){pt.applyMiddleware(ir)}),pt.get(ct)},jt.prototype._getContainerModuleHelpersFactory=function(){var ct=this,pt=function(Ye,bt){Ye._binding.moduleId=bt},ir=function(Ye){return function(bt){var $e=ct.bind.bind(ct),Yt=$e(bt);return pt(Yt,Ye),Yt}},Y=function(Ye){return function(bt){var $e=ct.unbind.bind(ct);$e(bt)}},Xt=function(Ye){return function(bt){var $e=ct.isBound.bind(ct);return $e(bt)}},st=function(Ye){return function(bt){var $e=ct.rebind.bind(ct),Yt=$e(bt);return pt(Yt,Ye),Yt}};return function(Ye){return{bindFunction:ir(Ye),isboundFunction:Xt(Ye),rebindFunction:st(Ye),unbindFunction:Y(Ye)}}},jt.prototype._get=function(ct,pt,ir,Y,Xt,st){var Ye=null,bt={avoidConstraints:ct,contextInterceptor:function($e){return $e},isMultiInject:pt,key:Xt,serviceIdentifier:Y,targetType:ir,value:st};if(this._middleware){if(Ye=this._middleware(bt),Ye==null)throw new Error(H.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(bt);return Ye},jt.prototype._planAndResolve=function(){var ct=this;return function(pt){var ir=ye.plan(ct._metadataReader,ct,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);ir=pt.contextInterceptor(ir);var Y=Je.resolve(ir);return Y}},jt}();ne.Container=er},33244:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.AsyncContainerModule=ne.ContainerModule=void 0;var Ie=J(37791),ge=function(){function Oe(H){this.id=Ie.id(),this.registry=H}return Oe}();ne.ContainerModule=ge;var v=function(){function Oe(H){this.id=Ie.id(),this.registry=H}return Oe}();ne.AsyncContainerModule=v},85700:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.ContainerSnapshot=void 0;var J=function(){function Ie(){}return Ie.of=function(ge,v){var Oe=new Ie;return Oe.bindings=ge,Oe.middleware=v,Oe},Ie}();ne.ContainerSnapshot=J},80175:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Lookup=void 0;var Ie=J(16674),ge=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(Oe,H){if(Oe==null)throw new Error(Ie.NULL_ARGUMENT);if(H==null)throw new Error(Ie.NULL_ARGUMENT);var ce=this._map.get(Oe);ce!==void 0?(ce.push(H),this._map.set(Oe,ce)):this._map.set(Oe,[H])},v.prototype.get=function(Oe){if(Oe==null)throw new Error(Ie.NULL_ARGUMENT);var H=this._map.get(Oe);if(H!==void 0)return H;throw new Error(Ie.KEY_NOT_FOUND)},v.prototype.remove=function(Oe){if(Oe==null)throw new Error(Ie.NULL_ARGUMENT);if(!this._map.delete(Oe))throw new Error(Ie.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(Oe){var H=this;this._map.forEach(function(ce,he){var Fe=ce.filter(function(ye){return!Oe(ye)});Fe.length>0?H._map.set(he,Fe):H._map.delete(he)})},v.prototype.hasKey=function(Oe){if(Oe==null)throw new Error(Ie.NULL_ARGUMENT);return this._map.has(Oe)},v.prototype.clone=function(){var Oe=new v;return this._map.forEach(function(H,ce){H.forEach(function(he){return Oe.add(ce,he.clone())})}),Oe},v.prototype.traverse=function(Oe){this._map.forEach(function(H,ce){Oe(ce,H)})},v}();ne.Lookup=ge},86700:function(Ar,ne,J){"use strict";var Ie;Ie={value:!0},Ie=Ie=Ie=Ie=Ie=Ie=ne.GW=Ie=Ie=ne.zY=Ie=Ie=Ie=Ie=Ie=ne.f3=Ie=Ie=ne.b2=Ie=Ie=Ie=Ie=Ie=ne.W2=Ie=void 0;var ge=J(6867);Ie=ge;var v=J(51389);Object.defineProperty(ne,"W2",{enumerable:!0,get:function(){return v.Container}});var Oe=J(28421);Ie={enumerable:!0,get:function(){return Oe.BindingScopeEnum}},Ie={enumerable:!0,get:function(){return Oe.BindingTypeEnum}},Ie={enumerable:!0,get:function(){return Oe.TargetTypeEnum}};var H=J(33244);Ie={enumerable:!0,get:function(){return H.AsyncContainerModule}},Ie={enumerable:!0,get:function(){return H.ContainerModule}};var ce=J(64315);Object.defineProperty(ne,"b2",{enumerable:!0,get:function(){return ce.injectable}});var he=J(32052);Ie={enumerable:!0,get:function(){return he.tagged}};var Fe=J(38085);Ie={enumerable:!0,get:function(){return Fe.named}};var ye=J(5744);Object.defineProperty(ne,"f3",{enumerable:!0,get:function(){return ye.inject}}),Ie={enumerable:!0,get:function(){return ye.LazyServiceIdentifer}};var Je=J(6515);Ie={enumerable:!0,get:function(){return Je.optional}};var ft=J(86757);Ie={enumerable:!0,get:function(){return ft.unmanaged}};var xt=J(71693);Ie={enumerable:!0,get:function(){return xt.multiInject}};var Jt=J(55638);Ie={enumerable:!0,get:function(){return Jt.targetName}};var ur=J(7014);Object.defineProperty(ne,"zY",{enumerable:!0,get:function(){return ur.postConstruct}});var It=J(51377);Ie={enumerable:!0,get:function(){return It.MetadataReader}};var er=J(37791);Ie={enumerable:!0,get:function(){return er.id}};var jt=J(99934);Object.defineProperty(ne,"GW",{enumerable:!0,get:function(){return jt.decorate}});var ct=J(80758);Ie={enumerable:!0,get:function(){return ct.traverseAncerstors}},Ie={enumerable:!0,get:function(){return ct.taggedConstraint}},Ie={enumerable:!0,get:function(){return ct.namedConstraint}},Ie={enumerable:!0,get:function(){return ct.typeConstraint}};var pt=J(55800);Ie={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var ir=J(70600);Ie={enumerable:!0,get:function(){return ir.multiBindToService}}},95228:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Context=void 0;var Ie=J(37791),ge=function(){function v(Oe){this.id=Ie.id(),this.container=Oe}return v.prototype.addPlan=function(Oe){this.plan=Oe},v.prototype.setCurrentRequest=function(Oe){this.currentRequest=Oe},v}();ne.Context=ge},47738:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Metadata=void 0;var Ie=J(6867),ge=function(){function v(Oe,H){this.key=Oe,this.value=H}return v.prototype.toString=function(){return this.key===Ie.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();ne.Metadata=ge},51377:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.MetadataReader=void 0;var Ie=J(6867),ge=function(){function v(){}return v.prototype.getConstructorMetadata=function(Oe){var H=Reflect.getMetadata(Ie.PARAM_TYPES,Oe),ce=Reflect.getMetadata(Ie.TAGGED,Oe);return{compilerGeneratedMetadata:H,userGeneratedMetadata:ce||{}}},v.prototype.getPropertiesMetadata=function(Oe){var H=Reflect.getMetadata(Ie.TAGGED_PROP,Oe)||[];return H},v}();ne.MetadataReader=ge},55314:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Plan=void 0;var J=function(){function Ie(ge,v){this.parentContext=ge,this.rootRequest=v}return Ie}();ne.Plan=J},86311:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.getBindingDictionary=ne.createMockRequest=ne.plan=void 0;var Ie=J(23184),ge=J(16674),v=J(28421),Oe=J(6867),H=J(85265),ce=J(55800),he=J(95228),Fe=J(47738),ye=J(55314),Je=J(6e3),ft=J(6748),xt=J(18924);function Jt(Y){return Y._bindingDictionary}ne.getBindingDictionary=Jt;function ur(Y,Xt,st,Ye,bt,$e){var Yt=Y?Oe.MULTI_INJECT_TAG:Oe.INJECT_TAG,Er=new Fe.Metadata(Yt,st),Hr=new xt.Target(Xt,Ye,st,Er);if(bt!==void 0){var nn=new Fe.Metadata(bt,$e);Hr.metadata.push(nn)}return Hr}function It(Y,Xt,st,Ye,bt){var $e=ct(st.container,bt.serviceIdentifier),Yt=[];return $e.length===Ie.BindingCount.NoBindingsAvailable&&st.container.options.autoBindInjectable&&typeof bt.serviceIdentifier=="function"&&Y.getConstructorMetadata(bt.serviceIdentifier).compilerGeneratedMetadata&&(st.container.bind(bt.serviceIdentifier).toSelf(),$e=ct(st.container,bt.serviceIdentifier)),Xt?Yt=$e:Yt=$e.filter(function(Er){var Hr=new ft.Request(Er.serviceIdentifier,st,Ye,Er,bt);return Er.constraint(Hr)}),er(bt.serviceIdentifier,Yt,bt,st.container),Yt}function er(Y,Xt,st,Ye){switch(Xt.length){case Ie.BindingCount.NoBindingsAvailable:if(st.isOptional())return Xt;var bt=ce.getServiceIdentifierAsString(Y),$e=ge.NOT_REGISTERED;throw $e+=ce.listMetadataForTarget(bt,st),$e+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,ct),new Error($e);case Ie.BindingCount.OnlyOneBindingAvailable:if(!st.isArray())return Xt;case Ie.BindingCount.MultipleBindingsAvailable:default:if(st.isArray())return Xt;var bt=ce.getServiceIdentifierAsString(Y),$e=ge.AMBIGUOUS_MATCH+" "+bt;throw $e+=ce.listRegisteredBindingsForServiceIdentifier(Ye,bt,ct),new Error($e)}}function jt(Y,Xt,st,Ye,bt,$e){var Yt,Er;if(bt===null){Yt=It(Y,Xt,Ye,null,$e),Er=new ft.Request(st,Ye,null,Yt,$e);var Hr=new ye.Plan(Ye,Er);Ye.addPlan(Hr)}else Yt=It(Y,Xt,Ye,bt,$e),Er=bt.addChildRequest($e.serviceIdentifier,Yt,$e);Yt.forEach(function(nn){var C=null;if($e.isArray())C=Er.addChildRequest(nn.serviceIdentifier,nn,$e);else{if(nn.cache)return;C=Er}if(nn.type===v.BindingTypeEnum.Instance&&nn.implementationType!==null){var Se=Je.getDependencies(Y,nn.implementationType);if(!Ye.container.options.skipBaseClassChecks){var ke=Je.getBaseClassDependencyCount(Y,nn.implementationType);if(Se.length<ke){var _t=ge.ARGUMENTS_LENGTH_MISMATCH(Je.getFunctionName(nn.implementationType));throw new Error(_t)}}Se.forEach(function(ht){jt(Y,!1,ht.serviceIdentifier,Ye,C,ht)})}})}function ct(Y,Xt){var st=[],Ye=Jt(Y);return Ye.hasKey(Xt)?st=Ye.get(Xt):Y.parent!==null&&(st=ct(Y.parent,Xt)),st}function pt(Y,Xt,st,Ye,bt,$e,Yt,Er){Er===void 0&&(Er=!1);var Hr=new he.Context(Xt),nn=ur(st,Ye,bt,"",$e,Yt);try{return jt(Y,Er,bt,Hr,null,nn),Hr}catch(C){throw H.isStackOverflowExeption(C)&&Hr.plan&&ce.circularDependencyToException(Hr.plan.rootRequest),C}}ne.plan=pt;function ir(Y,Xt,st,Ye){var bt=new xt.Target(v.TargetTypeEnum.Variable,"",Xt,new Fe.Metadata(st,Ye)),$e=new he.Context(Y),Yt=new ft.Request(Xt,$e,null,[],bt);return Yt}ne.createMockRequest=ir},88460:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.QueryableString=void 0;var J=function(){function Ie(ge){this.str=ge}return Ie.prototype.startsWith=function(ge){return this.str.indexOf(ge)===0},Ie.prototype.endsWith=function(ge){var v="",Oe=ge.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},Oe)},Ie.prototype.contains=function(ge){return this.str.indexOf(ge)!==-1},Ie.prototype.equals=function(ge){return this.str===ge},Ie.prototype.value=function(){return this.str},Ie}();ne.QueryableString=J},6e3:function(Ar,ne,J){"use strict";var Ie=this&&this.__spreadArray||function(It,er){for(var jt=0,ct=er.length,pt=It.length;jt<ct;jt++,pt++)It[pt]=er[jt];return It};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getFunctionName=ne.getBaseClassDependencyCount=ne.getDependencies=void 0;var ge=J(5744),v=J(16674),Oe=J(28421),H=J(6867),ce=J(55800);Object.defineProperty(ne,"getFunctionName",{enumerable:!0,get:function(){return ce.getFunctionName}});var he=J(18924);function Fe(It,er){var jt=ce.getFunctionName(er),ct=ye(It,jt,er,!1);return ct}ne.getDependencies=Fe;function ye(It,er,jt,ct){var pt=It.getConstructorMetadata(jt),ir=pt.compilerGeneratedMetadata;if(ir===void 0){var Y=v.MISSING_INJECTABLE_ANNOTATION+" "+er+".";throw new Error(Y)}var Xt=pt.userGeneratedMetadata,st=Object.keys(Xt),Ye=jt.length===0&&st.length>0,bt=st.length>jt.length,$e=Ye||bt?st.length:jt.length,Yt=ft(ct,er,ir,Xt,$e),Er=xt(It,jt),Hr=Ie(Ie([],Yt),Er);return Hr}function Je(It,er,jt,ct,pt){var ir=pt[It.toString()]||[],Y=ur(ir),Xt=Y.unmanaged!==!0,st=ct[It],Ye=Y.inject||Y.multiInject;if(st=Ye||st,st instanceof ge.LazyServiceIdentifer&&(st=st.unwrap()),Xt){var bt=st===Object,$e=st===Function,Yt=st===void 0,Er=bt||$e||Yt;if(!er&&Er){var Hr=v.MISSING_INJECT_ANNOTATION+" argument "+It+" in class "+jt+".";throw new Error(Hr)}var nn=new he.Target(Oe.TargetTypeEnum.ConstructorArgument,Y.targetName,st);return nn.metadata=ir,nn}return null}function ft(It,er,jt,ct,pt){for(var ir=[],Y=0;Y<pt;Y++){var Xt=Y,st=Je(Xt,It,er,jt,ct);st!==null&&ir.push(st)}return ir}function xt(It,er){for(var jt=It.getPropertiesMetadata(er),ct=[],pt=Object.keys(jt),ir=0,Y=pt;ir<Y.length;ir++){var Xt=Y[ir],st=jt[Xt],Ye=ur(jt[Xt]),bt=Ye.targetName||Xt,$e=Ye.inject||Ye.multiInject,Yt=new he.Target(Oe.TargetTypeEnum.ClassProperty,bt,$e);Yt.metadata=st,ct.push(Yt)}var Er=Object.getPrototypeOf(er.prototype).constructor;if(Er!==Object){var Hr=xt(It,Er);ct=Ie(Ie([],ct),Hr)}return ct}function Jt(It,er){var jt=Object.getPrototypeOf(er.prototype).constructor;if(jt!==Object){var ct=ce.getFunctionName(jt),pt=ye(It,ct,jt,!0),ir=pt.map(function(st){return st.metadata.filter(function(Ye){return Ye.key===H.UNMANAGED_TAG})}),Y=[].concat.apply([],ir).length,Xt=pt.length-Y;return Xt>0?Xt:Jt(It,jt)}else return 0}ne.getBaseClassDependencyCount=Jt;function ur(It){var er={};return It.forEach(function(jt){er[jt.key.toString()]=jt.value}),{inject:er[H.INJECT_TAG],multiInject:er[H.MULTI_INJECT_TAG],targetName:er[H.NAME_TAG],unmanaged:er[H.UNMANAGED_TAG]}}},6748:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Request=void 0;var Ie=J(37791),ge=function(){function v(Oe,H,ce,he,Fe){this.id=Ie.id(),this.serviceIdentifier=Oe,this.parentContext=H,this.parentRequest=ce,this.target=Fe,this.childRequests=[],this.bindings=Array.isArray(he)?he:[he],this.requestScope=ce===null?new Map:null}return v.prototype.addChildRequest=function(Oe,H,ce){var he=new v(Oe,this.parentContext,this,H,ce);return this.childRequests.push(he),he},v}();ne.Request=ge},18924:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.Target=void 0;var Ie=J(6867),ge=J(37791),v=J(47738),Oe=J(88460),H=function(){function ce(he,Fe,ye,Je){this.id=ge.id(),this.type=he,this.serviceIdentifier=ye,this.name=new Oe.QueryableString(Fe||""),this.metadata=new Array;var ft=null;typeof Je=="string"?ft=new v.Metadata(Ie.NAMED_TAG,Je):Je instanceof v.Metadata&&(ft=Je),ft!==null&&this.metadata.push(ft)}return ce.prototype.hasTag=function(he){for(var Fe=0,ye=this.metadata;Fe<ye.length;Fe++){var Je=ye[Fe];if(Je.key===he)return!0}return!1},ce.prototype.isArray=function(){return this.hasTag(Ie.MULTI_INJECT_TAG)},ce.prototype.matchesArray=function(he){return this.matchesTag(Ie.MULTI_INJECT_TAG)(he)},ce.prototype.isNamed=function(){return this.hasTag(Ie.NAMED_TAG)},ce.prototype.isTagged=function(){return this.metadata.some(function(he){return Ie.NON_CUSTOM_TAG_KEYS.every(function(Fe){return he.key!==Fe})})},ce.prototype.isOptional=function(){return this.matchesTag(Ie.OPTIONAL_TAG)(!0)},ce.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(he){return he.key===Ie.NAMED_TAG})[0]:null},ce.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(he){return Ie.NON_CUSTOM_TAG_KEYS.every(function(Fe){return he.key!==Fe})}):null},ce.prototype.matchesNamedTag=function(he){return this.matchesTag(Ie.NAMED_TAG)(he)},ce.prototype.matchesTag=function(he){var Fe=this;return function(ye){for(var Je=0,ft=Fe.metadata;Je<ft.length;Je++){var xt=ft[Je];if(xt.key===he&&xt.value===ye)return!0}return!1}},ce}();ne.Target=H},52279:function(Ar,ne,J){"use strict";var Ie=this&&this.__spreadArray||function(ye,Je){for(var ft=0,xt=Je.length,Jt=ye.length;ft<xt;ft++,Jt++)ye[Jt]=Je[ft];return ye};Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolveInstance=void 0;var ge=J(16674),v=J(28421),Oe=J(6867);function H(ye,Je,ft){var xt=Je.filter(function(ur){return ur.target!==null&&ur.target.type===v.TargetTypeEnum.ClassProperty}),Jt=xt.map(ft);return xt.forEach(function(ur,It){var er="";er=ur.target.name.value();var jt=Jt[It];ye[er]=jt}),ye}function ce(ye,Je){return new(ye.bind.apply(ye,Ie([void 0],Je)))}function he(ye,Je){if(Reflect.hasMetadata(Oe.POST_CONSTRUCT,ye)){var ft=Reflect.getMetadata(Oe.POST_CONSTRUCT,ye);try{Je[ft.value]()}catch(xt){throw new Error(ge.POST_CONSTRUCT_ERROR(ye.name,xt.message))}}}function Fe(ye,Je,ft){var xt=null;if(Je.length>0){var Jt=Je.filter(function(It){return It.target!==null&&It.target.type===v.TargetTypeEnum.ConstructorArgument}),ur=Jt.map(ft);xt=ce(ye,ur),xt=H(xt,Je,ft)}else xt=new ye;return he(ye,xt),xt}ne.resolveInstance=Fe},31927:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.resolve=void 0;var Ie=J(16674),ge=J(28421),v=J(85265),Oe=J(55800),H=J(52279),ce=function(ye,Je,ft){try{return ft()}catch(xt){throw v.isStackOverflowExeption(xt)?new Error(Ie.CIRCULAR_DEPENDENCY_IN_FACTORY(ye,Je.toString())):xt}},he=function(ye){return function(Je){Je.parentContext.setCurrentRequest(Je);var ft=Je.bindings,xt=Je.childRequests,Jt=Je.target&&Je.target.isArray(),ur=!Je.parentRequest||!Je.parentRequest.target||!Je.target||!Je.parentRequest.target.matchesArray(Je.target.serviceIdentifier);if(Jt&&ur)return xt.map(function(ir){var Y=he(ye);return Y(ir)});var It=null;if(Je.target.isOptional()&&ft.length===0)return;var er=ft[0],jt=er.scope===ge.BindingScopeEnum.Singleton,ct=er.scope===ge.BindingScopeEnum.Request;if(jt&&er.activated)return er.cache;if(ct&&ye!==null&&ye.has(er.id))return ye.get(er.id);if(er.type===ge.BindingTypeEnum.ConstantValue)It=er.cache,er.activated=!0;else if(er.type===ge.BindingTypeEnum.Function)It=er.cache,er.activated=!0;else if(er.type===ge.BindingTypeEnum.Constructor)It=er.implementationType;else if(er.type===ge.BindingTypeEnum.DynamicValue&&er.dynamicValue!==null)It=ce("toDynamicValue",er.serviceIdentifier,function(){return er.dynamicValue(Je.parentContext)});else if(er.type===ge.BindingTypeEnum.Factory&&er.factory!==null)It=ce("toFactory",er.serviceIdentifier,function(){return er.factory(Je.parentContext)});else if(er.type===ge.BindingTypeEnum.Provider&&er.provider!==null)It=ce("toProvider",er.serviceIdentifier,function(){return er.provider(Je.parentContext)});else if(er.type===ge.BindingTypeEnum.Instance&&er.implementationType!==null)It=H.resolveInstance(er.implementationType,xt,he(ye));else{var pt=Oe.getServiceIdentifierAsString(Je.serviceIdentifier);throw new Error(Ie.INVALID_BINDING_TYPE+" "+pt)}return typeof er.onActivation=="function"&&(It=er.onActivation(Je.parentContext,It)),jt&&(er.cache=It,er.activated=!0),ct&&ye!==null&&!ye.has(er.id)&&ye.set(er.id,It),It}};function Fe(ye){var Je=he(ye.plan.rootRequest.requestScope);return Je(ye.plan.rootRequest)}ne.resolve=Fe},83366:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInSyntax=void 0;var Ie=J(28421),ge=J(71325),v=function(){function Oe(H){this._binding=H}return Oe.prototype.inRequestScope=function(){return this._binding.scope=Ie.BindingScopeEnum.Request,new ge.BindingWhenOnSyntax(this._binding)},Oe.prototype.inSingletonScope=function(){return this._binding.scope=Ie.BindingScopeEnum.Singleton,new ge.BindingWhenOnSyntax(this._binding)},Oe.prototype.inTransientScope=function(){return this._binding.scope=Ie.BindingScopeEnum.Transient,new ge.BindingWhenOnSyntax(this._binding)},Oe}();ne.BindingInSyntax=v},74889:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingInWhenOnSyntax=void 0;var Ie=J(83366),ge=J(51811),v=J(98370),Oe=function(){function H(ce){this._binding=ce,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ge.BindingOnSyntax(this._binding),this._bindingInSyntax=new Ie.BindingInSyntax(ce)}return H.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},H.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},H.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},H.prototype.when=function(ce){return this._bindingWhenSyntax.when(ce)},H.prototype.whenTargetNamed=function(ce){return this._bindingWhenSyntax.whenTargetNamed(ce)},H.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},H.prototype.whenTargetTagged=function(ce,he){return this._bindingWhenSyntax.whenTargetTagged(ce,he)},H.prototype.whenInjectedInto=function(ce){return this._bindingWhenSyntax.whenInjectedInto(ce)},H.prototype.whenParentNamed=function(ce){return this._bindingWhenSyntax.whenParentNamed(ce)},H.prototype.whenParentTagged=function(ce,he){return this._bindingWhenSyntax.whenParentTagged(ce,he)},H.prototype.whenAnyAncestorIs=function(ce){return this._bindingWhenSyntax.whenAnyAncestorIs(ce)},H.prototype.whenNoAncestorIs=function(ce){return this._bindingWhenSyntax.whenNoAncestorIs(ce)},H.prototype.whenAnyAncestorNamed=function(ce){return this._bindingWhenSyntax.whenAnyAncestorNamed(ce)},H.prototype.whenAnyAncestorTagged=function(ce,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(ce,he)},H.prototype.whenNoAncestorNamed=function(ce){return this._bindingWhenSyntax.whenNoAncestorNamed(ce)},H.prototype.whenNoAncestorTagged=function(ce,he){return this._bindingWhenSyntax.whenNoAncestorTagged(ce,he)},H.prototype.whenAnyAncestorMatches=function(ce){return this._bindingWhenSyntax.whenAnyAncestorMatches(ce)},H.prototype.whenNoAncestorMatches=function(ce){return this._bindingWhenSyntax.whenNoAncestorMatches(ce)},H.prototype.onActivation=function(ce){return this._bindingOnSyntax.onActivation(ce)},H}();ne.BindingInWhenOnSyntax=Oe},51811:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingOnSyntax=void 0;var Ie=J(98370),ge=function(){function v(Oe){this._binding=Oe}return v.prototype.onActivation=function(Oe){return this._binding.onActivation=Oe,new Ie.BindingWhenSyntax(this._binding)},v}();ne.BindingOnSyntax=ge},15451:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingToSyntax=void 0;var Ie=J(16674),ge=J(28421),v=J(74889),Oe=J(71325),H=function(){function ce(he){this._binding=he}return ce.prototype.to=function(he){return this._binding.type=ge.BindingTypeEnum.Instance,this._binding.implementationType=he,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Ie.INVALID_TO_SELF_VALUE);var he=this._binding.serviceIdentifier;return this.to(he)},ce.prototype.toConstantValue=function(he){return this._binding.type=ge.BindingTypeEnum.ConstantValue,this._binding.cache=he,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ge.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toDynamicValue=function(he){return this._binding.type=ge.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=he,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},ce.prototype.toConstructor=function(he){return this._binding.type=ge.BindingTypeEnum.Constructor,this._binding.implementationType=he,this._binding.scope=ge.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toFactory=function(he){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=he,this._binding.scope=ge.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toFunction=function(he){if(typeof he!="function")throw new Error(Ie.INVALID_FUNCTION_BINDING);var Fe=this.toConstantValue(he);return this._binding.type=ge.BindingTypeEnum.Function,this._binding.scope=ge.BindingScopeEnum.Singleton,Fe},ce.prototype.toAutoFactory=function(he){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=function(Fe){var ye=function(){return Fe.container.get(he)};return ye},this._binding.scope=ge.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toProvider=function(he){return this._binding.type=ge.BindingTypeEnum.Provider,this._binding.provider=he,this._binding.scope=ge.BindingScopeEnum.Singleton,new Oe.BindingWhenOnSyntax(this._binding)},ce.prototype.toService=function(he){this.toDynamicValue(function(Fe){return Fe.container.get(he)})},ce}();ne.BindingToSyntax=H},71325:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenOnSyntax=void 0;var Ie=J(51811),ge=J(98370),v=function(){function Oe(H){this._binding=H,this._bindingWhenSyntax=new ge.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ie.BindingOnSyntax(this._binding)}return Oe.prototype.when=function(H){return this._bindingWhenSyntax.when(H)},Oe.prototype.whenTargetNamed=function(H){return this._bindingWhenSyntax.whenTargetNamed(H)},Oe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Oe.prototype.whenTargetTagged=function(H,ce){return this._bindingWhenSyntax.whenTargetTagged(H,ce)},Oe.prototype.whenInjectedInto=function(H){return this._bindingWhenSyntax.whenInjectedInto(H)},Oe.prototype.whenParentNamed=function(H){return this._bindingWhenSyntax.whenParentNamed(H)},Oe.prototype.whenParentTagged=function(H,ce){return this._bindingWhenSyntax.whenParentTagged(H,ce)},Oe.prototype.whenAnyAncestorIs=function(H){return this._bindingWhenSyntax.whenAnyAncestorIs(H)},Oe.prototype.whenNoAncestorIs=function(H){return this._bindingWhenSyntax.whenNoAncestorIs(H)},Oe.prototype.whenAnyAncestorNamed=function(H){return this._bindingWhenSyntax.whenAnyAncestorNamed(H)},Oe.prototype.whenAnyAncestorTagged=function(H,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(H,ce)},Oe.prototype.whenNoAncestorNamed=function(H){return this._bindingWhenSyntax.whenNoAncestorNamed(H)},Oe.prototype.whenNoAncestorTagged=function(H,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(H,ce)},Oe.prototype.whenAnyAncestorMatches=function(H){return this._bindingWhenSyntax.whenAnyAncestorMatches(H)},Oe.prototype.whenNoAncestorMatches=function(H){return this._bindingWhenSyntax.whenNoAncestorMatches(H)},Oe.prototype.onActivation=function(H){return this._bindingOnSyntax.onActivation(H)},Oe}();ne.BindingWhenOnSyntax=v},98370:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.BindingWhenSyntax=void 0;var Ie=J(51811),ge=J(80758),v=function(){function Oe(H){this._binding=H}return Oe.prototype.when=function(H){return this._binding.constraint=H,new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetNamed=function(H){return this._binding.constraint=ge.namedConstraint(H),new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(H){var ce=H.target!==null&&!H.target.isNamed()&&!H.target.isTagged();return ce},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenTargetTagged=function(H,ce){return this._binding.constraint=ge.taggedConstraint(H)(ce),new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenInjectedInto=function(H){return this._binding.constraint=function(ce){return ge.typeConstraint(H)(ce.parentRequest)},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenParentNamed=function(H){return this._binding.constraint=function(ce){return ge.namedConstraint(H)(ce.parentRequest)},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenParentTagged=function(H,ce){return this._binding.constraint=function(he){return ge.taggedConstraint(H)(ce)(he.parentRequest)},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorIs=function(H){return this._binding.constraint=function(ce){return ge.traverseAncerstors(ce,ge.typeConstraint(H))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorIs=function(H){return this._binding.constraint=function(ce){return!ge.traverseAncerstors(ce,ge.typeConstraint(H))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorNamed=function(H){return this._binding.constraint=function(ce){return ge.traverseAncerstors(ce,ge.namedConstraint(H))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorNamed=function(H){return this._binding.constraint=function(ce){return!ge.traverseAncerstors(ce,ge.namedConstraint(H))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorTagged=function(H,ce){return this._binding.constraint=function(he){return ge.traverseAncerstors(he,ge.taggedConstraint(H)(ce))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorTagged=function(H,ce){return this._binding.constraint=function(he){return!ge.traverseAncerstors(he,ge.taggedConstraint(H)(ce))},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenAnyAncestorMatches=function(H){return this._binding.constraint=function(ce){return ge.traverseAncerstors(ce,H)},new Ie.BindingOnSyntax(this._binding)},Oe.prototype.whenNoAncestorMatches=function(H){return this._binding.constraint=function(ce){return!ge.traverseAncerstors(ce,H)},new Ie.BindingOnSyntax(this._binding)},Oe}();ne.BindingWhenSyntax=v},80758:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.typeConstraint=ne.namedConstraint=ne.taggedConstraint=ne.traverseAncerstors=void 0;var Ie=J(6867),ge=J(47738),v=function(he,Fe){var ye=he.parentRequest;return ye!==null?Fe(ye)?!0:v(ye,Fe):!1};ne.traverseAncerstors=v;var Oe=function(he){return function(Fe){var ye=function(Je){return Je!==null&&Je.target!==null&&Je.target.matchesTag(he)(Fe)};return ye.metaData=new ge.Metadata(he,Fe),ye}};ne.taggedConstraint=Oe;var H=Oe(Ie.NAMED_TAG);ne.namedConstraint=H;var ce=function(he){return function(Fe){var ye=null;if(Fe!==null)if(ye=Fe.bindings[0],typeof he=="string"){var Je=ye.serviceIdentifier;return Je===he}else{var ft=Fe.bindings[0].implementationType;return he===ft}return!1}};ne.typeConstraint=ce},70600:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.multiBindToService=void 0;var J=function(Ie){return function(ge){return function(){for(var v=[],Oe=0;Oe<arguments.length;Oe++)v[Oe]=arguments[Oe];return v.forEach(function(H){return Ie.bind(H).toService(ge)})}}};ne.multiBindToService=J},85265:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.isStackOverflowExeption=void 0;var Ie=J(16674);function ge(v){return v instanceof RangeError||v.message===Ie.STACK_OVERFLOW}ne.isStackOverflowExeption=ge},37791:function(Ar,ne){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.id=void 0;var J=0;function Ie(){return J++}ne.id=Ie},55800:function(Ar,ne,J){"use strict";Object.defineProperty(ne,"__esModule",{value:!0}),ne.circularDependencyToException=ne.listMetadataForTarget=ne.listRegisteredBindingsForServiceIdentifier=ne.getServiceIdentifierAsString=ne.getFunctionName=void 0;var Ie=J(16674);function ge(ye){if(typeof ye=="function"){var Je=ye;return Je.name}else{if(typeof ye=="symbol")return ye.toString();var Je=ye;return Je}}ne.getServiceIdentifierAsString=ge;function v(ye,Je,ft){var xt="",Jt=ft(ye,Je);return Jt.length!==0&&(xt=`
Registered bindings:`,Jt.forEach(function(ur){var It="Object";ur.implementationType!==null&&(It=Fe(ur.implementationType)),xt=xt+`
 `+It,ur.constraint.metaData&&(xt=xt+" - "+ur.constraint.metaData)})),xt}ne.listRegisteredBindingsForServiceIdentifier=v;function Oe(ye,Je){return ye.parentRequest===null?!1:ye.parentRequest.serviceIdentifier===Je?!0:Oe(ye.parentRequest,Je)}function H(ye){function Je(xt,Jt){Jt===void 0&&(Jt=[]);var ur=ge(xt.serviceIdentifier);return Jt.push(ur),xt.parentRequest!==null?Je(xt.parentRequest,Jt):Jt}var ft=Je(ye);return ft.reverse().join(" --> ")}function ce(ye){ye.childRequests.forEach(function(Je){if(Oe(Je,Je.serviceIdentifier)){var ft=H(Je);throw new Error(Ie.CIRCULAR_DEPENDENCY+" "+ft)}else ce(Je)})}ne.circularDependencyToException=ce;function he(ye,Je){if(Je.isTagged()||Je.isNamed()){var ft="",xt=Je.getNamedTag(),Jt=Je.getCustomTags();return xt!==null&&(ft+=xt.toString()+`
`),Jt!==null&&Jt.forEach(function(ur){ft+=ur.toString()+`
`})," "+ye+`
 `+ye+" - "+ft}else return" "+ye}ne.listMetadataForTarget=he;function Fe(ye){if(ye.name)return ye.name;var Je=ye.toString(),ft=Je.match(/^function\s*([^\s(]+)/);return ft?ft[1]:"Anonymous function: "+Je}ne.getFunctionName=Fe},31745:function(Ar){"use strict";Ar.exports=J,Ar.exports.default=J;var ne=1e20;function J(H,ce,he,Fe,ye,Je){this.fontSize=H||24,this.buffer=ce===void 0?3:ce,this.cutoff=Fe||.25,this.fontFamily=ye||"sans-serif",this.fontWeight=Je||"normal",this.radius=he||8;var ft=this.size=this.fontSize+this.buffer*2,xt=ft+this.buffer*2,Jt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Jt?this.canvas=my.createOffscreenCanvas(ft,ft,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ft),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(xt*xt),this.gridInner=new Float64Array(xt*xt),this.f=new Float64Array(xt),this.z=new Float64Array(xt+1),this.v=new Uint16Array(xt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Jt?this.middle=Math.round(ft/2*1):this.middle=Math.round(ft/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ie(H,ce,he,Fe,ye,Je,ft){Je.fill(ne,0,ce*he),ft.fill(0,0,ce*he);for(var xt=(ce-Fe)/2,Jt=0;Jt<ye;Jt++)for(var ur=0;ur<Fe;ur++){var It=(Jt+xt)*ce+ur+xt,er=H.data[4*(Jt*Fe+ur)+3]/255;if(er===1)Je[It]=0,ft[It]=ne;else if(er===0)Je[It]=ne,ft[It]=0;else{var jt=Math.max(0,.5-er),ct=Math.max(0,er-.5);Je[It]=jt*jt,ft[It]=ct*ct}}}function ge(H,ce,he,Fe,ye,Je,ft){for(var xt=0;xt<ce*he;xt++){var Jt=Math.sqrt(Fe[xt])-Math.sqrt(ye[xt]);H[xt]=Math.round(255-255*(Jt/Je+ft))}}J.prototype._draw=function(H,ce){var he=this.ctx.measureText(H),Fe=he.width,ye=2*this.buffer,Je,ft,xt,Jt,ur,It,er,jt;ce&&this.useMetrics?(ur=Math.floor(he.actualBoundingBoxAscent),jt=this.buffer+Math.ceil(he.actualBoundingBoxAscent),It=this.buffer,er=this.buffer,ft=Math.min(this.size,Math.ceil(he.actualBoundingBoxRight-he.actualBoundingBoxLeft)),Jt=Math.min(this.size-It,Math.ceil(he.actualBoundingBoxAscent+he.actualBoundingBoxDescent)),Je=ft+ye,xt=Jt+ye,this.ctx.textBaseline="alphabetic"):(Je=ft=this.size,xt=Jt=this.size,ur=19*this.fontSize/24,It=er=0,jt=this.middle,this.ctx.textBaseline="middle");var ct;ft&&Jt&&(this.ctx.clearRect(er,It,ft,Jt),this.ctx.fillText(H,this.buffer,jt),ct=this.ctx.getImageData(er,It,ft,Jt));var pt=new Uint8ClampedArray(Je*xt);return Ie(ct,Je,xt,ft,Jt,this.gridOuter,this.gridInner),v(this.gridOuter,Je,xt,this.f,this.v,this.z),v(this.gridInner,Je,xt,this.f,this.v,this.z),ge(pt,Je,xt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:ft,height:Jt,sdfWidth:Je,sdfHeight:xt,top:ur,left:0,advance:Fe}}},J.prototype.draw=function(H){return this._draw(H,!1).data},J.prototype.drawWithMetrics=function(H){return this._draw(H,!0)};function v(H,ce,he,Fe,ye,Je){for(var ft=0;ft<ce;ft++)Oe(H,ft,ce,he,Fe,ye,Je);for(var xt=0;xt<he;xt++)Oe(H,xt*ce,1,ce,Fe,ye,Je)}function Oe(H,ce,he,Fe,ye,Je,ft){var xt,Jt,ur,It;for(Je[0]=0,ft[0]=-ne,ft[1]=ne,xt=0;xt<Fe;xt++)ye[xt]=H[ce+xt*he];for(xt=1,Jt=0,ur=0;xt<Fe;xt++){do It=Je[Jt],ur=(ye[xt]-ye[It]+xt*xt-It*It)/(xt-It)/2;while(ur<=ft[Jt]&&--Jt>-1);Jt++,Je[Jt]=xt,ft[Jt]=ur,ft[Jt+1]=ne}for(xt=0,Jt=0;xt<Fe;xt++){for(;ft[Jt+1]<xt;)Jt++;It=Je[Jt],H[ce+xt*he]=ye[It]+(xt-It)*(xt-It)}}},18857:function(Ar,ne,J){"use strict";J.r(ne),J.d(ne,{Function:function(){return zs},Interpreter:function(){return va},default:function(){return tl},evaluate:function(){return Zu},vm:function(){return Ie}});var Ie={};J.r(Ie),J.d(Ie,{Script:function(){return Ql},compileFunction:function(){return sf},createContext:function(){return is},runInContext:function(){return El},runInNewContext:function(){return Ns}});var ge={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Oe={5:v,"5module":v+" export import",6:v+" const class extends export import super"},H=/^in(stanceof)?$/,ce="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",he="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Fe=new RegExp("["+ce+"]"),ye=new RegExp("["+ce+he+"]");ce=he=null;var Je=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],ft=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function xt(_,T){for(var N=65536,R=0;R<T.length;R+=2){if(N+=T[R],N>_)return!1;if(N+=T[R+1],N>=_)return!0}}function Jt(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Fe.test(String.fromCharCode(_)):T===!1?!1:xt(_,Je)}function ur(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ye.test(String.fromCharCode(_)):T===!1?!1:xt(_,Je)||xt(_,ft)}var It=function(T,N){N===void 0&&(N={}),this.label=T,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function er(_,T){return new It(_,{beforeExpr:!0,binop:T})}var jt={beforeExpr:!0},ct={startsExpr:!0},pt={};function ir(_,T){return T===void 0&&(T={}),T.keyword=_,pt[_]=new It(_,T)}var Y={num:new It("num",ct),regexp:new It("regexp",ct),string:new It("string",ct),name:new It("name",ct),eof:new It("eof"),bracketL:new It("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new It("]"),braceL:new It("{",{beforeExpr:!0,startsExpr:!0}),braceR:new It("}"),parenL:new It("(",{beforeExpr:!0,startsExpr:!0}),parenR:new It(")"),comma:new It(",",jt),semi:new It(";",jt),colon:new It(":",jt),dot:new It("."),question:new It("?",jt),questionDot:new It("?."),arrow:new It("=>",jt),template:new It("template"),invalidTemplate:new It("invalidTemplate"),ellipsis:new It("...",jt),backQuote:new It("`",ct),dollarBraceL:new It("${",{beforeExpr:!0,startsExpr:!0}),eq:new It("=",{beforeExpr:!0,isAssign:!0}),assign:new It("_=",{beforeExpr:!0,isAssign:!0}),incDec:new It("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new It("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:er("||",1),logicalAND:er("&&",2),bitwiseOR:er("|",3),bitwiseXOR:er("^",4),bitwiseAND:er("&",5),equality:er("==/!=/===/!==",6),relational:er("</>/<=/>=",7),bitShift:er("<</>>/>>>",8),plusMin:new It("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:er("%",10),star:er("*",10),slash:er("/",10),starstar:new It("**",{beforeExpr:!0}),coalesce:er("??",1),_break:ir("break"),_case:ir("case",jt),_catch:ir("catch"),_continue:ir("continue"),_debugger:ir("debugger"),_default:ir("default",jt),_do:ir("do",{isLoop:!0,beforeExpr:!0}),_else:ir("else",jt),_finally:ir("finally"),_for:ir("for",{isLoop:!0}),_function:ir("function",ct),_if:ir("if"),_return:ir("return",jt),_switch:ir("switch"),_throw:ir("throw",jt),_try:ir("try"),_var:ir("var"),_const:ir("const"),_while:ir("while",{isLoop:!0}),_with:ir("with"),_new:ir("new",{beforeExpr:!0,startsExpr:!0}),_this:ir("this",ct),_super:ir("super",ct),_class:ir("class",ct),_extends:ir("extends",jt),_export:ir("export"),_import:ir("import",ct),_null:ir("null",ct),_true:ir("true",ct),_false:ir("false",ct),_in:ir("in",{beforeExpr:!0,binop:7}),_instanceof:ir("instanceof",{beforeExpr:!0,binop:7}),_typeof:ir("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ir("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ir("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,st=new RegExp(Xt.source,"g");function Ye(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var bt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Yt=Object.prototype,Er=Yt.hasOwnProperty,Hr=Yt.toString;function nn(_,T){return Er.call(_,T)}var C=Array.isArray||function(_){return Hr.call(_)==="[object Array]"};function Se(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(T,N){this.line=T,this.column=N};ke.prototype.offset=function(T){return new ke(this.line,this.column+T)};var _t=function(T,N,R){this.start=N,this.end=R,T.sourceFile!==null&&(this.source=T.sourceFile)};function ht(_,T){for(var N=1,R=0;;){st.lastIndex=R;var X=st.exec(_);if(X&&X.index<T)++N,R=X.index+X[0].length;else return new ke(N,T-R)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Ht(_){var T={};for(var N in Lt)T[N]=_&&nn(_,N)?_[N]:Lt[N];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),C(T.onToken)){var R=T.onToken;T.onToken=function(X){return R.push(X)}}return C(T.onComment)&&(T.onComment=xr(T,T.onComment)),T}function xr(_,T){return function(N,R,X,ve,je,at){var ot={type:N?"Block":"Line",value:R,start:X,end:ve};_.locations&&(ot.loc=new _t(this,je,at)),_.ranges&&(ot.range=[X,ve]),T.push(ot)}}var Kn=1,mn=2,di=Kn|mn,Gn=4,ni=8,vi=16,Hn=32,mi=64,ca=128;function Gi(_,T){return mn|(_?Gn:0)|(T?ni:0)}var Li=0,$i=1,fa=2,ko=3,Oa=4,ya=5,Fi=function(T,N,R){this.options=T=Ht(T),this.sourceFile=T.sourceFile,this.keywords=Se(Oe[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var X="";if(T.allowReserved!==!0){for(var ve=T.ecmaVersion;!(X=ge[ve]);ve--);T.sourceType==="module"&&(X+=" await")}this.reservedWords=Se(X);var je=(X?X+" ":"")+ge.strict;this.reservedWordsStrict=Se(je),this.reservedWordsStrictBind=Se(je+" "+ge.strictBind),this.input=String(N),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Kn),this.regexpState=null},ra={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Fi.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},ra.inFunction.get=function(){return(this.currentVarScope().flags&mn)>0},ra.inGenerator.get=function(){return(this.currentVarScope().flags&ni)>0},ra.inAsync.get=function(){return(this.currentVarScope().flags&Gn)>0},ra.allowSuper.get=function(){return(this.currentThisScope().flags&mi)>0},ra.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ca)>0},ra.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Fi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&mn)>0},Fi.extend=function(){for(var T=[],N=arguments.length;N--;)T[N]=arguments[N];for(var R=this,X=0;X<T.length;X++)R=T[X](R);return R},Fi.parse=function(T,N){return new this(N,T).parse()},Fi.parseExpressionAt=function(T,N,R){var X=new this(R,T,N);return X.nextToken(),X.parseExpression()},Fi.tokenizer=function(T,N){return new this(N,T)},Object.defineProperties(Fi.prototype,ra);var Qi=Fi.prototype,Es=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Qi.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var T=Es.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){$e.lastIndex=_+T[0].length;var N=$e.exec(this.input),R=N.index+N[0].length,X=this.input.charAt(R);return X===";"||X==="}"||Xt.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(X)||X==="!"&&this.input.charAt(R+1)==="=")}_+=T[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Qi.eat=function(_){return this.type===_?(this.next(),!0):!1},Qi.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},Qi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Qi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Qi.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},Qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Qi.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Qi.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Qi.expect=function(_){this.eat(_)||this.unexpected()},Qi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function le(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Qi.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var N=T?_.parenthesizedAssign:_.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},Qi.checkExpressionErrors=function(_,T){if(!_)return!1;var N=_.shorthandAssign,R=_.doubleProto;if(!T)return N>=0||R>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},Qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Qi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var ii=Fi.prototype;ii.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==Y.eof;){var N=this.parseStatement(null,!0,T);_.body.push(N)}if(this.inModule)for(var R=0,X=Object.keys(this.undefinedExports);R<X.length;R+=1){var ve=X[R];this.raiseRecoverable(this.undefinedExports[ve].start,"Export '"+ve+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var yo={kind:"loop"},Qs={kind:"switch"};ii.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var T=$e.exec(this.input),N=this.pos+T[0].length,R=this.input.charCodeAt(N);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Jt(R,!0)){for(var X=N+1;ur(this.input.charCodeAt(X),!0);)++X;var ve=this.input.slice(N,X);if(!H.test(ve))return!0}return!1},ii.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),T=this.pos+_[0].length;return!Xt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!ur(this.input.charAt(T+8)))},ii.parseStatement=function(_,T,N){var R=this.type,X=this.startNode(),ve;switch(this.isLet(_)&&(R=Y._var,ve="let"),R){case Y._break:case Y._continue:return this.parseBreakContinueStatement(X,R.keyword);case Y._debugger:return this.parseDebuggerStatement(X);case Y._do:return this.parseDoStatement(X);case Y._for:return this.parseForStatement(X);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(X,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(X,!0);case Y._if:return this.parseIfStatement(X);case Y._return:return this.parseReturnStatement(X);case Y._switch:return this.parseSwitchStatement(X);case Y._throw:return this.parseThrowStatement(X);case Y._try:return this.parseTryStatement(X);case Y._const:case Y._var:return ve=ve||this.value,_&&ve!=="var"&&this.unexpected(),this.parseVarStatement(X,ve);case Y._while:return this.parseWhileStatement(X);case Y._with:return this.parseWithStatement(X);case Y.braceL:return this.parseBlock(!0,X);case Y.semi:return this.parseEmptyStatement(X);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&R===Y._import){$e.lastIndex=this.pos;var je=$e.exec(this.input),at=this.pos+je[0].length,ot=this.input.charCodeAt(at);if(ot===40||ot===46)return this.parseExpressionStatement(X,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===Y._import?this.parseImport(X):this.parseExport(X,N);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(X,!0,!_);var tr=this.value,ar=this.parseExpression();return R===Y.name&&ar.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(X,tr,ar,_):this.parseExpressionStatement(X,ar)}},ii.parseBreakContinueStatement=function(_,T){var N=T==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var X=this.labels[R];if((_.label==null||X.name===_.label.name)&&(X.kind!=null&&(N||X.kind==="loop")||_.label&&N))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,N?"BreakStatement":"ContinueStatement")},ii.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},ii.parseDoStatement=function(_){return this.next(),this.labels.push(yo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},ii.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(yo),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var N=this.isLet();if(this.type===Y._var||this.type===Y._const||N){var R=this.startNode(),X=N?"let":this.value;return this.next(),this.parseVar(R,!0,X),this.finishNode(R,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,R)):(T>-1&&this.unexpected(T),this.parseFor(_,R))}var ve=new le,je=this.parseExpression(!0,ve);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(je,!1,ve),this.checkLVal(je),this.parseForIn(_,je)):(this.checkExpressionErrors(ve,!0),T>-1&&this.unexpected(T),this.parseFor(_,je))},ii.parseFunctionStatement=function(_,T,N){return this.next(),this.parseFunction(_,$t|(N?0:Pr),!1,T)},ii.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},ii.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},ii.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(Qs),this.enterScope(0);for(var T,N=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var R=this.type===Y._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),R?T.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,T.test=null),this.expect(Y.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},ii.parseThrowStatement=function(_){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Bt=[];ii.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var T=this.startNode();if(this.next(),this.eat(Y.parenL)){T.param=this.parseBindingAtom();var N=T.param.type==="Identifier";this.enterScope(N?Hn:0),this.checkLVal(T.param,N?Oa:fa),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},ii.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},ii.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(yo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},ii.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},ii.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},ii.parseLabeledStatement=function(_,T,N,R){for(var X=0,ve=this.labels;X<ve.length;X+=1){var je=ve[X];je.name===T&&this.raise(N.start,"Label '"+T+"' is already declared")}for(var at=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,ot=this.labels.length-1;ot>=0;ot--){var tr=this.labels[ot];if(tr.statementStart===_.start)tr.statementStart=this.start,tr.kind=at;else break}return this.labels.push({name:T,kind:at,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=N,this.finishNode(_,"LabeledStatement")},ii.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},ii.parseBlock=function(_,T,N){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var R=this.parseStatement(null);T.body.push(R)}return N&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},ii.parseFor=function(_,T){return _.init=T,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},ii.parseForIn=function(_,T){var N=this.type===Y._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,N?"ForInStatement":"ForOfStatement")},ii.parseVar=function(_,T,N){for(_.declarations=[],_.kind=N;;){var R=this.startNode();if(this.parseVarId(R,N),this.eat(Y.eq)?R.init=this.parseMaybeAssign(T):N==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(T&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(Y.comma))break}return _},ii.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?$i:fa,!1)};var $t=1,Pr=2,ln=4;ii.parseFunction=function(_,T,N,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===Y.star&&T&Pr&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!R),T&$t&&(_.id=T&ln&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(T&Pr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?$i:fa:ko));var X=this.yieldPos,ve=this.awaitPos,je=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(_.async,_.generator)),T&$t||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,N,!1),this.yieldPos=X,this.awaitPos=ve,this.awaitIdentPos=je,this.finishNode(_,T&$t?"FunctionDeclaration":"FunctionExpression")},ii.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ii.parseClass=function(_,T){this.next();var N=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var R=this.startNode(),X=!1;for(R.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var ve=this.parseClassElement(_.superClass!==null);ve&&(R.body.push(ve),ve.type==="MethodDefinition"&&ve.kind==="constructor"&&(X&&this.raise(ve.start,"Duplicate constructor in the same class"),X=!0))}return this.strict=N,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},ii.parseClassElement=function(_){var T=this;if(this.eat(Y.semi))return null;var N=this.startNode(),R=function(ot,tr){tr===void 0&&(tr=!1);var ar=T.start,Mn=T.startLoc;return T.eatContextual(ot)?T.type!==Y.parenL&&(!tr||!T.canInsertSemicolon())?!0:(N.key&&T.unexpected(),N.computed=!1,N.key=T.startNodeAt(ar,Mn),N.key.name=ot,T.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=R("static");var X=this.eat(Y.star),ve=!1;X||(this.options.ecmaVersion>=8&&R("async",!0)?(ve=!0,X=this.options.ecmaVersion>=9&&this.eat(Y.star)):R("get")?N.kind="get":R("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var je=N.key,at=!1;return!N.computed&&!N.static&&(je.type==="Identifier"&&je.name==="constructor"||je.type==="Literal"&&je.value==="constructor")?(N.kind!=="method"&&this.raise(je.start,"Constructor can't have get/set modifier"),X&&this.raise(je.start,"Constructor can't be a generator"),ve&&this.raise(je.start,"Constructor can't be an async method"),N.kind="constructor",at=_):N.static&&je.type==="Identifier"&&je.name==="prototype"&&this.raise(je.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,X,ve,at),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},ii.parseClassMethod=function(_,T,N,R){return _.value=this.parseMethod(T,N,R),this.finishNode(_,"MethodDefinition")},ii.parseClassId=function(_,T){this.type===Y.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,fa,!1)):(T===!0&&this.unexpected(),_.id=null)},ii.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},ii.parseExport=function(_,T){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(T,"default",this.lastTokStart);var N;if(this.type===Y._function||(N=this.isAsyncFunction())){var R=this.startNode();this.next(),N&&this.next(),_.declaration=this.parseFunction(R,$t|ln,!1,N)}else if(this.type===Y._class){var X=this.startNode();_.declaration=this.parseClass(X,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var ve=0,je=_.specifiers;ve<je.length;ve+=1){var at=je[ve];this.checkUnreserved(at.local),this.checkLocalExport(at.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},ii.checkExport=function(_,T,N){!_||(nn(_,T)&&this.raiseRecoverable(N,"Duplicate export '"+T+"'"),_[T]=!0)},ii.checkPatternExport=function(_,T){var N=T.type;if(N==="Identifier")this.checkExport(_,T.name,T.start);else if(N==="ObjectPattern")for(var R=0,X=T.properties;R<X.length;R+=1){var ve=X[R];this.checkPatternExport(_,ve)}else if(N==="ArrayPattern")for(var je=0,at=T.elements;je<at.length;je+=1){var ot=at[je];ot&&this.checkPatternExport(_,ot)}else N==="Property"?this.checkPatternExport(_,T.value):N==="AssignmentPattern"?this.checkPatternExport(_,T.left):N==="RestElement"?this.checkPatternExport(_,T.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},ii.checkVariableExport=function(_,T){if(!!_)for(var N=0,R=T;N<R.length;N+=1){var X=R[N];this.checkPatternExport(_,X.id)}},ii.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ii.parseExportSpecifiers=function(_){var T=[],N=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(N)N=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),T.push(this.finishNode(R,"ExportSpecifier"))}return T},ii.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=Bt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},ii.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===Y.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,fa),_.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,fa),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(T)T=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var X=this.startNode();X.imported=this.parseIdent(!0),this.eatContextual("as")?X.local=this.parseIdent():(this.checkUnreserved(X.imported),X.local=X.imported),this.checkLVal(X.local,fa),_.push(this.finishNode(X,"ImportSpecifier"))}return _},ii.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},ii.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var An=Fi.prototype;An.toAssignable=function(_,T,N){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var R=0,X=_.properties;R<X.length;R+=1){var ve=X[R];this.toAssignable(ve,T),ve.type==="RestElement"&&(ve.argument.type==="ArrayPattern"||ve.argument.type==="ObjectPattern")&&this.raise(ve.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,N);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return _},An.toAssignableList=function(_,T){for(var N=_.length,R=0;R<N;R++){var X=_[R];X&&this.toAssignable(X,T)}if(N){var ve=_[N-1];this.options.ecmaVersion===6&&T&&ve&&ve.type==="RestElement"&&ve.argument.type!=="Identifier"&&this.unexpected(ve.argument.start)}return _},An.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},An.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},An.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},An.parseBindingList=function(_,T,N){for(var R=[],X=!0;!this.eat(_);)if(X?X=!1:this.expect(Y.comma),T&&this.type===Y.comma)R.push(null);else{if(N&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var ve=this.parseRestBinding();this.parseBindingListItem(ve),R.push(ve),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var je=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(je),R.push(je)}}return R},An.parseBindingListItem=function(_){return _},An.parseMaybeDefault=function(_,T,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return N;var R=this.startNodeAt(_,T);return R.left=N,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},An.checkLVal=function(_,T,N){switch(T===void 0&&(T=Li),_.type){case"Identifier":T===fa&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),N&&(nn(N,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),N[_.name]=!0),T!==Li&&T!==ya&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,X=_.properties;R<X.length;R+=1){var ve=X[R];this.checkLVal(ve,T,N)}break;case"Property":this.checkLVal(_.value,T,N);break;case"ArrayPattern":for(var je=0,at=_.elements;je<at.length;je+=1){var ot=at[je];ot&&this.checkLVal(ot,T,N)}break;case"AssignmentPattern":this.checkLVal(_.left,T,N);break;case"RestElement":this.checkLVal(_.argument,T,N);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,N);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var Nn=Fi.prototype;Nn.checkPropClash=function(_,T,N){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,X;switch(R.type){case"Identifier":X=R.name;break;case"Literal":X=String(R.value);break;default:return}var ve=_.kind;if(this.options.ecmaVersion>=6){X==="__proto__"&&ve==="init"&&(T.proto&&(N?N.doubleProto<0&&(N.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),T.proto=!0);return}X="$"+X;var je=T[X];if(je){var at;ve==="init"?at=this.strict&&je.init||je.get||je.set:at=je.init||je[ve],at&&this.raiseRecoverable(R.start,"Redefinition of property")}else je=T[X]={init:!1,get:!1,set:!1};je[ve]=!0}},Nn.parseExpression=function(_,T){var N=this.start,R=this.startLoc,X=this.parseMaybeAssign(_,T);if(this.type===Y.comma){var ve=this.startNodeAt(N,R);for(ve.expressions=[X];this.eat(Y.comma);)ve.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(ve,"SequenceExpression")}return X},Nn.parseMaybeAssign=function(_,T,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,X=-1,ve=-1;T?(X=T.parenthesizedAssign,ve=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new le,R=!0);var je=this.start,at=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var ot=this.parseMaybeConditional(_,T);if(N&&(ot=N.call(this,ot,je,at)),this.type.isAssign){var tr=this.startNodeAt(je,at);return tr.operator=this.value,tr.left=this.type===Y.eq?this.toAssignable(ot,!1,T):ot,R||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=tr.left.start&&(T.shorthandAssign=-1),this.checkLVal(ot),this.next(),tr.right=this.parseMaybeAssign(_),this.finishNode(tr,"AssignmentExpression")}else R&&this.checkExpressionErrors(T,!0);return X>-1&&(T.parenthesizedAssign=X),ve>-1&&(T.trailingComma=ve),ot},Nn.parseMaybeConditional=function(_,T){var N=this.start,R=this.startLoc,X=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return X;if(this.eat(Y.question)){var ve=this.startNodeAt(N,R);return ve.test=X,ve.consequent=this.parseMaybeAssign(),this.expect(Y.colon),ve.alternate=this.parseMaybeAssign(_),this.finishNode(ve,"ConditionalExpression")}return X},Nn.parseExprOps=function(_,T){var N=this.start,R=this.startLoc,X=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||X.start===N&&X.type==="ArrowFunctionExpression"?X:this.parseExprOp(X,N,R,-1,_)},Nn.parseExprOp=function(_,T,N,R,X){var ve=this.type.binop;if(ve!=null&&(!X||this.type!==Y._in)&&ve>R){var je=this.type===Y.logicalOR||this.type===Y.logicalAND,at=this.type===Y.coalesce;at&&(ve=Y.logicalAND.binop);var ot=this.value;this.next();var tr=this.start,ar=this.startLoc,Mn=this.parseExprOp(this.parseMaybeUnary(null,!1),tr,ar,ve,X),ei=this.buildBinary(T,N,_,Mn,ot,je||at);return(je&&this.type===Y.coalesce||at&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ei,T,N,R,X)}return _},Nn.buildBinary=function(_,T,N,R,X,ve){var je=this.startNodeAt(_,T);return je.left=N,je.operator=X,je.right=R,this.finishNode(je,ve?"LogicalExpression":"BinaryExpression")},Nn.parseMaybeUnary=function(_,T){var N=this.start,R=this.startLoc,X;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))X=this.parseAwait(),T=!0;else if(this.type.prefix){var ve=this.startNode(),je=this.type===Y.incDec;ve.operator=this.value,ve.prefix=!0,this.next(),ve.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),je?this.checkLVal(ve.argument):this.strict&&ve.operator==="delete"&&ve.argument.type==="Identifier"?this.raiseRecoverable(ve.start,"Deleting local variable in strict mode"):T=!0,X=this.finishNode(ve,je?"UpdateExpression":"UnaryExpression")}else{if(X=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return X;for(;this.type.postfix&&!this.canInsertSemicolon();){var at=this.startNodeAt(N,R);at.operator=this.value,at.prefix=!1,at.argument=X,this.checkLVal(X),this.next(),X=this.finishNode(at,"UpdateExpression")}}return!T&&this.eat(Y.starstar)?this.buildBinary(N,R,X,this.parseMaybeUnary(null,!1),"**",!1):X},Nn.parseExprSubscripts=function(_){var T=this.start,N=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var X=this.parseSubscripts(R,T,N);return _&&X.type==="MemberExpression"&&(_.parenthesizedAssign>=X.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=X.start&&(_.parenthesizedBind=-1)),X},Nn.parseSubscripts=function(_,T,N,R){for(var X=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,ve=!1;;){var je=this.parseSubscript(_,T,N,R,X,ve);if(je.optional&&(ve=!0),je===_||je.type==="ArrowFunctionExpression"){if(ve){var at=this.startNodeAt(T,N);at.expression=je,je=this.finishNode(at,"ChainExpression")}return je}_=je}},Nn.parseSubscript=function(_,T,N,R,X,ve){var je=this.options.ecmaVersion>=11,at=je&&this.eat(Y.questionDot);R&&at&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ot=this.eat(Y.bracketL);if(ot||at&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var tr=this.startNodeAt(T,N);tr.object=_,tr.property=ot?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),tr.computed=!!ot,ot&&this.expect(Y.bracketR),je&&(tr.optional=at),_=this.finishNode(tr,"MemberExpression")}else if(!R&&this.eat(Y.parenL)){var ar=new le,Mn=this.yieldPos,ei=this.awaitPos,Rn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Vi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,ar);if(X&&!at&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Mn,this.awaitPos=ei,this.awaitIdentPos=Rn,this.parseArrowExpression(this.startNodeAt(T,N),Vi,!0);this.checkExpressionErrors(ar,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=ei||this.awaitPos,this.awaitIdentPos=Rn||this.awaitIdentPos;var sa=this.startNodeAt(T,N);sa.callee=_,sa.arguments=Vi,je&&(sa.optional=at),_=this.finishNode(sa,"CallExpression")}else if(this.type===Y.backQuote){(at||ve)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ba=this.startNodeAt(T,N);ba.tag=_,ba.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(ba,"TaggedTemplateExpression")}return _},Nn.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var T,N=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(T,"Super");case Y._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case Y.name:var R=this.start,X=this.startLoc,ve=this.containsEsc,je=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!ve&&je.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(R,X),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(R,X),[je],!1);if(this.options.ecmaVersion>=8&&je.name==="async"&&this.type===Y.name&&!ve)return je=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,X),[je],!0)}return je;case Y.regexp:var at=this.value;return T=this.parseLiteral(at.value),T.regex={pattern:at.pattern,flags:at.flags},T;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return T=this.startNode(),T.value=this.type===Y._null?null:this.type===Y._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case Y.parenL:var ot=this.start,tr=this.parseParenAndDistinguishExpression(N);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(tr)&&(_.parenthesizedAssign=ot),_.parenthesizedBind<0&&(_.parenthesizedBind=ot)),tr;case Y.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Nn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},Nn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var T=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},Nn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Nn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Nn.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},Nn.parseParenAndDistinguishExpression=function(_){var T=this.start,N=this.startLoc,R,X=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var ve=this.start,je=this.startLoc,at=[],ot=!0,tr=!1,ar=new le,Mn=this.yieldPos,ei=this.awaitPos,Rn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(ot?ot=!1:this.expect(Y.comma),X&&this.afterTrailingComma(Y.parenR,!0)){tr=!0;break}else if(this.type===Y.ellipsis){Rn=this.start,at.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else at.push(this.parseMaybeAssign(!1,ar,this.parseParenItem));var Vi=this.start,sa=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ar,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Mn,this.awaitPos=ei,this.parseParenArrowList(T,N,at);(!at.length||tr)&&this.unexpected(this.lastTokStart),Rn&&this.unexpected(Rn),this.checkExpressionErrors(ar,!0),this.yieldPos=Mn||this.yieldPos,this.awaitPos=ei||this.awaitPos,at.length>1?(R=this.startNodeAt(ve,je),R.expressions=at,this.finishNodeAt(R,"SequenceExpression",Vi,sa)):R=at[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var ba=this.startNodeAt(T,N);return ba.expression=R,this.finishNode(ba,"ParenthesizedExpression")}else return R},Nn.parseParenItem=function(_){return _},Nn.parseParenArrowList=function(_,T,N){return this.parseArrowExpression(this.startNodeAt(_,T),N)};var _i=[];Nn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=T;var N=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,X=this.startLoc,ve=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,X,!0),ve&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=_i,this.finishNode(_,"NewExpression")},Nn.parseTemplateElement=function(_){var T=_.isTagged,N=this.startNode();return this.type===Y.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===Y.backQuote,this.finishNode(N,"TemplateElement")},Nn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var N=this.startNode();this.next(),N.expressions=[];var R=this.parseTemplateElement({isTagged:T});for(N.quasis=[R];!R.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(Y.braceR),N.quasis.push(R=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(N,"TemplateLiteral")},Nn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Nn.parseObj=function(_,T){var N=this.startNode(),R=!0,X={};for(N.properties=[],this.next();!this.eat(Y.braceR);){if(R)R=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var ve=this.parseProperty(_,T);_||this.checkPropClash(ve,X,T),N.properties.push(ve)}return this.finishNode(N,_?"ObjectPattern":"ObjectExpression")},Nn.parseProperty=function(_,T){var N=this.startNode(),R,X,ve,je;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(N.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===Y.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,T),this.type===Y.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(_||T)&&(ve=this.start,je=this.startLoc),_||(R=this.eat(Y.star)));var at=this.containsEsc;return this.parsePropertyName(N),!_&&!at&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(N)?(X=!0,R=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(N,T)):X=!1,this.parsePropertyValue(N,_,R,X,ve,je,T,at),this.finishNode(N,"Property")},Nn.parsePropertyValue=function(_,T,N,R,X,ve,je,at){if((N||R)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,je),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(N,R);else if(!T&&!at&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(N||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var ot=_.kind==="get"?0:1;if(_.value.params.length!==ot){var tr=_.value.start;_.kind==="get"?this.raiseRecoverable(tr,"getter should have no params"):this.raiseRecoverable(tr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((N||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=X),_.kind="init",T?_.value=this.parseMaybeDefault(X,ve,_.key):this.type===Y.eq&&je?(je.shorthandAssign<0&&(je.shorthandAssign=this.start),_.value=this.parseMaybeDefault(X,ve,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Nn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Nn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Nn.parseMethod=function(_,T,N){var R=this.startNode(),X=this.yieldPos,ve=this.awaitPos,je=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(T,R.generator)|mi|(N?ca:0)),this.expect(Y.parenL),R.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=X,this.awaitPos=ve,this.awaitIdentPos=je,this.finishNode(R,"FunctionExpression")},Nn.parseArrowExpression=function(_,T,N){var R=this.yieldPos,X=this.awaitPos,ve=this.awaitIdentPos;return this.enterScope(Gi(N,!1)|vi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=X,this.awaitIdentPos=ve,this.finishNode(_,"ArrowFunctionExpression")},Nn.parseFunctionBody=function(_,T,N){var R=T&&this.type!==Y.braceL,X=this.strict,ve=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var je=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!X||je)&&(ve=this.strictDirective(this.end),ve&&je&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var at=this.labels;this.labels=[],ve&&(this.strict=!0),this.checkParams(_,!X&&!ve&&!T&&!N&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,ya),_.body=this.parseBlock(!1,void 0,ve&&!X),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=at}this.exitScope()},Nn.isSimpleParamList=function(_){for(var T=0,N=_;T<N.length;T+=1){var R=N[T];if(R.type!=="Identifier")return!1}return!0},Nn.checkParams=function(_,T){for(var N={},R=0,X=_.params;R<X.length;R+=1){var ve=X[R];this.checkLVal(ve,$i,T?null:N)}},Nn.parseExprList=function(_,T,N,R){for(var X=[],ve=!0;!this.eat(_);){if(ve)ve=!1;else if(this.expect(Y.comma),T&&this.afterTrailingComma(_))break;var je=void 0;N&&this.type===Y.comma?je=null:this.type===Y.ellipsis?(je=this.parseSpread(R),R&&this.type===Y.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):je=this.parseMaybeAssign(!1,R),X.push(je)}return X},Nn.checkUnreserved=function(_){var T=_.start,N=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(T,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,N).indexOf("\\")!==-1)){var X=this.strict?this.reservedWordsStrict:this.reservedWords;X.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+R+"' is reserved"))}},Nn.parseIdent=function(_,T){var N=this.startNode();return this.type===Y.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(N,"Identifier"),_||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},Nn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(Y.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},Nn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var fi=Fi.prototype;fi.raise=function(_,T){var N=ht(this.input,_);T+=" ("+N.line+":"+N.column+")";var R=new SyntaxError(T);throw R.pos=_,R.loc=N,R.raisedAt=this.pos,R},fi.raiseRecoverable=fi.raise,fi.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var En=Fi.prototype,Mi=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};En.enterScope=function(_){this.scopeStack.push(new Mi(_))},En.exitScope=function(){this.scopeStack.pop()},En.treatFunctionsAsVarInScope=function(_){return _.flags&mn||!this.inModule&&_.flags&Kn},En.declareName=function(_,T,N){var R=!1;if(T===fa){var X=this.currentScope();R=X.lexical.indexOf(_)>-1||X.functions.indexOf(_)>-1||X.var.indexOf(_)>-1,X.lexical.push(_),this.inModule&&X.flags&Kn&&delete this.undefinedExports[_]}else if(T===Oa){var ve=this.currentScope();ve.lexical.push(_)}else if(T===ko){var je=this.currentScope();this.treatFunctionsAsVar?R=je.lexical.indexOf(_)>-1:R=je.lexical.indexOf(_)>-1||je.var.indexOf(_)>-1,je.functions.push(_)}else for(var at=this.scopeStack.length-1;at>=0;--at){var ot=this.scopeStack[at];if(ot.lexical.indexOf(_)>-1&&!(ot.flags&Hn&&ot.lexical[0]===_)||!this.treatFunctionsAsVarInScope(ot)&&ot.functions.indexOf(_)>-1){R=!0;break}if(ot.var.push(_),this.inModule&&ot.flags&Kn&&delete this.undefinedExports[_],ot.flags&di)break}R&&this.raiseRecoverable(N,"Identifier '"+_+"' has already been declared")},En.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},En.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},En.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&di)return T}},En.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&di&&!(T.flags&vi))return T}};var Ti=function(T,N,R){this.type="",this.start=N,this.end=0,T.options.locations&&(this.loc=new _t(T,R)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[N,0])},eo=Fi.prototype;eo.startNode=function(){return new Ti(this,this.start,this.startLoc)},eo.startNodeAt=function(_,T){return new Ti(this,_,T)};function ps(_,T,N,R){return _.type=T,_.end=N,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=N),_}eo.finishNode=function(_,T){return ps.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},eo.finishNodeAt=function(_,T,N,R){return ps.call(this,_,T,N,R)};var Go=function(T,N,R,X,ve){this.token=T,this.isExpr=!!N,this.preserveSpace=!!R,this.override=X,this.generator=!!ve},Da={b_stat:new Go("{",!1),b_expr:new Go("{",!0),b_tmpl:new Go("${",!1),p_stat:new Go("(",!1),p_expr:new Go("(",!0),q_tmpl:new Go("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Go("function",!1),f_expr:new Go("function",!0),f_expr_gen:new Go("function",!0,!1,null,!0),f_gen:new Go("function",!1,!1,null,!0)},_a=Fi.prototype;_a.initialContext=function(){return[Da.b_stat]},_a.braceIsBlock=function(_){var T=this.curContext();return T===Da.f_expr||T===Da.f_stat?!0:_===Y.colon&&(T===Da.b_stat||T===Da.b_expr)?!T.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?T===Da.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},_a.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},_a.updateContext=function(_){var T,N=this.type;N.keyword&&_===Y.dot?this.exprAllowed=!1:(T=N.updateContext)?T.call(this,_):this.exprAllowed=N.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Da.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Da.b_stat:Da.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Da.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var T=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(T?Da.p_stat:Da.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===Da.b_stat)?this.context.push(Da.f_expr):this.context.push(Da.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Da.q_tmpl?this.context.pop():this.context.push(Da.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var T=this.context.length-1;this.context[T]===Da.f_expr?this.context[T]=Da.f_expr_gen:this.context[T]=Da.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",q=V+" Extended_Pictographic",ee=q,fe={9:V,10:q,11:ee},Me="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ue="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ke=Ue+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",oe=Ke+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Re={9:Ue,10:Ke,11:oe},ut={};function cr(_){var T=ut[_]={binary:Se(fe[_]+" "+Me),nonBinary:{General_Category:Se(Me),Script:Se(Re[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}cr(9),cr(10),cr(11);var Tt=Fi.prototype,Rt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ut[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Rt.prototype.reset=function(T,N,R){var X=R.indexOf("u")!==-1;this.start=T|0,this.source=N+"",this.flags=R,this.switchU=X&&this.parser.options.ecmaVersion>=6,this.switchN=X&&this.parser.options.ecmaVersion>=9},Rt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Rt.prototype.at=function(T,N){N===void 0&&(N=!1);var R=this.source,X=R.length;if(T>=X)return-1;var ve=R.charCodeAt(T);if(!(N||this.switchU)||ve<=55295||ve>=57344||T+1>=X)return ve;var je=R.charCodeAt(T+1);return je>=56320&&je<=57343?(ve<<10)+je-56613888:ve},Rt.prototype.nextIndex=function(T,N){N===void 0&&(N=!1);var R=this.source,X=R.length;if(T>=X)return X;var ve=R.charCodeAt(T),je;return!(N||this.switchU)||ve<=55295||ve>=57344||T+1>=X||(je=R.charCodeAt(T+1))<56320||je>57343?T+1:T+2},Rt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Rt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Rt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Rt.prototype.eat=function(T,N){return N===void 0&&(N=!1),this.current(N)===T?(this.advance(N),!0):!1};function hr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Tt.validateRegExpFlags=function(_){for(var T=_.validFlags,N=_.flags,R=0;R<N.length;R++){var X=N.charAt(R);T.indexOf(X)===-1&&this.raise(_.start,"Invalid regular expression flag"),N.indexOf(X,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Tt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Tt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,N=_.backReferenceNames;T<N.length;T+=1){var R=N[T];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Tt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Tt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Tt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Tt.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!N,!0}return _.pos=T,!1},Tt.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Tt.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Tt.regexp_eatBracedQuantifier=function(_,T){var N=_.pos;if(_.eat(123)){var R=0,X=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(X=_.lastIntValue),_.eat(125)))return X!==-1&&X<R&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=N}return!1},Tt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Tt.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Tt.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Tt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Tt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Tt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Tt.regexp_eatSyntaxCharacter=function(_){var T=_.current();return gn(T)?(_.lastIntValue=T,_.advance(),!0):!1};function gn(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Tt.regexp_eatPatternCharacters=function(_){for(var T=_.pos,N=0;(N=_.current())!==-1&&!gn(N);)_.advance();return _.pos!==T},Tt.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Tt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Tt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Tt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=hr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=hr(_.lastIntValue);return!0}return!1},Tt.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,N=this.options.ecmaVersion>=11,R=_.current(N);return _.advance(N),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,N)&&(R=_.lastIntValue),cn(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function cn(_){return Jt(_,!0)||_===36||_===95}Tt.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,N=this.options.ecmaVersion>=11,R=_.current(N);return _.advance(N),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,N)&&(R=_.lastIntValue),Et(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function Et(_){return ur(_,!0)||_===36||_===95||_===8204||_===8205}Tt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Tt.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var N=_.lastIntValue;if(_.switchU)return N>_.maxBackReference&&(_.maxBackReference=N),!0;if(N<=_.numCapturingParens)return!0;_.pos=T}return!1},Tt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Tt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Tt.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Tt.regexp_eatZero=function(_){return _.current()===48&&!Tn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Tt.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Tt.regexp_eatControlLetter=function(_){var T=_.current();return Qr(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function Qr(_){return _>=65&&_<=90||_>=97&&_<=122}Tt.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var N=_.pos,R=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var X=_.lastIntValue;if(R&&X>=55296&&X<=56319){var ve=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var je=_.lastIntValue;if(je>=56320&&je<=57343)return _.lastIntValue=(X-55296)*1024+(je-56320)+65536,!0}_.pos=ve,_.lastIntValue=X}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Lr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=N}return!1};function Lr(_){return _>=0&&_<=1114111}Tt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Tt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Tt.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Wr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Wr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Tt.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var N=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,N,R),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var X=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,X),!0}return!1},Tt.regexp_validateUnicodePropertyNameAndValue=function(_,T,N){nn(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(N)||_.raise("Invalid property value")},Tt.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Tt.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";hi(T=_.current());)_.lastStringValue+=hr(T),_.advance();return _.lastStringValue!==""};function hi(_){return Qr(_)||_===95}Tt.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";Jr(T=_.current());)_.lastStringValue+=hr(T),_.advance();return _.lastStringValue!==""};function Jr(_){return hi(_)||Tn(_)}Tt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Tt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Tt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var N=_.lastIntValue;_.switchU&&(T===-1||N===-1)&&_.raise("Invalid character class"),T!==-1&&N!==-1&&T>N&&_.raise("Range out of order in character class")}}},Tt.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var N=_.current();(N===99||Si(N))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Tt.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Tt.regexp_eatClassControlLetter=function(_){var T=_.current();return Tn(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Tt.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Tt.regexp_eatDecimalDigits=function(_){var T=_.pos,N=0;for(_.lastIntValue=0;Tn(N=_.current());)_.lastIntValue=10*_.lastIntValue+(N-48),_.advance();return _.pos!==T};function Tn(_){return _>=48&&_<=57}Tt.regexp_eatHexDigits=function(_){var T=_.pos,N=0;for(_.lastIntValue=0;Zi(N=_.current());)_.lastIntValue=16*_.lastIntValue+si(N),_.advance();return _.pos!==T};function Zi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function si(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Tt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var N=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+N*8+_.lastIntValue:_.lastIntValue=T*8+N}else _.lastIntValue=T;return!0}return!1},Tt.regexp_eatOctalDigit=function(_){var T=_.current();return Si(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Si(_){return _>=48&&_<=55}Tt.regexp_eatFixedHexDigits=function(_,T){var N=_.pos;_.lastIntValue=0;for(var R=0;R<T;++R){var X=_.current();if(!Zi(X))return _.pos=N,!1;_.lastIntValue=16*_.lastIntValue+si(X),_.advance()}return!0};var gi=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new _t(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},vt=Fi.prototype;vt.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new gi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},vt.getToken=function(){return this.next(),new gi(this)},typeof Symbol!="undefined"&&(vt[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===Y.eof,value:T}}}}),vt.curContext=function(){return this.context[this.context.length-1]},vt.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},vt.readToken=function(_){return Jt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},vt.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},vt.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){st.lastIndex=T;for(var R;(R=st.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,N),T,this.pos,_,this.curPosition())},vt.skipLineComment=function(_){for(var T=this.pos,N=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Ye(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,N,this.curPosition())},vt.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&bt.test(String.fromCharCode(_)))++this.pos;else break e}}},vt.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=_,this.value=T,this.updateContext(N)},vt.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},vt.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},vt.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),N=1,R=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++N,R=Y.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(Y.assign,N+1):this.finishOp(R,N)},vt.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return T===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},vt.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},vt.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):T===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},vt.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),N=1;return T===_?(N=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(Y.assign,N+1):this.finishOp(Y.bitShift,N)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(N=2),this.finishOp(Y.relational,N))},vt.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},vt.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(Y.questionDot,2)}if(T===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},vt.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+bi(_)+"'")},vt.finishOp=function(_,T){var N=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,N)},vt.readRegexp=function(){for(var _,T,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Xt.test(R)&&this.raise(N,"Unterminated regular expression"),_)_=!1;else{if(R==="[")T=!0;else if(R==="]"&&T)T=!1;else if(R==="/"&&!T)break;_=R==="\\"}++this.pos}var X=this.input.slice(N,this.pos);++this.pos;var ve=this.pos,je=this.readWord1();this.containsEsc&&this.unexpected(ve);var at=this.regexpState||(this.regexpState=new Rt(this));at.reset(N,X,je),this.validateRegExpFlags(at),this.validateRegExpPattern(at);var ot=null;try{ot=new RegExp(X,je)}catch(tr){}return this.finishToken(Y.regexp,{pattern:X,flags:je,value:ot})},vt.readInt=function(_,T,N){for(var R=this.options.ecmaVersion>=12&&T===void 0,X=N&&this.input.charCodeAt(this.pos)===48,ve=this.pos,je=0,at=0,ot=0,tr=T==null?Infinity:T;ot<tr;++ot,++this.pos){var ar=this.input.charCodeAt(this.pos),Mn=void 0;if(R&&ar===95){X&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),at===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),ot===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),at=ar;continue}if(ar>=97?Mn=ar-97+10:ar>=65?Mn=ar-65+10:ar>=48&&ar<=57?Mn=ar-48:Mn=Infinity,Mn>=_)break;at=ar,je=je*_+Mn}return R&&at===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===ve||T!=null&&this.pos-ve!==T?null:je};function kt(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ca(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}vt.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var N=this.readInt(_);return N==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=Ca(this.input.slice(T,this.pos)),++this.pos):Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,N)},vt.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var N=this.pos-T>=2&&this.input.charCodeAt(T)===48;N&&this.strict&&this.raise(T,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!N&&!_&&this.options.ecmaVersion>=11&&R===110){var X=Ca(this.input.slice(T,this.pos));return++this.pos,Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,X)}N&&/[89]/.test(this.input.slice(T,this.pos))&&(N=!1),R===46&&!N&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!N&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Jt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var ve=kt(this.input.slice(T,this.pos),N);return this.finishToken(Y.num,ve)},vt.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else T=this.readHexChar(4);return T};function bi(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}vt.readString=function(_){for(var T="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(T+=this.input.slice(N,this.pos),T+=this.readEscapedChar(!1),N=this.pos):(Ye(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(N,this.pos++),this.finishToken(Y.string,T)};var Ci={};vt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ci)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},vt.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ci;this.raise(_,T)},vt.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(Y.template,_));if(N===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(Ye(N)){switch(_+=this.input.slice(T,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},vt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},vt.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return bi(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],X=parseInt(R,8);return X>255&&(R=R.slice(0,-1),X=parseInt(R,8)),this.pos+=R.length-1,T=this.input.charCodeAt(this.pos),(R!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(X)}return Ye(T)?"":String.fromCharCode(T)}},vt.readHexChar=function(_){var T=this.pos,N=this.readInt(16,_);return N===null&&this.invalidStringToken(T,"Bad character escape sequence"),N},vt.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,N=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var X=this.fullCharCodeAtPos();if(ur(X,R))this.pos+=X<=65535?1:2;else if(X===92){this.containsEsc=!0,_+=this.input.slice(N,this.pos);var ve=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var je=this.readCodePoint();(T?Jt:ur)(je,R)||this.invalidStringToken(ve,"Invalid Unicode escape"),_+=bi(je),N=this.pos}else break;T=!1}return _+this.input.slice(N,this.pos)},vt.readWord=function(){var _=this.readWord1(),T=Y.name;return this.keywords.test(_)&&(T=pt[_]),this.finishToken(T,_)};var Di="7.4.1";Fi.acorn={Parser:Fi,version:Di,defaultOptions:Lt,Position:ke,SourceLocation:_t,getLineInfo:ht,Node:Ti,TokenType:It,tokTypes:Y,keywordTypes:pt,TokContext:Go,tokContexts:Da,isIdentifierChar:ur,isIdentifierStart:Jt,Token:gi,isNewLine:Ye,lineBreak:Xt,lineBreakG:st,nonASCIIwhitespace:bt};function Fr(_,T){return Fi.parse(_,T)}function xn(_,T,N){return Fi.parseExpressionAt(_,T,N)}function Ct(_,T){return Fi.tokenizer(_,T)}function Ji(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function de(_){var T=typeof Map=="function"?new Map:void 0;return de=function(R){if(R===null||!hu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(R))return T.get(R);T.set(R,X)}function X(){return Wi(R,arguments,wa(this).constructor)}return X.prototype=Object.create(R.prototype,{constructor:{value:X,enumerable:!1,writable:!0,configurable:!0}}),Fa(X,R)},de(_)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Wi(_,T,N){return Ko()?Wi=Reflect.construct:Wi=function(X,ve,je){var at=[null];at.push.apply(at,ve);var ot=Function.bind.apply(X,at),tr=new ot;return je&&Fa(tr,je.prototype),tr},Wi.apply(null,arguments)}function hu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function Fa(_,T){return Fa=Object.setPrototypeOf||function(R,X){return R.__proto__=X,R},Fa(_,T)}function wa(_){return wa=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},wa(_)}var Ga=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(de(Error)),ea=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(de(SyntaxError)),Mo=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(de(ReferenceError)),Ho=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(de(TypeError)),bu=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(Ga),ho=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(ea),Lo=function(_){Ji(T,_);function T(){return _.apply(this,arguments)||this}return T}(Mo),ta={UnknownError:[3001,"%0",bu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",bu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Lo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Lo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Lo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Lo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Lo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Lo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Lo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Lo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Lo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Lo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Mo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Mo],IsNotConstructor:[2003,"%0 is not a constructor",Ho]};function Ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Do(_,T,N){return Ha()?Do=Reflect.construct:Do=function(X,ve,je){var at=[null];at.push.apply(at,ve);var ot=Function.bind.apply(X,at),tr=new ot;return je&&Wa(tr,je.prototype),tr},Do.apply(null,arguments)}function Wa(_,T){return Wa=Object.setPrototypeOf||function(R,X){return R.__proto__=X,R},Wa(_,T)}var Ss="0.0.3";function bl(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var ds=Object.prototype.hasOwnProperty,Q=Symbol("Break"),me=Symbol("Continue"),He=Symbol("DefaultCase"),wt=Symbol("EmptyStatementReturn"),Tr=Symbol("WithScopeName"),In=Symbol("SuperScopeName"),wi=Symbol("RootScopeName"),to=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Ba=function(){function _(N){this.interpreter=N}var T=_.prototype;return T.generator=function(){var R=this.interpreter;function X(){return this.getCurrentScope()}function ve(){return this.getGlobalScope()}function je(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:X.bind(R),getGlobalScope:ve.bind(R),getCurrentContext:je.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Wo(_,T,N){if(N===void 0&&(N=!0),!(_ instanceof Ba))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var R=_.generator(),X=R.getOptions(),ve={timeout:X.timeout,_initEnv:function(){N||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},je=N?R.getGlobalScope():R.getCurrentScope(),at=new va(je,ve);return at.evaluate(T)}}Object.defineProperty(Wo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function vs(_){if(!(_ instanceof Ba))throw new Error("Illegal call");for(var T=_.generator(),N=arguments.length,R=new Array(N>1?N-1:0),X=1;X<N;X++)R[X-1]=arguments[X];var ve=R.pop(),je=new va(T.getGlobalScope(),T.getOptions()),at=`
		    (function anonymous(`+R.join(",")+`){
		        `+ve+`
		    });
		    `;return je.evaluate(at)}Object.defineProperty(vs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var uo=function(T){this.value=T},Po=function(T){this.value=T},ms=function(T){this.value=T},Cs=function(T,N,R){N===void 0&&(N=null),this.name=R,this.parent=N,this.data=T,this.labelStack=[]};function Ps(){}function Js(_,T){return _===void 0&&(_=null),new Cs(Object.create(null),_,T)}function gs(_){return Object.create(_)}var ha={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Wo,Function:vs};typeof JSON!="undefined"&&(ha.JSON=JSON),typeof Promise!="undefined"&&(ha.Promise=Promise),typeof Set!="undefined"&&(ha.Set=Set),typeof Map!="undefined"&&(ha.Map=Map),typeof Symbol!="undefined"&&(ha.Symbol=Symbol),typeof Proxy!="undefined"&&(ha.Proxy=Proxy),typeof WeakMap!="undefined"&&(ha.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ha.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ha.Reflect=Reflect);var va=function(){function _(N,R){N===void 0&&(N=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(R){var X;if(R instanceof Cs)X=R;else{var ve=null,je=this.createSuperScope(R);this.options.rootContext&&(ve=new Cs(gs(this.options.rootContext),je,wi)),X=new Cs(R,ve||je,to)}this.globalScope=X,this.currentScope=this.globalScope,this.globalContext=X.data,this.currentContext=X.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var at=this.options._initEnv;at&&at.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(R){return R instanceof bu||R instanceof Lo||R instanceof ho},T.createSuperScope=function(R){var X=Object.assign({},ha),ve=Object.keys(X);return ve.forEach(function(je){je in R&&delete X[je]}),new Cs(X,null,In)},T.setCurrentContext=function(R){this.currentContext=R},T.setCurrentScope=function(R){this.currentScope=R},T.evaluate=function(R){R===void 0&&(R="");var X;if(!!R)return X=Fr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(X,R)},T.appendCode=function(R){return this.evaluate(R)},T.evaluateNode=function(R,X){var ve=this;X===void 0&&(X=""),this.value=void 0,this.source=X,this.sourceList.push(X),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var je=this.getCurrentScope(),at=this.getCurrentContext(),ot=je.labelStack.concat([]),tr=this.callStack.concat([]),ar=function(){ve.setCurrentScope(je),ve.setCurrentContext(at),je.labelStack=ot,ve.callStack=tr};try{var Mn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Mn()}catch(ei){throw ei}finally{ar(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(R,X,ve){var je=R[1].replace("%0",String(X));return ve!==null&&(je+=this.getNodePosition(ve||this.lastExecNode)),je},T.createError=function(R,X){return new X(R)},T.createThrowError=function(R,X){return this.createError(R,X)},T.createInternalThrowError=function(R,X,ve){return this.createError(this.createErrorMessage(R,X,ve),R[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,X=Date.now();return X-this.execStartTime>R},T.getNodePosition=function(R){if(R){var X="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+X:""}return""},T.createClosure=function(R){var X=this,ve;switch(R.type){case"BinaryExpression":ve=this.binaryExpressionHandler(R);break;case"LogicalExpression":ve=this.logicalExpressionHandler(R);break;case"UnaryExpression":ve=this.unaryExpressionHandler(R);break;case"UpdateExpression":ve=this.updateExpressionHandler(R);break;case"ObjectExpression":ve=this.objectExpressionHandler(R);break;case"ArrayExpression":ve=this.arrayExpressionHandler(R);break;case"CallExpression":ve=this.callExpressionHandler(R);break;case"NewExpression":ve=this.newExpressionHandler(R);break;case"MemberExpression":ve=this.memberExpressionHandler(R);break;case"ThisExpression":ve=this.thisExpressionHandler(R);break;case"SequenceExpression":ve=this.sequenceExpressionHandler(R);break;case"Literal":ve=this.literalHandler(R);break;case"Identifier":ve=this.identifierHandler(R);break;case"AssignmentExpression":ve=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":ve=this.functionDeclarationHandler(R);break;case"VariableDeclaration":ve=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":ve=this.programHandler(R);break;case"ExpressionStatement":ve=this.expressionStatementHandler(R);break;case"EmptyStatement":ve=this.emptyStatementHandler(R);break;case"ReturnStatement":ve=this.returnStatementHandler(R);break;case"FunctionExpression":ve=this.functionExpressionHandler(R);break;case"IfStatement":ve=this.ifStatementHandler(R);break;case"ConditionalExpression":ve=this.conditionalExpressionHandler(R);break;case"ForStatement":ve=this.forStatementHandler(R);break;case"WhileStatement":ve=this.whileStatementHandler(R);break;case"DoWhileStatement":ve=this.doWhileStatementHandler(R);break;case"ForInStatement":ve=this.forInStatementHandler(R);break;case"WithStatement":ve=this.withStatementHandler(R);break;case"ThrowStatement":ve=this.throwStatementHandler(R);break;case"TryStatement":ve=this.tryStatementHandler(R);break;case"ContinueStatement":ve=this.continueStatementHandler(R);break;case"BreakStatement":ve=this.breakStatementHandler(R);break;case"SwitchStatement":ve=this.switchStatementHandler(R);break;case"LabeledStatement":ve=this.labeledStatementHandler(R);break;case"DebuggerStatement":ve=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ta.NodeTypeSyntaxError,R.type,R)}return function(){var je=X.options.timeout;if(je&&je>0&&X.checkTimeout())throw X.createInternalThrowError(ta.ExecutionTimeOutError,je,null);return X.lastExecNode=R,ve.apply(void 0,arguments)}},T.binaryExpressionHandler=function(R){var X=this,ve=this.createClosure(R.left),je=this.createClosure(R.right);return function(){var at=ve(),ot=je();switch(R.operator){case"==":return at==ot;case"!=":return at!=ot;case"===":return at===ot;case"!==":return at!==ot;case"<":return at<ot;case"<=":return at<=ot;case">":return at>ot;case">=":return at>=ot;case"<<":return at<<ot;case">>":return at>>ot;case">>>":return at>>>ot;case"+":return at+ot;case"-":return at-ot;case"*":return at*ot;case"**":return Math.pow(at,ot);case"/":return at/ot;case"%":return at%ot;case"|":return at|ot;case"^":return at^ot;case"&":return at&ot;case"in":return at in ot;case"instanceof":return at instanceof ot;default:throw X.createInternalThrowError(ta.BinaryOperatorSyntaxError,R.operator,R)}}},T.logicalExpressionHandler=function(R){var X=this,ve=this.createClosure(R.left),je=this.createClosure(R.right);return function(){switch(R.operator){case"||":return ve()||je();case"&&":return ve()&&je();default:throw X.createInternalThrowError(ta.LogicalOperatorSyntaxError,R.operator,R)}}},T.unaryExpressionHandler=function(R){var X=this;switch(R.operator){case"delete":var ve=this.createObjectGetter(R.argument),je=this.createNameGetter(R.argument);return function(){var ar=ve(),Mn=je();return delete ar[Mn]};default:var at;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var ot=this.createObjectGetter(R.argument),tr=this.createNameGetter(R.argument);at=function(){return ot()[tr()]}}else at=this.createClosure(R.argument);return function(){var ar=at();switch(R.operator){case"-":return-ar;case"+":return+ar;case"!":return!ar;case"~":return~ar;case"void":return;case"typeof":return typeof ar;default:throw X.createInternalThrowError(ta.UnaryOperatorSyntaxError,R.operator,R)}}}},T.updateExpressionHandler=function(R){var X=this,ve=this.createObjectGetter(R.argument),je=this.createNameGetter(R.argument);return function(){var at=ve(),ot=je();switch(X.assertVariable(at,ot,R),R.operator){case"++":return R.prefix?++at[ot]:at[ot]++;case"--":return R.prefix?--at[ot]:at[ot]--;default:throw X.createInternalThrowError(ta.UpdateOperatorSyntaxError,R.operator,R)}}},T.objectExpressionHandler=function(R){var X=this,ve=[];function je(ot){return ot.type==="Identifier"?ot.name:ot.type==="Literal"?ot.value:this.throwError(ta.ObjectStructureSyntaxError,ot.type,ot)}var at=Object.create(null);return R.properties.forEach(function(ot){var tr=ot.kind,ar=je(ot.key);(!at[ar]||tr==="init")&&(at[ar]={}),at[ar][tr]=X.createClosure(ot.value),ve.push({key:ar,property:ot})}),function(){for(var ot={},tr=ve.length,ar=0;ar<tr;ar++){var Mn=ve[ar],ei=Mn.key,Rn=at[ei],Vi=Rn.init?Rn.init():void 0,sa=Rn.get?Rn.get():function(){},ba=Rn.set?Rn.set():function(Vu){};if("set"in Rn||"get"in Rn){var Bi={configurable:!0,enumerable:!0,get:sa,set:ba};Object.defineProperty(ot,ei,Bi)}else{var ys=Mn.property,eu=ys.kind;ys.key.type==="Identifier"&&ys.value.type==="FunctionExpression"&&eu==="init"&&!ys.value.id&&bl(Vi,ys.key.name),ot[ei]=Vi}}return ot}},T.arrayExpressionHandler=function(R){var X=this,ve=R.elements.map(function(je){return je&&X.createClosure(je)});return function(){for(var je=ve.length,at=Array(je),ot=0;ot<je;ot++){var tr=ve[ot];tr&&(at[ot]=tr())}return at}},T.safeObjectGet=function(R,X,ve){return R[X]},T.createCallFunctionGetter=function(R){var X=this;switch(R.type){case"MemberExpression":var ve=this.createClosure(R.object),je=this.createMemberKeyGetter(R),at=this.source;return function(){var tr=ve(),ar=je(),Mn=X.safeObjectGet(tr,ar,R);if(!Mn||!Ra(Mn)){var ei=at.slice(R.start,R.end);throw X.createInternalThrowError(ta.FunctionUndefinedReferenceError,ei,R)}return Mn.__IS_EVAL_FUNC?function(Rn){return Mn(new Ba(X),Rn,!0)}:Mn.__IS_FUNCTION_FUNC?function(){for(var Rn=arguments.length,Vi=new Array(Rn),sa=0;sa<Rn;sa++)Vi[sa]=arguments[sa];return Mn.apply(void 0,[new Ba(X)].concat(Vi))}:Mn.bind(tr)};default:var ot=this.createClosure(R);return function(){var tr="";R.type==="Identifier"&&(tr=R.name);var ar=ot();if(!ar||!Ra(ar))throw X.createInternalThrowError(ta.FunctionUndefinedReferenceError,tr,R);if(R.type==="Identifier"&&ar.__IS_EVAL_FUNC&&tr==="eval")return function(Rn){var Vi=X.getScopeFromName(tr,X.getCurrentScope()),sa=Vi.name===In||Vi.name===to||Vi.name===wi;return ar(new Ba(X),Rn,!sa)};if(ar.__IS_EVAL_FUNC)return function(Rn){return ar(new Ba(X),Rn,!0)};if(ar.__IS_FUNCTION_FUNC)return function(){for(var Rn=arguments.length,Vi=new Array(Rn),sa=0;sa<Rn;sa++)Vi[sa]=arguments[sa];return ar.apply(void 0,[new Ba(X)].concat(Vi))};var Mn=X.options.globalContextInFunction;if(R.type==="Identifier"){var ei=X.getIdentifierScope(R);ei.name===Tr&&(Mn=ei.data)}return ar.bind(Mn)}}},T.callExpressionHandler=function(R){var X=this,ve=this.createCallFunctionGetter(R.callee),je=R.arguments.map(function(at){return X.createClosure(at)});return function(){return ve().apply(void 0,je.map(function(at){return at()}))}},T.functionExpressionHandler=function(R){var X=this,ve=this,je=this.source,at=this.collectDeclVars,ot=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var tr=R.id?R.id.name:"",ar=R.params.length,Mn=R.params.map(function(sa){return X.createParamNameGetter(sa)}),ei=this.createClosure(R.body),Rn=this.collectDeclVars,Vi=this.collectDeclFuncs;return this.collectDeclVars=at,this.collectDeclFuncs=ot,function(){var sa=ve.getCurrentScope(),ba=function Bi(){for(var ys=arguments.length,eu=new Array(ys),Vu=0;Vu<ys;Vu++)eu[Vu]=arguments[Vu];ve.callStack.push(""+tr);var uf=ve.getCurrentScope(),rl=Js(sa,"FunctionScope("+tr+")");ve.setCurrentScope(rl),ve.addDeclarationsToScope(Rn,Vi,rl),tr&&(rl.data[tr]=Bi),rl.data.arguments=arguments,Mn.forEach(function(Su,Cu){rl.data[Su()]=eu[Cu]});var Ic=ve.getCurrentContext();ve.setCurrentContext(this);var Eu=ei();if(ve.setCurrentContext(Ic),ve.setCurrentScope(uf),ve.callStack.pop(),Eu instanceof uo)return Eu.value};return bl(ba,tr),Object.defineProperty(ba,"length",{value:ar,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(ba,"toString",{value:function(){return je.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(ba,"valueOf",{value:function(){return je.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),ba}},T.newExpressionHandler=function(R){var X=this,ve=this.source,je=this.createClosure(R.callee),at=R.arguments.map(function(ot){return X.createClosure(ot)});return function(){var ot=je();if(!Ra(ot)||ot.__IS_EVAL_FUNC){var tr=R.callee,ar=ve.slice(tr.start,tr.end);throw X.createInternalThrowError(ta.IsNotConstructor,ar,R)}return ot.__IS_FUNCTION_FUNC?ot.apply(void 0,[new Ba(X)].concat(at.map(function(Mn){return Mn()}))):Do(ot,at.map(function(Mn){return Mn()}))}},T.memberExpressionHandler=function(R){var X=this.createClosure(R.object),ve=this.createMemberKeyGetter(R);return function(){var je=X(),at=ve();return je[at]}},T.thisExpressionHandler=function(R){var X=this;return function(){return X.getCurrentContext()}},T.sequenceExpressionHandler=function(R){var X=this,ve=R.expressions.map(function(je){return X.createClosure(je)});return function(){for(var je,at=ve.length,ot=0;ot<at;ot++){var tr=ve[ot];je=tr()}return je}},T.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},T.identifierHandler=function(R){var X=this;return function(){var ve=X.getCurrentScope(),je=X.getScopeDataFromName(R.name,ve);return X.assertVariable(je,R.name,R),je[R.name]}},T.getIdentifierScope=function(R){var X=this.getCurrentScope(),ve=this.getScopeFromName(R.name,X);return ve},T.assignmentExpressionHandler=function(R){var X=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var ve=this.createObjectGetter(R.left),je=this.createNameGetter(R.left),at=this.createClosure(R.right);return function(){var ot=ve(),tr=je(),ar=at();switch(R.operator!=="="&&X.assertVariable(ot,tr,R),R.operator){case"=":return ot[tr]=ar;case"+=":return ot[tr]+=ar;case"-=":return ot[tr]-=ar;case"*=":return ot[tr]*=ar;case"**=":return ot[tr]=Math.pow(ot[tr],ar);case"/=":return ot[tr]/=ar;case"%=":return ot[tr]%=ar;case"<<=":return ot[tr]<<=ar;case">>=":return ot[tr]>>=ar;case">>>=":return ot[tr]>>>=ar;case"&=":return ot[tr]&=ar;case"^=":return ot[tr]^=ar;case"|=":return ot[tr]|=ar;default:throw X.createInternalThrowError(ta.AssignmentExpressionSyntaxError,R.type,R)}}},T.functionDeclarationHandler=function(R){if(R.id){var X=this.functionExpressionHandler(R);Object.defineProperty(X,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,X)}return function(){return wt}},T.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ta.VariableTypeSyntaxError,R.type,R)},T.variableDeclarationHandler=function(R){for(var X=this,ve,je=[],at=0;at<R.declarations.length;at++){var ot=R.declarations[at];this.varDeclaration(this.getVariableName(ot.id)),ot.init&&je.push({type:"AssignmentExpression",operator:"=",left:ot.id,right:ot.init})}return je.length&&(ve=this.createClosure({type:"BlockStatement",body:je})),function(){if(ve){var tr=X.isVarDeclMode;X.isVarDeclMode=!0,ve(),X.isVarDeclMode=tr}return wt}},T.assertVariable=function(R,X,ve){if(R===this.globalScope.data&&!(X in R))throw this.createInternalThrowError(ta.VariableUndefinedReferenceError,X,ve)},T.programHandler=function(R){var X=this,ve=R.body.map(function(je){return X.createClosure(je)});return function(){for(var je=wt,at=0;at<ve.length;at++){var ot=ve[at],tr=X.setValue(ot());if(tr!==wt&&(je=tr,je instanceof uo||je instanceof Po||je instanceof ms||je===Q||je===me))break}return je}},T.expressionStatementHandler=function(R){return this.createClosure(R.expression)},T.emptyStatementHandler=function(R){return function(){return wt}},T.returnStatementHandler=function(R){var X=R.argument?this.createClosure(R.argument):Ps;return function(){return new uo(X())}},T.ifStatementHandler=function(R){var X=this.createClosure(R.test),ve=this.createClosure(R.consequent),je=R.alternate?this.createClosure(R.alternate):function(){return wt};return function(){return X()?ve():je()}},T.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},T.forStatementHandler=function(R){var X=this,ve=Ps,je=R.test?this.createClosure(R.test):function(){return!0},at=Ps,ot=this.createClosure(R.body);return R.type==="ForStatement"&&(ve=R.init?this.createClosure(R.init):ve,at=R.update?this.createClosure(R.update):Ps),function(tr){var ar,Mn=wt,ei=R.type==="DoWhileStatement";for(tr&&tr.type==="LabeledStatement"&&(ar=tr.label.name),ve();ei||je();at()){ei=!1;var Rn=X.setValue(ot());if(!(Rn===wt||Rn===me)){if(Rn===Q)break;if(Mn=Rn,Mn instanceof ms&&Mn.value===ar){Mn=wt;continue}if(Mn instanceof uo||Mn instanceof Po||Mn instanceof ms)break}}return Mn}},T.whileStatementHandler=function(R){return this.forStatementHandler(R)},T.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},T.forInStatementHandler=function(R){var X=this,ve=R.left,je=this.createClosure(R.right),at=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),ve=R.left.declarations[0].id),function(ot){var tr,ar=wt,Mn;ot&&ot.type==="LabeledStatement"&&(tr=ot.label.name);var ei=je();for(Mn in ei){X.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:ve,right:{type:"Literal",value:Mn}})();var Rn=X.setValue(at());if(!(Rn===wt||Rn===me)){if(Rn===Q)break;if(ar=Rn,ar instanceof ms&&ar.value===tr){ar=wt;continue}if(ar instanceof uo||ar instanceof Po||ar instanceof ms)break}}return ar}},T.withStatementHandler=function(R){var X=this,ve=this.createClosure(R.object),je=this.createClosure(R.body);return function(){var at=ve(),ot=X.getCurrentScope(),tr=new Cs(at,ot,Tr);X.setCurrentScope(tr);var ar=X.setValue(je());return X.setCurrentScope(ot),ar}},T.throwStatementHandler=function(R){var X=this,ve=this.createClosure(R.argument);return function(){throw X.setValue(void 0),ve()}},T.tryStatementHandler=function(R){var X=this,ve=this.createClosure(R.block),je=R.handler?this.catchClauseHandler(R.handler):null,at=R.finalizer?this.createClosure(R.finalizer):null;return function(){var ot=X.getCurrentScope(),tr=X.getCurrentContext(),ar=ot.labelStack.concat([]),Mn=X.callStack.concat([]),ei=wt,Rn,Vi,sa=function(){X.setCurrentScope(ot),X.setCurrentContext(tr),ot.labelStack=ar,X.callStack=Mn};try{ei=X.setValue(ve()),ei instanceof uo&&(Rn=ei)}catch(ba){if(sa(),X.isInterruptThrow(ba))throw ba;if(je)try{ei=X.setValue(je(ba)),ei instanceof uo&&(Rn=ei)}catch(Bi){if(sa(),X.isInterruptThrow(Bi))throw Bi;Vi=Bi}}if(at)try{ei=at(),ei instanceof uo&&(Rn=ei)}catch(ba){if(sa(),X.isInterruptThrow(ba))throw ba;Vi=ba}if(Vi)throw Vi;return Rn||ei}},T.catchClauseHandler=function(R){var X=this,ve=this.createParamNameGetter(R.param),je=this.createClosure(R.body);return function(at){var ot,tr=X.getCurrentScope(),ar=tr.data,Mn=ve(),ei=ds.call(ar,Mn),Rn=ar[Mn];return ar[Mn]=at,ot=je(),ei?ar[Mn]=Rn:delete ar[Mn],ot}},T.continueStatementHandler=function(R){return function(){return R.label?new ms(R.label.name):me}},T.breakStatementHandler=function(R){return function(){return R.label?new Po(R.label.name):Q}},T.switchStatementHandler=function(R){var X=this,ve=this.createClosure(R.discriminant),je=R.cases.map(function(at){return X.switchCaseHandler(at)});return function(){for(var at=ve(),ot=!1,tr,ar,Mn,ei=0;ei<je.length;ei++){var Rn=je[ei](),Vi=Rn.testClosure();if(Vi===He){Mn=Rn;continue}if(ot||Vi===at){if(ot=!0,ar=X.setValue(Rn.bodyClosure()),ar===wt)continue;if(ar===Q||(tr=ar,tr instanceof uo||tr instanceof Po||tr instanceof ms||tr===me))break}}if(!ot&&Mn){ar=X.setValue(Mn.bodyClosure());var sa=ar===wt||ar===Q||ar===me;sa||(tr=ar)}return tr}},T.switchCaseHandler=function(R){var X=R.test?this.createClosure(R.test):function(){return He},ve=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:X,bodyClosure:ve}}},T.labeledStatementHandler=function(R){var X=this,ve=R.label.name,je=this.createClosure(R.body);return function(){var at,ot=X.getCurrentScope();return ot.labelStack.push(ve),at=je(R),at instanceof Po&&at.value===ve&&(at=wt),ot.labelStack.pop(),at}},T.debuggerStatementHandler=function(R){return function(){debugger;return wt}},T.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ta.ParamTypeSyntaxError,R.type,R)},T.createObjectKeyGetter=function(R){var X;return R.type==="Identifier"?X=function(){return R.name}:X=this.createClosure(R),function(){return X()}},T.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},T.createObjectGetter=function(R){var X=this;switch(R.type){case"Identifier":return function(){return X.getScopeDataFromName(R.name,X.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ta.AssignmentTypeSyntaxError,R.type,R)}},T.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ta.AssignmentTypeSyntaxError,R.type,R)}},T.varDeclaration=function(R){var X=this.collectDeclVars;X[R]=void 0},T.funcDeclaration=function(R,X){var ve=this.collectDeclFuncs;ve[R]=X},T.addDeclarationsToScope=function(R,X,ve){var je=ve.data;for(var at in X){var ot=X[at];je[at]=ot&&ot()}for(var tr in R)tr in je||(je[tr]=void 0)},T.getScopeValue=function(R,X){var ve=this.getScopeFromName(R,X);return ve.data[R]},T.getScopeDataFromName=function(R,X){return this.getScopeFromName(R,X).data},T.getScopeFromName=function(R,X){var ve=X;do if(R in ve.data)return ve;while(ve=ve.parent);return this.globalScope},T.setValue=function(R){var X=this.callStack.length;return this.isVarDeclMode||X||R===wt||R===Q||R===me||R instanceof Po||R instanceof ms||(this.value=R instanceof uo?R.value:R),R},T.getValue=function(){return this.value},_}();va.version=Ss,va.eval=Wo,va.Function=vs,va.ecmaVersion=5,va.globalContextInFunction=void 0,va.global=Object.create(null);function is(_){return _===void 0&&(_=Object.create(null)),_}function sf(_,T,N){T===void 0&&(T=[]),N===void 0&&(N={});var R=N.parsingContext,X=N.timeout===void 0?0:N.timeout,ve=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,je=new va(R,{ecmaVersion:N.ecmaVersion,timeout:X,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return je.evaluate(ve)}function El(_,T,N){var R=new va(T,N);return R.evaluate(_)}var Ns=El,Ql=function(){function _(N){this._code=N}var T=_.prototype;return T.runInContext=function(R){return El(this._code,R)},T.runInNewContext=function(R){return El(this._code,R)},_}(),Zu=function(_,T,N){return El(_,T,N)};function zs(){for(var _=arguments.length,T=new Array(_),N=0;N<_;N++)T[N]=arguments[N];var R=T.pop();return sf(R||"",T)}var tl=Zu},20396:function(Ar,ne,J){var Ie;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ge,v,Oe,H){"use strict";var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",he=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Fe=ce||he,ye=["","webkit","Moz","MS","ms","o"],Je=Fe?"":v.createElement("div"),ft="function",xt=Math.round,Jt=Math.abs,ur=Date.now;function It(Q,me,He){return setTimeout(st(Q,He),me)}function er(Q,me,He){return Array.isArray(Q)?(jt(Q,He[me],He),!0):!1}function jt(Q,me,He){var wt;if(!!Q)if(Q.forEach)Q.forEach(me,He);else if(Q.length!==H)for(wt=0;wt<Q.length;)me.call(He,Q[wt],wt,Q),wt++;else for(wt in Q)Q.hasOwnProperty(wt)&&me.call(He,Q[wt],wt,Q)}function ct(Q,me,He){var wt="DEPRECATED METHOD: "+me+`
`+He+` AT 
`;return function(){var Tr=new Error("get-stack-trace"),In=Tr&&Tr.stack?Tr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wi=ge.console&&(ge.console.warn||ge.console.log);return wi&&wi.call(ge.console,wt,In),Q.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(me){if(me===H||me===null)throw new TypeError("Cannot convert undefined or null to object");for(var He=Object(me),wt=1;wt<arguments.length;wt++){var Tr=arguments[wt];if(Tr!==H&&Tr!==null)for(var In in Tr)Tr.hasOwnProperty(In)&&(He[In]=Tr[In])}return He}:pt=Object.assign;var ir=ct(function(me,He,wt){for(var Tr=Object.keys(He),In=0;In<Tr.length;)(!wt||wt&&me[Tr[In]]===H)&&(me[Tr[In]]=He[Tr[In]]),In++;return me},"extend","Use `assign`."),Y=ct(function(me,He){return ir(me,He,!0)},"merge","Use `assign`.");function Xt(Q,me,He){var wt=me.prototype,Tr;Tr=Q.prototype=Object.create(wt),Tr.constructor=Q,Tr._super=wt,He&&pt(Tr,He)}function st(Q,me){return function(){return Q.apply(me,arguments)}}function Ye(Q,me){return typeof Q==ft?Q.apply(me&&me[0]||H,me):Q}function bt(Q,me){return Q===H?me:Q}function $e(Q,me,He){jt(nn(me),function(wt){Q.addEventListener(wt,He,!1)})}function Yt(Q,me,He){jt(nn(me),function(wt){Q.removeEventListener(wt,He,!1)})}function Er(Q,me){for(;Q;){if(Q==me)return!0;Q=Q.parentNode}return!1}function Hr(Q,me){return Q.indexOf(me)>-1}function nn(Q){return Q.trim().split(/\s+/g)}function C(Q,me,He){if(Q.indexOf&&!He)return Q.indexOf(me);for(var wt=0;wt<Q.length;){if(He&&Q[wt][He]==me||!He&&Q[wt]===me)return wt;wt++}return-1}function Se(Q){return Array.prototype.slice.call(Q,0)}function ke(Q,me,He){for(var wt=[],Tr=[],In=0;In<Q.length;){var wi=me?Q[In][me]:Q[In];C(Tr,wi)<0&&wt.push(Q[In]),Tr[In]=wi,In++}return He&&(me?wt=wt.sort(function(Ra,Ba){return Ra[me]>Ba[me]}):wt=wt.sort()),wt}function _t(Q,me){for(var He,wt,Tr=me[0].toUpperCase()+me.slice(1),In=0;In<ye.length;){if(He=ye[In],wt=He?He+Tr:me,wt in Q)return wt;In++}return H}var ht=1;function Lt(){return ht++}function Ht(Q){var me=Q.ownerDocument||Q;return me.defaultView||me.parentWindow||ge}var xr=/mobile|tablet|ip(ad|hone|od)|android/i,Kn="ontouchstart"in ge,mn=_t(ge,"PointerEvent")!==H,di=Kn&&xr.test(navigator.userAgent),Gn="touch",ni="pen",vi="mouse",Hn="kinect",mi=25,ca=1,Gi=2,Li=4,$i=8,fa=1,ko=2,Oa=4,ya=8,Fi=16,ra=ko|Oa,Qi=ya|Fi,Es=ra|Qi,le=["x","y"],ii=["clientX","clientY"];function yo(Q,me){var He=this;this.manager=Q,this.callback=me,this.element=Q.element,this.target=Q.options.inputTarget,this.domHandler=function(wt){Ye(Q.options.enable,[Q])&&He.handler(wt)},this.init()}yo.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Ht(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Yt(this.element,this.evEl,this.domHandler),this.evTarget&&Yt(this.target,this.evTarget,this.domHandler),this.evWin&&Yt(Ht(this.element),this.evWin,this.domHandler)}};function Qs(Q){var me,He=Q.options.inputClass;return He?me=He:mn?me=Me:di?me=Rt:Kn?me=Et:me=_a,new me(Q,Bt)}function Bt(Q,me,He){var wt=He.pointers.length,Tr=He.changedPointers.length,In=me&ca&&wt-Tr==0,wi=me&(Li|$i)&&wt-Tr==0;He.isFirst=!!In,He.isFinal=!!wi,In&&(Q.session={}),He.eventType=me,$t(Q,He),Q.emit("hammer.input",He),Q.recognize(He),Q.session.prevInput=He}function $t(Q,me){var He=Q.session,wt=me.pointers,Tr=wt.length;He.firstInput||(He.firstInput=An(me)),Tr>1&&!He.firstMultiple?He.firstMultiple=An(me):Tr===1&&(He.firstMultiple=!1);var In=He.firstInput,wi=He.firstMultiple,to=wi?wi.center:In.center,Ra=me.center=Nn(wt);me.timeStamp=ur(),me.deltaTime=me.timeStamp-In.timeStamp,me.angle=Mi(to,Ra),me.distance=En(to,Ra),Pr(He,me),me.offsetDirection=fi(me.deltaX,me.deltaY);var Ba=_i(me.deltaTime,me.deltaX,me.deltaY);me.overallVelocityX=Ba.x,me.overallVelocityY=Ba.y,me.overallVelocity=Jt(Ba.x)>Jt(Ba.y)?Ba.x:Ba.y,me.scale=wi?eo(wi.pointers,wt):1,me.rotation=wi?Ti(wi.pointers,wt):0,me.maxPointers=He.prevInput?me.pointers.length>He.prevInput.maxPointers?me.pointers.length:He.prevInput.maxPointers:me.pointers.length,ln(He,me);var Wo=Q.element;Er(me.srcEvent.target,Wo)&&(Wo=me.srcEvent.target),me.target=Wo}function Pr(Q,me){var He=me.center,wt=Q.offsetDelta||{},Tr=Q.prevDelta||{},In=Q.prevInput||{};(me.eventType===ca||In.eventType===Li)&&(Tr=Q.prevDelta={x:In.deltaX||0,y:In.deltaY||0},wt=Q.offsetDelta={x:He.x,y:He.y}),me.deltaX=Tr.x+(He.x-wt.x),me.deltaY=Tr.y+(He.y-wt.y)}function ln(Q,me){var He=Q.lastInterval||me,wt=me.timeStamp-He.timeStamp,Tr,In,wi,to;if(me.eventType!=$i&&(wt>mi||He.velocity===H)){var Ra=me.deltaX-He.deltaX,Ba=me.deltaY-He.deltaY,Wo=_i(wt,Ra,Ba);In=Wo.x,wi=Wo.y,Tr=Jt(Wo.x)>Jt(Wo.y)?Wo.x:Wo.y,to=fi(Ra,Ba),Q.lastInterval=me}else Tr=He.velocity,In=He.velocityX,wi=He.velocityY,to=He.direction;me.velocity=Tr,me.velocityX=In,me.velocityY=wi,me.direction=to}function An(Q){for(var me=[],He=0;He<Q.pointers.length;)me[He]={clientX:xt(Q.pointers[He].clientX),clientY:xt(Q.pointers[He].clientY)},He++;return{timeStamp:ur(),pointers:me,center:Nn(me),deltaX:Q.deltaX,deltaY:Q.deltaY}}function Nn(Q){var me=Q.length;if(me===1)return{x:xt(Q[0].clientX),y:xt(Q[0].clientY)};for(var He=0,wt=0,Tr=0;Tr<me;)He+=Q[Tr].clientX,wt+=Q[Tr].clientY,Tr++;return{x:xt(He/me),y:xt(wt/me)}}function _i(Q,me,He){return{x:me/Q||0,y:He/Q||0}}function fi(Q,me){return Q===me?fa:Jt(Q)>=Jt(me)?Q<0?ko:Oa:me<0?ya:Fi}function En(Q,me,He){He||(He=le);var wt=me[He[0]]-Q[He[0]],Tr=me[He[1]]-Q[He[1]];return Math.sqrt(wt*wt+Tr*Tr)}function Mi(Q,me,He){He||(He=le);var wt=me[He[0]]-Q[He[0]],Tr=me[He[1]]-Q[He[1]];return Math.atan2(Tr,wt)*180/Math.PI}function Ti(Q,me){return Mi(me[1],me[0],ii)+Mi(Q[1],Q[0],ii)}function eo(Q,me){return En(me[0],me[1],ii)/En(Q[0],Q[1],ii)}var ps={mousedown:ca,mousemove:Gi,mouseup:Li},Go="mousedown",Da="mousemove mouseup";function _a(){this.evEl=Go,this.evWin=Da,this.pressed=!1,yo.apply(this,arguments)}Xt(_a,yo,{handler:function(me){var He=ps[me.type];He&ca&&me.button===0&&(this.pressed=!0),He&Gi&&me.which!==1&&(He=Li),!!this.pressed&&(He&Li&&(this.pressed=!1),this.callback(this.manager,He,{pointers:[me],changedPointers:[me],pointerType:vi,srcEvent:me}))}});var V={pointerdown:ca,pointermove:Gi,pointerup:Li,pointercancel:$i,pointerout:$i},q={2:Gn,3:ni,4:vi,5:Hn},ee="pointerdown",fe="pointermove pointerup pointercancel";!Fe&&ge.MSPointerEvent&&!ge.PointerEvent&&(ee="MSPointerDown",fe="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=ee,this.evWin=fe,yo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Me,yo,{handler:function(me){var He=this.store,wt=!1,Tr=me.type.toLowerCase().replace("ms",""),In=V[Tr],wi=q[me.pointerType]||me.pointerType,to=wi==Gn,Ra=C(He,me.pointerId,"pointerId");In&ca&&(me.button===0||to)?Ra<0&&(He.push(me),Ra=He.length-1):In&(Li|$i)&&(wt=!0),!(Ra<0)&&(He[Ra]=me,this.callback(this.manager,In,{pointers:He,changedPointers:[me],pointerType:wi,srcEvent:me}),wt&&He.splice(Ra,1))}});var Ue={touchstart:ca,touchmove:Gi,touchend:Li,touchcancel:$i},Ke="touchstart",oe="touchstart touchmove touchend touchcancel";function Re(){this.evTarget=Ke,this.evWin=oe,this.started=!1,yo.apply(this,arguments)}Xt(Re,yo,{handler:function(me){var He=Ue[me.type];if(He===ca&&(this.started=!0),!!this.started){var wt=ut.call(this,me,He);He&(Li|$i)&&wt[0].length-wt[1].length==0&&(this.started=!1),this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:Gn,srcEvent:me})}}});function ut(Q,me){var He=Se(Q.touches),wt=Se(Q.changedTouches);return me&(Li|$i)&&(He=ke(He.concat(wt),"identifier",!0)),[He,wt]}var cr={touchstart:ca,touchmove:Gi,touchend:Li,touchcancel:$i},Tt="touchstart touchmove touchend touchcancel";function Rt(){this.evTarget=Tt,this.targetIds={},yo.apply(this,arguments)}Xt(Rt,yo,{handler:function(me){var He=cr[me.type],wt=hr.call(this,me,He);!wt||this.callback(this.manager,He,{pointers:wt[0],changedPointers:wt[1],pointerType:Gn,srcEvent:me})}});function hr(Q,me){var He=Se(Q.touches),wt=this.targetIds;if(me&(ca|Gi)&&He.length===1)return wt[He[0].identifier]=!0,[He,He];var Tr,In,wi=Se(Q.changedTouches),to=[],Ra=this.target;if(In=He.filter(function(Ba){return Er(Ba.target,Ra)}),me===ca)for(Tr=0;Tr<In.length;)wt[In[Tr].identifier]=!0,Tr++;for(Tr=0;Tr<wi.length;)wt[wi[Tr].identifier]&&to.push(wi[Tr]),me&(Li|$i)&&delete wt[wi[Tr].identifier],Tr++;if(!!to.length)return[ke(In.concat(to),"identifier",!0),to]}var gn=2500,cn=25;function Et(){yo.apply(this,arguments);var Q=st(this.handler,this);this.touch=new Rt(this.manager,Q),this.mouse=new _a(this.manager,Q),this.primaryTouch=null,this.lastTouches=[]}Xt(Et,yo,{handler:function(me,He,wt){var Tr=wt.pointerType==Gn,In=wt.pointerType==vi;if(!(In&&wt.sourceCapabilities&&wt.sourceCapabilities.firesTouchEvents)){if(Tr)Qr.call(this,He,wt);else if(In&&Wr.call(this,wt))return;this.callback(me,He,wt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Qr(Q,me){Q&ca?(this.primaryTouch=me.changedPointers[0].identifier,Lr.call(this,me)):Q&(Li|$i)&&Lr.call(this,me)}function Lr(Q){var me=Q.changedPointers[0];if(me.identifier===this.primaryTouch){var He={x:me.clientX,y:me.clientY};this.lastTouches.push(He);var wt=this.lastTouches,Tr=function(){var In=wt.indexOf(He);In>-1&&wt.splice(In,1)};setTimeout(Tr,gn)}}function Wr(Q){for(var me=Q.srcEvent.clientX,He=Q.srcEvent.clientY,wt=0;wt<this.lastTouches.length;wt++){var Tr=this.lastTouches[wt],In=Math.abs(me-Tr.x),wi=Math.abs(He-Tr.y);if(In<=cn&&wi<=cn)return!0}return!1}var hi=Fe?H:_t(Je.style,"touchAction"),Jr=hi!==H,Tn="compute",Zi="auto",si="manipulation",Si="none",gi="pan-x",vt="pan-y",kt=Ci();function Ca(Q,me){this.manager=Q,this.set(me)}Ca.prototype={set:function(Q){Q==Tn&&(Q=this.compute()),Jr&&this.manager.element.style&&kt[Q]&&(this.manager.element.style[hi]=Q),this.actions=Q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Q=[];return jt(this.manager.recognizers,function(me){Ye(me.options.enable,[me])&&(Q=Q.concat(me.getTouchAction()))}),bi(Q.join(" "))},preventDefaults:function(Q){var me=Q.srcEvent,He=Q.offsetDirection;if(this.manager.session.prevented){me.preventDefault();return}var wt=this.actions,Tr=Hr(wt,Si)&&!kt[Si],In=Hr(wt,vt)&&!kt[vt],wi=Hr(wt,gi)&&!kt[gi];if(Tr){var to=Q.pointers.length===1,Ra=Q.distance<2,Ba=Q.deltaTime<250;if(to&&Ra&&Ba)return}if(!(wi&&In)&&(Tr||In&&He&ra||wi&&He&Qi))return this.preventSrc(me)},preventSrc:function(Q){this.manager.session.prevented=!0,Q.preventDefault()}};function bi(Q){if(Hr(Q,Si))return Si;var me=Hr(Q,gi),He=Hr(Q,vt);return me&&He?Si:me||He?me?gi:vt:Hr(Q,si)?si:Zi}function Ci(){if(!Jr)return!1;var Q={};if(Fe)return Q;var me=ge.CSS&&ge.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(He){Q[He]=me?ge.CSS.supports("touch-action",He):!0}),Q}var Di=1,Fr=2,xn=4,Ct=8,Ji=Ct,de=16,Ko=32;function Wi(Q){this.options=pt({},this.defaults,Q||{}),this.id=Lt(),this.manager=null,this.options.enable=bt(this.options.enable,!0),this.state=Di,this.simultaneous={},this.requireFail=[]}Wi.prototype={defaults:{},set:function(Q){return pt(this.options,Q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Q){if(er(Q,"recognizeWith",this))return this;var me=this.simultaneous;return Q=wa(Q,this),me[Q.id]||(me[Q.id]=Q,Q.recognizeWith(this)),this},dropRecognizeWith:function(Q){return er(Q,"dropRecognizeWith",this)?this:(Q=wa(Q,this),delete this.simultaneous[Q.id],this)},requireFailure:function(Q){if(er(Q,"requireFailure",this))return this;var me=this.requireFail;return Q=wa(Q,this),C(me,Q)===-1&&(me.push(Q),Q.requireFailure(this)),this},dropRequireFailure:function(Q){if(er(Q,"dropRequireFailure",this))return this;Q=wa(Q,this);var me=C(this.requireFail,Q);return me>-1&&this.requireFail.splice(me,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Q){return!!this.simultaneous[Q.id]},emit:function(Q){var me=this,He=this.state;function wt(Tr){me.manager.emit(Tr,Q)}He<Ct&&wt(me.options.event+hu(He)),wt(me.options.event),Q.additionalEvent&&wt(Q.additionalEvent),He>=Ct&&wt(me.options.event+hu(He))},tryEmit:function(Q){if(this.canEmit())return this.emit(Q);this.state=Ko},canEmit:function(){for(var Q=0;Q<this.requireFail.length;){if(!(this.requireFail[Q].state&(Ko|Di)))return!1;Q++}return!0},recognize:function(Q){var me=pt({},Q);if(!Ye(this.options.enable,[this,me])){this.reset(),this.state=Ko;return}this.state&(Ji|de|Ko)&&(this.state=Di),this.state=this.process(me),this.state&(Fr|xn|Ct|de)&&this.tryEmit(me)},process:function(Q){},getTouchAction:function(){},reset:function(){}};function hu(Q){return Q&de?"cancel":Q&Ct?"end":Q&xn?"move":Q&Fr?"start":""}function Fa(Q){return Q==Fi?"down":Q==ya?"up":Q==ko?"left":Q==Oa?"right":""}function wa(Q,me){var He=me.manager;return He?He.get(Q):Q}function Ga(){Wi.apply(this,arguments)}Xt(Ga,Wi,{defaults:{pointers:1},attrTest:function(Q){var me=this.options.pointers;return me===0||Q.pointers.length===me},process:function(Q){var me=this.state,He=Q.eventType,wt=me&(Fr|xn),Tr=this.attrTest(Q);return wt&&(He&$i||!Tr)?me|de:wt||Tr?He&Li?me|Ct:me&Fr?me|xn:Fr:Ko}});function ea(){Ga.apply(this,arguments),this.pX=null,this.pY=null}Xt(ea,Ga,{defaults:{event:"pan",threshold:10,pointers:1,direction:Es},getTouchAction:function(){var Q=this.options.direction,me=[];return Q&ra&&me.push(vt),Q&Qi&&me.push(gi),me},directionTest:function(Q){var me=this.options,He=!0,wt=Q.distance,Tr=Q.direction,In=Q.deltaX,wi=Q.deltaY;return Tr&me.direction||(me.direction&ra?(Tr=In===0?fa:In<0?ko:Oa,He=In!=this.pX,wt=Math.abs(Q.deltaX)):(Tr=wi===0?fa:wi<0?ya:Fi,He=wi!=this.pY,wt=Math.abs(Q.deltaY))),Q.direction=Tr,He&&wt>me.threshold&&Tr&me.direction},attrTest:function(Q){return Ga.prototype.attrTest.call(this,Q)&&(this.state&Fr||!(this.state&Fr)&&this.directionTest(Q))},emit:function(Q){this.pX=Q.deltaX,this.pY=Q.deltaY;var me=Fa(Q.direction);me&&(Q.additionalEvent=this.options.event+me),this._super.emit.call(this,Q)}});function Mo(){Ga.apply(this,arguments)}Xt(Mo,Ga,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Si]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.scale-1)>this.options.threshold||this.state&Fr)},emit:function(Q){if(Q.scale!==1){var me=Q.scale<1?"in":"out";Q.additionalEvent=this.options.event+me}this._super.emit.call(this,Q)}});function Ho(){Wi.apply(this,arguments),this._timer=null,this._input=null}Xt(Ho,Wi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zi]},process:function(Q){var me=this.options,He=Q.pointers.length===me.pointers,wt=Q.distance<me.threshold,Tr=Q.deltaTime>me.time;if(this._input=Q,!wt||!He||Q.eventType&(Li|$i)&&!Tr)this.reset();else if(Q.eventType&ca)this.reset(),this._timer=It(function(){this.state=Ji,this.tryEmit()},me.time,this);else if(Q.eventType&Li)return Ji;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(Q){this.state===Ji&&(Q&&Q.eventType&Li?this.manager.emit(this.options.event+"up",Q):(this._input.timeStamp=ur(),this.manager.emit(this.options.event,this._input)))}});function bu(){Ga.apply(this,arguments)}Xt(bu,Ga,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Si]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.rotation)>this.options.threshold||this.state&Fr)}});function ho(){Ga.apply(this,arguments)}Xt(ho,Ga,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ra|Qi,pointers:1},getTouchAction:function(){return ea.prototype.getTouchAction.call(this)},attrTest:function(Q){var me=this.options.direction,He;return me&(ra|Qi)?He=Q.overallVelocity:me&ra?He=Q.overallVelocityX:me&Qi&&(He=Q.overallVelocityY),this._super.attrTest.call(this,Q)&&me&Q.offsetDirection&&Q.distance>this.options.threshold&&Q.maxPointers==this.options.pointers&&Jt(He)>this.options.velocity&&Q.eventType&Li},emit:function(Q){var me=Fa(Q.offsetDirection);me&&this.manager.emit(this.options.event+me,Q),this.manager.emit(this.options.event,Q)}});function Lo(){Wi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Lo,Wi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[si]},process:function(Q){var me=this.options,He=Q.pointers.length===me.pointers,wt=Q.distance<me.threshold,Tr=Q.deltaTime<me.time;if(this.reset(),Q.eventType&ca&&this.count===0)return this.failTimeout();if(wt&&Tr&&He){if(Q.eventType!=Li)return this.failTimeout();var In=this.pTime?Q.timeStamp-this.pTime<me.interval:!0,wi=!this.pCenter||En(this.pCenter,Q.center)<me.posThreshold;this.pTime=Q.timeStamp,this.pCenter=Q.center,!wi||!In?this.count=1:this.count+=1,this._input=Q;var to=this.count%me.taps;if(to===0)return this.hasRequireFailures()?(this._timer=It(function(){this.state=Ji,this.tryEmit()},me.interval,this),Fr):Ji}return Ko},failTimeout:function(){return this._timer=It(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ji&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ta(Q,me){return me=me||{},me.recognizers=bt(me.recognizers,ta.defaults.preset),new Wa(Q,me)}ta.VERSION="2.0.7",ta.defaults={domEvents:!1,touchAction:Tn,enable:!0,inputTarget:null,inputClass:null,preset:[[bu,{enable:!1}],[Mo,{enable:!1},["rotate"]],[ho,{direction:ra}],[ea,{direction:ra},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ha=1,Do=2;function Wa(Q,me){this.options=pt({},ta.defaults,me||{}),this.options.inputTarget=this.options.inputTarget||Q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Q,this.input=Qs(this),this.touchAction=new Ca(this,this.options.touchAction),Ss(this,!0),jt(this.options.recognizers,function(He){var wt=this.add(new He[0](He[1]));He[2]&&wt.recognizeWith(He[2]),He[3]&&wt.requireFailure(He[3])},this)}Wa.prototype={set:function(Q){return pt(this.options,Q),Q.touchAction&&this.touchAction.update(),Q.inputTarget&&(this.input.destroy(),this.input.target=Q.inputTarget,this.input.init()),this},stop:function(Q){this.session.stopped=Q?Do:Ha},recognize:function(Q){var me=this.session;if(!me.stopped){this.touchAction.preventDefaults(Q);var He,wt=this.recognizers,Tr=me.curRecognizer;(!Tr||Tr&&Tr.state&Ji)&&(Tr=me.curRecognizer=null);for(var In=0;In<wt.length;)He=wt[In],me.stopped!==Do&&(!Tr||He==Tr||He.canRecognizeWith(Tr))?He.recognize(Q):He.reset(),!Tr&&He.state&(Fr|xn|Ct)&&(Tr=me.curRecognizer=He),In++}},get:function(Q){if(Q instanceof Wi)return Q;for(var me=this.recognizers,He=0;He<me.length;He++)if(me[He].options.event==Q)return me[He];return null},add:function(Q){if(er(Q,"add",this))return this;var me=this.get(Q.options.event);return me&&this.remove(me),this.recognizers.push(Q),Q.manager=this,this.touchAction.update(),Q},remove:function(Q){if(er(Q,"remove",this))return this;if(Q=this.get(Q),Q){var me=this.recognizers,He=C(me,Q);He!==-1&&(me.splice(He,1),this.touchAction.update())}return this},on:function(Q,me){if(Q!==H&&me!==H){var He=this.handlers;return jt(nn(Q),function(wt){He[wt]=He[wt]||[],He[wt].push(me)}),this}},off:function(Q,me){if(Q!==H){var He=this.handlers;return jt(nn(Q),function(wt){me?He[wt]&&He[wt].splice(C(He[wt],me),1):delete He[wt]}),this}},emit:function(Q,me){this.options.domEvents&&bl(Q,me);var He=this.handlers[Q]&&this.handlers[Q].slice();if(!(!He||!He.length)){me.type=Q,me.preventDefault=function(){me.srcEvent.preventDefault()};for(var wt=0;wt<He.length;)He[wt](me),wt++}},destroy:function(){this.element&&Ss(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ss(Q,me){var He=Q.element;if(!!He.style){var wt;jt(Q.options.cssProps,function(Tr,In){wt=_t(He.style,In),me?(Q.oldCssProps[wt]=He.style[wt],He.style[wt]=Tr):He.style[wt]=Q.oldCssProps[wt]||""}),me||(Q.oldCssProps={})}}function bl(Q,me){if(!Fe){var He=v.createEvent("Event");He.initEvent(Q,!0,!0),He.gesture=me,me.target.dispatchEvent(He)}}if(!Fe){pt(ta,{INPUT_START:ca,INPUT_MOVE:Gi,INPUT_END:Li,INPUT_CANCEL:$i,STATE_POSSIBLE:Di,STATE_BEGAN:Fr,STATE_CHANGED:xn,STATE_ENDED:Ct,STATE_RECOGNIZED:Ji,STATE_CANCELLED:de,STATE_FAILED:Ko,DIRECTION_NONE:fa,DIRECTION_LEFT:ko,DIRECTION_RIGHT:Oa,DIRECTION_UP:ya,DIRECTION_DOWN:Fi,DIRECTION_HORIZONTAL:ra,DIRECTION_VERTICAL:Qi,DIRECTION_ALL:Es,Manager:Wa,Input:yo,TouchAction:Ca,TouchInput:Rt,MouseInput:_a,PointerEventInput:Me,TouchMouseInput:Et,SingleTouchInput:Re,Recognizer:Wi,AttrRecognizer:Ga,Tap:Lo,Pan:ea,Swipe:ho,Pinch:Mo,Rotate:bu,Press:Ho,on:$e,off:Yt,each:jt,merge:Y,extend:ir,assign:pt,inherit:Xt,bindFn:st,prefixed:_t});var ds=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ds.Hammer=ta,Ie=function(){return ta}.call(ne,J,ne,Ar),Ie!==H&&(Ar.exports=Ie)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ar,ne,J){(function(Ie,ge){Ar.exports=ge(J(18857))})(this,function(Ie){"use strict";var ge=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},v=function(z,ue){for(var De=Object.keys(ue),Mt=0;Mt<De.length;++Mt)z[De[Mt]]=ue[De[Mt]];return z},Oe=`
`;function H(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function ce(z){var ue=new Error("(regl) "+z);throw console.error(ue),ue}function he(z,ue){z||ce(ue)}function Fe(z){return z?": "+z:""}function ye(z,ue,De){z in ue||ce("unknown parameter ("+z+")"+Fe(De)+". possible values: "+Object.keys(ue).join())}function Je(z,ue){ge(z)||ce("invalid parameter type"+Fe(ue)+". must be a typed array")}function ft(z,ue){switch(ue){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function xt(z,ue,De){ft(z,ue)||ce("invalid parameter type"+Fe(De)+". expected "+ue+", got "+typeof z)}function Jt(z,ue){z>=0&&(z|0)===z||ce("invalid parameter type, ("+z+")"+Fe(ue)+". must be a nonnegative integer")}function ur(z,ue,De){ue.indexOf(z)<0&&ce("invalid value"+Fe(De)+". must be one of: "+ue)}var It=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function er(z){Object.keys(z).forEach(function(ue){It.indexOf(ue)<0&&ce('invalid regl constructor argument "'+ue+'". must be one of '+It)})}function jt(z,ue){for(z=z+"";z.length<ue;)z=" "+z;return z}function ct(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function pt(z,ue){this.number=z,this.line=ue,this.errors=[]}function ir(z,ue,De){this.file=z,this.line=ue,this.message=De}function Y(){var z=new Error,ue=(z.stack||z).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ue);if(De)return De[1];var Mt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ue);return Mt?Mt[1]:"unknown"}function Xt(){var z=new Error,ue=(z.stack||z).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ue);if(De)return De[1];var Mt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ue);return Mt?Mt[1]:"unknown"}function st(z,ue){var De=z.split(`
`),Mt=1,rr=0,At={unknown:new ct,0:new ct};At.unknown.name=At[0].name=ue||Y(),At.unknown.lines.push(new pt(0,""));for(var qt=0;qt<De.length;++qt){var sr=De[qt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(sr);if(dr)switch(dr[1]){case"line":var mr=/(\d+)(\s+\d+)?/.exec(dr[2]);mr&&(Mt=mr[1]|0,mr[2]&&(rr=mr[2]|0,rr in At||(At[rr]=new ct)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);Sr&&(At[rr].name=Sr[1]?H(Sr[2]):Sr[2]);break}At[rr].lines.push(new pt(Mt++,sr))}return Object.keys(At).forEach(function(Cr){var Ur=At[Cr];Ur.lines.forEach(function(vr){Ur.index[vr.number]=vr})}),At}function Ye(z){var ue=[];return z.split(`
`).forEach(function(De){if(!(De.length<5)){var Mt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);Mt?ue.push(new ir(Mt[1]|0,Mt[2]|0,Mt[3].trim())):De.length>0&&ue.push(new ir("unknown",0,De))}}),ue}function bt(z,ue){ue.forEach(function(De){var Mt=z[De.file];if(Mt){var rr=Mt.index[De.line];if(rr){rr.errors.push(De),Mt.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(De)})}function $e(z,ue,De,Mt,rr){if(!z.getShaderParameter(ue,z.COMPILE_STATUS)){var At=z.getShaderInfoLog(ue),qt=Mt===z.FRAGMENT_SHADER?"fragment":"vertex";ke(De,"string",qt+" shader source must be a string",rr);var sr=st(De,rr),dr=Ye(At);bt(sr,dr),Object.keys(sr).forEach(function(mr){var Sr=sr[mr];if(!Sr.hasErrors)return;var Cr=[""],Ur=[""];function vr(br,rt){Cr.push(br),Ur.push(rt||"")}vr("file number "+mr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(br){if(br.errors.length>0){vr(jt(br.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(br.line+Oe,"color:red; background-color:yellow; font-weight:bold");var rt=0;br.errors.forEach(function(Ut){var gr=Ut.message,Dr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(gr);if(Dr){var or=Dr[1];switch(gr=Dr[2],or){case"assign":or="=";break}rt=Math.max(br.line.indexOf(or,rt),0)}else rt=0;vr(jt("| ",6)),vr(jt("^^^",rt+3)+Oe,"font-weight:bold"),vr(jt("| ",6)),vr(gr+Oe,"font-weight:bold")}),vr(jt("| ",6)+Oe)}else vr(jt(br.number,4)+"|  "),vr(br.line+Oe,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ur[0]=Cr.join("%c"),console.log.apply(console,Ur)):console.log(Cr.join(""))}),he.raise("Error compiling "+qt+" shader, "+sr[0].name)}}function Yt(z,ue,De,Mt,rr){if(!z.getProgramParameter(ue,z.LINK_STATUS)){var At=z.getProgramInfoLog(ue),qt=st(De,rr),sr=st(Mt,rr),dr='Error linking program with vertex shader, "'+sr[0].name+'", and fragment shader "'+qt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+Oe+"%c"+At,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+Oe+At),he.raise(dr)}}function Er(z){z._commandRef=Y()}function Hr(z,ue,De,Mt){Er(z);function rr(dr){return dr?Mt.id(dr):0}z._fragId=rr(z.static.frag),z._vertId=rr(z.static.vert);function At(dr,mr){Object.keys(mr).forEach(function(Sr){dr[Mt.id(Sr)]=!0})}var qt=z._uniformSet={};At(qt,ue.static),At(qt,ue.dynamic);var sr=z._attributeSet={};At(sr,De.static),At(sr,De.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function nn(z,ue){var De=Xt();ce(z+" in command "+(ue||Y())+(De==="unknown"?"":" called from "+De))}function C(z,ue,De){z||nn(ue,De||Y())}function Se(z,ue,De,Mt){z in ue||nn("unknown parameter ("+z+")"+Fe(De)+". possible values: "+Object.keys(ue).join(),Mt||Y())}function ke(z,ue,De,Mt){ft(z,ue)||nn("invalid parameter type"+Fe(De)+". expected "+ue+", got "+typeof z,Mt||Y())}function _t(z){z()}function ht(z,ue,De){z.texture?ur(z.texture._texture.internalformat,ue,"unsupported texture format for attachment"):ur(z.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var Lt=33071,Ht=9728,xr=9984,Kn=9985,mn=9986,di=9987,Gn=5120,ni=5121,vi=5122,Hn=5123,mi=5124,ca=5125,Gi=5126,Li=32819,$i=32820,fa=33635,ko=34042,Oa=36193,ya={};ya[Gn]=ya[ni]=1,ya[vi]=ya[Hn]=ya[Oa]=ya[fa]=ya[Li]=ya[$i]=2,ya[mi]=ya[ca]=ya[Gi]=ya[ko]=4;function Fi(z,ue){return z===$i||z===Li||z===fa?2:z===ko?4:ya[z]*ue}function ra(z){return!(z&z-1)&&!!z}function Qi(z,ue,De){var Mt,rr=ue.width,At=ue.height,qt=ue.channels;he(rr>0&&rr<=De.maxTextureSize&&At>0&&At<=De.maxTextureSize,"invalid texture shape"),(z.wrapS!==Lt||z.wrapT!==Lt)&&he(ra(rr)&&ra(At),"incompatible wrap mode for texture, both width and height must be power of 2"),ue.mipmask===1?rr!==1&&At!==1&&he(z.minFilter!==xr&&z.minFilter!==mn&&z.minFilter!==Kn&&z.minFilter!==di,"min filter requires mipmap"):(he(ra(rr)&&ra(At),"texture must be a square power of 2 to support mipmapping"),he(ue.mipmask===(rr<<1)-1,"missing or incomplete mipmap data")),ue.type===Gi&&(De.extensions.indexOf("oes_texture_float_linear")<0&&he(z.minFilter===Ht&&z.magFilter===Ht,"filter not supported, must enable oes_texture_float_linear"),he(!z.genMipmaps,"mipmap generation not supported with float textures"));var sr=ue.images;for(Mt=0;Mt<16;++Mt)if(sr[Mt]){var dr=rr>>Mt,mr=At>>Mt;he(ue.mipmask&1<<Mt,"missing mipmap data");var Sr=sr[Mt];if(he(Sr.width===dr&&Sr.height===mr,"invalid shape for mip images"),he(Sr.format===ue.format&&Sr.internalformat===ue.internalformat&&Sr.type===ue.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Cr=Math.ceil(Fi(Sr.type,qt)*dr/Sr.unpackAlignment)*Sr.unpackAlignment;he(Sr.data.byteLength===Cr*mr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else z.genMipmaps||he((ue.mipmask&1<<Mt)==0,"extra mipmap data");ue.compressed&&he(!z.genMipmaps,"mipmap generation for compressed images not supported")}function Es(z,ue,De,Mt){var rr=z.width,At=z.height,qt=z.channels;he(rr>0&&rr<=Mt.maxTextureSize&&At>0&&At<=Mt.maxTextureSize,"invalid texture shape"),he(rr===At,"cube map must be square"),he(ue.wrapS===Lt&&ue.wrapT===Lt,"wrap mode not supported by cube map");for(var sr=0;sr<De.length;++sr){var dr=De[sr];he(dr.width===rr&&dr.height===At,"inconsistent cube map face shape"),ue.genMipmaps&&(he(!dr.compressed,"can not generate mipmap for compressed textures"),he(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var mr=dr.images,Sr=0;Sr<16;++Sr){var Cr=mr[Sr];if(Cr){var Ur=rr>>Sr,vr=At>>Sr;he(dr.mipmask&1<<Sr,"missing mipmap data"),he(Cr.width===Ur&&Cr.height===vr,"invalid shape for mip images"),he(Cr.format===z.format&&Cr.internalformat===z.internalformat&&Cr.type===z.type,"incompatible type for mip image"),Cr.compressed||(Cr.data?he(Cr.data.byteLength===Ur*vr*Math.max(Fi(Cr.type,qt),Cr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Cr.element||Cr.copy)}}}}var le=v(he,{optional:_t,raise:ce,commandRaise:nn,command:C,parameter:ye,commandParameter:Se,constructor:er,type:xt,commandType:ke,isTypedArray:Je,nni:Jt,oneOf:ur,shaderError:$e,linkError:Yt,callSite:Xt,saveCommandRef:Er,saveDrawInfo:Hr,framebufferFormat:ht,guessCommand:Y,texture2D:Qi,textureCube:Es}),ii=0,yo=0,Qs=5,Bt=6;function $t(z,ue){this.id=ii++,this.type=z,this.data=ue}function Pr(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ln(z){if(z.length===0)return[];var ue=z.charAt(0),De=z.charAt(z.length-1);if(z.length>1&&ue===De&&(ue==='"'||ue==="'"))return['"'+Pr(z.substr(1,z.length-2))+'"'];var Mt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(Mt)return ln(z.substr(0,Mt.index)).concat(ln(Mt[1])).concat(ln(z.substr(Mt.index+Mt[0].length)));var rr=z.split(".");if(rr.length===1)return['"'+Pr(z)+'"'];for(var At=[],qt=0;qt<rr.length;++qt)At=At.concat(ln(rr[qt]));return At}function An(z){return"["+ln(z).join("][")+"]"}function Nn(z,ue){return new $t(z,An(ue+""))}function _i(z){return typeof z=="function"&&!z._reglType||z instanceof $t}function fi(z,ue){if(typeof z=="function")return new $t(yo,z);if(typeof z=="number"||typeof z=="boolean")return new $t(Qs,z);if(Array.isArray(z))return new $t(Bt,z.map(function(De,Mt){return fi(De,ue+"["+Mt+"]")}));if(z instanceof $t)return z;le(!1,"invalid option type in uniform "+ue)}var En={DynamicVariable:$t,define:Nn,isDynamic:_i,unbox:fi,accessor:An},Mi={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},Ti=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",eo=Ti?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ps(){var z={"":0},ue=[""];return{id:function(De){var Mt=z[De];return Mt||(Mt=z[De]=ue.length,ue.push(De),Mt)},str:function(De){return ue[De]}}}function Go(z,ue,De){var Mt=document.createElement("canvas");v(Mt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),z.appendChild(Mt),z===document.body&&(Mt.style.position="absolute",v(z.style,{margin:0,padding:0}));function rr(){var sr=window.innerWidth,dr=window.innerHeight;if(z!==document.body){var mr=Mt.getBoundingClientRect();sr=mr.right-mr.left,dr=mr.bottom-mr.top}Mt.width=De*sr,Mt.height=De*dr}var At;z!==document.body&&typeof ResizeObserver=="function"?(At=new ResizeObserver(function(){setTimeout(rr)}),At.observe(z)):window.addEventListener("resize",rr,!1);function qt(){At?At.disconnect():window.removeEventListener("resize",rr),z.removeChild(Mt)}return rr(),{canvas:Mt,onDestroy:qt}}function Da(z,ue){function De(Mt){try{return z.getContext(Mt,ue)}catch(rr){return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function _a(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function V(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function q(z){return typeof z=="string"?z.split():(le(Array.isArray(z),"invalid extension array"),z)}function ee(z){return typeof z=="string"?(le(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function fe(z){var ue=z||{},De,Mt,rr,At,qt={},sr=[],dr=[],mr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Cr=function(br){br&&le.raise(br)},Ur=function(){};if(typeof ue=="string"?(le(typeof document!="undefined","selector queries only supported in DOM environments"),De=document.querySelector(ue),le(De,"invalid query string for element")):typeof ue=="object"?_a(ue)?De=ue:V(ue)?(At=ue,rr=At.canvas):(le.constructor(ue),"gl"in ue?At=ue.gl:"canvas"in ue?rr=ee(ue.canvas):"container"in ue&&(Mt=ee(ue.container)),"attributes"in ue&&(qt=ue.attributes,le.type(qt,"object","invalid context attributes")),"extensions"in ue&&(sr=q(ue.extensions)),"optionalExtensions"in ue&&(dr=q(ue.optionalExtensions)),"onDone"in ue&&(le.type(ue.onDone,"function","invalid or missing onDone callback"),Cr=ue.onDone),"profile"in ue&&(Sr=!!ue.profile),"pixelRatio"in ue&&(mr=+ue.pixelRatio,le(mr>0,"invalid pixel ratio"))):le.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?rr=De:Mt=De),!At){if(!rr){le(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=Go(Mt||document.body,Cr,mr);if(!vr)return null;rr=vr.canvas,Ur=vr.onDestroy}qt.premultipliedAlpha===void 0&&(qt.premultipliedAlpha=!0),At=Da(rr,qt)}return At?{gl:At,canvas:rr,container:Mt,extensions:sr,optionalExtensions:dr,pixelRatio:mr,profile:Sr,onDone:Cr,onDestroy:Ur}:(Ur(),Cr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Me(z,ue){var De={};function Mt(sr){le.type(sr,"string","extension name must be string");var dr=sr.toLowerCase(),mr;try{mr=De[dr]=rr(sr)}catch(Sr){}return!!mr}function rr(sr){return z.getExtension(sr)?z.getExtension(sr):z.getExtension(sr.toLowerCase())?z.getExtension(sr.toLowerCase()):null}for(var At=0;At<ue.extensions.length;++At){var qt=ue.extensions[At];if(!Mt(qt))return ue.onDestroy(),ue.onDone('"'+qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ue.optionalExtensions.forEach(Mt),{extensions:De,restore:function(){Object.keys(De).forEach(function(sr){if(De[sr]&&!Mt(sr))throw new Error("(regl): error restoring extension "+sr)})}}}function Ue(z,ue){for(var De=Array(z),Mt=0;Mt<z;++Mt)De[Mt]=ue(Mt);return De}var Ke=5120,oe=5121,Re=5122,ut=5123,cr=5124,Tt=5125,Rt=5126;function hr(z){for(var ue=16;ue<=1<<28;ue*=16)if(z<=ue)return ue;return 0}function gn(z){var ue,De;return ue=(z>65535)<<4,z>>>=ue,De=(z>255)<<3,z>>>=De,ue|=De,De=(z>15)<<2,z>>>=De,ue|=De,De=(z>3)<<1,z>>>=De,ue|=De,ue|z>>1}function cn(){var z=Ue(8,function(){return[]});function ue(At){var qt=hr(At),sr=z[gn(qt)>>2];return sr.length>0?sr.pop():new ArrayBuffer(qt)}function De(At){z[gn(At.byteLength)>>2].push(At)}function Mt(At,qt){var sr=null;switch(At){case Ke:sr=new Int8Array(ue(qt),0,qt);break;case oe:sr=new Uint8Array(ue(qt),0,qt);break;case Re:sr=new Int16Array(ue(2*qt),0,qt);break;case ut:sr=new Uint16Array(ue(2*qt),0,qt);break;case cr:sr=new Int32Array(ue(4*qt),0,qt);break;case Tt:sr=new Uint32Array(ue(4*qt),0,qt);break;case Rt:sr=new Float32Array(ue(4*qt),0,qt);break;default:return null}return sr.length!==qt?sr.subarray(0,qt):sr}function rr(At){De(At.buffer)}return{alloc:ue,free:De,allocType:Mt,freeType:rr}}var Et=cn();Et.zero=cn();var Qr=3408,Lr=3410,Wr=3411,hi=3412,Jr=3413,Tn=3414,Zi=3415,si=33901,Si=33902,gi=3379,vt=3386,kt=34921,Ca=36347,bi=36348,Ci=35661,Di=35660,Fr=34930,xn=36349,Ct=34076,Ji=34024,de=7936,Ko=7937,Wi=7938,hu=35724,Fa=34047,wa=36063,Ga=34852,ea=3553,Mo=34067,Ho=34069,bu=33984,ho=6408,Lo=5126,ta=5121,Ha=36160,Do=36053,Wa=36064,Ss=16384,bl=function(z,ue){var De=1;ue.ext_texture_filter_anisotropic&&(De=z.getParameter(Fa));var Mt=1,rr=1;ue.webgl_draw_buffers&&(Mt=z.getParameter(Ga),rr=z.getParameter(wa));var At=!!ue.oes_texture_float;if(At){var qt=z.createTexture();z.bindTexture(ea,qt),z.texImage2D(ea,0,ho,1,1,0,ho,Lo,null);var sr=z.createFramebuffer();if(z.bindFramebuffer(Ha,sr),z.framebufferTexture2D(Ha,Wa,ea,qt,0),z.bindTexture(ea,null),z.checkFramebufferStatus(Ha)!==Do)At=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(Ss);var dr=Et.allocType(Lo,4);z.readPixels(0,0,1,1,ho,Lo,dr),z.getError()?At=!1:(z.deleteFramebuffer(sr),z.deleteTexture(qt),At=dr[0]===1),Et.freeType(dr)}}var mr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!mr){var Cr=z.createTexture(),Ur=Et.allocType(ta,36);z.activeTexture(bu),z.bindTexture(Mo,Cr),z.texImage2D(Ho,0,ho,3,3,0,ho,ta,Ur),Et.freeType(Ur),z.bindTexture(Mo,null),z.deleteTexture(Cr),Sr=!z.getError()}return{colorBits:[z.getParameter(Lr),z.getParameter(Wr),z.getParameter(hi),z.getParameter(Jr)],depthBits:z.getParameter(Tn),stencilBits:z.getParameter(Zi),subpixelBits:z.getParameter(Qr),extensions:Object.keys(ue).filter(function(vr){return!!ue[vr]}),maxAnisotropic:De,maxDrawbuffers:Mt,maxColorAttachments:rr,pointSizeDims:z.getParameter(si),lineWidthDims:z.getParameter(Si),maxViewportDims:z.getParameter(vt),maxCombinedTextureUnits:z.getParameter(Ci),maxCubeMapSize:z.getParameter(Ct),maxRenderbufferSize:z.getParameter(Ji),maxTextureUnits:z.getParameter(Fr),maxTextureSize:z.getParameter(gi),maxAttributes:z.getParameter(kt),maxVertexUniforms:z.getParameter(Ca),maxVertexTextureUnits:z.getParameter(Di),maxVaryingVectors:z.getParameter(bi),maxFragmentUniforms:z.getParameter(xn),glsl:z.getParameter(hu),renderer:z.getParameter(Ko),vendor:z.getParameter(de),version:z.getParameter(Wi),readFloat:At,npotTextureCube:Sr}};function ds(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||ge(z.data))}var Q=function(z){return Object.keys(z).map(function(ue){return z[ue]})},me={shape:to,flatten:wi};function He(z,ue,De){for(var Mt=0;Mt<ue;++Mt)De[Mt]=z[Mt]}function wt(z,ue,De,Mt){for(var rr=0,At=0;At<ue;++At)for(var qt=z[At],sr=0;sr<De;++sr)Mt[rr++]=qt[sr]}function Tr(z,ue,De,Mt,rr,At){for(var qt=At,sr=0;sr<ue;++sr)for(var dr=z[sr],mr=0;mr<De;++mr)for(var Sr=dr[mr],Cr=0;Cr<Mt;++Cr)rr[qt++]=Sr[Cr]}function In(z,ue,De,Mt,rr){for(var At=1,qt=De+1;qt<ue.length;++qt)At*=ue[qt];var sr=ue[De];if(ue.length-De==4){var dr=ue[De+1],mr=ue[De+2],Sr=ue[De+3];for(qt=0;qt<sr;++qt)Tr(z[qt],dr,mr,Sr,Mt,rr),rr+=At}else for(qt=0;qt<sr;++qt)In(z[qt],ue,De+1,Mt,rr),rr+=At}function wi(z,ue,De,Mt){var rr=1;if(ue.length)for(var At=0;At<ue.length;++At)rr*=ue[At];else rr=0;var qt=Mt||Et.allocType(De,rr);switch(ue.length){case 0:break;case 1:He(z,ue[0],qt);break;case 2:wt(z,ue[0],ue[1],qt);break;case 3:Tr(z,ue[0],ue[1],ue[2],qt,0);break;default:In(z,ue,0,qt,0)}return qt}function to(z){for(var ue=[],De=z;De.length;De=De[0])ue.push(De.length);return ue}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ba=5120,Wo=5122,vs=5124,uo=5121,Po=5123,ms=5125,Cs=5126,Ps=5126,Js={int8:Ba,int16:Wo,int32:vs,uint8:uo,uint16:Po,uint32:ms,float:Cs,float32:Ps},gs=35048,ha=35040,va={dynamic:gs,stream:ha,static:35044},is=me.flatten,sf=me.shape,El=35044,Ns=35040,Ql=5121,Zu=5126,zs=[];zs[5120]=1,zs[5122]=2,zs[5124]=4,zs[5121]=1,zs[5123]=2,zs[5125]=4,zs[5126]=4;function tl(z){return Ra[Object.prototype.toString.call(z)]|0}function _(z,ue){for(var De=0;De<ue.length;++De)z[De]=ue[De]}function T(z,ue,De,Mt,rr,At,qt){for(var sr=0,dr=0;dr<De;++dr)for(var mr=0;mr<Mt;++mr)z[sr++]=ue[rr*dr+At*mr+qt]}function N(z,ue,De,Mt){var rr=0,At={};function qt(rt){this.id=rr++,this.buffer=z.createBuffer(),this.type=rt,this.usage=El,this.byteLength=0,this.dimension=1,this.dtype=Ql,this.persistentData=null,De.profile&&(this.stats={size:0})}qt.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},qt.prototype.destroy=function(){Ur(this)};var sr=[];function dr(rt,Ut){var gr=sr.pop();return gr||(gr=new qt(rt)),gr.bind(),Cr(gr,Ut,Ns,0,1,!1),gr}function mr(rt){sr.push(rt)}function Sr(rt,Ut,gr){rt.byteLength=Ut.byteLength,z.bufferData(rt.type,Ut,gr)}function Cr(rt,Ut,gr,Dr,or,Mr){var $r;if(rt.usage=gr,Array.isArray(Ut)){if(rt.dtype=Dr||Zu,Ut.length>0){var Bn;if(Array.isArray(Ut[0])){$r=sf(Ut);for(var Wt=1,Qt=1;Qt<$r.length;++Qt)Wt*=$r[Qt];rt.dimension=Wt,Bn=is(Ut,$r,rt.dtype),Sr(rt,Bn,gr),Mr?rt.persistentData=Bn:Et.freeType(Bn)}else if(typeof Ut[0]=="number"){rt.dimension=or;var yn=Et.allocType(rt.dtype,Ut.length);_(yn,Ut),Sr(rt,yn,gr),Mr?rt.persistentData=yn:Et.freeType(yn)}else ge(Ut[0])?(rt.dimension=Ut[0].length,rt.dtype=Dr||tl(Ut[0])||Zu,Bn=is(Ut,[Ut.length,Ut[0].length],rt.dtype),Sr(rt,Bn,gr),Mr?rt.persistentData=Bn:Et.freeType(Bn)):le.raise("invalid buffer data")}}else if(ge(Ut))rt.dtype=Dr||tl(Ut),rt.dimension=or,Sr(rt,Ut,gr),Mr&&(rt.persistentData=new Uint8Array(new Uint8Array(Ut.buffer)));else if(ds(Ut)){$r=Ut.shape;var jr=Ut.stride,yr=Ut.offset,Yr=0,qr=0,pi=0,ti=0;$r.length===1?(Yr=$r[0],qr=1,pi=jr[0],ti=0):$r.length===2?(Yr=$r[0],qr=$r[1],pi=jr[0],ti=jr[1]):le.raise("invalid shape"),rt.dtype=Dr||tl(Ut.data)||Zu,rt.dimension=qr;var Xr=Et.allocType(rt.dtype,Yr*qr);T(Xr,Ut.data,Yr,qr,pi,ti,yr),Sr(rt,Xr,gr),Mr?rt.persistentData=Xr:Et.freeType(Xr)}else Ut instanceof ArrayBuffer?(rt.dtype=Ql,rt.dimension=or,Sr(rt,Ut,gr),Mr&&(rt.persistentData=new Uint8Array(new Uint8Array(Ut)))):le.raise("invalid buffer data")}function Ur(rt){ue.bufferCount--,Mt(rt);var Ut=rt.buffer;le(Ut,"buffer must not be deleted already"),z.deleteBuffer(Ut),rt.buffer=null,delete At[rt.id]}function vr(rt,Ut,gr,Dr){ue.bufferCount++;var or=new qt(Ut);At[or.id]=or;function Mr(Wt){var Qt=El,yn=null,jr=0,yr=0,Yr=1;return Array.isArray(Wt)||ge(Wt)||ds(Wt)||Wt instanceof ArrayBuffer?yn=Wt:typeof Wt=="number"?jr=Wt|0:Wt&&(le.type(Wt,"object","buffer arguments must be an object, a number or an array"),"data"in Wt&&(le(yn===null||Array.isArray(yn)||ge(yn)||ds(yn),"invalid data for buffer"),yn=Wt.data),"usage"in Wt&&(le.parameter(Wt.usage,va,"invalid buffer usage"),Qt=va[Wt.usage]),"type"in Wt&&(le.parameter(Wt.type,Js,"invalid buffer type"),yr=Js[Wt.type]),"dimension"in Wt&&(le.type(Wt.dimension,"number","invalid dimension"),Yr=Wt.dimension|0),"length"in Wt&&(le.nni(jr,"buffer length must be a nonnegative integer"),jr=Wt.length|0)),or.bind(),yn?Cr(or,yn,Qt,yr,Yr,Dr):(jr&&z.bufferData(or.type,jr,Qt),or.dtype=yr||Ql,or.usage=Qt,or.dimension=Yr,or.byteLength=jr),De.profile&&(or.stats.size=or.byteLength*zs[or.dtype]),Mr}function $r(Wt,Qt){le(Qt+Wt.byteLength<=or.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Wt.byteLength+" starting from offset "+Qt+" to a buffer of size "+or.byteLength),z.bufferSubData(or.type,Qt,Wt)}function Bn(Wt,Qt){var yn=(Qt||0)|0,jr;if(or.bind(),ge(Wt)||Wt instanceof ArrayBuffer)$r(Wt,yn);else if(Array.isArray(Wt)){if(Wt.length>0)if(typeof Wt[0]=="number"){var yr=Et.allocType(or.dtype,Wt.length);_(yr,Wt),$r(yr,yn),Et.freeType(yr)}else if(Array.isArray(Wt[0])||ge(Wt[0])){jr=sf(Wt);var Yr=is(Wt,jr,or.dtype);$r(Yr,yn),Et.freeType(Yr)}else le.raise("invalid buffer data")}else if(ds(Wt)){jr=Wt.shape;var qr=Wt.stride,pi=0,ti=0,Xr=0,tn=0;jr.length===1?(pi=jr[0],ti=1,Xr=qr[0],tn=0):jr.length===2?(pi=jr[0],ti=jr[1],Xr=qr[0],tn=qr[1]):le.raise("invalid shape");var Xn=Array.isArray(Wt.data)?or.dtype:tl(Wt.data),oi=Et.allocType(Xn,pi*ti);T(oi,Wt.data,pi,ti,Xr,tn,Wt.offset),$r(oi,yn),Et.freeType(oi)}else le.raise("invalid data for buffer subdata");return Mr}return gr||Mr(rt),Mr._reglType="buffer",Mr._buffer=or,Mr.subdata=Bn,De.profile&&(Mr.stats=or.stats),Mr.destroy=function(){Ur(or)},Mr}function br(){Q(At).forEach(function(rt){rt.buffer=z.createBuffer(),z.bindBuffer(rt.type,rt.buffer),z.bufferData(rt.type,rt.persistentData||rt.byteLength,rt.usage)})}return De.profile&&(ue.getTotalBufferSize=function(){var rt=0;return Object.keys(At).forEach(function(Ut){rt+=At[Ut].stats.size}),rt}),{create:vr,createStream:dr,destroyStream:mr,clear:function(){Q(At).forEach(Ur),sr.forEach(Ur)},getBuffer:function(rt){return rt&&rt._buffer instanceof qt?rt._buffer:null},restore:br,_initBuffer:Cr}}var R=0,X=0,ve=1,je=1,at=4,ot=4,tr={points:R,point:X,lines:ve,line:je,triangles:at,triangle:ot,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ar=0,Mn=1,ei=4,Rn=5120,Vi=5121,sa=5122,ba=5123,Bi=5124,ys=5125,eu=34963,Vu=35040,uf=35044;function rl(z,ue,De,Mt){var rr={},At=0,qt={uint8:Vi,uint16:ba};ue.oes_element_index_uint&&(qt.uint32=ys);function sr(br){this.id=At++,rr[this.id]=this,this.buffer=br,this.primType=ei,this.vertCount=0,this.type=0}sr.prototype.bind=function(){this.buffer.bind()};var dr=[];function mr(br){var rt=dr.pop();return rt||(rt=new sr(De.create(null,eu,!0,!1)._buffer)),Cr(rt,br,Vu,-1,-1,0,0),rt}function Sr(br){dr.push(br)}function Cr(br,rt,Ut,gr,Dr,or,Mr){br.buffer.bind();var $r;if(rt){var Bn=Mr;!Mr&&(!ge(rt)||ds(rt)&&!ge(rt.data))&&(Bn=ue.oes_element_index_uint?ys:ba),De._initBuffer(br.buffer,rt,Ut,Bn,3)}else z.bufferData(eu,or,Ut),br.buffer.dtype=$r||Vi,br.buffer.usage=Ut,br.buffer.dimension=3,br.buffer.byteLength=or;if($r=Mr,!Mr){switch(br.buffer.dtype){case Vi:case Rn:$r=Vi;break;case ba:case sa:$r=ba;break;case ys:case Bi:$r=ys;break;default:le.raise("unsupported type for element array")}br.buffer.dtype=$r}br.type=$r,le($r!==ys||!!ue.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Wt=Dr;Wt<0&&(Wt=br.buffer.byteLength,$r===ba?Wt>>=1:$r===ys&&(Wt>>=2)),br.vertCount=Wt;var Qt=gr;if(gr<0){Qt=ei;var yn=br.buffer.dimension;yn===1&&(Qt=ar),yn===2&&(Qt=Mn),yn===3&&(Qt=ei)}br.primType=Qt}function Ur(br){Mt.elementsCount--,le(br.buffer!==null,"must not double destroy elements"),delete rr[br.id],br.buffer.destroy(),br.buffer=null}function vr(br,rt){var Ut=De.create(null,eu,!0),gr=new sr(Ut._buffer);Mt.elementsCount++;function Dr(or){if(!or)Ut(),gr.primType=ei,gr.vertCount=0,gr.type=Vi;else if(typeof or=="number")Ut(or),gr.primType=ei,gr.vertCount=or|0,gr.type=Vi;else{var Mr=null,$r=uf,Bn=-1,Wt=-1,Qt=0,yn=0;Array.isArray(or)||ge(or)||ds(or)?Mr=or:(le.type(or,"object","invalid arguments for elements"),"data"in or&&(Mr=or.data,le(Array.isArray(Mr)||ge(Mr)||ds(Mr),"invalid data for element buffer")),"usage"in or&&(le.parameter(or.usage,va,"invalid element buffer usage"),$r=va[or.usage]),"primitive"in or&&(le.parameter(or.primitive,tr,"invalid element buffer primitive"),Bn=tr[or.primitive]),"count"in or&&(le(typeof or.count=="number"&&or.count>=0,"invalid vertex count for elements"),Wt=or.count|0),"type"in or&&(le.parameter(or.type,qt,"invalid buffer type"),yn=qt[or.type]),"length"in or?Qt=or.length|0:(Qt=Wt,yn===ba||yn===sa?Qt*=2:(yn===ys||yn===Bi)&&(Qt*=4))),Cr(gr,Mr,$r,Bn,Wt,Qt,yn)}return Dr}return Dr(br),Dr._reglType="elements",Dr._elements=gr,Dr.subdata=function(or,Mr){return Ut.subdata(or,Mr),Dr},Dr.destroy=function(){Ur(gr)},Dr}return{create:vr,createStream:mr,destroyStream:Sr,getElements:function(br){return typeof br=="function"&&br._elements instanceof sr?br._elements:null},clear:function(){Q(rr).forEach(Ur)}}}var Ic=new Float32Array(1),Eu=new Uint32Array(Ic.buffer),Su=5123;function Cu(z){for(var ue=Et.allocType(Su,z.length),De=0;De<z.length;++De)if(isNaN(z[De]))ue[De]=65535;else if(z[De]===Infinity)ue[De]=31744;else if(z[De]===-Infinity)ue[De]=64512;else{Ic[0]=z[De];var Mt=Eu[0],rr=Mt>>>31<<15,At=(Mt<<1>>>24)-127,qt=Mt>>13&(1<<10)-1;if(At<-24)ue[De]=rr;else if(At<-14){var sr=-14-At;ue[De]=rr+(qt+(1<<10)>>sr)}else At>15?ue[De]=rr+31744:ue[De]=rr+(At+15<<10)+qt}return ue}function lo(z){return Array.isArray(z)||ge(z)}var Bf=function(z){return!(z&z-1)&&!!z},Nf=34467,$o=3553,Oc=34067,wu=34069,tu=6408,lf=6406,Sl=6407,Oi=6409,Cl=6410,Eh=32854,nl=32855,Rc=36194,zf=32819,Sh=32820,Uf=33635,kc=34042,Jl=6402,ec=34041,wl=35904,il=35906,Al=36193,ju=33776,Us=33777,cf=33778,ff=33779,Zf=35986,ru=35987,tc=34798,Lc=35840,hf=35841,Tl=35842,tp=35843,pf=36196,Ml=5121,df=5123,vf=5125,Pl=5126,Dc=10242,Ch=10243,wh=10497,rc=33071,Ah=33648,Il=10240,Hi=10241,nc=9728,na=9729,Au=9984,ji=9985,Aa=9986,_s=9987,Fc=33170,Gu=4352,Na=4353,ic=4354,Ol=34046,Hu=3317,Bc=37440,Tu=37441,po=37443,Rl=37444,ac=33984,vo=[Au,Aa,ji,_s],hn=[0,Oi,Cl,Sl,tu],co={};co[Oi]=co[lf]=co[Jl]=1,co[ec]=co[Cl]=2,co[Sl]=co[wl]=3,co[tu]=co[il]=4;function Wu(z){return"[object "+z+"]"}var ka=Wu("HTMLCanvasElement"),Zs=Wu("OffscreenCanvas"),ws=Wu("CanvasRenderingContext2D"),mf=Wu("ImageBitmap"),zr=Wu("HTMLImageElement"),oc=Wu("HTMLVideoElement"),gf=Object.keys(Ra).concat([ka,Zs,ws,mf,zr,oc]),al=[];al[Ml]=1,al[Pl]=4,al[Al]=2,al[df]=2,al[vf]=4;var Ea=[];Ea[Eh]=2,Ea[nl]=2,Ea[Rc]=2,Ea[ec]=4,Ea[ju]=.5,Ea[Us]=.5,Ea[cf]=1,Ea[ff]=1,Ea[Zf]=.5,Ea[ru]=1,Ea[tc]=1,Ea[Lc]=.5,Ea[hf]=.25,Ea[Tl]=.5,Ea[tp]=.25,Ea[pf]=.5;function xs(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function yf(z){if(!Array.isArray(z))return!1;var ue=z.length;return!(ue===0||!lo(z[0]))}function Mu(z){return Object.prototype.toString.call(z)}function Is(z){return Mu(z)===ka}function Pu(z){return Mu(z)===Zs}function Vf(z){return Mu(z)===ws}function ol(z){return Mu(z)===mf}function jf(z){return Mu(z)===zr}function _f(z){return Mu(z)===oc}function nu(z){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&z&&z.getContext)}function As(z){var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ue&&z&&"src"in z&&"crossOrigin"in z)}function Ei(z){if(!z)return!1;if(nu(z)||As(z))return!0;var ue=Mu(z);return gf.indexOf(ue)>=0?!0:xs(z)||yf(z)||ds(z)}function Iu(z){return Ra[Object.prototype.toString.call(z)]|0}function iu(z,ue){var De=ue.length;switch(z.type){case Ml:case df:case vf:case Pl:var Mt=Et.allocType(z.type,De);Mt.set(ue),z.data=Mt;break;case Al:z.data=Cu(ue);break;default:le.raise("unsupported texture type, must specify a typed array")}}function Xo(z,ue){return Et.allocType(z.type===Al?Pl:z.type,ue)}function sl(z,ue){z.type===Al?(z.data=Cu(ue),Et.freeType(ue)):z.data=ue}function as(z,ue,De,Mt,rr,At){for(var qt=z.width,sr=z.height,dr=z.channels,mr=qt*sr*dr,Sr=Xo(z,mr),Cr=0,Ur=0;Ur<sr;++Ur)for(var vr=0;vr<qt;++vr)for(var br=0;br<dr;++br)Sr[Cr++]=ue[De*vr+Mt*Ur+rr*br+At];sl(z,Sr)}function Vs(z,ue,De,Mt,rr,At){var qt;if(typeof Ea[z]!="undefined"?qt=Ea[z]:qt=co[z]*al[ue],At&&(qt*=6),rr){for(var sr=0,dr=De;dr>=1;)sr+=qt*dr*dr,dr/=2;return sr}else return qt*De*Mt}function bs(z,ue,De,Mt,rr,At,qt){var sr={"don't care":Gu,"dont care":Gu,nice:ic,fast:Na},dr={repeat:wh,clamp:rc,mirror:Ah},mr={nearest:nc,linear:na},Sr=v({mipmap:_s,"nearest mipmap nearest":Au,"linear mipmap nearest":ji,"nearest mipmap linear":Aa,"linear mipmap linear":_s},mr),Cr={none:0,browser:Rl},Ur={uint8:Ml,rgba4:zf,rgb565:Uf,"rgb5 a1":Sh},vr={alpha:lf,luminance:Oi,"luminance alpha":Cl,rgb:Sl,rgba:tu,rgba4:Eh,"rgb5 a1":nl,rgb565:Rc},br={};ue.ext_srgb&&(vr.srgb=wl,vr.srgba=il),ue.oes_texture_float&&(Ur.float32=Ur.float=Pl),ue.oes_texture_half_float&&(Ur.float16=Ur["half float"]=Al),ue.webgl_depth_texture&&(v(vr,{depth:Jl,"depth stencil":ec}),v(Ur,{uint16:df,uint32:vf,"depth stencil":kc})),ue.webgl_compressed_texture_s3tc&&v(br,{"rgb s3tc dxt1":ju,"rgba s3tc dxt1":Us,"rgba s3tc dxt3":cf,"rgba s3tc dxt5":ff}),ue.webgl_compressed_texture_atc&&v(br,{"rgb atc":Zf,"rgba atc explicit alpha":ru,"rgba atc interpolated alpha":tc}),ue.webgl_compressed_texture_pvrtc&&v(br,{"rgb pvrtc 4bppv1":Lc,"rgb pvrtc 2bppv1":hf,"rgba pvrtc 4bppv1":Tl,"rgba pvrtc 2bppv1":tp}),ue.webgl_compressed_texture_etc1&&(br["rgb etc1"]=pf);var rt=Array.prototype.slice.call(z.getParameter(Nf)||new Uint32Array(0));Object.keys(br).forEach(function(Ce){var Ft=br[Ce];rt.indexOf(Ft)>=0&&(vr[Ce]=Ft)});var Ut=Object.keys(vr);De.textureFormats=Ut;var gr=[];Object.keys(vr).forEach(function(Ce){var Ft=vr[Ce];gr[Ft]=Ce});var Dr=[];Object.keys(Ur).forEach(function(Ce){var Ft=Ur[Ce];Dr[Ft]=Ce});var or=[];Object.keys(mr).forEach(function(Ce){var Ft=mr[Ce];or[Ft]=Ce});var Mr=[];Object.keys(Sr).forEach(function(Ce){var Ft=Sr[Ce];Mr[Ft]=Ce});var $r=[];Object.keys(dr).forEach(function(Ce){var Ft=dr[Ce];$r[Ft]=Ce});var Bn=Ut.reduce(function(Ce,Ft){var gt=vr[Ft];return gt===Oi||gt===lf||gt===Oi||gt===Cl||gt===Jl||gt===ec||ue.ext_srgb&&(gt===wl||gt===il)?Ce[gt]=gt:gt===nl||Ft.indexOf("rgba")>=0?Ce[gt]=tu:Ce[gt]=Sl,Ce},{});function Wt(){this.internalformat=tu,this.format=tu,this.type=Ml,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Rl,this.width=0,this.height=0,this.channels=0}function Qt(Ce,Ft){Ce.internalformat=Ft.internalformat,Ce.format=Ft.format,Ce.type=Ft.type,Ce.compressed=Ft.compressed,Ce.premultiplyAlpha=Ft.premultiplyAlpha,Ce.flipY=Ft.flipY,Ce.unpackAlignment=Ft.unpackAlignment,Ce.colorSpace=Ft.colorSpace,Ce.width=Ft.width,Ce.height=Ft.height,Ce.channels=Ft.channels}function yn(Ce,Ft){if(!(typeof Ft!="object"||!Ft)){if("premultiplyAlpha"in Ft&&(le.type(Ft.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ce.premultiplyAlpha=Ft.premultiplyAlpha),"flipY"in Ft&&(le.type(Ft.flipY,"boolean","invalid texture flip"),Ce.flipY=Ft.flipY),"alignment"in Ft&&(le.oneOf(Ft.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ce.unpackAlignment=Ft.alignment),"colorSpace"in Ft&&(le.parameter(Ft.colorSpace,Cr,"invalid colorSpace"),Ce.colorSpace=Cr[Ft.colorSpace]),"type"in Ft){var gt=Ft.type;le(ue.oes_texture_float||!(gt==="float"||gt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),le(ue.oes_texture_half_float||!(gt==="half float"||gt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),le(ue.webgl_depth_texture||!(gt==="uint16"||gt==="uint32"||gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(gt,Ur,"invalid texture type"),Ce.type=Ur[gt]}var pn=Ce.width,Ni=Ce.height,_e=Ce.channels,ie=!1;"shape"in Ft?(le(Array.isArray(Ft.shape)&&Ft.shape.length>=2,"shape must be an array"),pn=Ft.shape[0],Ni=Ft.shape[1],Ft.shape.length===3&&(_e=Ft.shape[2],le(_e>0&&_e<=4,"invalid number of channels"),ie=!0),le(pn>=0&&pn<=De.maxTextureSize,"invalid width"),le(Ni>=0&&Ni<=De.maxTextureSize,"invalid height")):("radius"in Ft&&(pn=Ni=Ft.radius,le(pn>=0&&pn<=De.maxTextureSize,"invalid radius")),"width"in Ft&&(pn=Ft.width,le(pn>=0&&pn<=De.maxTextureSize,"invalid width")),"height"in Ft&&(Ni=Ft.height,le(Ni>=0&&Ni<=De.maxTextureSize,"invalid height")),"channels"in Ft&&(_e=Ft.channels,le(_e>0&&_e<=4,"invalid number of channels"),ie=!0)),Ce.width=pn|0,Ce.height=Ni|0,Ce.channels=_e|0;var ze=!1;if("format"in Ft){var nt=Ft.format;le(ue.webgl_depth_texture||!(nt==="depth"||nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(nt,vr,"invalid texture format");var St=Ce.internalformat=vr[nt];Ce.format=Bn[St],nt in Ur&&("type"in Ft||(Ce.type=Ur[nt])),nt in br&&(Ce.compressed=!0),ze=!0}!ie&&ze?Ce.channels=co[Ce.format]:ie&&!ze?Ce.channels!==hn[Ce.format]&&(Ce.format=Ce.internalformat=hn[Ce.channels]):ze&&ie&&le(Ce.channels===co[Ce.format],"number of channels inconsistent with specified format")}}function jr(Ce){z.pixelStorei(Bc,Ce.flipY),z.pixelStorei(Tu,Ce.premultiplyAlpha),z.pixelStorei(po,Ce.colorSpace),z.pixelStorei(Hu,Ce.unpackAlignment)}function yr(){Wt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Yr(Ce,Ft){var gt=null;if(Ei(Ft)?gt=Ft:Ft&&(le.type(Ft,"object","invalid pixel data type"),yn(Ce,Ft),"x"in Ft&&(Ce.xOffset=Ft.x|0),"y"in Ft&&(Ce.yOffset=Ft.y|0),Ei(Ft.data)&&(gt=Ft.data)),le(!Ce.compressed||gt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ft.copy){le(!gt,"can not specify copy and data field for the same texture");var pn=rr.viewportWidth,Ni=rr.viewportHeight;Ce.width=Ce.width||pn-Ce.xOffset,Ce.height=Ce.height||Ni-Ce.yOffset,Ce.needsCopy=!0,le(Ce.xOffset>=0&&Ce.xOffset<pn&&Ce.yOffset>=0&&Ce.yOffset<Ni&&Ce.width>0&&Ce.width<=pn&&Ce.height>0&&Ce.height<=Ni,"copy texture read out of bounds")}else if(!gt)Ce.width=Ce.width||1,Ce.height=Ce.height||1,Ce.channels=Ce.channels||4;else if(ge(gt))Ce.channels=Ce.channels||4,Ce.data=gt,!("type"in Ft)&&Ce.type===Ml&&(Ce.type=Iu(gt));else if(xs(gt))Ce.channels=Ce.channels||4,iu(Ce,gt),Ce.alignment=1,Ce.needsFree=!0;else if(ds(gt)){var _e=gt.data;!Array.isArray(_e)&&Ce.type===Ml&&(Ce.type=Iu(_e));var ie=gt.shape,ze=gt.stride,nt,St,We,Le,Qe,pe;ie.length===3?(We=ie[2],pe=ze[2]):(le(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),We=1,pe=1),nt=ie[0],St=ie[1],Le=ze[0],Qe=ze[1],Ce.alignment=1,Ce.width=nt,Ce.height=St,Ce.channels=We,Ce.format=Ce.internalformat=hn[We],Ce.needsFree=!0,as(Ce,_e,Le,Qe,pe,gt.offset)}else if(nu(gt)||Is(gt)||Pu(gt)||Vf(gt))nu(gt)||Is(gt)||Pu(gt)?Ce.element=gt:Ce.element=gt.canvas,Ce.width=Ce.element.width,Ce.height=Ce.element.height,Ce.channels=4;else if(ol(gt))Ce.element=gt,Ce.width=gt.width,Ce.height=gt.height,Ce.channels=4;else if(jf(gt))Ce.element=gt,Ce.width=gt.naturalWidth,Ce.height=gt.naturalHeight,Ce.channels=4;else if(As(gt))Ce.element=gt,Ce.width=gt.width,Ce.height=gt.height,Ce.channels=4;else if(_f(gt))Ce.element=gt,Ce.width=gt.videoWidth,Ce.height=gt.videoHeight,Ce.channels=4;else if(yf(gt)){var Ne=Ce.width||gt[0].length,Ee=Ce.height||gt.length,it=Ce.channels;lo(gt[0][0])?it=it||gt[0][0].length:it=it||1;for(var yt=me.shape(gt),lr=1,Br=0;Br<yt.length;++Br)lr*=yt[Br];var Nr=Xo(Ce,lr);me.flatten(gt,yt,"",Nr),sl(Ce,Nr),Ce.alignment=1,Ce.width=Ne,Ce.height=Ee,Ce.channels=it,Ce.format=Ce.internalformat=hn[it],Ce.needsFree=!0}Ce.type===Pl?le(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ce.type===Al&&le(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function qr(Ce,Ft,gt){var pn=Ce.element,Ni=Ce.data,_e=Ce.internalformat,ie=Ce.format,ze=Ce.type,nt=Ce.width,St=Ce.height;jr(Ce),pn?z.texImage2D(Ft,gt,ie,ie,ze,pn):Ce.compressed?z.compressedTexImage2D(Ft,gt,_e,nt,St,0,Ni):Ce.needsCopy?(Mt(),z.copyTexImage2D(Ft,gt,ie,Ce.xOffset,Ce.yOffset,nt,St,0)):z.texImage2D(Ft,gt,ie,nt,St,0,ie,ze,Ni||null)}function pi(Ce,Ft,gt,pn,Ni){var _e=Ce.element,ie=Ce.data,ze=Ce.internalformat,nt=Ce.format,St=Ce.type,We=Ce.width,Le=Ce.height;jr(Ce),_e?z.texSubImage2D(Ft,Ni,gt,pn,nt,St,_e):Ce.compressed?z.compressedTexSubImage2D(Ft,Ni,gt,pn,ze,We,Le,ie):Ce.needsCopy?(Mt(),z.copyTexSubImage2D(Ft,Ni,gt,pn,Ce.xOffset,Ce.yOffset,We,Le)):z.texSubImage2D(Ft,Ni,gt,pn,We,Le,nt,St,ie)}var ti=[];function Xr(){return ti.pop()||new yr}function tn(Ce){Ce.needsFree&&Et.freeType(Ce.data),yr.call(Ce),ti.push(Ce)}function Xn(){Wt.call(this),this.genMipmaps=!1,this.mipmapHint=Gu,this.mipmask=0,this.images=Array(16)}function oi(Ce,Ft,gt){var pn=Ce.images[0]=Xr();Ce.mipmask=1,pn.width=Ce.width=Ft,pn.height=Ce.height=gt,pn.channels=Ce.channels=4}function Ri(Ce,Ft){var gt=null;if(Ei(Ft))gt=Ce.images[0]=Xr(),Qt(gt,Ce),Yr(gt,Ft),Ce.mipmask=1;else if(yn(Ce,Ft),Array.isArray(Ft.mipmap))for(var pn=Ft.mipmap,Ni=0;Ni<pn.length;++Ni)gt=Ce.images[Ni]=Xr(),Qt(gt,Ce),gt.width>>=Ni,gt.height>>=Ni,Yr(gt,pn[Ni]),Ce.mipmask|=1<<Ni;else gt=Ce.images[0]=Xr(),Qt(gt,Ce),Yr(gt,Ft),Ce.mipmask=1;Qt(Ce,Ce.images[0]),Ce.compressed&&(Ce.internalformat===ju||Ce.internalformat===Us||Ce.internalformat===cf||Ce.internalformat===ff)&&le(Ce.width%4==0&&Ce.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function no(Ce,Ft){for(var gt=Ce.images,pn=0;pn<gt.length;++pn){if(!gt[pn])return;qr(gt[pn],Ft,pn)}}var io=[];function Ii(){var Ce=io.pop()||new Xn;Wt.call(Ce),Ce.mipmask=0;for(var Ft=0;Ft<16;++Ft)Ce.images[Ft]=null;return Ce}function Qo(Ce){for(var Ft=Ce.images,gt=0;gt<Ft.length;++gt)Ft[gt]&&tn(Ft[gt]),Ft[gt]=null;io.push(Ce)}function Va(){this.minFilter=nc,this.magFilter=nc,this.wrapS=rc,this.wrapT=rc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Gu}function Uo(Ce,Ft){if("min"in Ft){var gt=Ft.min;le.parameter(gt,Sr),Ce.minFilter=Sr[gt],vo.indexOf(Ce.minFilter)>=0&&!("faces"in Ft)&&(Ce.genMipmaps=!0)}if("mag"in Ft){var pn=Ft.mag;le.parameter(pn,mr),Ce.magFilter=mr[pn]}var Ni=Ce.wrapS,_e=Ce.wrapT;if("wrap"in Ft){var ie=Ft.wrap;typeof ie=="string"?(le.parameter(ie,dr),Ni=_e=dr[ie]):Array.isArray(ie)&&(le.parameter(ie[0],dr),le.parameter(ie[1],dr),Ni=dr[ie[0]],_e=dr[ie[1]])}else{if("wrapS"in Ft){var ze=Ft.wrapS;le.parameter(ze,dr),Ni=dr[ze]}if("wrapT"in Ft){var nt=Ft.wrapT;le.parameter(nt,dr),_e=dr[nt]}}if(Ce.wrapS=Ni,Ce.wrapT=_e,"anisotropic"in Ft){var St=Ft.anisotropic;le(typeof St=="number"&&St>=1&&St<=De.maxAnisotropic,"aniso samples must be between 1 and "),Ce.anisotropic=Ft.anisotropic}if("mipmap"in Ft){var We=!1;switch(typeof Ft.mipmap){case"string":le.parameter(Ft.mipmap,sr,"invalid mipmap hint"),Ce.mipmapHint=sr[Ft.mipmap],Ce.genMipmaps=!0,We=!0;break;case"boolean":We=Ce.genMipmaps=Ft.mipmap;break;case"object":le(Array.isArray(Ft.mipmap),"invalid mipmap type"),Ce.genMipmaps=!1,We=!0;break;default:le.raise("invalid mipmap type")}We&&!("min"in Ft)&&(Ce.minFilter=Au)}}function bo(Ce,Ft){z.texParameteri(Ft,Hi,Ce.minFilter),z.texParameteri(Ft,Il,Ce.magFilter),z.texParameteri(Ft,Dc,Ce.wrapS),z.texParameteri(Ft,Ch,Ce.wrapT),ue.ext_texture_filter_anisotropic&&z.texParameteri(Ft,Ol,Ce.anisotropic),Ce.genMipmaps&&(z.hint(Fc,Ce.mipmapHint),z.generateMipmap(Ft))}var Yo=0,Oo={},Jo=De.maxTextureUnits,ao=Array(Jo).map(function(){return null});function li(Ce){Wt.call(this),this.mipmask=0,this.internalformat=tu,this.id=Yo++,this.refCount=1,this.target=Ce,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Va,qt.profile&&(this.stats={size:0})}function Zo(Ce){z.activeTexture(ac),z.bindTexture(Ce.target,Ce.texture)}function qi(){var Ce=ao[0];Ce?z.bindTexture(Ce.target,Ce.texture):z.bindTexture($o,null)}function es(Ce){var Ft=Ce.texture;le(Ft,"must not double destroy texture");var gt=Ce.unit,pn=Ce.target;gt>=0&&(z.activeTexture(ac+gt),z.bindTexture(pn,null),ao[gt]=null),z.deleteTexture(Ft),Ce.texture=null,Ce.params=null,Ce.pixels=null,Ce.refCount=0,delete Oo[Ce.id],At.textureCount--}v(li.prototype,{bind:function(){var Ce=this;Ce.bindCount+=1;var Ft=Ce.unit;if(Ft<0){for(var gt=0;gt<Jo;++gt){var pn=ao[gt];if(pn){if(pn.bindCount>0)continue;pn.unit=-1}ao[gt]=Ce,Ft=gt;break}Ft>=Jo&&le.raise("insufficient number of texture units"),qt.profile&&At.maxTextureUnits<Ft+1&&(At.maxTextureUnits=Ft+1),Ce.unit=Ft,z.activeTexture(ac+Ft),z.bindTexture(Ce.target,Ce.texture)}return Ft},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&es(this)}});function Or(Ce,Ft){var gt=new li($o);Oo[gt.id]=gt,At.textureCount++;function pn(ie,ze){var nt=gt.texInfo;Va.call(nt);var St=Ii();return typeof ie=="number"?typeof ze=="number"?oi(St,ie|0,ze|0):oi(St,ie|0,ie|0):ie?(le.type(ie,"object","invalid arguments to regl.texture"),Uo(nt,ie),Ri(St,ie)):oi(St,1,1),nt.genMipmaps&&(St.mipmask=(St.width<<1)-1),gt.mipmask=St.mipmask,Qt(gt,St),le.texture2D(nt,St,De),gt.internalformat=St.internalformat,pn.width=St.width,pn.height=St.height,Zo(gt),no(St,$o),bo(nt,$o),qi(),Qo(St),qt.profile&&(gt.stats.size=Vs(gt.internalformat,gt.type,St.width,St.height,nt.genMipmaps,!1)),pn.format=gr[gt.internalformat],pn.type=Dr[gt.type],pn.mag=or[nt.magFilter],pn.min=Mr[nt.minFilter],pn.wrapS=$r[nt.wrapS],pn.wrapT=$r[nt.wrapT],pn}function Ni(ie,ze,nt,St){le(!!ie,"must specify image data");var We=ze|0,Le=nt|0,Qe=St|0,pe=Xr();return Qt(pe,gt),pe.width=0,pe.height=0,Yr(pe,ie),pe.width=pe.width||(gt.width>>Qe)-We,pe.height=pe.height||(gt.height>>Qe)-Le,le(gt.type===pe.type&&gt.format===pe.format&&gt.internalformat===pe.internalformat,"incompatible format for texture.subimage"),le(We>=0&&Le>=0&&We+pe.width<=gt.width&&Le+pe.height<=gt.height,"texture.subimage write out of bounds"),le(gt.mipmask&1<<Qe,"missing mipmap data"),le(pe.data||pe.element||pe.needsCopy,"missing image data"),Zo(gt),pi(pe,$o,We,Le,Qe),qi(),tn(pe),pn}function _e(ie,ze){var nt=ie|0,St=ze|0||nt;if(nt===gt.width&&St===gt.height)return pn;pn.width=gt.width=nt,pn.height=gt.height=St,Zo(gt);for(var We=0;gt.mipmask>>We;++We){var Le=nt>>We,Qe=St>>We;if(!Le||!Qe)break;z.texImage2D($o,We,gt.format,Le,Qe,0,gt.format,gt.type,null)}return qi(),qt.profile&&(gt.stats.size=Vs(gt.internalformat,gt.type,nt,St,!1,!1)),pn}return pn(Ce,Ft),pn.subimage=Ni,pn.resize=_e,pn._reglType="texture2d",pn._texture=gt,qt.profile&&(pn.stats=gt.stats),pn.destroy=function(){gt.decRef()},pn}function rn(Ce,Ft,gt,pn,Ni,_e){var ie=new li(Oc);Oo[ie.id]=ie,At.cubeCount++;var ze=new Array(6);function nt(Le,Qe,pe,Ne,Ee,it){var yt,lr=ie.texInfo;for(Va.call(lr),yt=0;yt<6;++yt)ze[yt]=Ii();if(typeof Le=="number"||!Le){var Br=Le|0||1;for(yt=0;yt<6;++yt)oi(ze[yt],Br,Br)}else if(typeof Le=="object")if(Qe)Ri(ze[0],Le),Ri(ze[1],Qe),Ri(ze[2],pe),Ri(ze[3],Ne),Ri(ze[4],Ee),Ri(ze[5],it);else if(Uo(lr,Le),yn(ie,Le),"faces"in Le){var Nr=Le.faces;for(le(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),yt=0;yt<6;++yt)le(typeof Nr[yt]=="object"&&!!Nr[yt],"invalid input for cube map face"),Qt(ze[yt],ie),Ri(ze[yt],Nr[yt])}else for(yt=0;yt<6;++yt)Ri(ze[yt],Le);else le.raise("invalid arguments to cube map");for(Qt(ie,ze[0]),le.optional(function(){De.npotTextureCube||le(Bf(ie.width)&&Bf(ie.height),"your browser does not support non power or two texture dimensions")}),lr.genMipmaps?ie.mipmask=(ze[0].width<<1)-1:ie.mipmask=ze[0].mipmask,le.textureCube(ie,lr,ze,De),ie.internalformat=ze[0].internalformat,nt.width=ze[0].width,nt.height=ze[0].height,Zo(ie),yt=0;yt<6;++yt)no(ze[yt],wu+yt);for(bo(lr,Oc),qi(),qt.profile&&(ie.stats.size=Vs(ie.internalformat,ie.type,nt.width,nt.height,lr.genMipmaps,!0)),nt.format=gr[ie.internalformat],nt.type=Dr[ie.type],nt.mag=or[lr.magFilter],nt.min=Mr[lr.minFilter],nt.wrapS=$r[lr.wrapS],nt.wrapT=$r[lr.wrapT],yt=0;yt<6;++yt)Qo(ze[yt]);return nt}function St(Le,Qe,pe,Ne,Ee){le(!!Qe,"must specify image data"),le(typeof Le=="number"&&Le===(Le|0)&&Le>=0&&Le<6,"invalid face");var it=pe|0,yt=Ne|0,lr=Ee|0,Br=Xr();return Qt(Br,ie),Br.width=0,Br.height=0,Yr(Br,Qe),Br.width=Br.width||(ie.width>>lr)-it,Br.height=Br.height||(ie.height>>lr)-yt,le(ie.type===Br.type&&ie.format===Br.format&&ie.internalformat===Br.internalformat,"incompatible format for texture.subimage"),le(it>=0&&yt>=0&&it+Br.width<=ie.width&&yt+Br.height<=ie.height,"texture.subimage write out of bounds"),le(ie.mipmask&1<<lr,"missing mipmap data"),le(Br.data||Br.element||Br.needsCopy,"missing image data"),Zo(ie),pi(Br,wu+Le,it,yt,lr),qi(),tn(Br),nt}function We(Le){var Qe=Le|0;if(Qe!==ie.width){nt.width=ie.width=Qe,nt.height=ie.height=Qe,Zo(ie);for(var pe=0;pe<6;++pe)for(var Ne=0;ie.mipmask>>Ne;++Ne)z.texImage2D(wu+pe,Ne,ie.format,Qe>>Ne,Qe>>Ne,0,ie.format,ie.type,null);return qi(),qt.profile&&(ie.stats.size=Vs(ie.internalformat,ie.type,nt.width,nt.height,!1,!0)),nt}}return nt(Ce,Ft,gt,pn,Ni,_e),nt.subimage=St,nt.resize=We,nt._reglType="textureCube",nt._texture=ie,qt.profile&&(nt.stats=ie.stats),nt.destroy=function(){ie.decRef()},nt}function ia(){for(var Ce=0;Ce<Jo;++Ce)z.activeTexture(ac+Ce),z.bindTexture($o,null),ao[Ce]=null;Q(Oo).forEach(es),At.cubeCount=0,At.textureCount=0}qt.profile&&(At.getTotalTextureSize=function(){var Ce=0;return Object.keys(Oo).forEach(function(Ft){Ce+=Oo[Ft].stats.size}),Ce});function Ro(){for(var Ce=0;Ce<Jo;++Ce){var Ft=ao[Ce];Ft&&(Ft.bindCount=0,Ft.unit=-1,ao[Ce]=null)}Q(Oo).forEach(function(gt){gt.texture=z.createTexture(),z.bindTexture(gt.target,gt.texture);for(var pn=0;pn<32;++pn)if((gt.mipmask&1<<pn)!=0)if(gt.target===$o)z.texImage2D($o,pn,gt.internalformat,gt.width>>pn,gt.height>>pn,0,gt.internalformat,gt.type,null);else for(var Ni=0;Ni<6;++Ni)z.texImage2D(wu+Ni,pn,gt.internalformat,gt.width>>pn,gt.height>>pn,0,gt.internalformat,gt.type,null);bo(gt.texInfo,gt.target)})}function yl(){for(var Ce=0;Ce<Jo;++Ce){var Ft=ao[Ce];Ft&&(Ft.bindCount=0,Ft.unit=-1,ao[Ce]=null),z.activeTexture(ac+Ce),z.bindTexture($o,null),z.bindTexture(Oc,null)}}return{create2D:Or,createCube:rn,clear:ia,getTexture:function(Ce){return null},restore:Ro,refresh:yl}}var pu=36161,On=32854,Sn=32855,Nc=36194,os=33189,au=36168,Fo=34041,Ou=35907,xf=34836,bf=34842,ua=34843,pa=[];pa[On]=2,pa[Sn]=2,pa[Nc]=2,pa[os]=2,pa[au]=1,pa[Fo]=4,pa[Ou]=4,pa[xf]=16,pa[bf]=8,pa[ua]=6;function Th(z,ue,De){return pa[z]*ue*De}var Xu=function(z,ue,De,Mt,rr){var At={rgba4:On,rgb565:Nc,"rgb5 a1":Sn,depth:os,stencil:au,"depth stencil":Fo};ue.ext_srgb&&(At.srgba=Ou),ue.ext_color_buffer_half_float&&(At.rgba16f=bf,At.rgb16f=ua),ue.webgl_color_buffer_float&&(At.rgba32f=xf);var qt=[];Object.keys(At).forEach(function(vr){var br=At[vr];qt[br]=vr});var sr=0,dr={};function mr(vr){this.id=sr++,this.refCount=1,this.renderbuffer=vr,this.format=On,this.width=0,this.height=0,rr.profile&&(this.stats={size:0})}mr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(vr){var br=vr.renderbuffer;le(br,"must not double destroy renderbuffer"),z.bindRenderbuffer(pu,null),z.deleteRenderbuffer(br),vr.renderbuffer=null,vr.refCount=0,delete dr[vr.id],Mt.renderbufferCount--}function Cr(vr,br){var rt=new mr(z.createRenderbuffer());dr[rt.id]=rt,Mt.renderbufferCount++;function Ut(Dr,or){var Mr=0,$r=0,Bn=On;if(typeof Dr=="object"&&Dr){var Wt=Dr;if("shape"in Wt){var Qt=Wt.shape;le(Array.isArray(Qt)&&Qt.length>=2,"invalid renderbuffer shape"),Mr=Qt[0]|0,$r=Qt[1]|0}else"radius"in Wt&&(Mr=$r=Wt.radius|0),"width"in Wt&&(Mr=Wt.width|0),"height"in Wt&&($r=Wt.height|0);"format"in Wt&&(le.parameter(Wt.format,At,"invalid renderbuffer format"),Bn=At[Wt.format])}else typeof Dr=="number"?(Mr=Dr|0,typeof or=="number"?$r=or|0:$r=Mr):Dr?le.raise("invalid arguments to renderbuffer constructor"):Mr=$r=1;if(le(Mr>0&&$r>0&&Mr<=De.maxRenderbufferSize&&$r<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(Mr===rt.width&&$r===rt.height&&Bn===rt.format))return Ut.width=rt.width=Mr,Ut.height=rt.height=$r,rt.format=Bn,z.bindRenderbuffer(pu,rt.renderbuffer),z.renderbufferStorage(pu,Bn,Mr,$r),le(z.getError()===0,"invalid render buffer format"),rr.profile&&(rt.stats.size=Th(rt.format,rt.width,rt.height)),Ut.format=qt[rt.format],Ut}function gr(Dr,or){var Mr=Dr|0,$r=or|0||Mr;return Mr===rt.width&&$r===rt.height||(le(Mr>0&&$r>0&&Mr<=De.maxRenderbufferSize&&$r<=De.maxRenderbufferSize,"invalid renderbuffer size"),Ut.width=rt.width=Mr,Ut.height=rt.height=$r,z.bindRenderbuffer(pu,rt.renderbuffer),z.renderbufferStorage(pu,rt.format,Mr,$r),le(z.getError()===0,"invalid render buffer format"),rr.profile&&(rt.stats.size=Th(rt.format,rt.width,rt.height))),Ut}return Ut(vr,br),Ut.resize=gr,Ut._reglType="renderbuffer",Ut._renderbuffer=rt,rr.profile&&(Ut.stats=rt.stats),Ut.destroy=function(){rt.decRef()},Ut}rr.profile&&(Mt.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(dr).forEach(function(br){vr+=dr[br].stats.size}),vr});function Ur(){Q(dr).forEach(function(vr){vr.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(pu,vr.renderbuffer),z.renderbufferStorage(pu,vr.format,vr.width,vr.height)}),z.bindRenderbuffer(pu,null)}return{create:Cr,clear:function(){Q(dr).forEach(Sr)},restore:Ur}},du=36160,Xi=36161,ro=3553,Os=34069,js=36064,ul=36096,Ru=36128,kl=33306,mo=36053,sc=36054,Ll=36055,Ef=36057,ll=36061,cl=36193,uc=5121,ku=5126,Gs=6407,zc=6408,Uc=6402,Gf=[Gs,zc],lc=[];lc[zc]=4,lc[Gs]=3;var l=[];l[uc]=1,l[ku]=4,l[cl]=2;var f=32854,c=32855,d=36194,b=33189,w=36168,P=34041,k=35907,U=34836,G=34842,ae=34843,se=[f,c,d,k,G,ae,U],re={};re[mo]="complete",re[sc]="incomplete attachment",re[Ef]="incomplete dimensions",re[Ll]="incomplete, missing attachment",re[ll]="unsupported";function be(z,ue,De,Mt,rr,At){var qt={cur:null,next:null,dirty:!1,setFBO:null},sr=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];ue.ext_srgb&&dr.push("srgba"),ue.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),ue.webgl_color_buffer_float&&dr.push("rgba32f");var mr=["uint8"];ue.oes_texture_half_float&&mr.push("half float","float16"),ue.oes_texture_float&&mr.push("float","float32");function Sr(yr,Yr,qr){this.target=yr,this.texture=Yr,this.renderbuffer=qr;var pi=0,ti=0;Yr?(pi=Yr.width,ti=Yr.height):qr&&(pi=qr.width,ti=qr.height),this.width=pi,this.height=ti}function Cr(yr){yr&&(yr.texture&&yr.texture._texture.decRef(),yr.renderbuffer&&yr.renderbuffer._renderbuffer.decRef())}function Ur(yr,Yr,qr){if(!!yr)if(yr.texture){var pi=yr.texture._texture,ti=Math.max(1,pi.width),Xr=Math.max(1,pi.height);le(ti===Yr&&Xr===qr,"inconsistent width/height for supplied texture"),pi.refCount+=1}else{var tn=yr.renderbuffer._renderbuffer;le(tn.width===Yr&&tn.height===qr,"inconsistent width/height for renderbuffer"),tn.refCount+=1}}function vr(yr,Yr){Yr&&(Yr.texture?z.framebufferTexture2D(du,yr,Yr.target,Yr.texture._texture.texture,0):z.framebufferRenderbuffer(du,yr,Xi,Yr.renderbuffer._renderbuffer.renderbuffer))}function br(yr){var Yr=ro,qr=null,pi=null,ti=yr;typeof yr=="object"&&(ti=yr.data,"target"in yr&&(Yr=yr.target|0)),le.type(ti,"function","invalid attachment data");var Xr=ti._reglType;return Xr==="texture2d"?(qr=ti,le(Yr===ro)):Xr==="textureCube"?(qr=ti,le(Yr>=Os&&Yr<Os+6,"invalid cube map target")):Xr==="renderbuffer"?(pi=ti,Yr=Xi):le.raise("invalid regl object for attachment"),new Sr(Yr,qr,pi)}function rt(yr,Yr,qr,pi,ti){if(qr){var Xr=Mt.create2D({width:yr,height:Yr,format:pi,type:ti});return Xr._texture.refCount=0,new Sr(ro,Xr,null)}else{var tn=rr.create({width:yr,height:Yr,format:pi});return tn._renderbuffer.refCount=0,new Sr(Xi,null,tn)}}function Ut(yr){return yr&&(yr.texture||yr.renderbuffer)}function gr(yr,Yr,qr){yr&&(yr.texture?yr.texture.resize(Yr,qr):yr.renderbuffer&&yr.renderbuffer.resize(Yr,qr),yr.width=Yr,yr.height=qr)}var Dr=0,or={};function Mr(){this.id=Dr++,or[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(yr){yr.colorAttachments.forEach(Cr),Cr(yr.depthAttachment),Cr(yr.stencilAttachment),Cr(yr.depthStencilAttachment)}function Bn(yr){var Yr=yr.framebuffer;le(Yr,"must not double destroy framebuffer"),z.deleteFramebuffer(Yr),yr.framebuffer=null,At.framebufferCount--,delete or[yr.id]}function Wt(yr){var Yr;z.bindFramebuffer(du,yr.framebuffer);var qr=yr.colorAttachments;for(Yr=0;Yr<qr.length;++Yr)vr(js+Yr,qr[Yr]);for(Yr=qr.length;Yr<De.maxColorAttachments;++Yr)z.framebufferTexture2D(du,js+Yr,ro,null,0);z.framebufferTexture2D(du,kl,ro,null,0),z.framebufferTexture2D(du,ul,ro,null,0),z.framebufferTexture2D(du,Ru,ro,null,0),vr(ul,yr.depthAttachment),vr(Ru,yr.stencilAttachment),vr(kl,yr.depthStencilAttachment);var pi=z.checkFramebufferStatus(du);!z.isContextLost()&&pi!==mo&&le.raise("framebuffer configuration not supported, status = "+re[pi]),z.bindFramebuffer(du,qt.next?qt.next.framebuffer:null),qt.cur=qt.next,z.getError()}function Qt(yr,Yr){var qr=new Mr;At.framebufferCount++;function pi(Xr,tn){var Xn;le(qt.next!==qr,"can not update framebuffer which is currently in use");var oi=0,Ri=0,no=!0,io=!0,Ii=null,Qo=!0,Va="rgba",Uo="uint8",bo=1,Yo=null,Oo=null,Jo=null,ao=!1;if(typeof Xr=="number")oi=Xr|0,Ri=tn|0||oi;else if(!Xr)oi=Ri=1;else{le.type(Xr,"object","invalid arguments for framebuffer");var li=Xr;if("shape"in li){var Zo=li.shape;le(Array.isArray(Zo)&&Zo.length>=2,"invalid shape for framebuffer"),oi=Zo[0],Ri=Zo[1]}else"radius"in li&&(oi=Ri=li.radius),"width"in li&&(oi=li.width),"height"in li&&(Ri=li.height);("color"in li||"colors"in li)&&(Ii=li.color||li.colors,Array.isArray(Ii)&&le(Ii.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),Ii||("colorCount"in li&&(bo=li.colorCount|0,le(bo>0,"invalid color buffer count")),"colorTexture"in li&&(Qo=!!li.colorTexture,Va="rgba4"),"colorType"in li&&(Uo=li.colorType,Qo?(le(ue.oes_texture_float||!(Uo==="float"||Uo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),le(ue.oes_texture_half_float||!(Uo==="half float"||Uo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Uo==="half float"||Uo==="float16"?(le(ue.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Va="rgba16f"):(Uo==="float"||Uo==="float32")&&(le(ue.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Va="rgba32f"),le.oneOf(Uo,mr,"invalid color type")),"colorFormat"in li&&(Va=li.colorFormat,sr.indexOf(Va)>=0?Qo=!0:dr.indexOf(Va)>=0?Qo=!1:le.optional(function(){Qo?le.oneOf(li.colorFormat,sr,"invalid color format for texture"):le.oneOf(li.colorFormat,dr,"invalid color format for renderbuffer")}))),("depthTexture"in li||"depthStencilTexture"in li)&&(ao=!!(li.depthTexture||li.depthStencilTexture),le(!ao||ue.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in li&&(typeof li.depth=="boolean"?no=li.depth:(Yo=li.depth,io=!1)),"stencil"in li&&(typeof li.stencil=="boolean"?io=li.stencil:(Oo=li.stencil,no=!1)),"depthStencil"in li&&(typeof li.depthStencil=="boolean"?no=io=li.depthStencil:(Jo=li.depthStencil,no=!1,io=!1))}var qi=null,es=null,Or=null,rn=null;if(Array.isArray(Ii))qi=Ii.map(br);else if(Ii)qi=[br(Ii)];else for(qi=new Array(bo),Xn=0;Xn<bo;++Xn)qi[Xn]=rt(oi,Ri,Qo,Va,Uo);le(ue.webgl_draw_buffers||qi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),le(qi.length<=De.maxColorAttachments,"too many color attachments, not supported"),oi=oi||qi[0].width,Ri=Ri||qi[0].height,Yo?es=br(Yo):no&&!io&&(es=rt(oi,Ri,ao,"depth","uint32")),Oo?Or=br(Oo):io&&!no&&(Or=rt(oi,Ri,!1,"stencil","uint8")),Jo?rn=br(Jo):!Yo&&!Oo&&io&&no&&(rn=rt(oi,Ri,ao,"depth stencil","depth stencil")),le(!!Yo+!!Oo+!!Jo<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ia=null;for(Xn=0;Xn<qi.length;++Xn)if(Ur(qi[Xn],oi,Ri),le(!qi[Xn]||qi[Xn].texture&&Gf.indexOf(qi[Xn].texture._texture.format)>=0||qi[Xn].renderbuffer&&se.indexOf(qi[Xn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xn+" is invalid"),qi[Xn]&&qi[Xn].texture){var Ro=lc[qi[Xn].texture._texture.format]*l[qi[Xn].texture._texture.type];ia===null?ia=Ro:le(ia===Ro,"all color attachments much have the same number of bits per pixel.")}return Ur(es,oi,Ri),le(!es||es.texture&&es.texture._texture.format===Uc||es.renderbuffer&&es.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),Ur(Or,oi,Ri),le(!Or||Or.renderbuffer&&Or.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Ur(rn,oi,Ri),le(!rn||rn.texture&&rn.texture._texture.format===P||rn.renderbuffer&&rn.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),$r(qr),qr.width=oi,qr.height=Ri,qr.colorAttachments=qi,qr.depthAttachment=es,qr.stencilAttachment=Or,qr.depthStencilAttachment=rn,pi.color=qi.map(Ut),pi.depth=Ut(es),pi.stencil=Ut(Or),pi.depthStencil=Ut(rn),pi.width=qr.width,pi.height=qr.height,Wt(qr),pi}function ti(Xr,tn){le(qt.next!==qr,"can not resize a framebuffer which is currently in use");var Xn=Math.max(Xr|0,1),oi=Math.max(tn|0||Xn,1);if(Xn===qr.width&&oi===qr.height)return pi;for(var Ri=qr.colorAttachments,no=0;no<Ri.length;++no)gr(Ri[no],Xn,oi);return gr(qr.depthAttachment,Xn,oi),gr(qr.stencilAttachment,Xn,oi),gr(qr.depthStencilAttachment,Xn,oi),qr.width=pi.width=Xn,qr.height=pi.height=oi,Wt(qr),pi}return pi(yr,Yr),v(pi,{resize:ti,_reglType:"framebuffer",_framebuffer:qr,destroy:function(){Bn(qr),$r(qr)},use:function(Xr){qt.setFBO({framebuffer:pi},Xr)}})}function yn(yr){var Yr=Array(6);function qr(ti){var Xr;le(Yr.indexOf(qt.next)<0,"can not update framebuffer which is currently in use");var tn={color:null},Xn=0,oi=null,Ri="rgba",no="uint8",io=1;if(typeof ti=="number")Xn=ti|0;else if(!ti)Xn=1;else{le.type(ti,"object","invalid arguments for framebuffer");var Ii=ti;if("shape"in Ii){var Qo=Ii.shape;le(Array.isArray(Qo)&&Qo.length>=2,"invalid shape for framebuffer"),le(Qo[0]===Qo[1],"cube framebuffer must be square"),Xn=Qo[0]}else"radius"in Ii&&(Xn=Ii.radius|0),"width"in Ii?(Xn=Ii.width|0,"height"in Ii&&le(Ii.height===Xn,"must be square")):"height"in Ii&&(Xn=Ii.height|0);("color"in Ii||"colors"in Ii)&&(oi=Ii.color||Ii.colors,Array.isArray(oi)&&le(oi.length===1||ue.webgl_draw_buffers,"multiple render targets not supported")),oi||("colorCount"in Ii&&(io=Ii.colorCount|0,le(io>0,"invalid color buffer count")),"colorType"in Ii&&(le.oneOf(Ii.colorType,mr,"invalid color type"),no=Ii.colorType),"colorFormat"in Ii&&(Ri=Ii.colorFormat,le.oneOf(Ii.colorFormat,sr,"invalid color format for texture"))),"depth"in Ii&&(tn.depth=Ii.depth),"stencil"in Ii&&(tn.stencil=Ii.stencil),"depthStencil"in Ii&&(tn.depthStencil=Ii.depthStencil)}var Va;if(oi)if(Array.isArray(oi))for(Va=[],Xr=0;Xr<oi.length;++Xr)Va[Xr]=oi[Xr];else Va=[oi];else{Va=Array(io);var Uo={radius:Xn,format:Ri,type:no};for(Xr=0;Xr<io;++Xr)Va[Xr]=Mt.createCube(Uo)}for(tn.color=Array(Va.length),Xr=0;Xr<Va.length;++Xr){var bo=Va[Xr];le(typeof bo=="function"&&bo._reglType==="textureCube","invalid cube map"),Xn=Xn||bo.width,le(bo.width===Xn&&bo.height===Xn,"invalid cube map shape"),tn.color[Xr]={target:Os,data:Va[Xr]}}for(Xr=0;Xr<6;++Xr){for(var Yo=0;Yo<Va.length;++Yo)tn.color[Yo].target=Os+Xr;Xr>0&&(tn.depth=Yr[0].depth,tn.stencil=Yr[0].stencil,tn.depthStencil=Yr[0].depthStencil),Yr[Xr]?Yr[Xr](tn):Yr[Xr]=Qt(tn)}return v(qr,{width:Xn,height:Xn,color:Va})}function pi(ti){var Xr,tn=ti|0;if(le(tn>0&&tn<=De.maxCubeMapSize,"invalid radius for cube fbo"),tn===qr.width)return qr;var Xn=qr.color;for(Xr=0;Xr<Xn.length;++Xr)Xn[Xr].resize(tn);for(Xr=0;Xr<6;++Xr)Yr[Xr].resize(tn);return qr.width=qr.height=tn,qr}return qr(yr),v(qr,{faces:Yr,resize:pi,_reglType:"framebufferCube",destroy:function(){Yr.forEach(function(ti){ti.destroy()})}})}function jr(){qt.cur=null,qt.next=null,qt.dirty=!0,Q(or).forEach(function(yr){yr.framebuffer=z.createFramebuffer(),Wt(yr)})}return v(qt,{getFramebuffer:function(yr){if(typeof yr=="function"&&yr._reglType==="framebuffer"){var Yr=yr._framebuffer;if(Yr instanceof Mr)return Yr}return null},create:Qt,createCube:yn,clear:function(){Q(or).forEach(Bn)},restore:jr})}var Te=5126,Ze=34962,xe=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Te,this.offset=0,this.stride=0,this.divisor=0}function dt(z,ue,De,Mt,rr,At,qt){for(var sr=De.maxAttributes,dr=new Array(sr),mr=0;mr<sr;++mr)dr[mr]=new qe;var Sr=0,Cr={},Ur={Record:qe,scope:{},state:dr,currentVAO:null,targetVAO:null,restore:br()?$r:function(){},createVAO:Bn,getVAO:Ut,destroyBuffer:vr,setVAO:br()?gr:Dr,clear:br()?or:function(){}};function vr(Wt){for(var Qt=0;Qt<dr.length;++Qt){var yn=dr[Qt];yn.buffer===Wt&&(z.disableVertexAttribArray(Qt),yn.buffer=null)}}function br(){return ue.oes_vertex_array_object}function rt(){return ue.angle_instanced_arrays}function Ut(Wt){return typeof Wt=="function"&&Wt._vao?Wt._vao:null}function gr(Wt){if(Wt!==Ur.currentVAO){var Qt=br();Wt?Qt.bindVertexArrayOES(Wt.vao):Qt.bindVertexArrayOES(null),Ur.currentVAO=Wt}}function Dr(Wt){if(Wt!==Ur.currentVAO){if(Wt)Wt.bindAttrs();else{for(var Qt=rt(),yn=0;yn<dr.length;++yn){var jr=dr[yn];jr.buffer?(z.enableVertexAttribArray(yn),jr.buffer.bind(),z.vertexAttribPointer(yn,jr.size,jr.type,jr.normalized,jr.stride,jr.offfset),Qt&&jr.divisor&&Qt.vertexAttribDivisorANGLE(yn,jr.divisor)):(z.disableVertexAttribArray(yn),z.vertexAttrib4f(yn,jr.x,jr.y,jr.z,jr.w))}qt.elements?z.bindBuffer(xe,qt.elements.buffer.buffer):z.bindBuffer(xe,null)}Ur.currentVAO=Wt}}function or(){Q(Cr).forEach(function(Wt){Wt.destroy()})}function Mr(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Wt=br();Wt?this.vao=Wt.createVertexArrayOES():this.vao=null,Cr[this.id]=this,this.buffers=[]}Mr.prototype.bindAttrs=function(){for(var Wt=rt(),Qt=this.attributes,yn=0;yn<Qt.length;++yn){var jr=Qt[yn];jr.buffer?(z.enableVertexAttribArray(yn),z.bindBuffer(Ze,jr.buffer.buffer),z.vertexAttribPointer(yn,jr.size,jr.type,jr.normalized,jr.stride,jr.offset),Wt&&jr.divisor&&Wt.vertexAttribDivisorANGLE(yn,jr.divisor)):(z.disableVertexAttribArray(yn),z.vertexAttrib4f(yn,jr.x,jr.y,jr.z,jr.w))}for(var yr=Qt.length;yr<sr;++yr)z.disableVertexAttribArray(yr);var Yr=At.getElements(this.elements);Yr?z.bindBuffer(xe,Yr.buffer.buffer):z.bindBuffer(xe,null)},Mr.prototype.refresh=function(){var Wt=br();Wt&&(Wt.bindVertexArrayOES(this.vao),this.bindAttrs(),Ur.currentVAO=null,Wt.bindVertexArrayOES(null))},Mr.prototype.destroy=function(){if(this.vao){var Wt=br();this===Ur.currentVAO&&(Ur.currentVAO=null,Wt.bindVertexArrayOES(null)),Wt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Cr[this.id]&&(delete Cr[this.id],Mt.vaoCount-=1)};function $r(){var Wt=br();Wt&&Q(Cr).forEach(function(Qt){Qt.refresh()})}function Bn(Wt){var Qt=new Mr;Mt.vaoCount+=1;function yn(jr){var yr;if(Array.isArray(jr))yr=jr,Qt.elements&&Qt.ownsElements&&Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1,Qt.offset=0,Qt.count=0,Qt.instances=-1,Qt.primitive=4;else{if(le(typeof jr=="object","invalid arguments for create vao"),le("attributes"in jr,"must specify attributes for vao"),jr.elements){var Yr=jr.elements;Qt.ownsElements?typeof Yr=="function"&&Yr._reglType==="elements"?(Qt.elements.destroy(),Qt.ownsElements=!1):(Qt.elements(Yr),Qt.ownsElements=!1):At.getElements(jr.elements)?(Qt.elements=jr.elements,Qt.ownsElements=!1):(Qt.elements=At.create(jr.elements),Qt.ownsElements=!0)}else Qt.elements=null,Qt.ownsElements=!1;yr=jr.attributes,Qt.offset=0,Qt.count=-1,Qt.instances=-1,Qt.primitive=4,Qt.elements&&(Qt.count=Qt.elements._elements.vertCount,Qt.primitive=Qt.elements._elements.primType),"offset"in jr&&(Qt.offset=jr.offset|0),"count"in jr&&(Qt.count=jr.count|0),"instances"in jr&&(Qt.instances=jr.instances|0),"primitive"in jr&&(le(jr.primitive in tr,"bad primitive type: "+jr.primitive),Qt.primitive=tr[jr.primitive]),le.optional(()=>{for(var no=Object.keys(jr),io=0;io<no.length;++io)le(Ve.indexOf(no[io])>=0,'invalid option for vao: "'+no[io]+'" valid options are '+Ve)}),le(Array.isArray(yr),"attributes must be an array")}le(yr.length<sr,"too many attributes"),le(yr.length>0,"must specify at least one attribute");var qr={},pi=Qt.attributes;pi.length=yr.length;for(var ti=0;ti<yr.length;++ti){var Xr=yr[ti],tn=pi[ti]=new qe,Xn=Xr.data||Xr;if(Array.isArray(Xn)||ge(Xn)||ds(Xn)){var oi;Qt.buffers[ti]&&(oi=Qt.buffers[ti],ge(Xn)&&oi._buffer.byteLength>=Xn.byteLength?oi.subdata(Xn):(oi.destroy(),Qt.buffers[ti]=null)),Qt.buffers[ti]||(oi=Qt.buffers[ti]=rr.create(Xr,Ze,!1,!0)),tn.buffer=rr.getBuffer(oi),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1,qr[ti]=1}else rr.getBuffer(Xr)?(tn.buffer=rr.getBuffer(Xr),tn.size=tn.buffer.dimension|0,tn.normalized=!1,tn.type=tn.buffer.dtype,tn.offset=0,tn.stride=0,tn.divisor=0,tn.state=1):rr.getBuffer(Xr.buffer)?(tn.buffer=rr.getBuffer(Xr.buffer),tn.size=(+Xr.size||tn.buffer.dimension)|0,tn.normalized=!!Xr.normalized||!1,"type"in Xr?(le.parameter(Xr.type,Js,"invalid buffer type"),tn.type=Js[Xr.type]):tn.type=tn.buffer.dtype,tn.offset=(Xr.offset||0)|0,tn.stride=(Xr.stride||0)|0,tn.divisor=(Xr.divisor||0)|0,tn.state=1,le(tn.size>=1&&tn.size<=4,"size must be between 1 and 4"),le(tn.offset>=0,"invalid offset"),le(tn.stride>=0&&tn.stride<=255,"stride must be between 0 and 255"),le(tn.divisor>=0,"divisor must be positive"),le(!tn.divisor||!!ue.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Xr?(le(ti>0,"first attribute must not be a constant"),tn.x=+Xr.x||0,tn.y=+Xr.y||0,tn.z=+Xr.z||0,tn.w=+Xr.w||0,tn.state=2):le(!1,"invalid attribute spec for location "+ti)}for(var Ri=0;Ri<Qt.buffers.length;++Ri)!qr[Ri]&&Qt.buffers[Ri]&&(Qt.buffers[Ri].destroy(),Qt.buffers[Ri]=null);return Qt.refresh(),yn}return yn.destroy=function(){for(var jr=0;jr<Qt.buffers.length;++jr)Qt.buffers[jr]&&Qt.buffers[jr].destroy();Qt.buffers.length=0,Qt.ownsElements&&(Qt.elements.destroy(),Qt.elements=null,Qt.ownsElements=!1),Qt.destroy()},yn._vao=Qt,yn._reglType="vao",yn(Wt)}return Ur}var Gt=35632,Dt=35633,zt=35718,pr=35721;function kr(z,ue,De,Mt){var rr={},At={};function qt(rt,Ut,gr,Dr){this.name=rt,this.id=Ut,this.location=gr,this.info=Dr}function sr(rt,Ut){for(var gr=0;gr<rt.length;++gr)if(rt[gr].id===Ut.id){rt[gr].location=Ut.location;return}rt.push(Ut)}function dr(rt,Ut,gr){var Dr=rt===Gt?rr:At,or=Dr[Ut];if(!or){var Mr=ue.str(Ut);or=z.createShader(rt),z.shaderSource(or,Mr),z.compileShader(or),le.shaderError(z,or,Mr,rt,gr),Dr[Ut]=or}return or}var mr={},Sr=[],Cr=0;function Ur(rt,Ut){this.id=Cr++,this.fragId=rt,this.vertId=Ut,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Mt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(rt,Ut,gr){var Dr,or,Mr=dr(Gt,rt.fragId),$r=dr(Dt,rt.vertId),Bn=rt.program=z.createProgram();if(z.attachShader(Bn,Mr),z.attachShader(Bn,$r),gr)for(Dr=0;Dr<gr.length;++Dr){var Wt=gr[Dr];z.bindAttribLocation(Bn,Wt[0],Wt[1])}z.linkProgram(Bn),le.linkError(z,Bn,ue.str(rt.fragId),ue.str(rt.vertId),Ut);var Qt=z.getProgramParameter(Bn,zt);Mt.profile&&(rt.stats.uniformsCount=Qt);var yn=rt.uniforms;for(Dr=0;Dr<Qt;++Dr)if(or=z.getActiveUniform(Bn,Dr),or)if(or.size>1)for(var jr=0;jr<or.size;++jr){var yr=or.name.replace("[0]","["+jr+"]");sr(yn,new qt(yr,ue.id(yr),z.getUniformLocation(Bn,yr),or))}else sr(yn,new qt(or.name,ue.id(or.name),z.getUniformLocation(Bn,or.name),or));var Yr=z.getProgramParameter(Bn,pr);Mt.profile&&(rt.stats.attributesCount=Yr);var qr=rt.attributes;for(Dr=0;Dr<Yr;++Dr)or=z.getActiveAttrib(Bn,Dr),or&&sr(qr,new qt(or.name,ue.id(or.name),z.getAttribLocation(Bn,or.name),or))}Mt.profile&&(De.getMaxUniformsCount=function(){var rt=0;return Sr.forEach(function(Ut){Ut.stats.uniformsCount>rt&&(rt=Ut.stats.uniformsCount)}),rt},De.getMaxAttributesCount=function(){var rt=0;return Sr.forEach(function(Ut){Ut.stats.attributesCount>rt&&(rt=Ut.stats.attributesCount)}),rt});function br(){rr={},At={};for(var rt=0;rt<Sr.length;++rt)vr(Sr[rt],null,Sr[rt].attributes.map(function(Ut){return[Ut.location,Ut.name]}))}return{clear:function(){var rt=z.deleteShader.bind(z);Q(rr).forEach(rt),rr={},Q(At).forEach(rt),At={},Sr.forEach(function(Ut){z.deleteProgram(Ut.program)}),Sr.length=0,mr={},De.shaderCount=0},program:function(rt,Ut,gr,Dr){le.command(rt>=0,"missing vertex shader",gr),le.command(Ut>=0,"missing fragment shader",gr);var or=mr[Ut];or||(or=mr[Ut]={});var Mr=or[rt];if(Mr&&(Mr.refCount++,!Dr))return Mr;var $r=new Ur(Ut,rt);return De.shaderCount++,vr($r,gr,Dr),Mr||(or[rt]=$r),Sr.push($r),v($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){z.deleteProgram($r.program);var Bn=Sr.indexOf($r);Sr.splice(Bn,1),De.shaderCount--}or[$r.vertId].refCount<=0&&(z.deleteShader(At[$r.vertId]),delete At[$r.vertId],delete mr[$r.fragId][$r.vertId]),Object.keys(mr[$r.fragId]).length||(z.deleteShader(rr[$r.fragId]),delete rr[$r.fragId],delete mr[$r.fragId])}})},restore:br,shader:dr,frag:-1,vert:-1}}var Ir=6408,Kr=5121,Dn=3333,kn=5126;function zn(z,ue,De,Mt,rr,At,qt){function sr(Sr){var Cr;ue.next===null?(le(rr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Cr=Kr):(le(ue.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Cr=ue.next.colorAttachments[0].texture._texture.type,le.optional(function(){At.oes_texture_float?(le(Cr===Kr||Cr===kn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Cr===kn&&le(qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):le(Cr===Kr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ur=0,vr=0,br=Mt.framebufferWidth,rt=Mt.framebufferHeight,Ut=null;ge(Sr)?Ut=Sr:Sr&&(le.type(Sr,"object","invalid arguments to regl.read()"),Ur=Sr.x|0,vr=Sr.y|0,le(Ur>=0&&Ur<Mt.framebufferWidth,"invalid x offset for regl.read"),le(vr>=0&&vr<Mt.framebufferHeight,"invalid y offset for regl.read"),br=(Sr.width||Mt.framebufferWidth-Ur)|0,rt=(Sr.height||Mt.framebufferHeight-vr)|0,Ut=Sr.data||null),Ut&&(Cr===Kr?le(Ut instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Cr===kn&&le(Ut instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),le(br>0&&br+Ur<=Mt.framebufferWidth,"invalid width for read pixels"),le(rt>0&&rt+vr<=Mt.framebufferHeight,"invalid height for read pixels"),De();var gr=br*rt*4;return Ut||(Cr===Kr?Ut=new Uint8Array(gr):Cr===kn&&(Ut=Ut||new Float32Array(gr))),le.isTypedArray(Ut,"data buffer for regl.read() must be a typedarray"),le(Ut.byteLength>=gr,"data buffer for regl.read() too small"),z.pixelStorei(Dn,4),z.readPixels(Ur,vr,br,rt,Ir,Cr,Ut),Ut}function dr(Sr){var Cr;return ue.setFBO({framebuffer:Sr.framebuffer},function(){Cr=sr(Sr)}),Cr}function mr(Sr){return!Sr||!("framebuffer"in Sr)?sr(Sr):dr(Sr)}return mr}function Pi(z){return Array.prototype.slice.call(z)}function en(z){return Pi(z).join("")}function $n(){var z=0,ue=[],De=[];function Mt(Cr){for(var Ur=0;Ur<De.length;++Ur)if(De[Ur]===Cr)return ue[Ur];var vr="g"+z++;return ue.push(vr),De.push(Cr),vr}function rr(){var Cr=[];function Ur(){Cr.push.apply(Cr,Pi(arguments))}var vr=[];function br(){var rt="v"+z++;return vr.push(rt),arguments.length>0&&(Cr.push(rt,"="),Cr.push.apply(Cr,Pi(arguments)),Cr.push(";")),rt}return v(Ur,{def:br,toString:function(){return en([vr.length>0?"var "+vr.join(",")+";":"",en(Cr)])}})}function At(){var Cr=rr(),Ur=rr(),vr=Cr.toString,br=Ur.toString;function rt(Ut,gr){Ur(Ut,gr,"=",Cr.def(Ut,gr),";")}return v(function(){Cr.apply(Cr,Pi(arguments))},{def:Cr.def,entry:Cr,exit:Ur,save:rt,set:function(Ut,gr,Dr){rt(Ut,gr),Cr(Ut,gr,"=",Dr,";")},toString:function(){return vr()+br()}})}function qt(){var Cr=en(arguments),Ur=At(),vr=At(),br=Ur.toString,rt=vr.toString;return v(Ur,{then:function(){return Ur.apply(Ur,Pi(arguments)),this},else:function(){return vr.apply(vr,Pi(arguments)),this},toString:function(){var Ut=rt();return Ut&&(Ut="else{"+Ut+"}"),en(["if(",Cr,"){",br(),"}",Ut])}})}var sr=rr(),dr={};function mr(Cr,Ur){var vr=[];function br(){var or="a"+vr.length;return vr.push(or),or}Ur=Ur||0;for(var rt=0;rt<Ur;++rt)br();var Ut=At(),gr=Ut.toString,Dr=dr[Cr]=v(Ut,{arg:br,toString:function(){return en(["function(",vr.join(),"){",gr(),"}"])}});return Dr}function Sr(){var Cr=['"use strict";',sr,"return {"];Object.keys(dr).forEach(function(rt){Cr.push('"',rt,'":',dr[rt].toString(),",")}),Cr.push("}");var Ur=en(Cr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",br=vr?Ie.Function.apply(null,ue.concat(Ur)):Function.apply(null,ue.concat(Ur));return br.apply(null,De)}return{global:sr,link:Mt,block:rr,proc:mr,scope:At,cond:qt,compile:Sr}}var ai="xyzw".split(""),Qn=5121,Vn=1,ui=2,Wn=0,jn=1,Sa=2,Ua=3,Bo=4,No=5,Xa=6,fo="dither",Ts="blend.enable",ss="blend.color",ou="blend.equation",Za="blend.func",su="depth.enable",Hs="depth.func",Dl="depth.range",fl="depth.mask",vu="colorMask",hl="cull.enable",cc="cull.face",uu="frontFace",Fl="lineWidth",lu="polygonOffset.enable",_o="polygonOffset.offset",Lu="sample.alpha",Yu="sample.enable",Du="sample.coverage",Yi="stencil.enable",Rs="stencil.mask",us="stencil.func",qu="stencil.opFront",Zc="stencil.opBack",Vc="scissor.enable",jc="scissor.box",Ws="viewport",Bl="profile",ks="framebuffer",pl="vert",Gc="frag",mu="elements",zo="primitive",Hc="count",Hf="offset",Nl="instances",Wf="vao",rp="Width",np="Height",fc=ks+rp,Wc=ks+np,Xf=Ws+rp,Gp=Ws+np,zl="drawingBuffer",Xc=zl+rp,ip=zl+np,bd=[Za,ou,us,qu,Zc,Du,Ws,jc,_o],Sf=34962,ap=34963,Ed=35632,Sd=35633,Cd=3553,Vr=34067,wd=2884,Zt=3042,Ad=3024,Io=2960,Yf=2929,op=3089,qf=32823,Mh=32926,Cf=32928,hc=5126,Kf=35664,pc=35665,Yc=35666,wf=5124,$f=35667,Ul=35668,Qf=35669,Jf=35670,eh=35671,qc=35672,dc=35673,Xs=35674,th=35675,rh=35676,nh=35678,ih=35680,Ph=4,dl=1028,vc=1029,Hp=2304,ah=2305,Wp=32775,mv=32776,Td=519,cu=7680,sp=0,Ih=1,Kc=32774,Fu=513,Xp=36160,Md=36064,vl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},$c=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ku={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},La={frag:Ed,vert:Sd},ml={cw:Hp,ccw:ah};function Oh(z){return Array.isArray(z)||ge(z)||ds(z)}function up(z){return z.sort(function(ue,De){return ue===Ws?-1:De===Ws?1:ue<De?-1:1})}function la(z,ue,De,Mt){this.thisDep=z,this.contextDep=ue,this.propDep=De,this.append=Mt}function gc(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function xo(z){return new la(!1,!1,!1,z)}function Ys(z,ue){var De=z.type;if(De===Wn){var Mt=z.data.length;return new la(!0,Mt>=1,Mt>=2,ue)}else if(De===Bo){var rr=z.data;return new la(rr.thisDep,rr.contextDep,rr.propDep,ue)}else{if(De===No)return new la(!1,!1,!1,ue);if(De===Xa){for(var At=!1,qt=!1,sr=!1,dr=0;dr<z.data.length;++dr){var mr=z.data[dr];if(mr.type===jn)sr=!0;else if(mr.type===Sa)qt=!0;else if(mr.type===Ua)At=!0;else if(mr.type===Wn){At=!0;var Sr=mr.data;Sr>=1&&(qt=!0),Sr>=2&&(sr=!0)}else mr.type===Bo&&(At=At||mr.data.thisDep,qt=qt||mr.data.contextDep,sr=sr||mr.data.propDep)}return new la(At,qt,sr,ue)}else return new la(De===Ua,De===Sa,De===jn,ue)}}var oh=new la(!1,!1,!1,function(){});function Yp(z,ue,De,Mt,rr,At,qt,sr,dr,mr,Sr,Cr,Ur,vr,br){var rt=mr.Record,Ut={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Ut.min=Wp,Ut.max=mv);var gr=De.angle_instanced_arrays,Dr=De.webgl_draw_buffers,or=De.oes_vertex_array_object,Mr={dirty:!0,profile:br.profile},$r={},Bn=[],Wt={},Qt={};function yn(_e){return _e.replace(".","_")}function jr(_e,ie,ze){var nt=yn(_e);Bn.push(_e),$r[nt]=Mr[nt]=!!ze,Wt[nt]=ie}function yr(_e,ie,ze){var nt=yn(_e);Bn.push(_e),Array.isArray(ze)?(Mr[nt]=ze.slice(),$r[nt]=ze.slice()):Mr[nt]=$r[nt]=ze,Qt[nt]=ie}jr(fo,Ad),jr(Ts,Zt),yr(ss,"blendColor",[0,0,0,0]),yr(ou,"blendEquationSeparate",[Kc,Kc]),yr(Za,"blendFuncSeparate",[Ih,sp,Ih,sp]),jr(su,Yf,!0),yr(Hs,"depthFunc",Fu),yr(Dl,"depthRange",[0,1]),yr(fl,"depthMask",!0),yr(vu,vu,[!0,!0,!0,!0]),jr(hl,wd),yr(cc,"cullFace",vc),yr(uu,uu,ah),yr(Fl,Fl,1),jr(lu,qf),yr(_o,"polygonOffset",[0,0]),jr(Lu,Mh),jr(Yu,Cf),yr(Du,"sampleCoverage",[1,!1]),jr(Yi,Io),yr(Rs,"stencilMask",-1),yr(us,"stencilFunc",[Td,0,-1]),yr(qu,"stencilOpSeparate",[dl,cu,cu,cu]),yr(Zc,"stencilOpSeparate",[vc,cu,cu,cu]),jr(Vc,op),yr(jc,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),yr(Ws,Ws,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var Yr={gl:z,context:Ur,strings:ue,next:$r,current:Mr,draw:Cr,elements:At,buffer:rr,shader:Sr,attributes:mr.state,vao:mr,uniforms:dr,framebuffer:sr,extensions:De,timer:vr,isBufferArgs:Oh},qr={primTypes:tr,compareFuncs:Ku,blendFuncs:vl,blendEquations:Ut,stencilOps:mc,glTypes:Js,orientationType:ml};le.optional(function(){Yr.isArrayLike=lo}),Dr&&(qr.backBuffer=[vc],qr.drawBuffer=Ue(Mt.maxDrawbuffers,function(_e){return _e===0?[0]:Ue(_e,function(ie){return Md+ie})}));var pi=0;function ti(){var _e=$n(),ie=_e.link,ze=_e.global;_e.id=pi++,_e.batchId="0";var nt=ie(Yr),St=_e.shared={props:"a0"};Object.keys(Yr).forEach(function(Ne){St[Ne]=ze.def(nt,".",Ne)}),le.optional(function(){_e.CHECK=ie(le),_e.commandStr=le.guessCommand(),_e.command=ie(_e.commandStr),_e.assert=function(Ne,Ee,it){Ne("if(!(",Ee,"))",this.CHECK,".commandRaise(",ie(it),",",this.command,");")},qr.invalidBlendCombinations=$c});var We=_e.next={},Le=_e.current={};Object.keys(Qt).forEach(function(Ne){Array.isArray(Mr[Ne])&&(We[Ne]=ze.def(St.next,".",Ne),Le[Ne]=ze.def(St.current,".",Ne))});var Qe=_e.constants={};Object.keys(qr).forEach(function(Ne){Qe[Ne]=ze.def(JSON.stringify(qr[Ne]))}),_e.invoke=function(Ne,Ee){switch(Ee.type){case Wn:var it=["this",St.context,St.props,_e.batchId];return Ne.def(ie(Ee.data),".call(",it.slice(0,Math.max(Ee.data.length+1,4)),")");case jn:return Ne.def(St.props,Ee.data);case Sa:return Ne.def(St.context,Ee.data);case Ua:return Ne.def("this",Ee.data);case Bo:return Ee.data.append(_e,Ne),Ee.data.ref;case No:return Ee.data.toString();case Xa:return Ee.data.map(function(yt){return _e.invoke(Ne,yt)})}},_e.attribCache={};var pe={};return _e.scopeAttrib=function(Ne){var Ee=ue.id(Ne);if(Ee in pe)return pe[Ee];var it=mr.scope[Ee];it||(it=mr.scope[Ee]=new rt);var yt=pe[Ee]=ie(it);return yt},_e}function Xr(_e){var ie=_e.static,ze=_e.dynamic,nt;if(Bl in ie){var St=!!ie[Bl];nt=xo(function(Le,Qe){return St}),nt.enable=St}else if(Bl in ze){var We=ze[Bl];nt=Ys(We,function(Le,Qe){return Le.invoke(Qe,We)})}return nt}function tn(_e,ie){var ze=_e.static,nt=_e.dynamic;if(ks in ze){var St=ze[ks];return St?(St=sr.getFramebuffer(St),le.command(St,"invalid framebuffer object"),xo(function(Le,Qe){var pe=Le.link(St),Ne=Le.shared;Qe.set(Ne.framebuffer,".next",pe);var Ee=Ne.context;return Qe.set(Ee,"."+fc,pe+".width"),Qe.set(Ee,"."+Wc,pe+".height"),pe})):xo(function(Le,Qe){var pe=Le.shared;Qe.set(pe.framebuffer,".next","null");var Ne=pe.context;return Qe.set(Ne,"."+fc,Ne+"."+Xc),Qe.set(Ne,"."+Wc,Ne+"."+ip),"null"})}else if(ks in nt){var We=nt[ks];return Ys(We,function(Le,Qe){var pe=Le.invoke(Qe,We),Ne=Le.shared,Ee=Ne.framebuffer,it=Qe.def(Ee,".getFramebuffer(",pe,")");le.optional(function(){Le.assert(Qe,"!"+pe+"||"+it,"invalid framebuffer object")}),Qe.set(Ee,".next",it);var yt=Ne.context;return Qe.set(yt,"."+fc,it+"?"+it+".width:"+yt+"."+Xc),Qe.set(yt,"."+Wc,it+"?"+it+".height:"+yt+"."+ip),it})}else return null}function Xn(_e,ie,ze){var nt=_e.static,St=_e.dynamic;function We(pe){if(pe in nt){var Ne=nt[pe];le.commandType(Ne,"object","invalid "+pe,ze.commandStr);var Ee=!0,it=Ne.x|0,yt=Ne.y|0,lr,Br;return"width"in Ne?(lr=Ne.width|0,le.command(lr>=0,"invalid "+pe,ze.commandStr)):Ee=!1,"height"in Ne?(Br=Ne.height|0,le.command(Br>=0,"invalid "+pe,ze.commandStr)):Ee=!1,new la(!Ee&&ie&&ie.thisDep,!Ee&&ie&&ie.contextDep,!Ee&&ie&&ie.propDep,function(Rr,Cn){var on=Rr.shared.context,bn=lr;"width"in Ne||(bn=Cn.def(on,".",fc,"-",it));var _n=Br;return"height"in Ne||(_n=Cn.def(on,".",Wc,"-",yt)),[it,yt,bn,_n]})}else if(pe in St){var Nr=St[pe],an=Ys(Nr,function(Rr,Cn){var on=Rr.invoke(Cn,Nr);le.optional(function(){Rr.assert(Cn,on+"&&typeof "+on+'==="object"',"invalid "+pe)});var bn=Rr.shared.context,_n=Cn.def(on,".x|0"),dn=Cn.def(on,".y|0"),Yn=Cn.def('"width" in ',on,"?",on,".width|0:","(",bn,".",fc,"-",_n,")"),xa=Cn.def('"height" in ',on,"?",on,".height|0:","(",bn,".",Wc,"-",dn,")");return le.optional(function(){Rr.assert(Cn,Yn+">=0&&"+xa+">=0","invalid "+pe)}),[_n,dn,Yn,xa]});return ie&&(an.thisDep=an.thisDep||ie.thisDep,an.contextDep=an.contextDep||ie.contextDep,an.propDep=an.propDep||ie.propDep),an}else return ie?new la(ie.thisDep,ie.contextDep,ie.propDep,function(Rr,Cn){var on=Rr.shared.context;return[0,0,Cn.def(on,".",fc),Cn.def(on,".",Wc)]}):null}var Le=We(Ws);if(Le){var Qe=Le;Le=new la(Le.thisDep,Le.contextDep,Le.propDep,function(pe,Ne){var Ee=Qe.append(pe,Ne),it=pe.shared.context;return Ne.set(it,"."+Xf,Ee[2]),Ne.set(it,"."+Gp,Ee[3]),Ee})}return{viewport:Le,scissor_box:We(jc)}}function oi(_e,ie){var ze=_e.static,nt=typeof ze[Gc]=="string"&&typeof ze[pl]=="string";if(nt){if(Object.keys(ie.dynamic).length>0)return null;var St=ie.static,We=Object.keys(St);if(We.length>0&&typeof St[We[0]]=="number"){for(var Le=[],Qe=0;Qe<We.length;++Qe)le(typeof St[We[Qe]]=="number","must specify all vertex attribute locations when using vaos"),Le.push([St[We[Qe]]|0,We[Qe]]);return Le}}return null}function Ri(_e,ie,ze){var nt=_e.static,St=_e.dynamic;function We(Ee){if(Ee in nt){var it=ue.id(nt[Ee]);le.optional(function(){Sr.shader(La[Ee],it,le.guessCommand())});var yt=xo(function(){return it});return yt.id=it,yt}else if(Ee in St){var lr=St[Ee];return Ys(lr,function(Br,Nr){var an=Br.invoke(Nr,lr),Rr=Nr.def(Br.shared.strings,".id(",an,")");return le.optional(function(){Nr(Br.shared.shader,".shader(",La[Ee],",",Rr,",",Br.command,");")}),Rr})}return null}var Le=We(Gc),Qe=We(pl),pe=null,Ne;return gc(Le)&&gc(Qe)?(pe=Sr.program(Qe.id,Le.id,null,ze),Ne=xo(function(Ee,it){return Ee.link(pe)})):Ne=new la(Le&&Le.thisDep||Qe&&Qe.thisDep,Le&&Le.contextDep||Qe&&Qe.contextDep,Le&&Le.propDep||Qe&&Qe.propDep,function(Ee,it){var yt=Ee.shared.shader,lr;Le?lr=Le.append(Ee,it):lr=it.def(yt,".",Gc);var Br;Qe?Br=Qe.append(Ee,it):Br=it.def(yt,".",pl);var Nr=yt+".program("+Br+","+lr;return le.optional(function(){Nr+=","+Ee.command}),it.def(Nr+")")}),{frag:Le,vert:Qe,progVar:Ne,program:pe}}function no(_e,ie){var ze=_e.static,nt=_e.dynamic,St={},We=!1;function Le(){if(Wf in ze){var Cn=ze[Wf];return Cn!==null&&mr.getVAO(Cn)===null&&(Cn=mr.createVAO(Cn)),We=!0,St.vao=Cn,xo(function(bn){var _n=mr.getVAO(Cn);return _n?bn.link(_n):"null"})}else if(Wf in nt){We=!0;var on=nt[Wf];return Ys(on,function(bn,_n){var dn=bn.invoke(_n,on);return _n.def(bn.shared.vao+".getVAO("+dn+")")})}return null}var Qe=Le(),pe=!1;function Ne(){if(mu in ze){var Cn=ze[mu];if(St.elements=Cn,Oh(Cn)){var on=St.elements=At.create(Cn,!0);Cn=At.getElements(on),pe=!0}else Cn&&(Cn=At.getElements(Cn),pe=!0,le.command(Cn,"invalid elements",ie.commandStr));var bn=xo(function(dn,Yn){if(Cn){var xa=dn.link(Cn);return dn.ELEMENTS=xa,xa}return dn.ELEMENTS=null,null});return bn.value=Cn,bn}else if(mu in nt){pe=!0;var _n=nt[mu];return Ys(_n,function(dn,Yn){var xa=dn.shared,ls=xa.isBufferArgs,za=xa.elements,da=dn.invoke(Yn,_n),Vl=Yn.def("null"),Ls=Yn.def(ls,"(",da,")"),_l=dn.cond(Ls).then(Vl,"=",za,".createStream(",da,");").else(Vl,"=",za,".getElements(",da,");");return le.optional(function(){dn.assert(_l.else,"!"+da+"||"+Vl,"invalid elements")}),Yn.entry(_l),Yn.exit(dn.cond(Ls).then(za,".destroyStream(",Vl,");")),dn.ELEMENTS=Vl,Vl})}else if(We)return new la(Qe.thisDep,Qe.contextDep,Qe.propDep,function(dn,Yn){return Yn.def(dn.shared.vao+".currentVAO?"+dn.shared.elements+".getElements("+dn.shared.vao+".currentVAO.elements):null")});return null}var Ee=Ne();function it(){if(zo in ze){var Cn=ze[zo];return St.primitive=Cn,le.commandParameter(Cn,tr,"invalid primitve",ie.commandStr),xo(function(bn,_n){return tr[Cn]})}else if(zo in nt){var on=nt[zo];return Ys(on,function(bn,_n){var dn=bn.constants.primTypes,Yn=bn.invoke(_n,on);return le.optional(function(){bn.assert(_n,Yn+" in "+dn,"invalid primitive, must be one of "+Object.keys(tr))}),_n.def(dn,"[",Yn,"]")})}else{if(pe)return gc(Ee)?Ee.value?xo(function(bn,_n){return _n.def(bn.ELEMENTS,".primType")}):xo(function(){return Ph}):new la(Ee.thisDep,Ee.contextDep,Ee.propDep,function(bn,_n){var dn=bn.ELEMENTS;return _n.def(dn,"?",dn,".primType:",Ph)});if(We)return new la(Qe.thisDep,Qe.contextDep,Qe.propDep,function(bn,_n){return _n.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+Ph)})}return null}function yt(Cn,on){if(Cn in ze){var bn=ze[Cn]|0;return on?St.offset=bn:St.instances=bn,le.command(!on||bn>=0,"invalid "+Cn,ie.commandStr),xo(function(dn,Yn){return on&&(dn.OFFSET=bn),bn})}else if(Cn in nt){var _n=nt[Cn];return Ys(_n,function(dn,Yn){var xa=dn.invoke(Yn,_n);return on&&(dn.OFFSET=xa,le.optional(function(){dn.assert(Yn,xa+">=0","invalid "+Cn)})),xa})}else if(on){if(pe)return xo(function(dn,Yn){return dn.OFFSET=0,0});if(We)return new la(Qe.thisDep,Qe.contextDep,Qe.propDep,function(dn,Yn){return Yn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.offset:0")})}else if(We)return new la(Qe.thisDep,Qe.contextDep,Qe.propDep,function(dn,Yn){return Yn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.instances:-1")});return null}var lr=yt(Hf,!0);function Br(){if(Hc in ze){var Cn=ze[Hc]|0;return St.count=Cn,le.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",ie.commandStr),xo(function(){return Cn})}else if(Hc in nt){var on=nt[Hc];return Ys(on,function(Yn,xa){var ls=Yn.invoke(xa,on);return le.optional(function(){Yn.assert(xa,"typeof "+ls+'==="number"&&'+ls+">=0&&"+ls+"===("+ls+"|0)","invalid vertex count")}),ls})}else if(pe)if(gc(Ee)){if(Ee)return lr?new la(lr.thisDep,lr.contextDep,lr.propDep,function(Yn,xa){var ls=xa.def(Yn.ELEMENTS,".vertCount-",Yn.OFFSET);return le.optional(function(){Yn.assert(xa,ls+">=0","invalid vertex offset/element buffer too small")}),ls}):xo(function(Yn,xa){return xa.def(Yn.ELEMENTS,".vertCount")});var bn=xo(function(){return-1});return le.optional(function(){bn.MISSING=!0}),bn}else{var _n=new la(Ee.thisDep||lr.thisDep,Ee.contextDep||lr.contextDep,Ee.propDep||lr.propDep,function(Yn,xa){var ls=Yn.ELEMENTS;return Yn.OFFSET?xa.def(ls,"?",ls,".vertCount-",Yn.OFFSET,":-1"):xa.def(ls,"?",ls,".vertCount:-1")});return le.optional(function(){_n.DYNAMIC=!0}),_n}else if(We){var dn=new la(Qe.thisDep,Qe.contextDep,Qe.propDep,function(Yn,xa){return xa.def(Yn.shared.vao,".currentVAO?",Yn.shared.vao,".currentVAO.count:-1")});return dn}return null}var Nr=it(),an=Br(),Rr=yt(Nl,!1);return{elements:Ee,primitive:Nr,count:an,instances:Rr,offset:lr,vao:Qe,vaoActive:We,elementsActive:pe,static:St}}function io(_e,ie){var ze=_e.static,nt=_e.dynamic,St={};return Bn.forEach(function(We){var Le=yn(We);function Qe(pe,Ne){if(We in ze){var Ee=pe(ze[We]);St[Le]=xo(function(){return Ee})}else if(We in nt){var it=nt[We];St[Le]=Ys(it,function(yt,lr){return Ne(yt,lr,yt.invoke(lr,it))})}}switch(We){case hl:case Ts:case fo:case Yi:case su:case Vc:case lu:case Lu:case Yu:case fl:return Qe(function(pe){return le.commandType(pe,"boolean",We,ie.commandStr),pe},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,"typeof "+Ee+'==="boolean"',"invalid flag "+We,pe.commandStr)}),Ee});case Hs:return Qe(function(pe){return le.commandParameter(pe,Ku,"invalid "+We,ie.commandStr),Ku[pe]},function(pe,Ne,Ee){var it=pe.constants.compareFuncs;return le.optional(function(){pe.assert(Ne,Ee+" in "+it,"invalid "+We+", must be one of "+Object.keys(Ku))}),Ne.def(it,"[",Ee,"]")});case Dl:return Qe(function(pe){return le.command(lo(pe)&&pe.length===2&&typeof pe[0]=="number"&&typeof pe[1]=="number"&&pe[0]<=pe[1],"depth range is 2d array",ie.commandStr),pe},function(pe,Ne,Ee){le.optional(function(){pe.assert(Ne,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===2&&typeof "+Ee+'[0]==="number"&&typeof '+Ee+'[1]==="number"&&'+Ee+"[0]<="+Ee+"[1]","depth range must be a 2d array")});var it=Ne.def("+",Ee,"[0]"),yt=Ne.def("+",Ee,"[1]");return[it,yt]});case Za:return Qe(function(pe){le.commandType(pe,"object","blend.func",ie.commandStr);var Ne="srcRGB"in pe?pe.srcRGB:pe.src,Ee="srcAlpha"in pe?pe.srcAlpha:pe.src,it="dstRGB"in pe?pe.dstRGB:pe.dst,yt="dstAlpha"in pe?pe.dstAlpha:pe.dst;return le.commandParameter(Ne,vl,Le+".srcRGB",ie.commandStr),le.commandParameter(Ee,vl,Le+".srcAlpha",ie.commandStr),le.commandParameter(it,vl,Le+".dstRGB",ie.commandStr),le.commandParameter(yt,vl,Le+".dstAlpha",ie.commandStr),le.command($c.indexOf(Ne+", "+it)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ne+", "+it+")",ie.commandStr),[vl[Ne],vl[it],vl[Ee],vl[yt]]},function(pe,Ne,Ee){var it=pe.constants.blendFuncs;le.optional(function(){pe.assert(Ne,Ee+"&&typeof "+Ee+'==="object"',"invalid blend func, must be an object")});function yt(on,bn){var _n=Ne.def('"',on,bn,'" in ',Ee,"?",Ee,".",on,bn,":",Ee,".",on);return le.optional(function(){pe.assert(Ne,_n+" in "+it,"invalid "+We+"."+on+bn+", must be one of "+Object.keys(vl))}),_n}var lr=yt("src","RGB"),Br=yt("dst","RGB");le.optional(function(){var on=pe.constants.invalidBlendCombinations;pe.assert(Ne,on+".indexOf("+lr+'+", "+'+Br+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Nr=Ne.def(it,"[",lr,"]"),an=Ne.def(it,"[",yt("src","Alpha"),"]"),Rr=Ne.def(it,"[",Br,"]"),Cn=Ne.def(it,"[",yt("dst","Alpha"),"]");return[Nr,Rr,an,Cn]});case ou:return Qe(function(pe){if(typeof pe=="string")return le.commandParameter(pe,Ut,"invalid "+We,ie.commandStr),[Ut[pe],Ut[pe]];if(typeof pe=="object")return le.commandParameter(pe.rgb,Ut,We+".rgb",ie.commandStr),le.commandParameter(pe.alpha,Ut,We+".alpha",ie.commandStr),[Ut[pe.rgb],Ut[pe.alpha]];le.commandRaise("invalid blend.equation",ie.commandStr)},function(pe,Ne,Ee){var it=pe.constants.blendEquations,yt=Ne.def(),lr=Ne.def(),Br=pe.cond("typeof ",Ee,'==="string"');return le.optional(function(){function Nr(an,Rr,Cn){pe.assert(an,Cn+" in "+it,"invalid "+Rr+", must be one of "+Object.keys(Ut))}Nr(Br.then,We,Ee),pe.assert(Br.else,Ee+"&&typeof "+Ee+'==="object"',"invalid "+We),Nr(Br.else,We+".rgb",Ee+".rgb"),Nr(Br.else,We+".alpha",Ee+".alpha")}),Br.then(yt,"=",lr,"=",it,"[",Ee,"];"),Br.else(yt,"=",it,"[",Ee,".rgb];",lr,"=",it,"[",Ee,".alpha];"),Ne(Br),[yt,lr]});case ss:return Qe(function(pe){return le.command(lo(pe)&&pe.length===4,"blend.color must be a 4d array",ie.commandStr),Ue(4,function(Ne){return+pe[Ne]})},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","blend.color must be a 4d array")}),Ue(4,function(it){return Ne.def("+",Ee,"[",it,"]")})});case Rs:return Qe(function(pe){return le.commandType(pe,"number",Le,ie.commandStr),pe|0},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,"typeof "+Ee+'==="number"',"invalid stencil.mask")}),Ne.def(Ee,"|0")});case us:return Qe(function(pe){le.commandType(pe,"object",Le,ie.commandStr);var Ne=pe.cmp||"keep",Ee=pe.ref||0,it="mask"in pe?pe.mask:-1;return le.commandParameter(Ne,Ku,We+".cmp",ie.commandStr),le.commandType(Ee,"number",We+".ref",ie.commandStr),le.commandType(it,"number",We+".mask",ie.commandStr),[Ku[Ne],Ee,it]},function(pe,Ne,Ee){var it=pe.constants.compareFuncs;le.optional(function(){function Nr(){pe.assert(Ne,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Nr(Ee+"&&typeof ",Ee,'==="object"'),Nr('!("cmp" in ',Ee,")||(",Ee,".cmp in ",it,")")});var yt=Ne.def('"cmp" in ',Ee,"?",it,"[",Ee,".cmp]",":",cu),lr=Ne.def(Ee,".ref|0"),Br=Ne.def('"mask" in ',Ee,"?",Ee,".mask|0:-1");return[yt,lr,Br]});case qu:case Zc:return Qe(function(pe){le.commandType(pe,"object",Le,ie.commandStr);var Ne=pe.fail||"keep",Ee=pe.zfail||"keep",it=pe.zpass||"keep";return le.commandParameter(Ne,mc,We+".fail",ie.commandStr),le.commandParameter(Ee,mc,We+".zfail",ie.commandStr),le.commandParameter(it,mc,We+".zpass",ie.commandStr),[We===Zc?vc:dl,mc[Ne],mc[Ee],mc[it]]},function(pe,Ne,Ee){var it=pe.constants.stencilOps;le.optional(function(){pe.assert(Ne,Ee+"&&typeof "+Ee+'==="object"',"invalid "+We)});function yt(lr){return le.optional(function(){pe.assert(Ne,'!("'+lr+'" in '+Ee+")||("+Ee+"."+lr+" in "+it+")","invalid "+We+"."+lr+", must be one of "+Object.keys(mc))}),Ne.def('"',lr,'" in ',Ee,"?",it,"[",Ee,".",lr,"]:",cu)}return[We===Zc?vc:dl,yt("fail"),yt("zfail"),yt("zpass")]});case _o:return Qe(function(pe){le.commandType(pe,"object",Le,ie.commandStr);var Ne=pe.factor|0,Ee=pe.units|0;return le.commandType(Ne,"number",Le+".factor",ie.commandStr),le.commandType(Ee,"number",Le+".units",ie.commandStr),[Ne,Ee]},function(pe,Ne,Ee){le.optional(function(){pe.assert(Ne,Ee+"&&typeof "+Ee+'==="object"',"invalid "+We)});var it=Ne.def(Ee,".factor|0"),yt=Ne.def(Ee,".units|0");return[it,yt]});case cc:return Qe(function(pe){var Ne=0;return pe==="front"?Ne=dl:pe==="back"&&(Ne=vc),le.command(!!Ne,Le,ie.commandStr),Ne},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,Ee+'==="front"||'+Ee+'==="back"',"invalid cull.face")}),Ne.def(Ee,'==="front"?',dl,":",vc)});case Fl:return Qe(function(pe){return le.command(typeof pe=="number"&&pe>=Mt.lineWidthDims[0]&&pe<=Mt.lineWidthDims[1],"invalid line width, must be a positive number between "+Mt.lineWidthDims[0]+" and "+Mt.lineWidthDims[1],ie.commandStr),pe},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,"typeof "+Ee+'==="number"&&'+Ee+">="+Mt.lineWidthDims[0]+"&&"+Ee+"<="+Mt.lineWidthDims[1],"invalid line width")}),Ee});case uu:return Qe(function(pe){return le.commandParameter(pe,ml,Le,ie.commandStr),ml[pe]},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,Ee+'==="cw"||'+Ee+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ne.def(Ee+'==="cw"?'+Hp+":"+ah)});case vu:return Qe(function(pe){return le.command(lo(pe)&&pe.length===4,"color.mask must be length 4 array",ie.commandStr),pe.map(function(Ne){return!!Ne})},function(pe,Ne,Ee){return le.optional(function(){pe.assert(Ne,pe.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","invalid color.mask")}),Ue(4,function(it){return"!!"+Ee+"["+it+"]"})});case Du:return Qe(function(pe){le.command(typeof pe=="object"&&pe,Le,ie.commandStr);var Ne="value"in pe?pe.value:1,Ee=!!pe.invert;return le.command(typeof Ne=="number"&&Ne>=0&&Ne<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[Ne,Ee]},function(pe,Ne,Ee){le.optional(function(){pe.assert(Ne,Ee+"&&typeof "+Ee+'==="object"',"invalid sample.coverage")});var it=Ne.def('"value" in ',Ee,"?+",Ee,".value:1"),yt=Ne.def("!!",Ee,".invert");return[it,yt]})}}),St}function Ii(_e,ie){var ze=_e.static,nt=_e.dynamic,St={};return Object.keys(ze).forEach(function(We){var Le=ze[We],Qe;if(typeof Le=="number"||typeof Le=="boolean")Qe=xo(function(){return Le});else if(typeof Le=="function"){var pe=Le._reglType;pe==="texture2d"||pe==="textureCube"?Qe=xo(function(Ne){return Ne.link(Le)}):pe==="framebuffer"||pe==="framebufferCube"?(le.command(Le.color.length>0,'missing color attachment for framebuffer sent to uniform "'+We+'"',ie.commandStr),Qe=xo(function(Ne){return Ne.link(Le.color[0])})):le.commandRaise('invalid data for uniform "'+We+'"',ie.commandStr)}else lo(Le)?Qe=xo(function(Ne){var Ee=Ne.global.def("[",Ue(Le.length,function(it){return le.command(typeof Le[it]=="number"||typeof Le[it]=="boolean","invalid uniform "+We,Ne.commandStr),Le[it]}),"]");return Ee}):le.commandRaise('invalid or missing data for uniform "'+We+'"',ie.commandStr);Qe.value=Le,St[We]=Qe}),Object.keys(nt).forEach(function(We){var Le=nt[We];St[We]=Ys(Le,function(Qe,pe){return Qe.invoke(pe,Le)})}),St}function Qo(_e,ie){var ze=_e.static,nt=_e.dynamic,St={};return Object.keys(ze).forEach(function(We){var Le=ze[We],Qe=ue.id(We),pe=new rt;if(Oh(Le))pe.state=Vn,pe.buffer=rr.getBuffer(rr.create(Le,Sf,!1,!0)),pe.type=0;else{var Ne=rr.getBuffer(Le);if(Ne)pe.state=Vn,pe.buffer=Ne,pe.type=0;else if(le.command(typeof Le=="object"&&Le,"invalid data for attribute "+We,ie.commandStr),"constant"in Le){var Ee=Le.constant;pe.buffer="null",pe.state=ui,typeof Ee=="number"?pe.x=Ee:(le.command(lo(Ee)&&Ee.length>0&&Ee.length<=4,"invalid constant for attribute "+We,ie.commandStr),ai.forEach(function(Rr,Cn){Cn<Ee.length&&(pe[Rr]=Ee[Cn])}))}else{Oh(Le.buffer)?Ne=rr.getBuffer(rr.create(Le.buffer,Sf,!1,!0)):Ne=rr.getBuffer(Le.buffer),le.command(!!Ne,'missing buffer for attribute "'+We+'"',ie.commandStr);var it=Le.offset|0;le.command(it>=0,'invalid offset for attribute "'+We+'"',ie.commandStr);var yt=Le.stride|0;le.command(yt>=0&&yt<256,'invalid stride for attribute "'+We+'", must be integer betweeen [0, 255]',ie.commandStr);var lr=Le.size|0;le.command(!("size"in Le)||lr>0&&lr<=4,'invalid size for attribute "'+We+'", must be 1,2,3,4',ie.commandStr);var Br=!!Le.normalized,Nr=0;"type"in Le&&(le.commandParameter(Le.type,Js,"invalid type for attribute "+We,ie.commandStr),Nr=Js[Le.type]);var an=Le.divisor|0;le.optional(function(){"divisor"in Le&&(le.command(an===0||gr,'cannot specify divisor for attribute "'+We+'", instancing not supported',ie.commandStr),le.command(an>=0,'invalid divisor for attribute "'+We+'"',ie.commandStr));var Rr=ie.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Le).forEach(function(on){le.command(Cn.indexOf(on)>=0,'unknown parameter "'+on+'" for attribute pointer "'+We+'" (valid parameters are '+Cn+")",Rr)})}),pe.buffer=Ne,pe.state=Vn,pe.size=lr,pe.normalized=Br,pe.type=Nr||Ne.dtype,pe.offset=it,pe.stride=yt,pe.divisor=an}}St[We]=xo(function(Rr,Cn){var on=Rr.attribCache;if(Qe in on)return on[Qe];var bn={isStream:!1};return Object.keys(pe).forEach(function(_n){bn[_n]=pe[_n]}),pe.buffer&&(bn.buffer=Rr.link(pe.buffer),bn.type=bn.type||bn.buffer+".dtype"),on[Qe]=bn,bn})}),Object.keys(nt).forEach(function(We){var Le=nt[We];function Qe(pe,Ne){var Ee=pe.invoke(Ne,Le),it=pe.shared,yt=pe.constants,lr=it.isBufferArgs,Br=it.buffer;le.optional(function(){pe.assert(Ne,Ee+"&&(typeof "+Ee+'==="object"||typeof '+Ee+'==="function")&&('+lr+"("+Ee+")||"+Br+".getBuffer("+Ee+")||"+Br+".getBuffer("+Ee+".buffer)||"+lr+"("+Ee+'.buffer)||("constant" in '+Ee+"&&(typeof "+Ee+'.constant==="number"||'+it.isArrayLike+"("+Ee+".constant))))",'invalid dynamic attribute "'+We+'"')});var Nr={isStream:Ne.def(!1)},an=new rt;an.state=Vn,Object.keys(an).forEach(function(bn){Nr[bn]=Ne.def(""+an[bn])});var Rr=Nr.buffer,Cn=Nr.type;Ne("if(",lr,"(",Ee,")){",Nr.isStream,"=true;",Rr,"=",Br,".createStream(",Sf,",",Ee,");",Cn,"=",Rr,".dtype;","}else{",Rr,"=",Br,".getBuffer(",Ee,");","if(",Rr,"){",Cn,"=",Rr,".dtype;",'}else if("constant" in ',Ee,"){",Nr.state,"=",ui,";","if(typeof "+Ee+'.constant === "number"){',Nr[ai[0]],"=",Ee,".constant;",ai.slice(1).map(function(bn){return Nr[bn]}).join("="),"=0;","}else{",ai.map(function(bn,_n){return Nr[bn]+"="+Ee+".constant.length>"+_n+"?"+Ee+".constant["+_n+"]:0;"}).join(""),"}}else{","if(",lr,"(",Ee,".buffer)){",Rr,"=",Br,".createStream(",Sf,",",Ee,".buffer);","}else{",Rr,"=",Br,".getBuffer(",Ee,".buffer);","}",Cn,'="type" in ',Ee,"?",yt.glTypes,"[",Ee,".type]:",Rr,".dtype;",Nr.normalized,"=!!",Ee,".normalized;");function on(bn){Ne(Nr[bn],"=",Ee,".",bn,"|0;")}return on("size"),on("offset"),on("stride"),on("divisor"),Ne("}}"),Ne.exit("if(",Nr.isStream,"){",Br,".destroyStream(",Rr,");","}"),Nr}St[We]=Ys(Le,Qe)}),St}function Va(_e){var ie=_e.static,ze=_e.dynamic,nt={};return Object.keys(ie).forEach(function(St){var We=ie[St];nt[St]=xo(function(Le,Qe){return typeof We=="number"||typeof We=="boolean"?""+We:Le.link(We)})}),Object.keys(ze).forEach(function(St){var We=ze[St];nt[St]=Ys(We,function(Le,Qe){return Le.invoke(Qe,We)})}),nt}function Uo(_e,ie,ze,nt,St){var We=_e.static,Le=_e.dynamic;le.optional(function(){var on=[ks,pl,Gc,mu,zo,Hf,Hc,Nl,Bl,Wf].concat(Bn);function bn(_n){Object.keys(_n).forEach(function(dn){le.command(on.indexOf(dn)>=0,'unknown parameter "'+dn+'"',St.commandStr)})}bn(We),bn(Le)});var Qe=oi(_e,ie),pe=tn(_e,St),Ne=Xn(_e,pe,St),Ee=no(_e,St),it=io(_e,St),yt=Ri(_e,St,Qe);function lr(on){var bn=Ne[on];bn&&(it[on]=bn)}lr(Ws),lr(yn(jc));var Br=Object.keys(it).length>0,Nr={framebuffer:pe,draw:Ee,shader:yt,state:it,dirty:Br,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Nr.profile=Xr(_e,St),Nr.uniforms=Ii(ze,St),Nr.drawVAO=Nr.scopeVAO=Ee.vao,!Nr.drawVAO&&yt.program&&!Qe&&De.angle_instanced_arrays&&Ee.static.elements){var an=!0,Rr=yt.program.attributes.map(function(on){var bn=ie.static[on];return an=an&&!!bn,bn});if(an&&Rr.length>0){var Cn=mr.getVAO(mr.createVAO({attributes:Rr,elements:Ee.static.elements}));Nr.drawVAO=new la(null,null,null,function(on,bn){return on.link(Cn)}),Nr.useVAO=!0}}return Qe?Nr.useVAO=!0:Nr.attributes=Qo(ie,St),Nr.context=Va(nt,St),Nr}function bo(_e,ie,ze){var nt=_e.shared,St=nt.context,We=_e.scope();Object.keys(ze).forEach(function(Le){ie.save(St,"."+Le);var Qe=ze[Le],pe=Qe.append(_e,ie);Array.isArray(pe)?We(St,".",Le,"=[",pe.join(),"];"):We(St,".",Le,"=",pe,";")}),ie(We)}function Yo(_e,ie,ze,nt){var St=_e.shared,We=St.gl,Le=St.framebuffer,Qe;Dr&&(Qe=ie.def(St.extensions,".webgl_draw_buffers"));var pe=_e.constants,Ne=pe.drawBuffer,Ee=pe.backBuffer,it;ze?it=ze.append(_e,ie):it=ie.def(Le,".next"),nt||ie("if(",it,"!==",Le,".cur){"),ie("if(",it,"){",We,".bindFramebuffer(",Xp,",",it,".framebuffer);"),Dr&&ie(Qe,".drawBuffersWEBGL(",Ne,"[",it,".colorAttachments.length]);"),ie("}else{",We,".bindFramebuffer(",Xp,",null);"),Dr&&ie(Qe,".drawBuffersWEBGL(",Ee,");"),ie("}",Le,".cur=",it,";"),nt||ie("}")}function Oo(_e,ie,ze){var nt=_e.shared,St=nt.gl,We=_e.current,Le=_e.next,Qe=nt.current,pe=nt.next,Ne=_e.cond(Qe,".dirty");Bn.forEach(function(Ee){var it=yn(Ee);if(!(it in ze.state)){var yt,lr;if(it in Le){yt=Le[it],lr=We[it];var Br=Ue(Mr[it].length,function(an){return Ne.def(yt,"[",an,"]")});Ne(_e.cond(Br.map(function(an,Rr){return an+"!=="+lr+"["+Rr+"]"}).join("||")).then(St,".",Qt[it],"(",Br,");",Br.map(function(an,Rr){return lr+"["+Rr+"]="+an}).join(";"),";"))}else{yt=Ne.def(pe,".",it);var Nr=_e.cond(yt,"!==",Qe,".",it);Ne(Nr),it in Wt?Nr(_e.cond(yt).then(St,".enable(",Wt[it],");").else(St,".disable(",Wt[it],");"),Qe,".",it,"=",yt,";"):Nr(St,".",Qt[it],"(",yt,");",Qe,".",it,"=",yt,";")}}}),Object.keys(ze.state).length===0&&Ne(Qe,".dirty=false;"),ie(Ne)}function Jo(_e,ie,ze,nt){var St=_e.shared,We=_e.current,Le=St.current,Qe=St.gl;up(Object.keys(ze)).forEach(function(pe){var Ne=ze[pe];if(!(nt&&!nt(Ne))){var Ee=Ne.append(_e,ie);if(Wt[pe]){var it=Wt[pe];gc(Ne)?Ee?ie(Qe,".enable(",it,");"):ie(Qe,".disable(",it,");"):ie(_e.cond(Ee).then(Qe,".enable(",it,");").else(Qe,".disable(",it,");")),ie(Le,".",pe,"=",Ee,";")}else if(lo(Ee)){var yt=We[pe];ie(Qe,".",Qt[pe],"(",Ee,");",Ee.map(function(lr,Br){return yt+"["+Br+"]="+lr}).join(";"),";")}else ie(Qe,".",Qt[pe],"(",Ee,");",Le,".",pe,"=",Ee,";")}})}function ao(_e,ie){gr&&(_e.instancing=ie.def(_e.shared.extensions,".angle_instanced_arrays"))}function li(_e,ie,ze,nt,St){var We=_e.shared,Le=_e.stats,Qe=We.current,pe=We.timer,Ne=ze.profile;function Ee(){var on=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return on||typeof performance=="undefined"?"Date.now()":"performance.now()"}var it,yt;function lr(on){it=ie.def(),on(it,"=",Ee(),";"),typeof St=="string"?on(Le,".count+=",St,";"):on(Le,".count++;"),vr&&(nt?(yt=ie.def(),on(yt,"=",pe,".getNumPendingQueries();")):on(pe,".beginQuery(",Le,");"))}function Br(on){on(Le,".cpuTime+=",Ee(),"-",it,";"),vr&&(nt?on(pe,".pushScopeStats(",yt,",",pe,".getNumPendingQueries(),",Le,");"):on(pe,".endQuery();"))}function Nr(on){var bn=ie.def(Qe,".profile");ie(Qe,".profile=",on,";"),ie.exit(Qe,".profile=",bn,";")}var an;if(Ne){if(gc(Ne)){Ne.enable?(lr(ie),Br(ie.exit),Nr("true")):Nr("false");return}an=Ne.append(_e,ie),Nr(an)}else an=ie.def(Qe,".profile");var Rr=_e.block();lr(Rr),ie("if(",an,"){",Rr,"}");var Cn=_e.block();Br(Cn),ie.exit("if(",an,"){",Cn,"}")}function Zo(_e,ie,ze,nt,St){var We=_e.shared;function Le(pe){switch(pe){case Kf:case $f:case eh:return 2;case pc:case Ul:case qc:return 3;case Yc:case Qf:case dc:return 4;default:return 1}}function Qe(pe,Ne,Ee){var it=We.gl,yt=ie.def(pe,".location"),lr=ie.def(We.attributes,"[",yt,"]"),Br=Ee.state,Nr=Ee.buffer,an=[Ee.x,Ee.y,Ee.z,Ee.w],Rr=["buffer","normalized","offset","stride"];function Cn(){ie("if(!",lr,".buffer){",it,".enableVertexAttribArray(",yt,");}");var bn=Ee.type,_n;if(Ee.size?_n=ie.def(Ee.size,"||",Ne):_n=Ne,ie("if(",lr,".type!==",bn,"||",lr,".size!==",_n,"||",Rr.map(function(Yn){return lr+"."+Yn+"!=="+Ee[Yn]}).join("||"),"){",it,".bindBuffer(",Sf,",",Nr,".buffer);",it,".vertexAttribPointer(",[yt,_n,bn,Ee.normalized,Ee.stride,Ee.offset],");",lr,".type=",bn,";",lr,".size=",_n,";",Rr.map(function(Yn){return lr+"."+Yn+"="+Ee[Yn]+";"}).join(""),"}"),gr){var dn=Ee.divisor;ie("if(",lr,".divisor!==",dn,"){",_e.instancing,".vertexAttribDivisorANGLE(",[yt,dn],");",lr,".divisor=",dn,";}")}}function on(){ie("if(",lr,".buffer){",it,".disableVertexAttribArray(",yt,");",lr,".buffer=null;","}if(",ai.map(function(bn,_n){return lr+"."+bn+"!=="+an[_n]}).join("||"),"){",it,".vertexAttrib4f(",yt,",",an,");",ai.map(function(bn,_n){return lr+"."+bn+"="+an[_n]+";"}).join(""),"}")}Br===Vn?Cn():Br===ui?on():(ie("if(",Br,"===",Vn,"){"),Cn(),ie("}else{"),on(),ie("}"))}nt.forEach(function(pe){var Ne=pe.name,Ee=ze.attributes[Ne],it;if(Ee){if(!St(Ee))return;it=Ee.append(_e,ie)}else{if(!St(oh))return;var yt=_e.scopeAttrib(Ne);le.optional(function(){_e.assert(ie,yt+".state","missing attribute "+Ne)}),it={},Object.keys(new rt).forEach(function(lr){it[lr]=ie.def(yt,".",lr)})}Qe(_e.link(pe),Le(pe.info.type),it)})}function qi(_e,ie,ze,nt,St,We){for(var Le=_e.shared,Qe=Le.gl,pe,Ne=0;Ne<nt.length;++Ne){var Ee=nt[Ne],it=Ee.name,yt=Ee.info.type,lr=ze.uniforms[it],Br=_e.link(Ee),Nr=Br+".location",an;if(lr){if(!St(lr))continue;if(gc(lr)){var Rr=lr.value;if(le.command(Rr!==null&&typeof Rr!="undefined",'missing uniform "'+it+'"',_e.commandStr),yt===nh||yt===ih){le.command(typeof Rr=="function"&&(yt===nh&&(Rr._reglType==="texture2d"||Rr._reglType==="framebuffer")||yt===ih&&(Rr._reglType==="textureCube"||Rr._reglType==="framebufferCube")),"invalid texture for uniform "+it,_e.commandStr);var Cn=_e.link(Rr._texture||Rr.color[0]._texture);ie(Qe,".uniform1i(",Nr,",",Cn+".bind());"),ie.exit(Cn,".unbind();")}else if(yt===Xs||yt===th||yt===rh){le.optional(function(){le.command(lo(Rr),"invalid matrix for uniform "+it,_e.commandStr),le.command(yt===Xs&&Rr.length===4||yt===th&&Rr.length===9||yt===rh&&Rr.length===16,"invalid length for matrix uniform "+it,_e.commandStr)});var on=_e.global.def("new Float32Array(["+Array.prototype.slice.call(Rr)+"])"),bn=2;yt===th?bn=3:yt===rh&&(bn=4),ie(Qe,".uniformMatrix",bn,"fv(",Nr,",false,",on,");")}else{switch(yt){case hc:le.commandType(Rr,"number","uniform "+it,_e.commandStr),pe="1f";break;case Kf:le.command(lo(Rr)&&Rr.length===2,"uniform "+it,_e.commandStr),pe="2f";break;case pc:le.command(lo(Rr)&&Rr.length===3,"uniform "+it,_e.commandStr),pe="3f";break;case Yc:le.command(lo(Rr)&&Rr.length===4,"uniform "+it,_e.commandStr),pe="4f";break;case Jf:le.commandType(Rr,"boolean","uniform "+it,_e.commandStr),pe="1i";break;case wf:le.commandType(Rr,"number","uniform "+it,_e.commandStr),pe="1i";break;case eh:le.command(lo(Rr)&&Rr.length===2,"uniform "+it,_e.commandStr),pe="2i";break;case $f:le.command(lo(Rr)&&Rr.length===2,"uniform "+it,_e.commandStr),pe="2i";break;case qc:le.command(lo(Rr)&&Rr.length===3,"uniform "+it,_e.commandStr),pe="3i";break;case Ul:le.command(lo(Rr)&&Rr.length===3,"uniform "+it,_e.commandStr),pe="3i";break;case dc:le.command(lo(Rr)&&Rr.length===4,"uniform "+it,_e.commandStr),pe="4i";break;case Qf:le.command(lo(Rr)&&Rr.length===4,"uniform "+it,_e.commandStr),pe="4i";break}ie(Qe,".uniform",pe,"(",Nr,",",lo(Rr)?Array.prototype.slice.call(Rr):Rr,");")}continue}else an=lr.append(_e,ie)}else{if(!St(oh))continue;an=ie.def(Le.uniforms,"[",ue.id(it),"]")}yt===nh?(le(!Array.isArray(an),"must specify a scalar prop for textures"),ie("if(",an,"&&",an,'._reglType==="framebuffer"){',an,"=",an,".color[0];","}")):yt===ih&&(le(!Array.isArray(an),"must specify a scalar prop for cube maps"),ie("if(",an,"&&",an,'._reglType==="framebufferCube"){',an,"=",an,".color[0];","}")),le.optional(function(){function Ls(qs,yc){_e.assert(ie,qs,'bad data or missing for uniform "'+it+'".  '+yc)}function _l(qs){le(!Array.isArray(an),"must not specify an array type for uniform"),Ls("typeof "+an+'==="'+qs+'"',"invalid type, expected "+qs)}function Bu(qs,yc){Array.isArray(an)?le(an.length===qs,"must have length "+qs):Ls(Le.isArrayLike+"("+an+")&&"+an+".length==="+qs,"invalid vector, should have length "+qs,_e.commandStr)}function qp(qs){le(!Array.isArray(an),"must not specify a value type"),Ls("typeof "+an+'==="function"&&'+an+'._reglType==="texture'+(qs===Cd?"2d":"Cube")+'"',"invalid texture type",_e.commandStr)}switch(yt){case wf:_l("number");break;case $f:Bu(2,"number");break;case Ul:Bu(3,"number");break;case Qf:Bu(4,"number");break;case hc:_l("number");break;case Kf:Bu(2,"number");break;case pc:Bu(3,"number");break;case Yc:Bu(4,"number");break;case Jf:_l("boolean");break;case eh:Bu(2,"boolean");break;case qc:Bu(3,"boolean");break;case dc:Bu(4,"boolean");break;case Xs:Bu(4,"number");break;case th:Bu(9,"number");break;case rh:Bu(16,"number");break;case nh:qp(Cd);break;case ih:qp(Vr);break}});var _n=1;switch(yt){case nh:case ih:var dn=ie.def(an,"._texture");ie(Qe,".uniform1i(",Nr,",",dn,".bind());"),ie.exit(dn,".unbind();");continue;case wf:case Jf:pe="1i";break;case $f:case eh:pe="2i",_n=2;break;case Ul:case qc:pe="3i",_n=3;break;case Qf:case dc:pe="4i",_n=4;break;case hc:pe="1f";break;case Kf:pe="2f",_n=2;break;case pc:pe="3f",_n=3;break;case Yc:pe="4f",_n=4;break;case Xs:pe="Matrix2fv";break;case th:pe="Matrix3fv";break;case rh:pe="Matrix4fv";break}if(pe.charAt(0)==="M"){ie(Qe,".uniform",pe,"(",Nr,",");var Yn=Math.pow(yt-Xs+2,2),xa=_e.global.def("new Float32Array(",Yn,")");Array.isArray(an)?ie("false,(",Ue(Yn,function(Ls){return xa+"["+Ls+"]="+an[Ls]}),",",xa,")"):ie("false,(Array.isArray(",an,")||",an," instanceof Float32Array)?",an,":(",Ue(Yn,function(Ls){return xa+"["+Ls+"]="+an+"["+Ls+"]"}),",",xa,")"),ie(");")}else if(_n>1){for(var ls=[],za=[],da=0;da<_n;++da)Array.isArray(an)?za.push(an[da]):za.push(ie.def(an+"["+da+"]")),We&&ls.push(ie.def());We&&ie("if(!",_e.batchId,"||",ls.map(function(Ls,_l){return Ls+"!=="+za[_l]}).join("||"),"){",ls.map(function(Ls,_l){return Ls+"="+za[_l]+";"}).join("")),ie(Qe,".uniform",pe,"(",Nr,",",za.join(","),");"),We&&ie("}")}else{if(le(!Array.isArray(an),"uniform value must not be an array"),We){var Vl=ie.def();ie("if(!",_e.batchId,"||",Vl,"!==",an,"){",Vl,"=",an,";")}ie(Qe,".uniform",pe,"(",Nr,",",an,");"),We&&ie("}")}}}function es(_e,ie,ze,nt){var St=_e.shared,We=St.gl,Le=St.draw,Qe=nt.draw;function pe(){var _n=Qe.elements,dn,Yn=ie;return _n?((_n.contextDep&&nt.contextDynamic||_n.propDep)&&(Yn=ze),dn=_n.append(_e,Yn),Qe.elementsActive&&Yn("if("+dn+")"+We+".bindBuffer("+ap+","+dn+".buffer.buffer);")):(dn=Yn.def(),Yn(dn,"=",Le,".",mu,";","if(",dn,"){",We,".bindBuffer(",ap,",",dn,".buffer.buffer);}","else if(",St.vao,".currentVAO){",dn,"=",_e.shared.elements+".getElements("+St.vao,".currentVAO.elements);",or?"":"if("+dn+")"+We+".bindBuffer("+ap+","+dn+".buffer.buffer);","}")),dn}function Ne(){var _n=Qe.count,dn,Yn=ie;return _n?((_n.contextDep&&nt.contextDynamic||_n.propDep)&&(Yn=ze),dn=_n.append(_e,Yn),le.optional(function(){_n.MISSING&&_e.assert(ie,"false","missing vertex count"),_n.DYNAMIC&&_e.assert(Yn,dn+">=0","missing vertex count")})):(dn=Yn.def(Le,".",Hc),le.optional(function(){_e.assert(Yn,dn+">=0","missing vertex count")})),dn}var Ee=pe();function it(_n){var dn=Qe[_n];return dn?dn.contextDep&&nt.contextDynamic||dn.propDep?dn.append(_e,ze):dn.append(_e,ie):ie.def(Le,".",_n)}var yt=it(zo),lr=it(Hf),Br=Ne();if(typeof Br=="number"){if(Br===0)return}else ze("if(",Br,"){"),ze.exit("}");var Nr,an;gr&&(Nr=it(Nl),an=_e.instancing);var Rr=Ee+".type",Cn=Qe.elements&&gc(Qe.elements)&&!Qe.vaoActive;function on(){function _n(){ze(an,".drawElementsInstancedANGLE(",[yt,Br,Rr,lr+"<<(("+Rr+"-"+Qn+")>>1)",Nr],");")}function dn(){ze(an,".drawArraysInstancedANGLE(",[yt,lr,Br,Nr],");")}Ee&&Ee!=="null"?Cn?_n():(ze("if(",Ee,"){"),_n(),ze("}else{"),dn(),ze("}")):dn()}function bn(){function _n(){ze(We+".drawElements("+[yt,Br,Rr,lr+"<<(("+Rr+"-"+Qn+")>>1)"]+");")}function dn(){ze(We+".drawArrays("+[yt,lr,Br]+");")}Ee&&Ee!=="null"?Cn?_n():(ze("if(",Ee,"){"),_n(),ze("}else{"),dn(),ze("}")):dn()}gr&&(typeof Nr!="number"||Nr>=0)?typeof Nr=="string"?(ze("if(",Nr,">0){"),on(),ze("}else if(",Nr,"<0){"),bn(),ze("}")):on():bn()}function Or(_e,ie,ze,nt,St){var We=ti(),Le=We.proc("body",St);return le.optional(function(){We.commandStr=ie.commandStr,We.command=We.link(ie.commandStr)}),gr&&(We.instancing=Le.def(We.shared.extensions,".angle_instanced_arrays")),_e(We,Le,ze,nt),We.compile().body}function rn(_e,ie,ze,nt){ao(_e,ie),ze.useVAO?ze.drawVAO?ie(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,ie),");"):ie(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(ie(_e.shared.vao,".setVAO(null);"),Zo(_e,ie,ze,nt.attributes,function(){return!0})),qi(_e,ie,ze,nt.uniforms,function(){return!0},!1),es(_e,ie,ie,ze)}function ia(_e,ie){var ze=_e.proc("draw",1);ao(_e,ze),bo(_e,ze,ie.context),Yo(_e,ze,ie.framebuffer),Oo(_e,ze,ie),Jo(_e,ze,ie.state),li(_e,ze,ie,!1,!0);var nt=ie.shader.progVar.append(_e,ze);if(ze(_e.shared.gl,".useProgram(",nt,".program);"),ie.shader.program)rn(_e,ze,ie,ie.shader.program);else{ze(_e.shared.vao,".setVAO(null);");var St=_e.global.def("{}"),We=ze.def(nt,".id"),Le=ze.def(St,"[",We,"]");ze(_e.cond(Le).then(Le,".call(this,a0);").else(Le,"=",St,"[",We,"]=",_e.link(function(Qe){return Or(rn,_e,ie,Qe,1)}),"(",nt,");",Le,".call(this,a0);"))}Object.keys(ie.state).length>0&&ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&ze(_e.shared.vao,".setVAO(null);")}function Ro(_e,ie,ze,nt){_e.batchId="a1",ao(_e,ie);function St(){return!0}Zo(_e,ie,ze,nt.attributes,St),qi(_e,ie,ze,nt.uniforms,St,!1),es(_e,ie,ie,ze)}function yl(_e,ie,ze,nt){ao(_e,ie);var St=ze.contextDep,We=ie.def(),Le="a0",Qe="a1",pe=ie.def();_e.shared.props=pe,_e.batchId=We;var Ne=_e.scope(),Ee=_e.scope();ie(Ne.entry,"for(",We,"=0;",We,"<",Qe,";++",We,"){",pe,"=",Le,"[",We,"];",Ee,"}",Ne.exit);function it(Rr){return Rr.contextDep&&St||Rr.propDep}function yt(Rr){return!it(Rr)}if(ze.needsContext&&bo(_e,Ee,ze.context),ze.needsFramebuffer&&Yo(_e,Ee,ze.framebuffer),Jo(_e,Ee,ze.state,it),ze.profile&&it(ze.profile)&&li(_e,Ee,ze,!1,!0),nt)ze.useVAO?ze.drawVAO?it(ze.drawVAO)?Ee(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,Ee),");"):Ne(_e.shared.vao,".setVAO(",ze.drawVAO.append(_e,Ne),");"):Ne(_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"):(Ne(_e.shared.vao,".setVAO(null);"),Zo(_e,Ne,ze,nt.attributes,yt),Zo(_e,Ee,ze,nt.attributes,it)),qi(_e,Ne,ze,nt.uniforms,yt,!1),qi(_e,Ee,ze,nt.uniforms,it,!0),es(_e,Ne,Ee,ze);else{var lr=_e.global.def("{}"),Br=ze.shader.progVar.append(_e,Ee),Nr=Ee.def(Br,".id"),an=Ee.def(lr,"[",Nr,"]");Ee(_e.shared.gl,".useProgram(",Br,".program);","if(!",an,"){",an,"=",lr,"[",Nr,"]=",_e.link(function(Rr){return Or(Ro,_e,ze,Rr,2)}),"(",Br,");}",an,".call(this,a0[",We,"],",We,");")}}function Ce(_e,ie){var ze=_e.proc("batch",2);_e.batchId="0",ao(_e,ze);var nt=!1,St=!0;Object.keys(ie.context).forEach(function(lr){nt=nt||ie.context[lr].propDep}),nt||(bo(_e,ze,ie.context),St=!1);var We=ie.framebuffer,Le=!1;We?(We.propDep?nt=Le=!0:We.contextDep&&nt&&(Le=!0),Le||Yo(_e,ze,We)):Yo(_e,ze,null),ie.state.viewport&&ie.state.viewport.propDep&&(nt=!0);function Qe(lr){return lr.contextDep&&nt||lr.propDep}Oo(_e,ze,ie),Jo(_e,ze,ie.state,function(lr){return!Qe(lr)}),(!ie.profile||!Qe(ie.profile))&&li(_e,ze,ie,!1,"a1"),ie.contextDep=nt,ie.needsContext=St,ie.needsFramebuffer=Le;var pe=ie.shader.progVar;if(pe.contextDep&&nt||pe.propDep)yl(_e,ze,ie,null);else{var Ne=pe.append(_e,ze);if(ze(_e.shared.gl,".useProgram(",Ne,".program);"),ie.shader.program)yl(_e,ze,ie,ie.shader.program);else{ze(_e.shared.vao,".setVAO(null);");var Ee=_e.global.def("{}"),it=ze.def(Ne,".id"),yt=ze.def(Ee,"[",it,"]");ze(_e.cond(yt).then(yt,".call(this,a0,a1);").else(yt,"=",Ee,"[",it,"]=",_e.link(function(lr){return Or(yl,_e,ie,lr,2)}),"(",Ne,");",yt,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&ze(_e.shared.current,".dirty=true;"),_e.shared.vao&&ze(_e.shared.vao,".setVAO(null);")}function Ft(_e,ie){var ze=_e.proc("scope",3);_e.batchId="a2";var nt=_e.shared,St=nt.current;bo(_e,ze,ie.context),ie.framebuffer&&ie.framebuffer.append(_e,ze),up(Object.keys(ie.state)).forEach(function(Le){var Qe=ie.state[Le],pe=Qe.append(_e,ze);lo(pe)?pe.forEach(function(Ne,Ee){ze.set(_e.next[Le],"["+Ee+"]",Ne)}):ze.set(nt.next,"."+Le,pe)}),li(_e,ze,ie,!0,!0),[mu,Hf,Hc,Nl,zo].forEach(function(Le){var Qe=ie.draw[Le];!Qe||ze.set(nt.draw,"."+Le,""+Qe.append(_e,ze))}),Object.keys(ie.uniforms).forEach(function(Le){var Qe=ie.uniforms[Le].append(_e,ze);Array.isArray(Qe)&&(Qe="["+Qe.join()+"]"),ze.set(nt.uniforms,"["+ue.id(Le)+"]",Qe)}),Object.keys(ie.attributes).forEach(function(Le){var Qe=ie.attributes[Le].append(_e,ze),pe=_e.scopeAttrib(Le);Object.keys(new rt).forEach(function(Ne){ze.set(pe,"."+Ne,Qe[Ne])})}),ie.scopeVAO&&ze.set(nt.vao,".targetVAO",ie.scopeVAO.append(_e,ze));function We(Le){var Qe=ie.shader[Le];Qe&&ze.set(nt.shader,"."+Le,Qe.append(_e,ze))}We(pl),We(Gc),Object.keys(ie.state).length>0&&(ze(St,".dirty=true;"),ze.exit(St,".dirty=true;")),ze("a1(",_e.shared.context,",a0,",_e.batchId,");")}function gt(_e){if(!(typeof _e!="object"||lo(_e))){for(var ie=Object.keys(_e),ze=0;ze<ie.length;++ze)if(En.isDynamic(_e[ie[ze]]))return!0;return!1}}function pn(_e,ie,ze){var nt=ie.static[ze];if(!nt||!gt(nt))return;var St=_e.global,We=Object.keys(nt),Le=!1,Qe=!1,pe=!1,Ne=_e.global.def("{}");We.forEach(function(it){var yt=nt[it];if(En.isDynamic(yt)){typeof yt=="function"&&(yt=nt[it]=En.unbox(yt));var lr=Ys(yt,null);Le=Le||lr.thisDep,pe=pe||lr.propDep,Qe=Qe||lr.contextDep}else{switch(St(Ne,".",it,"="),typeof yt){case"number":St(yt);break;case"string":St('"',yt,'"');break;case"object":Array.isArray(yt)&&St("[",yt.join(),"]");break;default:St(_e.link(yt));break}St(";")}});function Ee(it,yt){We.forEach(function(lr){var Br=nt[lr];if(!!En.isDynamic(Br)){var Nr=it.invoke(yt,Br);yt(Ne,".",lr,"=",Nr,";")}})}ie.dynamic[ze]=new En.DynamicVariable(Bo,{thisDep:Le,contextDep:Qe,propDep:pe,ref:Ne,append:Ee}),delete ie.static[ze]}function Ni(_e,ie,ze,nt,St){var We=ti();We.stats=We.link(St),Object.keys(ie.static).forEach(function(Qe){pn(We,ie,Qe)}),bd.forEach(function(Qe){pn(We,_e,Qe)});var Le=Uo(_e,ie,ze,nt,We);return ia(We,Le),Ft(We,Le),Ce(We,Le),v(We.compile(),{destroy:function(){Le.shader.program.destroy()}})}return{next:$r,current:Mr,procs:function(){var _e=ti(),ie=_e.proc("poll"),ze=_e.proc("refresh"),nt=_e.block();ie(nt),ze(nt);var St=_e.shared,We=St.gl,Le=St.next,Qe=St.current;nt(Qe,".dirty=false;"),Yo(_e,ie),Yo(_e,ze,null,!0);var pe;gr&&(pe=_e.link(gr)),De.oes_vertex_array_object&&ze(_e.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ne=0;Ne<Mt.maxAttributes;++Ne){var Ee=ze.def(St.attributes,"[",Ne,"]"),it=_e.cond(Ee,".buffer");it.then(We,".enableVertexAttribArray(",Ne,");",We,".bindBuffer(",Sf,",",Ee,".buffer.buffer);",We,".vertexAttribPointer(",Ne,",",Ee,".size,",Ee,".type,",Ee,".normalized,",Ee,".stride,",Ee,".offset);").else(We,".disableVertexAttribArray(",Ne,");",We,".vertexAttrib4f(",Ne,",",Ee,".x,",Ee,".y,",Ee,".z,",Ee,".w);",Ee,".buffer=null;"),ze(it),gr&&ze(pe,".vertexAttribDivisorANGLE(",Ne,",",Ee,".divisor);")}return ze(_e.shared.vao,".currentVAO=null;",_e.shared.vao,".setVAO(",_e.shared.vao,".targetVAO);"),Object.keys(Wt).forEach(function(yt){var lr=Wt[yt],Br=nt.def(Le,".",yt),Nr=_e.block();Nr("if(",Br,"){",We,".enable(",lr,")}else{",We,".disable(",lr,")}",Qe,".",yt,"=",Br,";"),ze(Nr),ie("if(",Br,"!==",Qe,".",yt,"){",Nr,"}")}),Object.keys(Qt).forEach(function(yt){var lr=Qt[yt],Br=Mr[yt],Nr,an,Rr=_e.block();if(Rr(We,".",lr,"("),lo(Br)){var Cn=Br.length;Nr=_e.global.def(Le,".",yt),an=_e.global.def(Qe,".",yt),Rr(Ue(Cn,function(on){return Nr+"["+on+"]"}),");",Ue(Cn,function(on){return an+"["+on+"]="+Nr+"["+on+"];"}).join("")),ie("if(",Ue(Cn,function(on){return Nr+"["+on+"]!=="+an+"["+on+"]"}).join("||"),"){",Rr,"}")}else Nr=nt.def(Le,".",yt),an=nt.def(Qe,".",yt),Rr(Nr,");",Qe,".",yt,"=",Nr,";"),ie("if(",Nr,"!==",an,"){",Rr,"}");ze(Rr)}),_e.compile()}(),compile:Ni}}function Pd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var gl=34918,sh=34919,Qc=35007,Id=function(z,ue){if(!ue.ext_disjoint_timer_query)return null;var De=[];function Mt(){return De.pop()||ue.ext_disjoint_timer_query.createQueryEXT()}function rr(gr){De.push(gr)}var At=[];function qt(gr){var Dr=Mt();ue.ext_disjoint_timer_query.beginQueryEXT(Qc,Dr),At.push(Dr),vr(At.length-1,At.length,gr)}function sr(){ue.ext_disjoint_timer_query.endQueryEXT(Qc)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var mr=[];function Sr(){return mr.pop()||new dr}function Cr(gr){mr.push(gr)}var Ur=[];function vr(gr,Dr,or){var Mr=Sr();Mr.startQueryIndex=gr,Mr.endQueryIndex=Dr,Mr.sum=0,Mr.stats=or,Ur.push(Mr)}var br=[],rt=[];function Ut(){var gr,Dr,or=At.length;if(or!==0){rt.length=Math.max(rt.length,or+1),br.length=Math.max(br.length,or+1),br[0]=0,rt[0]=0;var Mr=0;for(gr=0,Dr=0;Dr<At.length;++Dr){var $r=At[Dr];ue.ext_disjoint_timer_query.getQueryObjectEXT($r,sh)?(Mr+=ue.ext_disjoint_timer_query.getQueryObjectEXT($r,gl),rr($r)):At[gr++]=$r,br[Dr+1]=Mr,rt[Dr+1]=gr}for(At.length=gr,gr=0,Dr=0;Dr<Ur.length;++Dr){var Bn=Ur[Dr],Wt=Bn.startQueryIndex,Qt=Bn.endQueryIndex;Bn.sum+=br[Qt]-br[Wt];var yn=rt[Wt],jr=rt[Qt];jr===yn?(Bn.stats.gpuTime+=Bn.sum/1e6,Cr(Bn)):(Bn.startQueryIndex=yn,Bn.endQueryIndex=jr,Ur[gr++]=Bn)}Ur.length=gr}}return{beginQuery:qt,endQuery:sr,pushScopeStats:vr,update:Ut,getNumPendingQueries:function(){return At.length},clear:function(){De.push.apply(De,At);for(var gr=0;gr<De.length;gr++)ue.ext_disjoint_timer_query.deleteQueryEXT(De[gr]);At.length=0,De.length=0},restore:function(){At.length=0,De.length=0}}},Rh=16384,Jc=256,kh=1024,lp=34962,uh="webglcontextlost",Ta="webglcontextrestored",cp=1,Zl=2,Af=3;function Lh(z,ue){for(var De=0;De<z.length;++De)if(z[De]===ue)return De;return-1}function Od(z){var ue=fe(z);if(!ue)return null;var De=ue.gl,Mt=De.getContextAttributes(),rr=De.isContextLost(),At=Me(De,ue);if(!At)return null;var qt=ps(),sr=Pd(),dr=At.extensions,mr=Id(De,dr),Sr=eo(),Cr=De.drawingBufferWidth,Ur=De.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Cr,viewportHeight:Ur,framebufferWidth:Cr,framebufferHeight:Ur,drawingBufferWidth:Cr,drawingBufferHeight:Ur,pixelRatio:ue.pixelRatio},br={},rt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ut=bl(De,dr),gr=N(De,sr,ue,Mr),Dr=rl(De,dr,gr,sr),or=dt(De,dr,Ut,sr,gr,Dr,rt);function Mr(Or){return or.destroyBuffer(Or)}var $r=kr(De,qt,sr,ue),Bn=bs(De,dr,Ut,function(){yn.procs.poll()},vr,sr,ue),Wt=Xu(De,dr,Ut,sr,ue),Qt=be(De,dr,Ut,Bn,Wt,sr),yn=Yp(De,qt,dr,Ut,gr,Dr,Bn,Qt,br,or,$r,rt,vr,mr,ue),jr=zn(De,Qt,yn.procs.poll,vr,Mt,dr,Ut),yr=yn.next,Yr=De.canvas,qr=[],pi=[],ti=[],Xr=[ue.onDestroy],tn=null;function Xn(){if(qr.length===0){mr&&mr.update(),tn=null;return}tn=Mi.next(Xn),ao();for(var Or=qr.length-1;Or>=0;--Or){var rn=qr[Or];rn&&rn(vr,null,0)}De.flush(),mr&&mr.update()}function oi(){!tn&&qr.length>0&&(tn=Mi.next(Xn))}function Ri(){tn&&(Mi.cancel(Xn),tn=null)}function no(Or){Or.preventDefault(),rr=!0,Ri(),pi.forEach(function(rn){rn()})}function io(Or){De.getError(),rr=!1,At.restore(),$r.restore(),gr.restore(),Bn.restore(),Wt.restore(),Qt.restore(),or.restore(),mr&&mr.restore(),yn.procs.refresh(),oi(),ti.forEach(function(rn){rn()})}var Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!Ii&&Yr&&(Yr.addEventListener(uh,no,!1),Yr.addEventListener(Ta,io,!1));function Qo(){qr.length=0,Ri(),!Ii&&Yr&&(Yr.removeEventListener(uh,no),Yr.removeEventListener(Ta,io)),$r.clear(),Qt.clear(),Wt.clear(),or.clear(),Bn.clear(),Dr.clear(),gr.clear(),mr&&mr.clear(),Xr.forEach(function(Or){Or()})}function Va(Or){le(!!Or,"invalid args to regl({...})"),le.type(Or,"object","invalid args to regl({...})");function rn(We){var Le=v({},We);delete Le.uniforms,delete Le.attributes,delete Le.context,delete Le.vao,"stencil"in Le&&Le.stencil.op&&(Le.stencil.opBack=Le.stencil.opFront=Le.stencil.op,delete Le.stencil.op);function Qe(pe){if(pe in Le){var Ne=Le[pe];delete Le[pe],Object.keys(Ne).forEach(function(Ee){Le[pe+"."+Ee]=Ne[Ee]})}}return Qe("blend"),Qe("depth"),Qe("cull"),Qe("stencil"),Qe("polygonOffset"),Qe("scissor"),Qe("sample"),"vao"in We&&(Le.vao=We.vao),Le}function ia(We,Le){var Qe={},pe={};return Object.keys(We).forEach(function(Ne){var Ee=We[Ne];if(En.isDynamic(Ee)){pe[Ne]=En.unbox(Ee,Ne);return}else if(Le&&Array.isArray(Ee)){for(var it=0;it<Ee.length;++it)if(En.isDynamic(Ee[it])){pe[Ne]=En.unbox(Ee,Ne);return}}Qe[Ne]=Ee}),{dynamic:pe,static:Qe}}var Ro=ia(Or.context||{},!0),yl=ia(Or.uniforms||{},!0),Ce=ia(Or.attributes||{},!1),Ft=ia(rn(Or),!1),gt={gpuTime:0,cpuTime:0,count:0},pn=yn.compile(Ft,Ce,yl,Ro,gt),Ni=pn.draw,_e=pn.batch,ie=pn.scope,ze=[];function nt(We){for(;ze.length<We;)ze.push(null);return ze}function St(We,Le){var Qe;if(rr&&le.raise("context lost"),typeof We=="function")return ie.call(this,null,We,0);if(typeof Le=="function")if(typeof We=="number")for(Qe=0;Qe<We;++Qe)ie.call(this,null,Le,Qe);else if(Array.isArray(We))for(Qe=0;Qe<We.length;++Qe)ie.call(this,We[Qe],Le,Qe);else return ie.call(this,We,Le,0);else if(typeof We=="number"){if(We>0)return _e.call(this,nt(We|0),We|0)}else if(Array.isArray(We)){if(We.length)return _e.call(this,We,We.length)}else return Ni.call(this,We)}return v(St,{stats:gt,destroy:function(){pn.destroy()}})}var Uo=Qt.setFBO=Va({framebuffer:En.define.call(null,cp,"framebuffer")});function bo(Or,rn){var ia=0;yn.procs.poll();var Ro=rn.color;Ro&&(De.clearColor(+Ro[0]||0,+Ro[1]||0,+Ro[2]||0,+Ro[3]||0),ia|=Rh),"depth"in rn&&(De.clearDepth(+rn.depth),ia|=Jc),"stencil"in rn&&(De.clearStencil(rn.stencil|0),ia|=kh),le(!!ia,"called regl.clear with no buffer specified"),De.clear(ia)}function Yo(Or){if(le(typeof Or=="object"&&Or,"regl.clear() takes an object as input"),"framebuffer"in Or)if(Or.framebuffer&&Or.framebuffer_reglType==="framebufferCube")for(var rn=0;rn<6;++rn)Uo(v({framebuffer:Or.framebuffer.faces[rn]},Or),bo);else Uo(Or,bo);else bo(null,Or)}function Oo(Or){le.type(Or,"function","regl.frame() callback must be a function"),qr.push(Or);function rn(){var ia=Lh(qr,Or);le(ia>=0,"cannot cancel a frame twice");function Ro(){var yl=Lh(qr,Ro);qr[yl]=qr[qr.length-1],qr.length-=1,qr.length<=0&&Ri()}qr[ia]=Ro}return oi(),{cancel:rn}}function Jo(){var Or=yr.viewport,rn=yr.scissor_box;Or[0]=Or[1]=rn[0]=rn[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=Or[2]=rn[2]=De.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=Or[3]=rn[3]=De.drawingBufferHeight}function ao(){vr.tick+=1,vr.time=Zo(),Jo(),yn.procs.poll()}function li(){Bn.refresh(),Jo(),yn.procs.refresh(),mr&&mr.update()}function Zo(){return(eo()-Sr)/1e3}li();function qi(Or,rn){le.type(rn,"function","listener callback must be a function");var ia;switch(Or){case"frame":return Oo(rn);case"lost":ia=pi;break;case"restore":ia=ti;break;case"destroy":ia=Xr;break;default:le.raise("invalid event, must be one of frame,lost,restore,destroy")}return ia.push(rn),{cancel:function(){for(var Ro=0;Ro<ia.length;++Ro)if(ia[Ro]===rn){ia[Ro]=ia[ia.length-1],ia.pop();return}}}}var es=v(Va,{clear:Yo,prop:En.define.bind(null,cp),context:En.define.bind(null,Zl),this:En.define.bind(null,Af),draw:Va({}),buffer:function(Or){return gr.create(Or,lp,!1,!1)},elements:function(Or){return Dr.create(Or,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:Wt.create,framebuffer:Qt.create,framebufferCube:Qt.createCube,vao:or.createVAO,attributes:Mt,frame:Oo,on:qi,limits:Ut,hasExtension:function(Or){return Ut.extensions.indexOf(Or.toLowerCase())>=0},read:jr,destroy:Qo,_gl:De,_refresh:li,poll:function(){ao(),mr&&mr.update()},now:Zo,stats:sr});return ue.onDone(null,es),es}return Od})},49029:function(Ar){var ne=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function J(Ie){return Ie.match(ne)||[]}Ar.exports=J},29750:function(Ar){function ne(J,Ie,ge){return J===J&&(ge!==void 0&&(J=J<=ge?J:ge),Ie!==void 0&&(J=J>=Ie?J:Ie)),J}Ar.exports=ne},18674:function(Ar){function ne(J){return function(Ie){return J==null?void 0:J[Ie]}}Ar.exports=ne},98805:function(Ar,ne,J){var Ie=J(40180),ge=J(62689),v=J(83140),Oe=J(79833);function H(ce){return function(he){he=Oe(he);var Fe=ge(he)?v(he):void 0,ye=Fe?Fe[0]:he.charAt(0),Je=Fe?Ie(Fe,1).join(""):he.slice(1);return ye[ce]()+Je}}Ar.exports=H},35393:function(Ar,ne,J){var Ie=J(62663),ge=J(53816),v=J(58748),Oe="['\u2019]",H=RegExp(Oe,"g");function ce(he){return function(Fe){return Ie(v(ge(Fe).replace(H,"")),he,"")}}Ar.exports=ce},69389:function(Ar,ne,J){var Ie=J(18674),ge={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Ie(ge);Ar.exports=v},93157:function(Ar){var ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function J(Ie){return ne.test(Ie)}Ar.exports=J},2757:function(Ar){var ne="\\ud800-\\udfff",J="\\u0300-\\u036f",Ie="\\ufe20-\\ufe2f",ge="\\u20d0-\\u20ff",v=J+Ie+ge,Oe="\\u2700-\\u27bf",H="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",he="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fe="\\u2000-\\u206f",ye=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Je="A-Z\\xc0-\\xd6\\xd8-\\xde",ft="\\ufe0e\\ufe0f",xt=ce+he+Fe+ye,Jt="['\u2019]",ur="["+xt+"]",It="["+v+"]",er="\\d+",jt="["+Oe+"]",ct="["+H+"]",pt="[^"+ne+xt+er+Oe+H+Je+"]",ir="\\ud83c[\\udffb-\\udfff]",Y="(?:"+It+"|"+ir+")",Xt="[^"+ne+"]",st="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="["+Je+"]",$e="\\u200d",Yt="(?:"+ct+"|"+pt+")",Er="(?:"+bt+"|"+pt+")",Hr="(?:"+Jt+"(?:d|ll|m|re|s|t|ve))?",nn="(?:"+Jt+"(?:D|LL|M|RE|S|T|VE))?",C=Y+"?",Se="["+ft+"]?",ke="(?:"+$e+"(?:"+[Xt,st,Ye].join("|")+")"+Se+C+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ht="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=Se+C+ke,Ht="(?:"+[jt,st,Ye].join("|")+")"+Lt,xr=RegExp([bt+"?"+ct+"+"+Hr+"(?="+[ur,bt,"$"].join("|")+")",Er+"+"+nn+"(?="+[ur,bt+Yt,"$"].join("|")+")",bt+"?"+Yt+"+"+Hr,bt+"+"+nn,ht,_t,er,Ht].join("|"),"g");function Kn(mn){return mn.match(xr)||[]}Ar.exports=Kn},68929:function(Ar,ne,J){var Ie=J(48403),ge=J(35393),v=ge(function(Oe,H,ce){return H=H.toLowerCase(),Oe+(ce?Ie(H):H)});Ar.exports=v},48403:function(Ar,ne,J){var Ie=J(79833),ge=J(11700);function v(Oe){return ge(Ie(Oe).toLowerCase())}Ar.exports=v},74691:function(Ar,ne,J){var Ie=J(29750),ge=J(14841);function v(Oe,H,ce){return ce===void 0&&(ce=H,H=void 0),ce!==void 0&&(ce=ge(ce),ce=ce===ce?ce:0),H!==void 0&&(H=ge(H),H=H===H?H:0),Ie(ge(Oe),H,ce)}Ar.exports=v},53816:function(Ar,ne,J){var Ie=J(69389),ge=J(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Oe="\\u0300-\\u036f",H="\\ufe20-\\ufe2f",ce="\\u20d0-\\u20ff",he=Oe+H+ce,Fe="["+he+"]",ye=RegExp(Fe,"g");function Je(ft){return ft=ge(ft),ft&&ft.replace(v,Ie).replace(ye,"")}Ar.exports=Je},14293:function(Ar){function ne(J){return J==null}Ar.exports=ne},81763:function(Ar,ne,J){var Ie=J(44239),ge=J(37005),v="[object Number]";function Oe(H){return typeof H=="number"||ge(H)&&Ie(H)==v}Ar.exports=Oe},30236:function(Ar,ne,J){var Ie=J(42980),ge=J(21463),v=ge(function(Oe,H,ce,he){Ie(Oe,H,ce,he)});Ar.exports=v},44908:function(Ar,ne,J){var Ie=J(45652);function ge(v){return v&&v.length?Ie(v):[]}Ar.exports=ge},11700:function(Ar,ne,J){var Ie=J(98805),ge=Ie("toUpperCase");Ar.exports=ge},58748:function(Ar,ne,J){var Ie=J(49029),ge=J(93157),v=J(79833),Oe=J(2757);function H(ce,he,Fe){return ce=v(ce),he=Fe?void 0:he,he===void 0?ge(ce)?Oe(ce):Ie(ce):ce.match(he)||[]}Ar.exports=H},6158:function(Ar){(function(ne,J){Ar.exports=J()})(this,function(){"use strict";var ne,J,Ie;function ge(v,Oe){if(!ne)ne=Oe;else if(!J)J=Oe;else{var H="var sharedChunk = {}; ("+ne+")(sharedChunk); ("+J+")(sharedChunk);",ce={};ne(ce),Ie=Oe(ce),typeof window!="undefined"&&(Ie.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}return ge(["exports"],function(v){"use strict";function Oe(t,o){return t(o={exports:{}},o.exports),o.exports}var H=ce;function ce(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}ce.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ce.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ce.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ce.prototype.solveCurveX=function(t,o){var u,h,g,x,S;for(o===void 0&&(o=1e-6),g=t,S=0;S<8;S++){if(x=this.sampleCurveX(g)-t,Math.abs(x)<o)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=x/M}if((g=t)<(u=0))return u;if(g>(h=1))return h;for(;u<h;){if(x=this.sampleCurveX(g),Math.abs(x-t)<o)return g;t>x?u=g:h=g,g=.5*(h-u)+u}return g},ce.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var he=Fe;function Fe(t,o){this.x=t,this.y=o}Fe.prototype={clone:function(){return new Fe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),g=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Fe.convert=function(t){return t instanceof Fe?t:Array.isArray(t)?new Fe(t[0],t[1]):t};var ye=typeof self!="undefined"?self:{},Je=Math.pow(2,53)-1;function ft(t,o,u,h){var g=new H(t,o,u,h);return function(x){return g.solve(x)}}var xt=ft(.25,.1,.25,1);function Jt(t,o,u){return Math.min(u,Math.max(o,t))}function ur(t,o,u){var h=u-o,g=((t-o)%h+h)%h+o;return g===o?u:g}function It(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,g=o;h<g.length;h+=1){var x=g[h];for(var S in x)t[S]=x[S]}return t}var er=1;function jt(){return er++}function ct(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function pt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ir(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Xt(t,o,u){var h={};for(var g in t)h[g]=o.call(u||this,t[g],g,t);return h}function st(t,o,u){var h={};for(var g in t)o.call(u||this,t[g],g,t)&&(h[g]=t[g]);return h}function Ye(t){return Array.isArray(t)?t.map(Ye):typeof t=="object"&&t?Xt(t,Ye):t}var bt={};function $e(t){bt[t]||(typeof console!="undefined"&&console.warn(t),bt[t]=!0)}function Yt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Er(t){for(var o=0,u=0,h=t.length,g=h-1,x=void 0,S=void 0;u<h;g=u++)o+=((S=t[g]).x-(x=t[u]).x)*(x.y+S.y);return o}function Hr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function nn(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,g,x,S){var M=x||S;return o[g]=!M||M.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var C=null;function Se(t){if(C==null){var o=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return C}function ke(t){try{var o=ye[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var _t,ht,Lt,Ht,xr=ye.performance&&ye.performance.now?ye.performance.now.bind(ye.performance):Date.now.bind(Date),Kn=ye.requestAnimationFrame||ye.mozRequestAnimationFrame||ye.webkitRequestAnimationFrame||ye.msRequestAnimationFrame,mn=ye.cancelAnimationFrame||ye.mozCancelAnimationFrame||ye.webkitCancelAnimationFrame||ye.msCancelAnimationFrame,di={now:xr,frame:function(t){var o=Kn(t);return{cancel:function(){return mn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ye.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return _t||(_t=ye.document.createElement("a")),_t.href=t,_t.href},hardwareConcurrency:ye.navigator&&ye.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ye.devicePixelRatio},get prefersReducedMotion(){return!!ye.matchMedia&&(ht==null&&(ht=ye.matchMedia("(prefers-reduced-motion: reduce)")),ht.matches)}},Gn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ni={supported:!1,testSupport:function(t){!vi&&Ht&&(Hn?mi(t):Lt=t)}},vi=!1,Hn=!1;function mi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ht),t.isContextLost())return;ni.supported=!0}catch(u){}t.deleteTexture(o),vi=!0}ye.document&&((Ht=ye.document.createElement("img")).onload=function(){Lt&&mi(Lt),Lt=null,Hn=!0},Ht.onerror=function(){vi=!0,Lt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ca="01",Gi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Li(t){return t.indexOf("mapbox:")===0}Gi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ca,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Gi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Gi.prototype.normalizeStyleURL=function(t,o){if(!Li(t))return t;var u=Oa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeGlyphsURL=function(t,o){if(!Li(t))return t;var u=Oa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSourceURL=function(t,o){if(!Li(t))return t;var u=Oa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSpriteURL=function(t,o,u,h){var g=Oa(t);return Li(t)?(g.path="/styles/v1"+g.path+"/sprite"+o+u,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=""+o+u,ya(g))},Gi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Li(t))return t;var u=Oa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(di.devicePixelRatio>=2||o===512?"@2x":"")+(ni.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(g){for(var x=0,S=g;x<S.length;x+=1){var M=S[x].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||Gn.ACCESS_TOKEN;return Gn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Gi.prototype.canonicalizeTileURL=function(t,o){var u=Oa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var g=u.params;return o&&(g=g.filter(function(x){return!x.match(/^access_token=/)})),g.length&&(h+="?"+g.join("&")),h},Gi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Li(o),h=[],g=0,x=t.tiles||[];g<x.length;g+=1){var S=x[g];fa(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Gi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Oa(Gn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Gn.REQUIRE_ACCESS_TOKEN)return ya(t);if(!(o=o||Gn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+o),ya(t)};var $i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function fa(t){return $i.test(t)}var ko=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oa(t){var o=t.match(ko);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ya(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Fi(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ye.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var ra=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ra.prototype.getStorageKey=function(t){var o,u=Fi(Gn.ACCESS_TOKEN);return o=u&&u.u?ye.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,g){return String.fromCharCode(Number("0x"+g))})):Gn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},ra.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ye.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var g=ye.localStorage.getItem(u);g&&(this.anonId=g)}catch(x){$e("Unable to read from LocalStorage")}},ra.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ye.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ye.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},ra.prototype.processRequests=function(t){},ra.prototype.postEvent=function(t,o,u,h){var g=this;if(Gn.EVENTS_URL){var x=Oa(Gn.EVENTS_URL);x.params.push("access_token="+(h||Gn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ca,userId:this.anonId},M=o?It(S,o):S,D={url:ya(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=_a(D,function(B){g.pendingRequest=null,u(B),g.saveEventData(),g.processRequests(h)})}},ra.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Qi,Es,le=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,g,x){this.skuToken=g,(Gn.EVENTS_URL&&x||Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Li(S)||fa(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},x)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),x=g.id,S=g.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=ct()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||x&&(h.success[x]=!0)},u))}},o}(ra),ii=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Gn.EVENTS_URL&&Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(g){return Li(g)||fa(g)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Fi(Gn.ACCESS_TOKEN),x=g?g.u:Gn.ACCESS_TOKEN,S=x!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=ct(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),B=new Date(M),Z=(M-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||D.getDate()!==B.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(j){j||(h.eventData.lastSuccess=M,h.eventData.tokenU=x)},u)}},o}(ra)),yo=ii.postTurnstileEvent.bind(ii),Qs=new le,Bt=Qs.postMapLoadEvent.bind(Qs),$t=500,Pr=50;function ln(){ye.caches&&!Qi&&(Qi=ye.caches.open("mapbox-tiles"))}function An(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Nn,_i=1/0;function fi(){return Nn==null&&(Nn=ye.OffscreenCanvas&&new ye.OffscreenCanvas(1,1).getContext("2d")&&typeof ye.createImageBitmap=="function"),Nn}var En={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(En);var Mi=function(t){function o(u,h,g){h===401&&fa(g)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=g,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ti=Hr()?function(){return self.worker&&self.worker.referrer}:function(){return(ye.location.protocol==="blob:"?ye.parent:ye).location.href},eo,ps,Go=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ti())&&!/^\w+:/.test(u))){if(ye.fetch&&ye.Request&&ye.AbortController&&ye.Request.prototype.hasOwnProperty("signal"))return function(h,g){var x,S=new ye.AbortController,M=new ye.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ti(),signal:S.signal}),D=!1,B=!1,Z=(x=M.url).indexOf("sku=")>0&&fa(x);h.type==="json"&&M.headers.set("Accept","application/json");var j=function(O,we,Pe){if(!B){if(O&&O.message!=="SecurityError"&&$e(O),we&&Pe)return K(we);var Ge=Date.now();ye.fetch(M).then(function(Be){if(Be.ok){var et=Z?Be.clone():null;return K(Be,et,Ge)}return g(new Mi(Be.statusText,Be.status,h.url))}).catch(function(Be){Be.code!==20&&g(new Error(Be.message))})}},K=function(O,we,Pe){(h.type==="arrayBuffer"?O.arrayBuffer():h.type==="json"?O.json():O.text()).then(function(Ge){B||(we&&Pe&&function(Be,et,mt){if(ln(),Qi){var Pt={status:et.status,statusText:et.statusText,headers:new ye.Headers};et.headers.forEach(function(nr,wr){return Pt.headers.set(wr,nr)});var Vt=nn(et.headers.get("Cache-Control")||"");Vt["no-store"]||(Vt["max-age"]&&Pt.headers.set("Expires",new Date(mt+1e3*Vt["max-age"]).toUTCString()),new Date(Pt.headers.get("Expires")).getTime()-mt<42e4||function(nr,wr){if(Es===void 0)try{new Response(new ReadableStream),Es=!0}catch(Gr){Es=!1}Es?wr(nr.body):nr.blob().then(wr)}(et,function(nr){var wr=new ye.Response(nr,Pt);ln(),Qi&&Qi.then(function(Gr){return Gr.put(An(Be.url),wr)}).catch(function(Gr){return $e(Gr.message)})}))}}(M,we,Pe),D=!0,g(null,Ge,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(function(Ge){B||g(new Error(Ge.message))})};return Z?function(O,we){if(ln(),!Qi)return we(null);var Pe=An(O.url);Qi.then(function(Ge){Ge.match(Pe).then(function(Be){var et=function(mt){if(!mt)return!1;var Pt=new Date(mt.headers.get("Expires")||0),Vt=nn(mt.headers.get("Cache-Control")||"");return Pt>Date.now()&&!Vt["no-cache"]}(Be);Ge.delete(Pe),et&&Ge.put(Pe,Be.clone()),we(null,Be,et)}).catch(we)}).catch(we)}(M,j):j(null,null),{cancel:function(){B=!0,D||S.abort()}}}(t,o);if(Hr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,g){var x=new ye.XMLHttpRequest;for(var S in x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer"),h.headers)x.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=function(){g(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var M=x.response;if(h.type==="json")try{M=JSON.parse(x.response)}catch(D){return g(D)}g(null,M,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else g(new Mi(x.statusText,x.status,h.url))},x.send(h.body),{cancel:function(){return x.abort()}}}(t,o)},Da=function(t,o){return Go(It(t,{type:"arrayBuffer"}),o)},_a=function(t,o){return Go(It(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";eo=[],ps=0;var q=function(t,o){if(ni.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ps>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return eo.push(u),u}ps++;var h=!1,g=function(){if(!h)for(h=!0,ps--;eo.length&&ps<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=eo.shift();S.cancelled||(S.cancel=q(S.requestParameters,S.callback).cancel)}},x=Da(t,function(S,M,D,B){g(),S?o(S):M&&(fi()?function(Z,j){var K=new ye.Blob([new Uint8Array(Z)],{type:"image/png"});ye.createImageBitmap(K).then(function(O){j(null,O)}).catch(function(O){j(new Error("Could not load image because of "+O.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,o):function(Z,j,K,O){var we=new ye.Image,Pe=ye.URL;we.onload=function(){j(null,we),Pe.revokeObjectURL(we.src),we.onload=null,ye.requestAnimationFrame(function(){we.src=V})},we.onerror=function(){return j(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ge=new ye.Blob([new Uint8Array(Z)],{type:"image/png"});we.cacheControl=K,we.expires=O,we.src=Z.byteLength?Pe.createObjectURL(Ge):V}(M,o,D,B))});return{cancel:function(){x.cancel(),g()}}};function ee(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function fe(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Me=function(t,o){o===void 0&&(o={}),It(this,o),this.type=t},Ue=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",It({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Me),Ke=function(){};Ke.prototype.on=function(t,o){return this._listeners=this._listeners||{},ee(t,o,this._listeners),this},Ke.prototype.off=function(t,o){return fe(t,o,this._listeners),fe(t,o,this._oneTimeListeners),this},Ke.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},ee(t,o,this._oneTimeListeners),this},Ke.prototype.fire=function(t,o){typeof t=="string"&&(t=new Me(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,g=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<g.length;h+=1)g[h].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];x<S.length;x+=1){var M=S[x];fe(u,M,this._oneTimeListeners),M.call(this,t)}var D=this._eventedParent;D&&(It(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof Ue&&console.error(t.error);return this},Ke.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Ke.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var oe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Re=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function ut(t){var o=t.value;return o?[new Re(t.key,o,"constants have been deprecated as of v8")]:[]}function cr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,g=o;h<g.length;h+=1){var x=g[h];for(var S in x)t[S]=x[S]}return t}function Tt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Rt(t){if(Array.isArray(t))return t.map(Rt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Rt(t[u]);return o}return Tt(t)}var hr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),gn=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var g=h[u];this.bindings[g[0]]=g[1]}};gn.prototype.concat=function(t){return new gn(this,t)},gn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},gn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var cn={kind:"null"},Et={kind:"number"},Qr={kind:"string"},Lr={kind:"boolean"},Wr={kind:"color"},hi={kind:"object"},Jr={kind:"value"},Tn={kind:"collator"},Zi={kind:"formatted"},si={kind:"resolvedImage"};function Si(t,o){return{kind:"array",itemType:t,N:o}}function gi(t){if(t.kind==="array"){var o=gi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var vt=[cn,Et,Qr,Lr,Wr,Zi,hi,Si(Jr),si];function kt(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!kt(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=vt;u<h.length;u+=1)if(!kt(h[u],o))return null}}return"Expected "+gi(t)+" but found "+gi(o)+" instead."}function Ca(t,o){return o.some(function(u){return u.kind===t.kind})}function bi(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ci=Oe(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function g(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function x(M){return(D=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:D>1?1:D;var D}function S(M,D,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?M+(D-M)*B*6:2*B<1?D:3*B<2?M+(D-M)*(2/3-B)*6:M}try{o.parseCSSColor=function(M){var D,B=M.replace(/ /g,"").toLowerCase();if(B in u)return u[B].slice();if(B[0]==="#")return B.length===4?(D=parseInt(B.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:B.length===7&&(D=parseInt(B.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=B.indexOf("("),j=B.indexOf(")");if(Z!==-1&&j+1===B.length){var K=B.substr(0,Z),O=B.substr(Z+1,j-(Z+1)).split(","),we=1;switch(K){case"rgba":if(O.length!==4)return null;we=x(O.pop());case"rgb":return O.length!==3?null:[g(O[0]),g(O[1]),g(O[2]),we];case"hsla":if(O.length!==4)return null;we=x(O.pop());case"hsl":if(O.length!==3)return null;var Pe=(parseFloat(O[0])%360+360)%360/360,Ge=x(O[1]),Be=x(O[2]),et=Be<=.5?Be*(Ge+1):Be+Ge-Be*Ge,mt=2*Be-et;return[h(255*S(mt,et,Pe+1/3)),h(255*S(mt,et,Pe)),h(255*S(mt,et,Pe-1/3)),we];default:return null}}return null}}catch(M){}}).parseCSSColor,Di=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Di.parse=function(t){if(t){if(t instanceof Di)return t;if(typeof t=="string"){var o=Ci(t);if(o)return new Di(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Di.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Di.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Di.black=new Di(0,0,0,1),Di.white=new Di(1,1,1,1),Di.transparent=new Di(0,0,0,0),Di.red=new Di(1,0,0,1);var Fr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Fr.prototype.compare=function(t,o){return this.collator.compare(t,o)},Fr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var xn=function(t,o,u,h,g){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=g},Ct=function(t){this.sections=t};Ct.fromString=function(t){return new Ct([new xn(t,null,null,null,null)])},Ct.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Ct.factory=function(t){return t instanceof Ct?t:Ct.fromString(t)},Ct.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Ct.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var g={};h.fontStack&&(g["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(g["font-scale"]=h.scale),h.textColor&&(g["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(g)}}return t};var Ji=function(t){this.name=t.name,this.available=t.available};function de(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Di||t instanceof Fr||t instanceof Ct||t instanceof Ji)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Ko(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function Wi(t){if(t===null)return cn;if(typeof t=="string")return Qr;if(typeof t=="boolean")return Lr;if(typeof t=="number")return Et;if(t instanceof Di)return Wr;if(t instanceof Fr)return Tn;if(t instanceof Ct)return Zi;if(t instanceof Ji)return si;if(Array.isArray(t)){for(var o,u=t.length,h=0,g=t;h<g.length;h+=1){var x=Wi(g[h]);if(o){if(o===x)continue;o=Jr;break}o=x}return Si(o||Jr,u)}return hi}function hu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Di||t instanceof Ct||t instanceof Ji?t.toString():JSON.stringify(t)}Ji.prototype.toString=function(){return this.name},Ji.fromString=function(t){return t?new Ji({name:t,available:!1}):null},Ji.prototype.serialize=function(){return["image",this.name]};var Fa=function(t,o){this.type=t,this.value=o};Fa.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return o.error("invalid value");var u=t[1],h=Wi(u),g=o.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Fa(h,u)},Fa.prototype.evaluate=function(){return this.value},Fa.prototype.eachChild=function(){},Fa.prototype.outputDefined=function(){return!0},Fa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Di?["rgba"].concat(this.value.toArray()):this.value instanceof Ct?this.value.serialize():this.value};var wa=function(t){this.name="ExpressionEvaluationError",this.message=t};wa.prototype.toJSON=function(){return this.message};var Ga={string:Qr,number:Et,boolean:Lr,object:hi},ea=function(t,o){this.type=t,this.args=o};ea.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,g=t[0];if(g==="array"){var x,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Ga)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ga[M],h++}else x=Jr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Si(x,S)}else u=Ga[g];for(var D=[];h<t.length;h++){var B=o.parse(t[h],h,Jr);if(!B)return null;D.push(B)}return new ea(u,D)},ea.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!kt(this.type,Wi(u)))return u;if(o===this.args.length-1)throw new wa("Expected value to be of type "+gi(this.type)+", but found "+gi(Wi(u))+" instead.")}return null},ea.prototype.eachChild=function(t){this.args.forEach(t)},ea.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ea.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(g){return g.serialize()}))};var Mo=function(t){this.type=Zi,this.sections=t};Mo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],g=!1,x=1;x<=t.length-1;++x){var S=t[x];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var M=null;if(S["font-scale"]&&!(M=o.parse(S["font-scale"],1,Et)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Si(Qr))))return null;var B=null;if(S["text-color"]&&!(B=o.parse(S["text-color"],1,Wr)))return null;var Z=h[h.length-1];Z.scale=M,Z.font=D,Z.textColor=B}else{var j=o.parse(t[x],1,Jr);if(!j)return null;var K=j.type.kind;if(K!=="string"&&K!=="value"&&K!=="null"&&K!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:j,scale:null,font:null,textColor:null})}}return new Mo(h)},Mo.prototype.evaluate=function(t){return new Ct(this.sections.map(function(o){var u=o.content.evaluate(t);return Wi(u)===si?new xn("",u,null,null,null):new xn(hu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Mo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Mo.prototype.outputDefined=function(){return!1},Mo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var g={};h.scale&&(g["font-scale"]=h.scale.serialize()),h.font&&(g["text-font"]=h.font.serialize()),h.textColor&&(g["text-color"]=h.textColor.serialize()),t.push(g)}return t};var Ho=function(t){this.type=si,this.input=t};Ho.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Qr);return u?new Ho(u):o.error("No image name provided.")},Ho.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Ji.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Ho.prototype.eachChild=function(t){t(this.input)},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){return["image",this.input.serialize()]};var bu={"to-boolean":Lr,"to-color":Wr,"to-number":Et,"to-string":Qr},ho=function(t,o){this.type=t,this.args=o};ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=bu[u],g=[],x=1;x<t.length;x++){var S=o.parse(t[x],x,Jr);if(!S)return null;g.push(S)}return new ho(h,g)},ho.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,g=this.args;h<g.length;h+=1){if(u=null,(o=g[h].evaluate(t))instanceof Di)return o;if(typeof o=="string"){var x=t.parseColor(o);if(x)return x}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":de(o[0],o[1],o[2],o[3])))return new Di(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new wa(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,D=this.args;M<D.length;M+=1){if((S=D[M].evaluate(t))===null)return 0;var B=Number(S);if(!isNaN(B))return B}throw new wa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Ct.fromString(hu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ji.fromString(hu(this.args[0].evaluate(t))):hu(this.args[0].evaluate(t))},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ho.prototype.serialize=function(){if(this.type.kind==="formatted")return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ho(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Lo=["Unknown","Point","LineString","Polygon"],ta=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ta.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ta.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Lo[this.feature.type]:this.feature.type:null},ta.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ta.prototype.canonicalID=function(){return this.canonical},ta.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ta.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Di.parse(t)),o};var Ha=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};Ha.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ha.prototype.eachChild=function(t){this.args.forEach(t)},Ha.prototype.outputDefined=function(){return!1},Ha.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ha.parse=function(t,o){var u,h=t[0],g=Ha.definitions[h];if(!g)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=S.filter(function(Un){var fn=Un[0];return!Array.isArray(fn)||fn.length===t.length-1}),D=null,B=0,Z=M;B<Z.length;B+=1){var j=Z[B],K=j[0],O=j[1];D=new Ps(o.registry,o.path,null,o.scope);for(var we=[],Pe=!1,Ge=1;Ge<t.length;Ge++){var Be=t[Ge],et=Array.isArray(K)?K[Ge-1]:K.type,mt=D.parse(Be,1+we.length,et);if(!mt){Pe=!0;break}we.push(mt)}if(!Pe)if(Array.isArray(K)&&K.length!==we.length)D.error("Expected "+K.length+" arguments, but found "+we.length+" instead.");else{for(var Pt=0;Pt<we.length;Pt++){var Vt=Array.isArray(K)?K[Pt]:K.type,nr=we[Pt];D.concat(Pt+1).checkSubtype(Vt,nr.type)}if(D.errors.length===0)return new Ha(h,x,O,we)}}if(M.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var wr=(M.length?M:S).map(function(Un){var fn;return fn=Un[0],Array.isArray(fn)?"("+fn.map(gi).join(", ")+")":"("+gi(fn.type)+"...)"}).join(" | "),Gr=[],Fn=1;Fn<t.length;Fn++){var sn=o.parse(t[Fn],1+Gr.length);if(!sn)return null;Gr.push(gi(sn.type))}o.error("Expected arguments of type "+wr+", but found ("+Gr.join(", ")+") instead.")}return null},Ha.register=function(t,o){for(var u in Ha.definitions=o,o)t[u]=Ha};var Do=function(t,o,u){this.type=Tn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Wa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Ss(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function bl(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(u*g*8192),Math.round(h*g*8192)]}function ds(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function Q(t,o){for(var u,h,g,x,S,M,D,B=!1,Z=0,j=o.length;Z<j;Z++)for(var K=o[Z],O=0,we=K.length;O<we-1;O++){if((x=(u=t)[0]-(h=K[O])[0])*(D=u[1]-(g=K[O+1])[1])-(M=u[0]-g[0])*(S=u[1]-h[1])==0&&x*M<=0&&S*D<=0)return!1;ds(t,K[O],K[O+1])&&(B=!B)}return B}function me(t,o){for(var u=0;u<o.length;u++)if(Q(t,o[u]))return!0;return!1}function He(t,o,u,h){var g=h[0]-u[0],x=h[1]-u[1],S=(t[0]-u[0])*x-g*(t[1]-u[1]),M=(o[0]-u[0])*x-g*(o[1]-u[1]);return S>0&&M<0||S<0&&M>0}function wt(t,o,u){for(var h=0,g=u;h<g.length;h+=1)for(var x=g[h],S=0;S<x.length-1;++S)if((j=[(Z=x[S+1])[0]-(B=x[S])[0],Z[1]-B[1]])[0]*(K=[(D=o)[0]-(M=t)[0],D[1]-M[1]])[1]-j[1]*K[0]!=0&&He(M,D,B,Z)&&He(B,Z,M,D))return!0;var M,D,B,Z,j,K;return!1}function Tr(t,o){for(var u=0;u<t.length;++u)if(!Q(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(wt(t[h],t[h+1],o))return!1;return!0}function In(t,o){for(var u=0;u<o.length;u++)if(Tr(t,o[u]))return!0;return!1}function wi(t,o,u){for(var h=[],g=0;g<t.length;g++){for(var x=[],S=0;S<t[g].length;S++){var M=bl(t[g][S],u);Wa(o,M),x.push(M)}h.push(x)}return h}function to(t,o,u){for(var h=[],g=0;g<t.length;g++){var x=wi(t[g],o,u);h.push(x)}return h}function Ra(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var g=.5*h,x=t[0]-u[0]>g?-h:u[0]-t[0]>g?h:0;x===0&&(x=t[0]-u[2]>g?-h:u[2]-t[0]>g?h:0),t[0]+=x}Wa(o,t)}function Ba(t,o,u,h){for(var g=8192*Math.pow(2,h.z),x=[8192*h.x,8192*h.y],S=[],M=0,D=t;M<D.length;M+=1)for(var B=0,Z=D[M];B<Z.length;B+=1){var j=Z[B],K=[j.x+x[0],j.y+x[1]];Ra(K,o,u,g),S.push(K)}return S}function Wo(t,o,u,h){for(var g,x=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],D=0,B=t;D<B.length;D+=1){for(var Z=[],j=0,K=B[D];j<K.length;j+=1){var O=K[j],we=[O.x+S[0],O.y+S[1]];Wa(o,we),Z.push(we)}M.push(Z)}if(o[2]-o[0]<=x/2){(g=o)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var Pe=0,Ge=M;Pe<Ge.length;Pe+=1)for(var Be=0,et=Ge[Pe];Be<et.length;Be+=1)Ra(et[Be],o,u,x)}return M}Do.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Lr);if(!h)return null;var g=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Lr);if(!g)return null;var x=null;return u.locale&&!(x=o.parse(u.locale,1,Qr))?null:new Do(h,g,x)},Do.prototype.evaluate=function(t){return new Fr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Do.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var vs=function(t,o){this.type=Lr,this.geojson=t,this.geometries=o};function uo(t){if(t instanceof Ha&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof vs)return!1;var o=!0;return t.eachChild(function(u){o&&!uo(u)&&(o=!1)}),o}function Po(t){if(t instanceof Ha&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Po(u)&&(o=!1)}),o}function ms(t,o){if(t instanceof Ha&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!ms(h,o)&&(u=!1)}),u}vs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new vs(u,u.features[h].geometry)}else if(u.type==="Feature"){var x=u.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new vs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new vs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},vs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=wi(u.coordinates,g,x),M=Ba(o.geometry(),h,g,x);if(!Ss(h,g))return!1;for(var D=0,B=M;D<B.length;D+=1)if(!Q(B[D],S))return!1}if(u.type==="MultiPolygon"){var Z=to(u.coordinates,g,x),j=Ba(o.geometry(),h,g,x);if(!Ss(h,g))return!1;for(var K=0,O=j;K<O.length;K+=1)if(!me(O[K],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=o.canonicalID();if(u.type==="Polygon"){var S=wi(u.coordinates,g,x),M=Wo(o.geometry(),h,g,x);if(!Ss(h,g))return!1;for(var D=0,B=M;D<B.length;D+=1)if(!Tr(B[D],S))return!1}if(u.type==="MultiPolygon"){var Z=to(u.coordinates,g,x),j=Wo(o.geometry(),h,g,x);if(!Ss(h,g))return!1;for(var K=0,O=j;K<O.length;K+=1)if(!In(O[K],Z))return!1}return!0}(t,this.geometries)}return!1},vs.prototype.eachChild=function(){},vs.prototype.outputDefined=function(){return!0},vs.prototype.serialize=function(){return["within",this.geojson]};var Cs=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Cs.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Cs(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Cs.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Cs.prototype.eachChild=function(){},Cs.prototype.outputDefined=function(){return!1},Cs.prototype.serialize=function(){return["var",this.name]};var Ps=function(t,o,u,h,g){o===void 0&&(o=[]),h===void 0&&(h=new gn),g===void 0&&(g=[]),this.registry=t,this.path=o,this.key=o.map(function(x){return"["+x+"]"}).join(""),this.scope=h,this.errors=g,this.expectedType=u};function Js(t,o){for(var u,h=t.length-1,g=0,x=h,S=0;g<=x;)if((u=t[S=Math.floor((g+x)/2)])<=o){if(S===h||o<t[S+1])return S;g=S+1}else{if(!(u>o))throw new wa("Input is not a number.");x=S-1}return 0}Ps.prototype.parse=function(t,o,u,h,g){return g===void 0&&(g={}),o?this.concat(o,u,h)._parse(t,g):this._parse(t,g)},Ps.prototype._parse=function(t,o){function u(B,Z,j){return j==="assert"?new ea(Z,[B]):j==="coerce"?new ho(Z,[B]):B}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[h];if(g){var x=g.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,M=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else x=u(x,S,o.typeAnnotation||"coerce");else x=u(x,S,o.typeAnnotation||"assert")}if(!(x instanceof Fa)&&x.type.kind!=="resolvedImage"&&function B(Z){if(Z instanceof Cs)return B(Z.boundExpression);if(Z instanceof Ha&&Z.name==="error"||Z instanceof Do||Z instanceof vs)return!1;var j=Z instanceof ho||Z instanceof ea,K=!0;return Z.eachChild(function(O){K=j?K&&B(O):K&&O instanceof Fa}),!!K&&uo(Z)&&ms(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var D=new ta;try{x=new Fa(x.type,x.evaluate(D))}catch(B){return this.error(B.message),null}}return x}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Ps.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,g=u?this.scope.concat(u):this.scope;return new Ps(this.registry,h,o||null,g,this.errors)},Ps.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(g){return"["+g+"]"}).join("");this.errors.push(new hr(h,t))},Ps.prototype.checkSubtype=function(t,o){var u=kt(t,o);return u&&this.error(u),u};var gs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,g=u;h<g.length;h+=1){var x=g[h],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function ha(t,o,u){return t*(1-u)+o*u}gs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Et);if(!u)return null;var h=[],g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],M=t[x+1],D=x,B=x+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(M,B,g);if(!Z)return null;g=g||Z.type,h.push([S,Z])}return new gs(g,u,h)},gs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var g=o.length;return h>=o[g-1]?u[g-1].evaluate(t):u[Js(o,h)].evaluate(t)},gs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},gs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},gs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var va=Object.freeze({__proto__:null,number:ha,color:function(t,o,u){return new Di(ha(t.r,o.r,u),ha(t.g,o.g,u),ha(t.b,o.b,u),ha(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,g){return ha(h,o[g],u)})}}),is=6/29*3*(6/29),sf=Math.PI/180,El=180/Math.PI;function Ns(t){return t>.008856451679035631?Math.pow(t,1/3):t/is+4/29}function Ql(t){return t>6/29?t*t*t:is*(t-4/29)}function Zu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function zs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tl(t){var o=zs(t.r),u=zs(t.g),h=zs(t.b),g=Ns((.4124564*o+.3575761*u+.1804375*h)/.95047),x=Ns((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*x-16,a:500*(g-x),b:200*(x-Ns((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*Ql(o),u=.95047*Ql(u),h=1.08883*Ql(h),new Di(Zu(3.2404542*u-1.5371385*o-.4985314*h),Zu(-.969266*u+1.8760108*o+.041556*h),Zu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function T(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var N={forward:tl,reverse:_,interpolate:function(t,o,u){return{l:ha(t.l,o.l,u),a:ha(t.a,o.a,u),b:ha(t.b,o.b,u),alpha:ha(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=tl(t),u=o.l,h=o.a,g=o.b,x=Math.atan2(g,h)*El;return{h:x<0?x+360:x,c:Math.sqrt(h*h+g*g),l:u,alpha:t.a}},reverse:function(t){var o=t.h*sf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:ha(t.c,o.c,u),l:ha(t.l,o.l,u),alpha:ha(t.alpha,o.alpha,u)}}},X=Object.freeze({__proto__:null,lab:N,hcl:R}),ve=function(t,o,u,h,g){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var x=0,S=g;x<S.length;x+=1){var M=S[x],D=M[1];this.labels.push(M[0]),this.outputs.push(D)}};function je(t,o,u,h){var g=h-u,x=t-u;return g===0?0:o===1?x/g:(Math.pow(o,x)-1)/(Math.pow(o,g)-1)}ve.interpolationFactor=function(t,o,u,h){var g=0;if(t.name==="exponential")g=je(o,t.base,u,h);else if(t.name==="linear")g=je(o,1,u,h);else if(t.name==="cubic-bezier"){var x=t.controlPoints;g=new H(x[0],x[1],x[2],x[3]).solve(je(o,1,u,h))}return g},ve.parse=function(t,o){var u=t[0],h=t[1],g=t[2],x=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Ge){return typeof Ge!="number"||Ge<0||Ge>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(g=o.parse(g,2,Et)))return null;var D=[],B=null;u==="interpolate-hcl"||u==="interpolate-lab"?B=Wr:o.expectedType&&o.expectedType.kind!=="value"&&(B=o.expectedType);for(var Z=0;Z<x.length;Z+=2){var j=x[Z],K=x[Z+1],O=Z+3,we=Z+4;if(typeof j!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(D.length&&D[D.length-1][0]>=j)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);var Pe=o.parse(K,we,B);if(!Pe)return null;B=B||Pe.type,D.push([j,Pe])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new ve(B,u,h,g,D):o.error("Type "+gi(B)+" is not interpolatable.")},ve.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var g=o.length;if(h>=o[g-1])return u[g-1].evaluate(t);var x=Js(o,h),S=ve.interpolationFactor(this.interpolation,h,o[x],o[x+1]),M=u[x].evaluate(t),D=u[x+1].evaluate(t);return this.operator==="interpolate"?va[this.type.kind.toLowerCase()](M,D,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(M),R.forward(D),S)):N.reverse(N.interpolate(N.forward(M),N.forward(D),S))},ve.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ve.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ve.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var at=function(t,o){this.type=t,this.args=o};at.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var g=[],x=0,S=t.slice(1);x<S.length;x+=1){var M=o.parse(S[x],1+g.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,g.push(M)}var D=h&&g.some(function(B){return kt(h,B.type)});return new at(D?Jr:u,g)},at.prototype.evaluate=function(t){for(var o,u=null,h=0,g=0,x=this.args;g<x.length&&(h++,(u=x[g].evaluate(t))&&u instanceof Ji&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);g+=1);return u},at.prototype.eachChild=function(t){this.args.forEach(t)},at.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},at.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var ot=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};ot.prototype.evaluate=function(t){return this.result.evaluate(t)},ot.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},ot.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var g=t[h];if(typeof g!="string")return o.error("Expected string, but found "+typeof g+" instead.",h);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var x=o.parse(t[h+1],h+1);if(!x)return null;u.push([g,x])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new ot(u,S):null},ot.prototype.outputDefined=function(){return this.result.outputDefined()},ot.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var tr=function(t,o,u){this.type=t,this.index=o,this.input=u};tr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Et),h=o.parse(t[2],2,Si(o.expectedType||Jr));return u&&h?new tr(h.type.itemType,u,h):null},tr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new wa("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new wa("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new wa("Array index must be an integer, but found "+o+" instead.");return u[o]},tr.prototype.eachChild=function(t){t(this.index),t(this.input)},tr.prototype.outputDefined=function(){return!1},tr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ar=function(t,o){this.type=Lr,this.needle=t,this.haystack=o};ar.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,Jr);return u&&h?Ca(u.type,[Lr,Qr,Et,cn,Jr])?new ar(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(u.type)+" instead"):null},ar.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!bi(o,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+gi(Wi(o))+" instead.");if(!bi(u,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+gi(Wi(u))+" instead.");return u.indexOf(o)>=0},ar.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ar.prototype.outputDefined=function(){return!0},ar.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Mn=function(t,o,u){this.type=Et,this.needle=t,this.haystack=o,this.fromIndex=u};Mn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,Jr);if(!u||!h)return null;if(!Ca(u.type,[Lr,Qr,Et,cn,Jr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+gi(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Et);return g?new Mn(u,h,g):null}return new Mn(u,h)},Mn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!bi(o,["boolean","string","number","null"]))throw new wa("Expected first argument to be of type boolean, string, number or null, but found "+gi(Wi(o))+" instead.");if(!bi(u,["string","array"]))throw new wa("Expected second argument to be of type array or string, but found "+gi(Wi(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Mn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Mn.prototype.outputDefined=function(){return!1},Mn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ei=function(t,o,u,h,g,x){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=g,this.otherwise=x};ei.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var g={},x=[],S=2;S<t.length-1;S+=2){var M=t[S],D=t[S+1];Array.isArray(M)||(M=[M]);var B=o.concat(S);if(M.length===0)return B.error("Expected at least one branch label.");for(var Z=0,j=M;Z<j.length;Z+=1){var K=j[Z];if(typeof K!="number"&&typeof K!="string")return B.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof K=="number"&&Math.floor(K)!==K)return B.error("Numeric branch labels must be integer values.");if(u){if(B.checkSubtype(u,Wi(K)))return null}else u=Wi(K);if(g[String(K)]!==void 0)return B.error("Branch labels must be unique.");g[String(K)]=x.length}var O=o.parse(D,S,h);if(!O)return null;h=h||O.type,x.push(O)}var we=o.parse(t[1],1,Jr);if(!we)return null;var Pe=o.parse(t[t.length-1],t.length-1,h);return Pe?we.type.kind!=="value"&&o.concat(1).checkSubtype(u,we.type)?null:new ei(u,h,we,g,x,Pe):null},ei.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(Wi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ei.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ei.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ei.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},g=0,x=Object.keys(this.cases).sort();g<x.length;g+=1){var S=x[g];(j=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[j][1].push(S)}for(var M=function(O){return t.inputType.kind==="number"?Number(O):O},D=0,B=u;D<B.length;D+=1){var Z=B[D],j=Z[0],K=Z[1];o.push(K.length===1?M(K[0]):K.map(M)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Rn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Rn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],g=1;g<t.length-1;g+=2){var x=o.parse(t[g],g,Lr);if(!x)return null;var S=o.parse(t[g+1],g+1,u);if(!S)return null;h.push([x,S]),u=u||S.type}var M=o.parse(t[t.length-1],t.length-1,u);return M?new Rn(u,h,M):null},Rn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],g=h[1];if(h[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},Rn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],g=h[1];t(h[0]),t(g)}t(this.otherwise)},Rn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Rn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Vi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function sa(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function ba(t,o,u,h){return h.compare(o,u)===0}function Bi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function g(x,S,M){this.type=Lr,this.lhs=x,this.rhs=S,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return g.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var M=x[0],D=S.parse(x[1],1,Jr);if(!D)return null;if(!sa(M,D.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+gi(D.type)+"'.");var B=S.parse(x[2],2,Jr);if(!B)return null;if(!sa(M,B.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+gi(B.type)+"'.");if(D.type.kind!==B.type.kind&&D.type.kind!=="value"&&B.type.kind!=="value")return S.error("Cannot compare types '"+gi(D.type)+"' and '"+gi(B.type)+"'.");h&&(D.type.kind==="value"&&B.type.kind!=="value"?D=new ea(B.type,[D]):D.type.kind!=="value"&&B.type.kind==="value"&&(B=new ea(D.type,[B])));var Z=null;if(x.length===4){if(D.type.kind!=="string"&&B.type.kind!=="string"&&D.type.kind!=="value"&&B.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(x[3],3,Tn)))return null}return new g(D,B,Z)},g.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){var D=Wi(S),B=Wi(M);if(D.kind!==B.kind||D.kind!=="string"&&D.kind!=="number")throw new wa('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+B.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=Wi(S),j=Wi(M);if(Z.kind!=="string"||j.kind!=="string")return o(x,S,M)}return this.collator?u(x,S,M,this.collator.evaluate(x)):o(x,S,M)},g.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},g}()}Vi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Jr),h=o.parse(t[2],2,Et);if(!u||!h)return null;if(!Ca(u.type,[Si(Jr),Qr,Jr]))return o.error("Expected first argument to be of type array or string, but found "+gi(u.type)+" instead");if(t.length===4){var g=o.parse(t[3],3,Et);return g?new Vi(u.type,u,h,g):null}return new Vi(u.type,u,h)},Vi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!bi(o,["string","array"]))throw new wa("Expected first argument to be of type array or string, but found "+gi(Wi(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Vi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Vi.prototype.outputDefined=function(){return!1},Vi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ys=Bi("==",function(t,o,u){return o===u},ba),eu=Bi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!ba(0,o,u,h)}),Vu=Bi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),uf=Bi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),rl=Bi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Ic=Bi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Eu=function(t,o,u,h,g){this.type=Qr,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=g};Eu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Et);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var g=null;if(h.locale&&!(g=o.parse(h.locale,1,Qr)))return null;var x=null;if(h.currency&&!(x=o.parse(h.currency,1,Qr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Et)))return null;var M=null;return h["max-fraction-digits"]&&!(M=o.parse(h["max-fraction-digits"],1,Et))?null:new Eu(u,g,x,S,M)},Eu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Eu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Su=function(t){this.type=Et,this.input=t};Su.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+gi(u.type)+" instead."):new Su(u):null},Su.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new wa("Expected value to be of type string or array, but found "+gi(Wi(o))+" instead.")},Su.prototype.eachChild=function(t){t(this.input)},Su.prototype.outputDefined=function(){return!1},Su.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Cu={"==":ys,"!=":eu,">":uf,"<":Vu,">=":Ic,"<=":rl,array:ea,at:tr,boolean:ea,case:Rn,coalesce:at,collator:Do,format:Mo,image:Ho,in:ar,"index-of":Mn,interpolate:ve,"interpolate-hcl":ve,"interpolate-lab":ve,length:Su,let:ot,literal:Fa,match:ei,number:ea,"number-format":Eu,object:ea,slice:Vi,step:gs,string:ea,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:Cs,within:vs};function lo(t,o){var u=o[0],h=o[1],g=o[2],x=o[3];u=u.evaluate(t),h=h.evaluate(t),g=g.evaluate(t);var S=x?x.evaluate(t):1,M=de(u,h,g,S);if(M)throw new wa(M);return new Di(u/255*S,h/255*S,g/255*S,S)}function Bf(t,o){return t in o}function Nf(t,o){var u=o[t];return u===void 0?null:u}function $o(t){return{type:t}}function Oc(t){return{result:"success",value:t}}function wu(t){return{result:"error",value:t}}function tu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function lf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Sl(t){return!!t.expression&&t.expression.interpolated}function Oi(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Cl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Eh(t){return t}function nl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Rc(t,o,u,h,g){return nl(typeof u===g?h[u]:void 0,t.default,o.default)}function zf(t,o,u){if(Oi(u)!=="number")return nl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var g=Js(t.stops.map(function(x){return x[0]}),u);return t.stops[g][1]}function Sh(t,o,u){var h=t.base!==void 0?t.base:1;if(Oi(u)!=="number")return nl(t.default,o.default);var g=t.stops.length;if(g===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[g-1][0])return t.stops[g-1][1];var x=Js(t.stops.map(function(j){return j[0]}),u),S=function(j,K,O,we){var Pe=we-O,Ge=j-O;return Pe===0?0:K===1?Ge/Pe:(Math.pow(K,Ge)-1)/(Math.pow(K,Pe)-1)}(u,h,t.stops[x][0],t.stops[x+1][0]),M=t.stops[x][1],D=t.stops[x+1][1],B=va[o.type]||Eh;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=X[t.colorSpace];B=function(j,K){return Z.reverse(Z.interpolate(Z.forward(j),Z.forward(K),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var j=[],K=arguments.length;K--;)j[K]=arguments[K];var O=M.evaluate.apply(void 0,j),we=D.evaluate.apply(void 0,j);if(O!==void 0&&we!==void 0)return B(O,we,S)}}:B(M,D,S)}function Uf(t,o,u){return o.type==="color"?u=Di.parse(u):o.type==="formatted"?u=Ct.fromString(u.toString()):o.type==="resolvedImage"?u=Ji.fromString(u.toString()):Oi(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),nl(u,t.default,o.default)}Ha.register(Cu,{error:[{kind:"error"},[Qr],function(t,o){throw new wa(o[0].evaluate(t))}],typeof:[Qr,[Jr],function(t,o){return gi(Wi(o[0].evaluate(t)))}],"to-rgba":[Si(Et,4),[Wr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Wr,[Et,Et,Et],lo],rgba:[Wr,[Et,Et,Et,Et],lo],has:{type:Lr,overloads:[[[Qr],function(t,o){return Bf(o[0].evaluate(t),t.properties())}],[[Qr,hi],function(t,o){var u=o[1];return Bf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:Jr,overloads:[[[Qr],function(t,o){return Nf(o[0].evaluate(t),t.properties())}],[[Qr,hi],function(t,o){var u=o[1];return Nf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[Jr,[Qr],function(t,o){return Nf(o[0].evaluate(t),t.featureState||{})}],properties:[hi,[],function(t){return t.properties()}],"geometry-type":[Qr,[],function(t){return t.geometryType()}],id:[Jr,[],function(t){return t.id()}],zoom:[Et,[],function(t){return t.globals.zoom}],"heatmap-density":[Et,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Et,[],function(t){return t.globals.lineProgress||0}],accumulated:[Jr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Et,$o(Et),function(t,o){for(var u=0,h=0,g=o;h<g.length;h+=1)u+=g[h].evaluate(t);return u}],"*":[Et,$o(Et),function(t,o){for(var u=1,h=0,g=o;h<g.length;h+=1)u*=g[h].evaluate(t);return u}],"-":{type:Et,overloads:[[[Et,Et],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Et],function(t,o){return-o[0].evaluate(t)}]]},"/":[Et,[Et,Et],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Et,[Et,Et],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Et,[],function(){return Math.LN2}],pi:[Et,[],function(){return Math.PI}],e:[Et,[],function(){return Math.E}],"^":[Et,[Et,Et],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Et,[Et],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Et,[Et],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Et,[Et],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Et,[Et],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Et,[Et],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Et,[Et],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Et,[Et],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Et,[Et],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Et,[Et],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Et,[Et],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Et,$o(Et),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Et,$o(Et),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Et,[Et],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Et,[Et],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Et,[Et],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Et,[Et],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Lr,[Qr,Jr],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Lr,[Jr],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Lr,[Qr],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Lr,[Qr,Jr],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],x=h.value;return typeof g==typeof x&&g<x}],"filter-id-<":[Lr,[Jr],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h<g}],"filter->":[Lr,[Qr,Jr],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],x=h.value;return typeof g==typeof x&&g>x}],"filter-id->":[Lr,[Jr],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h>g}],"filter-<=":[Lr,[Qr,Jr],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],x=h.value;return typeof g==typeof x&&g<=x}],"filter-id-<=":[Lr,[Jr],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h<=g}],"filter->=":[Lr,[Qr,Jr],function(t,o){var u=o[0],h=o[1],g=t.properties()[u.value],x=h.value;return typeof g==typeof x&&g>=x}],"filter-id->=":[Lr,[Jr],function(t,o){var u=o[0],h=t.id(),g=u.value;return typeof h==typeof g&&h>=g}],"filter-has":[Lr,[Jr],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Lr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Lr,[Si(Qr)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Lr,[Si(Jr)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Lr,[Qr,Si(Jr)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Lr,[Qr,Si(Jr)],function(t,o){var u=o[0],h=o[1];return function(g,x,S,M){for(;S<=M;){var D=S+M>>1;if(x[D]===g)return!0;x[D]>g?M=D-1:S=D+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Lr,overloads:[[[Lr,Lr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[$o(Lr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Lr,overloads:[[[Lr,Lr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[$o(Lr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Lr,[Lr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Lr,[Qr],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[Qr,[Qr],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[Qr,[Qr],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[Qr,$o(Jr),function(t,o){return o.map(function(u){return hu(u.evaluate(t))}).join("")}],"resolved-locale":[Qr,[Tn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var kc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ta,this._defaultValue=o?function(u){return u.type==="color"&&Cl(u.default)?new Di(0,0,0,0):u.type==="color"?Di.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Jl(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Cu}function ec(t,o){var u=new Ps(Cu,[],o?function(g){var x={color:Wr,string:Qr,number:Et,enum:Qr,boolean:Lr,formatted:Zi,resolvedImage:si};return g.type==="array"?Si(x[g.value]||Jr,g.length):x[g.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Oc(new kc(h,o)):wu(u.errors)}kc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,x){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},kc.prototype.evaluate=function(t,o,u,h,g,x){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new wa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var wl=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Po(o.expression)};wl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,g,x)},wl.prototype.evaluate=function(t,o,u,h,g,x){return this._styleExpression.evaluate(t,o,u,h,g,x)};var il=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Po(o.expression),this.interpolationType=h};function Al(t,o){if((t=ec(t,o)).result==="error")return t;var u=t.value.expression,h=uo(u);if(!h&&!tu(o))return wu([new hr("","data expressions not supported")]);var g=ms(u,["zoom"]);if(!g&&!lf(o))return wu([new hr("","zoom expressions not supported")]);var x=function S(M){var D=null;if(M instanceof ot)D=S(M.result);else if(M instanceof at)for(var B=0,Z=M.args;B<Z.length&&!(D=S(Z[B]));B+=1);else(M instanceof gs||M instanceof ve)&&M.input instanceof Ha&&M.input.name==="zoom"&&(D=M);return D instanceof hr||M.eachChild(function(j){var K=S(j);K instanceof hr?D=K:!D&&K?D=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&K&&D!==K&&(D=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return x||g?x instanceof hr?wu([x]):x instanceof ve&&!Sl(o)?wu([new hr("",'"interpolate" expressions cannot be used with this property')]):Oc(x?new il(h?"camera":"composite",t.value,x.labels,x instanceof ve?x.interpolation:void 0):new wl(h?"constant":"source",t.value)):wu([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}il.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,g,x)},il.prototype.evaluate=function(t,o,u,h,g,x){return this._styleExpression.evaluate(t,o,u,h,g,x)},il.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?ve.interpolationFactor(this.interpolationType,t,o,u):0};var ju=function(t,o){this._parameters=t,this._specification=o,cr(this,function u(h,g){var x,S,M,D=g.type==="color",B=h.stops&&typeof h.stops[0][0]=="object",Z=B||!(B||h.property!==void 0),j=h.type||(Sl(g)?"exponential":"interval");if(D&&((h=cr({},h)).stops&&(h.stops=h.stops.map(function(sn){return[sn[0],Di.parse(sn[1])]})),h.default=Di.parse(h.default?h.default:g.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!X[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(j==="exponential")x=Sh;else if(j==="interval")x=zf;else if(j==="categorical"){x=Rc,S=Object.create(null);for(var K=0,O=h.stops;K<O.length;K+=1){var we=O[K];S[we[0]]=we[1]}M=typeof h.stops[0][0]}else{if(j!=="identity")throw new Error('Unknown function type "'+j+'"');x=Uf}if(B){for(var Pe={},Ge=[],Be=0;Be<h.stops.length;Be++){var et=h.stops[Be],mt=et[0].zoom;Pe[mt]===void 0&&(Pe[mt]={zoom:mt,type:h.type,property:h.property,default:h.default,stops:[]},Ge.push(mt)),Pe[mt].stops.push([et[0].value,et[1]])}for(var Pt=[],Vt=0,nr=Ge;Vt<nr.length;Vt+=1){var wr=nr[Vt];Pt.push([Pe[wr].zoom,u(Pe[wr],g)])}var Gr={name:"linear"};return{kind:"composite",interpolationType:Gr,interpolationFactor:ve.interpolationFactor.bind(void 0,Gr),zoomStops:Pt.map(function(sn){return sn[0]}),evaluate:function(sn,Un){var fn=sn.zoom;return Sh({stops:Pt,base:h.base},g,fn).evaluate(fn,Un)}}}if(Z){var Fn=j==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Fn,interpolationFactor:ve.interpolationFactor.bind(void 0,Fn),zoomStops:h.stops.map(function(sn){return sn[0]}),evaluate:function(sn){return x(h,g,sn.zoom,S,M)}}}return{kind:"source",evaluate:function(sn,Un){var fn=Un&&Un.properties?Un.properties[h.property]:void 0;return fn===void 0?nl(h.default,g.default):x(h,g,fn,S,M)}}}(this._parameters,this._specification))};function Us(t){var o=t.key,u=t.value,h=t.valueSpec||{},g=t.objectElementValidators||{},x=t.style,S=t.styleSpec,M=[],D=Oi(u);if(D!=="object")return[new Re(o,u,"object expected, "+D+" found")];for(var B in u){var Z=B.split(".")[0],j=h[Z]||h["*"],K=void 0;if(g[Z])K=g[Z];else if(h[Z])K=ji;else if(g["*"])K=g["*"];else{if(!h["*"]){M.push(new Re(o,u[B],'unknown property "'+B+'"'));continue}K=ji}M=M.concat(K({key:(o&&o+".")+B,value:u[B],valueSpec:j,style:x,styleSpec:S,object:u,objectKey:B},u))}for(var O in h)g[O]||h[O].required&&h[O].default===void 0&&u[O]===void 0&&M.push(new Re(o,u,'missing required property "'+O+'"'));return M}function cf(t){var o=t.value,u=t.valueSpec,h=t.style,g=t.styleSpec,x=t.key,S=t.arrayElementValidator||ji;if(Oi(o)!=="array")return[new Re(x,o,"array expected, "+Oi(o)+" found")];if(u.length&&o.length!==u.length)return[new Re(x,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Re(x,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var M={type:u.value,values:u.values};g.$version<7&&(M.function=u.function),Oi(u.value)==="object"&&(M=u.value);for(var D=[],B=0;B<o.length;B++)D=D.concat(S({array:o,arrayIndex:B,value:o[B],valueSpec:M,style:h,styleSpec:g,key:x+"["+B+"]"}));return D}function ff(t){var o=t.key,u=t.value,h=t.valueSpec,g=Oi(u);return g==="number"&&u!=u&&(g="NaN"),g!=="number"?[new Re(o,u,"number expected, "+g+" found")]:"minimum"in h&&u<h.minimum?[new Re(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Re(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Zf(t){var o,u,h,g=t.valueSpec,x=Tt(t.value.type),S={},M=x!=="categorical"&&t.value.property===void 0,D=!M,B=Oi(t.value.stops)==="array"&&Oi(t.value.stops[0])==="array"&&Oi(t.value.stops[0][0])==="object",Z=Us({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(x==="identity")return[new Re(O.key,O.value,'identity function may not have a "stops" property')];var we=[],Pe=O.value;return we=we.concat(cf({key:O.key,value:Pe,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:j})),Oi(Pe)==="array"&&Pe.length===0&&we.push(new Re(O.key,Pe,"array must have at least one stop")),we},default:function(O){return ji({key:O.key,value:O.value,valueSpec:g,style:O.style,styleSpec:O.styleSpec})}}});return x==="identity"&&M&&Z.push(new Re(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||Z.push(new Re(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!Sl(t.valueSpec)&&Z.push(new Re(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!tu(t.valueSpec)?Z.push(new Re(t.key,t.value,"property functions not supported")):M&&!lf(t.valueSpec)&&Z.push(new Re(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!B||t.value.property!==void 0||Z.push(new Re(t.key,t.value,'"property" property is required')),Z;function j(O){var we=[],Pe=O.value,Ge=O.key;if(Oi(Pe)!=="array")return[new Re(Ge,Pe,"array expected, "+Oi(Pe)+" found")];if(Pe.length!==2)return[new Re(Ge,Pe,"array length 2 expected, length "+Pe.length+" found")];if(B){if(Oi(Pe[0])!=="object")return[new Re(Ge,Pe,"object expected, "+Oi(Pe[0])+" found")];if(Pe[0].zoom===void 0)return[new Re(Ge,Pe,"object stop key must have zoom")];if(Pe[0].value===void 0)return[new Re(Ge,Pe,"object stop key must have value")];if(h&&h>Tt(Pe[0].zoom))return[new Re(Ge,Pe[0].zoom,"stop zoom values must appear in ascending order")];Tt(Pe[0].zoom)!==h&&(h=Tt(Pe[0].zoom),u=void 0,S={}),we=we.concat(Us({key:Ge+"[0]",value:Pe[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:ff,value:K}}))}else we=we.concat(K({key:Ge+"[0]",value:Pe[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},Pe));return Jl(Rt(Pe[1]))?we.concat([new Re(Ge+"[1]",Pe[1],"expressions are not allowed in function stops.")]):we.concat(ji({key:Ge+"[1]",value:Pe[1],valueSpec:g,style:O.style,styleSpec:O.styleSpec}))}function K(O,we){var Pe=Oi(O.value),Ge=Tt(O.value),Be=O.value!==null?O.value:we;if(o){if(Pe!==o)return[new Re(O.key,Be,Pe+" stop domain type must match previous stop domain type "+o)]}else o=Pe;if(Pe!=="number"&&Pe!=="string"&&Pe!=="boolean")return[new Re(O.key,Be,"stop domain value must be a number, string, or boolean")];if(Pe!=="number"&&x!=="categorical"){var et="number expected, "+Pe+" found";return tu(g)&&x===void 0&&(et+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(O.key,Be,et)]}return x!=="categorical"||Pe!=="number"||isFinite(Ge)&&Math.floor(Ge)===Ge?x!=="categorical"&&Pe==="number"&&u!==void 0&&Ge<u?[new Re(O.key,Be,"stop domain values must appear in ascending order")]:(u=Ge,x==="categorical"&&Ge in S?[new Re(O.key,Be,"stop domain values must be unique")]:(S[Ge]=!0,[])):[new Re(O.key,Be,"integer expected, found "+Ge)]}}function ru(t){var o=(t.expressionContext==="property"?Al:ec)(Rt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Re(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Re(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Po(u))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Po(u))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ms(u,["zoom","feature-state"]))return[new Re(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!uo(u))return[new Re(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tc(t){var o=t.key,u=t.value,h=t.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Tt(u))===-1&&g.push(new Re(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Tt(u))===-1&&g.push(new Re(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),g}function Lc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Lc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}ju.deserialize=function(t){return new ju(t._parameters,t._specification)},ju.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var hf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Tl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Lc(t)||(t=pf(t));var o=ec(t,hf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,g){return o.value.evaluate(u,h,{},g)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var g=1;g<h.length;g++)if(u(h[g]))return!0;return!1}(t)}}function tp(t,o){return t<o?-1:t>o?1:0}function pf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Ml(t[1],t[2],"=="):u==="!="?Pl(Ml(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Ml(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(pf))):u==="all"?["all"].concat(t.slice(1).map(pf)):u==="none"?["all"].concat(t.slice(1).map(pf).map(Pl)):u==="in"?df(t[1],t.slice(2)):u==="!in"?Pl(df(t[1],t.slice(2))):u==="has"?vf(t[1]):u==="!has"?Pl(vf(t[1])):u!=="within"||t}function Ml(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function df(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(tp)]]:["filter-in-small",t,["literal",o]]}}function vf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Pl(t){return["!",t]}function Dc(t){return Lc(Rt(t.value))?ru(cr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,g=u.key;if(Oi(h)!=="array")return[new Re(g,h,"array expected, "+Oi(h)+" found")];var x,S=u.styleSpec,M=[];if(h.length<1)return[new Re(g,h,"filter array must have at least 1 element")];switch(M=M.concat(tc({key:g+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Tt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Tt(h[1])==="$type"&&M.push(new Re(g,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Re(g,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(x=Oi(h[1]))!=="string"&&M.push(new Re(g+"[1]",h[1],"string expected, "+x+" found"));for(var D=2;D<h.length;D++)x=Oi(h[D]),Tt(h[1])==="$type"?M=M.concat(tc({key:g+"["+D+"]",value:h[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&M.push(new Re(g+"["+D+"]",h[D],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var B=1;B<h.length;B++)M=M.concat(o({key:g+"["+B+"]",value:h[B],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":x=Oi(h[1]),h.length!==2?M.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="string"&&M.push(new Re(g+"[1]",h[1],"string expected, "+x+" found"));break;case"within":x=Oi(h[1]),h.length!==2?M.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="object"&&M.push(new Re(g+"[1]",h[1],"object expected, "+x+" found"))}return M}(t)}function Ch(t,o){var u=t.key,h=t.style,g=t.styleSpec,x=t.value,S=t.objectKey,M=g[o+"_"+t.layerType];if(!M)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return ji({key:u,value:x,valueSpec:g.transition,style:h,styleSpec:g});var B,Z=t.valueSpec||M[S];if(!Z)return[new Re(u,x,'unknown property "'+S+'"')];if(Oi(x)==="string"&&tu(Z)&&!Z.tokens&&(B=/^{([^}]+)}$/.exec(x)))return[new Re(u,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var j=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&j.push(new Re(u,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Cl(Rt(x))&&Tt(x.type)==="identity"&&j.push(new Re(u,x,'"text-font" does not support identity functions'))),j.concat(ji({key:t.key,value:x,valueSpec:Z,style:h,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:S}))}function wh(t){return Ch(t,"paint")}function rc(t){return Ch(t,"layout")}function Ah(t){var o=[],u=t.value,h=t.key,g=t.style,x=t.styleSpec;u.type||u.ref||o.push(new Re(h,u,'either "type" or "ref" is required'));var S,M=Tt(u.type),D=Tt(u.ref);if(u.id)for(var B=Tt(u.id),Z=0;Z<t.arrayIndex;Z++){var j=g.layers[Z];Tt(j.id)===B&&o.push(new Re(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+j.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(we){we in u&&o.push(new Re(h,u[we],'"'+we+'" is prohibited for ref layers'))}),g.layers.forEach(function(we){Tt(we.id)===D&&(S=we)}),S?S.ref?o.push(new Re(h,u.ref,"ref cannot reference another ref layer")):M=Tt(S.type):o.push(new Re(h,u.ref,'ref layer "'+D+'" not found'));else if(M!=="background")if(u.source){var K=g.sources&&g.sources[u.source],O=K&&Tt(K.type);K?O==="vector"&&M==="raster"?o.push(new Re(h,u.source,'layer "'+u.id+'" requires a raster source')):O==="raster"&&M!=="raster"?o.push(new Re(h,u.source,'layer "'+u.id+'" requires a vector source')):O!=="vector"||u["source-layer"]?O==="raster-dem"&&M!=="hillshade"?o.push(new Re(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]||O==="geojson"&&K.lineMetrics||o.push(new Re(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Re(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Re(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Re(h,u,'missing required property "source"'));return o=o.concat(Us({key:h,value:u,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ji({key:h+".type",value:u.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:Dc,layout:function(we){return Us({layer:u,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Pe){return rc(cr({layerType:M},Pe))}}})},paint:function(we){return Us({layer:u,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Pe){return wh(cr({layerType:M},Pe))}}})}}}))}function Il(t){var o=t.value,u=t.key,h=Oi(o);return h!=="string"?[new Re(u,o,"string expected, "+h+" found")]:[]}var Hi={promoteId:function(t){var o=t.key,u=t.value;if(Oi(u)==="string")return Il({key:o,value:u});var h=[];for(var g in u)h.push.apply(h,Il({key:o+"."+g,value:u[g]}));return h}};function nc(t){var o=t.value,u=t.key,h=t.styleSpec,g=t.style;if(!o.type)return[new Re(u,o,'"type" is required')];var x,S=Tt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Us({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Hi});case"geojson":if(x=Us({key:u,value:o,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:Hi}),o.cluster)for(var M in o.clusterProperties){var D=o.clusterProperties[M],B=D[0],Z=typeof B=="string"?[B,["accumulated"],["get",M]]:B;x.push.apply(x,ru({key:u+"."+M+".map",value:D[1],expressionContext:"cluster-map"})),x.push.apply(x,ru({key:u+"."+M+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return x;case"video":return Us({key:u,value:o,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return Us({key:u,value:o,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new Re(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function na(t){var o=t.value,u=t.styleSpec,h=u.light,g=t.style,x=[],S=Oi(o);if(o===void 0)return x;if(S!=="object")return x.concat([new Re("light",o,"object expected, "+S+" found")]);for(var M in o){var D=M.match(/^(.*)-transition$/);x=x.concat(D&&h[D[1]]&&h[D[1]].transition?ji({key:M,value:o[M],valueSpec:u.transition,style:g,styleSpec:u}):h[M]?ji({key:M,value:o[M],valueSpec:h[M],style:g,styleSpec:u}):[new Re(M,o[M],'unknown property "'+M+'"')])}return x}var Au={"*":function(){return[]},array:cf,boolean:function(t){var o=t.value,u=t.key,h=Oi(o);return h!=="boolean"?[new Re(u,o,"boolean expected, "+h+" found")]:[]},number:ff,color:function(t){var o=t.key,u=t.value,h=Oi(u);return h!=="string"?[new Re(o,u,"color expected, "+h+" found")]:Ci(u)===null?[new Re(o,u,'color expected, "'+u+'" found')]:[]},constants:ut,enum:tc,filter:Dc,function:Zf,layer:Ah,object:Us,source:nc,light:na,string:Il,formatted:function(t){return Il(t).length===0?[]:ru(t)},resolvedImage:function(t){return Il(t).length===0?[]:ru(t)}};function ji(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Cl(Tt(o))?Zf(t):u.expression&&Jl(Rt(o))?ru(t):u.type&&Au[u.type]?Au[u.type](t):Us(cr({},t,{valueSpec:u.type?h[u.type]:u}))}function Aa(t){var o=t.value,u=t.key,h=Il(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Re(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Re(u,o,'"glyphs" url must include a "{range}" token'))),h}function _s(t,o){o===void 0&&(o=oe);var u=[];return u=u.concat(ji({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Aa,"*":function(){return[]}}})),t.constants&&(u=u.concat(ut({key:"constants",value:t.constants,style:t,styleSpec:o}))),Fc(u)}function Fc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function Gu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Fc(t.apply(this,o))}}_s.source=Gu(nc),_s.light=Gu(na),_s.layer=Gu(Ah),_s.filter=Gu(Dc),_s.paintProperty=Gu(wh),_s.layoutProperty=Gu(rc);var Na=_s,ic=Na.light,Ol=Na.paintProperty,Hu=Na.layoutProperty;function Bc(t,o){var u=!1;if(o&&o.length)for(var h=0,g=o;h<g.length;h+=1)t.fire(new Ue(new Error(g[h].message))),u=!0;return u}var Tu=po;function po(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(o=g[1])+2*(u=g[2]);for(var x=0;x<this.d*this.d;x++){var S=g[3+x],M=g[3+x+1];h.push(S===M?null:g.subarray(S,M))}var D=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],D),this.bboxes=g.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var B=0;B<this.d*this.d;B++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}po.prototype.insert=function(t,o,u,h,g){this._forEachCell(o,u,h,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g)},po.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},po.prototype._insertCell=function(t,o,u,h,g,x){this.cells[g].push(x)},po.prototype.query=function(t,o,u,h,g){var x=this.min,S=this.max;if(t<=x&&o<=x&&S<=u&&S<=h&&!g)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,o,u,h,this._queryCell,M,{},g),M},po.prototype._queryCell=function(t,o,u,h,g,x,S,M){var D=this.cells[g];if(D!==null)for(var B=this.keys,Z=this.bboxes,j=0;j<D.length;j++){var K=D[j];if(S[K]===void 0){var O=4*K;(M?M(Z[O+0],Z[O+1],Z[O+2],Z[O+3]):t<=Z[O+2]&&o<=Z[O+3]&&u>=Z[O+0]&&h>=Z[O+1])?(S[K]=!0,x.push(B[K])):S[K]=!1}}},po.prototype._forEachCell=function(t,o,u,h,g,x,S,M){for(var D=this._convertToCellCoord(t),B=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),j=this._convertToCellCoord(h),K=D;K<=Z;K++)for(var O=B;O<=j;O++){var we=this.d*O+K;if((!M||M(this._convertFromCellCoord(K),this._convertFromCellCoord(O),this._convertFromCellCoord(K+1),this._convertFromCellCoord(O+1)))&&g.call(this,t,o,u,h,we,x,S,M))return}},po.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},po.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},po.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var g=new Int32Array(o+u+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=o,S=0;S<t.length;S++){var M=t[S];g[3+S]=x,g.set(M,x),x+=M.length}return g[3+t.length]=x,g.set(this.keys,x),g[3+t.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer};var Rl=ye.ImageData,ac=ye.ImageBitmap,vo={};function hn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),vo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var co in hn("Object",Object),Tu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Tu.deserialize=function(t){return new Tu(t.buffer)},hn("Grid",Tu),hn("Color",Di),hn("Error",Error),hn("ResolvedImage",Ji),hn("StylePropertyFunction",ju),hn("StyleExpression",kc,{omit:["_evaluator"]}),hn("ZoomDependentExpression",il),hn("ZoomConstantExpression",wl),hn("CompoundExpression",Ha,{omit:["_evaluate"]}),Cu)Cu[co]._classRegistryKey||hn("Expression_"+co,Cu[co]);function Wu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return ac&&t instanceof ac}function Zs(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Wu(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Rl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],g=0,x=t;g<x.length;g+=1)h.push(Zs(x[g],o));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var B in t)if(t.hasOwnProperty(B)&&!(vo[M].omit.indexOf(B)>=0)){var Z=t[B];D[B]=vo[M].shallow.indexOf(B)>=0?Z:Zs(Z,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(D.$name=M),D}throw new Error("can't serialize object of type "+typeof t)}function ws(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Wu(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Rl)return t;if(Array.isArray(t))return t.map(ws);if(typeof t=="object"){var o=t.$name||"Object",u=vo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),g=0,x=Object.keys(t);g<x.length;g+=1){var S=x[g];if(S!=="$name"){var M=t[S];h[S]=vo[o].shallow.indexOf(S)>=0?M:ws(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var mf=function(){this.first=!0};mf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function oc(t){for(var o=0,u=t;o<u.length;o+=1)if(gf(u[o].charCodeAt(0)))return!0;return!1}function gf(t){return!(t!==746&&t!==747&&(t<4352||!(zr["Bopomofo Extended"](t)||zr.Bopomofo(t)||zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zr["CJK Compatibility Ideographs"](t)||zr["CJK Compatibility"](t)||zr["CJK Radicals Supplement"](t)||zr["CJK Strokes"](t)||!(!zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zr["CJK Unified Ideographs Extension A"](t)||zr["CJK Unified Ideographs"](t)||zr["Enclosed CJK Letters and Months"](t)||zr["Hangul Compatibility Jamo"](t)||zr["Hangul Jamo Extended-A"](t)||zr["Hangul Jamo Extended-B"](t)||zr["Hangul Jamo"](t)||zr["Hangul Syllables"](t)||zr.Hiragana(t)||zr["Ideographic Description Characters"](t)||zr.Kanbun(t)||zr["Kangxi Radicals"](t)||zr["Katakana Phonetic Extensions"](t)||zr.Katakana(t)&&t!==12540||!(!zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zr["Unified Canadian Aboriginal Syllabics"](t)||zr["Unified Canadian Aboriginal Syllabics Extended"](t)||zr["Vertical Forms"](t)||zr["Yijing Hexagram Symbols"](t)||zr["Yi Syllables"](t)||zr["Yi Radicals"](t))))}function al(t){return!(gf(t)||function(o){return!!(zr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||zr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||zr["Letterlike Symbols"](o)||zr["Number Forms"](o)||zr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||zr["Control Pictures"](o)&&o!==9251||zr["Optical Character Recognition"](o)||zr["Enclosed Alphanumerics"](o)||zr["Geometric Shapes"](o)||zr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||zr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||zr["CJK Symbols and Punctuation"](o)||zr.Katakana(o)||zr["Private Use Area"](o)||zr["CJK Compatibility Forms"](o)||zr["Small Form Variants"](o)||zr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ea(t){return t>=1424&&t<=2303||zr["Arabic Presentation Forms-A"](t)||zr["Arabic Presentation Forms-B"](t)}function xs(t,o){return!(!o&&Ea(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zr.Khmer(t))}function yf(t){for(var o=0,u=t;o<u.length;o+=1)if(Ea(u[o].charCodeAt(0)))return!0;return!1}var Mu=null,Is="unavailable",Pu=null,Vf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Is="error"),Mu&&Mu(t)};function ol(){jf.fire(new Me("pluginStateChange",{pluginStatus:Is,pluginURL:Pu}))}var jf=new Ke,_f=function(){return Is},nu=function(){if(Is!=="deferred"||!Pu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Is="loading",ol(),Pu&&Da({url:Pu},function(t){t?Vf(t):(Is="loaded",ol())})},As={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Is==="loaded"||As.applyArabicShaping!=null},isLoading:function(){return Is==="loading"},setState:function(t){Is=t.pluginStatus,Pu=t.pluginURL},isParsed:function(){return As.applyArabicShaping!=null&&As.processBidirectionalText!=null&&As.processStyledBidirectionalText!=null},getPluginURL:function(){return Pu}},Ei=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mf,this.transition={})};Ei.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,g=o;h<g.length;h+=1)if(!xs(g[h].charCodeAt(0),u))return!1;return!0}(t,As.isLoaded())},Ei.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ei.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Iu=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Cl(u))return new ju(u,h);if(Jl(u)){var g=Al(u,h);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var x=u;return typeof u=="string"&&h.type==="color"&&(x=Di.parse(u)),{kind:"constant",evaluate:function(){return x}}}(o===void 0?t.specification.default:o,t.specification)};Iu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Iu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var iu=function(t){this.property=t,this.value=new Iu(t,void 0)};iu.prototype.transitioned=function(t,o){return new sl(this.property,this.value,o,It({},t.transition,this.transition),t.now)},iu.prototype.untransitioned=function(){return new sl(this.property,this.value,null,{},0)};var Xo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Xo.prototype.getValue=function(t){return Ye(this._values[t].value.value)},Xo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new iu(this._values[t].property)),this._values[t].value=new Iu(this._values[t].property,o===null?void 0:Ye(o))},Xo.prototype.getTransition=function(t){return Ye(this._values[t].transition)},Xo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new iu(this._values[t].property)),this._values[t].transition=Ye(o)||void 0},Xo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],g=this.getValue(h);g!==void 0&&(t[h]=g);var x=this.getTransition(h);x!==void 0&&(t[h+"-transition"]=x)}return t},Xo.prototype.transitioned=function(t,o){for(var u=new as(this._properties),h=0,g=Object.keys(this._values);h<g.length;h+=1){var x=g[h];u._values[x]=this._values[x].transitioned(t,o._values[x])}return u},Xo.prototype.untransitioned=function(){for(var t=new as(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var sl=function(t,o,u,h,g){this.property=t,this.value=o,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};sl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,g=this.value.possiblyEvaluate(t,o,u),x=this.prior;if(x){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return x.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,o,u),g,function(M){if(M<=0)return 0;if(M>=1)return 1;var D=M*M,B=D*M;return 4*(M<.5?B:3*(M-D)+B-.75)}(S))}return g};var as=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};as.prototype.possiblyEvaluate=function(t,o,u){for(var h=new pu(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},as.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Vs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Vs.prototype.getValue=function(t){return Ye(this._values[t].value)},Vs.prototype.setValue=function(t,o){this._values[t]=new Iu(this._values[t].property,o===null?void 0:Ye(o))},Vs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],g=this.getValue(h);g!==void 0&&(t[h]=g)}return t},Vs.prototype.possiblyEvaluate=function(t,o,u){for(var h=new pu(this._properties),g=0,x=Object.keys(this._values);g<x.length;g+=1){var S=x[g];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var bs=function(t,o,u){this.property=t,this.value=o,this.parameters=u};bs.prototype.isConstant=function(){return this.value.kind==="constant"},bs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},bs.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var pu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};pu.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},On.prototype.interpolate=function(t,o,u){var h=va[this.specification.type];return h?h(t,o,u):t};var Sn=function(t,o){this.specification=t,this.overrides=o};Sn.prototype.possiblyEvaluate=function(t,o,u,h){return new bs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Sn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new bs(this,{kind:"constant",value:void 0},t.parameters);var h=va[this.specification.type];return h?new bs(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Sn.prototype.evaluate=function(t,o,u,h,g,x){return t.kind==="constant"?t.value:t.evaluate(o,u,h,g,x)};var Nc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,g,x){if(u.value===void 0)return new bs(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},g,x),M=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(M,M,M,h);return new bs(this,{kind:"constant",value:D},h)}if(u.expression.kind==="camera"){var B=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new bs(this,{kind:"constant",value:B},h)}return new bs(this,u.expression,h)},o.prototype.evaluate=function(u,h,g,x,S,M){if(u.kind==="source"){var D=u.evaluate(h,g,x,S,M);return this._calculate(D,D,D,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},g,x),u.evaluate({zoom:Math.floor(h.zoom)},g,x),u.evaluate({zoom:Math.floor(h.zoom)+1},g,x),h):u.value},o.prototype._calculate=function(u,h,g,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:g,to:h}},o.prototype.interpolate=function(u){return u},o}(Sn),os=function(t){this.specification=t};os.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(o,null,{},u,h);return this._calculate(g,g,g,o)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ei(Math.floor(o.zoom),o)),t.expression.evaluate(new Ei(Math.floor(o.zoom+1),o)),o)}},os.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},os.prototype.interpolate=function(t){return t};var au=function(t){this.specification=t};au.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},au.prototype.interpolate=function(){return!1};var Fo=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new Iu(u,void 0),g=this.defaultTransitionablePropertyValues[o]=new iu(u);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};hn("DataDrivenProperty",Sn),hn("DataConstantProperty",On),hn("CrossFadedDataDrivenProperty",Nc),hn("CrossFadedProperty",os),hn("ColorRampProperty",au);var Ou=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Vs(h.layout)),h.paint)){for(var g in this._transitionablePaint=new Xo(h.paint),u.paint)this.setPaintProperty(g,u.paint[g],{validate:!1});for(var x in u.layout)this.setLayoutProperty(x,u.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,g){g===void 0&&(g={}),h!=null&&this._validate(Hu,"layers."+this.id+".layout."+u,u,h,g)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,g){if(g===void 0&&(g={}),h!=null&&this._validate(Ol,"layers."+this.id+".paint."+u,u,h,g))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var x=this._transitionablePaint._values[u],S=x.property.specification["property-type"]==="cross-faded-data-driven",M=x.value.isDataDriven(),D=x.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var B=this._transitionablePaint._values[u].value;return B.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(u,D,B)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,g){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),st(u,function(h,g){return!(h===void 0||g==="layout"&&!Object.keys(h).length||g==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,g,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Bc(this,u.call(Na,{key:h,layerType:this.type,objectKey:g,value:x,styleSpec:oe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof bs&&tu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(Ke),xf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},bf=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ua=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function pa(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(g){var x=xf[g.type].BYTES_PER_ELEMENT,S=u=Th(u,Math.max(o,x)),M=g.components||1;return h=Math.max(h,x),u+=x*M,{name:g.name,type:g.type,components:M,offset:S}}),size:Th(u,Math.max(h,o)),alignment:o}}function Th(t,o){return Math.ceil(t/o)*o}ua.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ua.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ua.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ua.prototype.clear=function(){this.length=0},ua.prototype.resize=function(t){this.reserve(t),this.length=t},ua.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ua.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var x=2*u;return this.int16[x+0]=h,this.int16[x+1]=g,u},o}(ua);Xu.prototype.bytesPerElement=4,hn("StructArrayLayout2i4",Xu);var du=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,x)},o.prototype.emplace=function(u,h,g,x,S){var M=4*u;return this.int16[M+0]=h,this.int16[M+1]=g,this.int16[M+2]=x,this.int16[M+3]=S,u},o}(ua);du.prototype.bytesPerElement=8,hn("StructArrayLayout4i8",du);var Xi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,x,S,M)},o.prototype.emplace=function(u,h,g,x,S,M,D){var B=6*u;return this.int16[B+0]=h,this.int16[B+1]=g,this.int16[B+2]=x,this.int16[B+3]=S,this.int16[B+4]=M,this.int16[B+5]=D,u},o}(ua);Xi.prototype.bytesPerElement=12,hn("StructArrayLayout2i4i12",Xi);var ro=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,x,S,M)},o.prototype.emplace=function(u,h,g,x,S,M,D){var B=4*u,Z=8*u;return this.int16[B+0]=h,this.int16[B+1]=g,this.uint8[Z+4]=x,this.uint8[Z+5]=S,this.uint8[Z+6]=M,this.uint8[Z+7]=D,u},o}(ua);ro.prototype.bytesPerElement=8,hn("StructArrayLayout2i4ub8",ro);var Os=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var x=2*u;return this.float32[x+0]=h,this.float32[x+1]=g,u},o}(ua);Os.prototype.bytesPerElement=8,hn("StructArrayLayout2f8",Os);var js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M,D,B,Z,j){var K=this.length;return this.resize(K+1),this.emplace(K,u,h,g,x,S,M,D,B,Z,j)},o.prototype.emplace=function(u,h,g,x,S,M,D,B,Z,j,K){var O=10*u;return this.uint16[O+0]=h,this.uint16[O+1]=g,this.uint16[O+2]=x,this.uint16[O+3]=S,this.uint16[O+4]=M,this.uint16[O+5]=D,this.uint16[O+6]=B,this.uint16[O+7]=Z,this.uint16[O+8]=j,this.uint16[O+9]=K,u},o}(ua);js.prototype.bytesPerElement=20,hn("StructArrayLayout10ui20",js);var ul=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M,D,B,Z,j,K,O){var we=this.length;return this.resize(we+1),this.emplace(we,u,h,g,x,S,M,D,B,Z,j,K,O)},o.prototype.emplace=function(u,h,g,x,S,M,D,B,Z,j,K,O,we){var Pe=12*u;return this.int16[Pe+0]=h,this.int16[Pe+1]=g,this.int16[Pe+2]=x,this.int16[Pe+3]=S,this.uint16[Pe+4]=M,this.uint16[Pe+5]=D,this.uint16[Pe+6]=B,this.uint16[Pe+7]=Z,this.int16[Pe+8]=j,this.int16[Pe+9]=K,this.int16[Pe+10]=O,this.int16[Pe+11]=we,u},o}(ua);ul.prototype.bytesPerElement=24,hn("StructArrayLayout4i4ui4i24",ul);var Ru=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,g)},o.prototype.emplace=function(u,h,g,x){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=g,this.float32[S+2]=x,u},o}(ua);Ru.prototype.bytesPerElement=12,hn("StructArrayLayout3f12",Ru);var kl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(ua);kl.prototype.bytesPerElement=4,hn("StructArrayLayout1ul4",kl);var mo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M,D,B,Z){var j=this.length;return this.resize(j+1),this.emplace(j,u,h,g,x,S,M,D,B,Z)},o.prototype.emplace=function(u,h,g,x,S,M,D,B,Z,j){var K=10*u,O=5*u;return this.int16[K+0]=h,this.int16[K+1]=g,this.int16[K+2]=x,this.int16[K+3]=S,this.int16[K+4]=M,this.int16[K+5]=D,this.uint32[O+3]=B,this.uint16[K+8]=Z,this.uint16[K+9]=j,u},o}(ua);mo.prototype.bytesPerElement=20,hn("StructArrayLayout6i1ul2ui20",mo);var sc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,g,x,S,M)},o.prototype.emplace=function(u,h,g,x,S,M,D){var B=6*u;return this.int16[B+0]=h,this.int16[B+1]=g,this.int16[B+2]=x,this.int16[B+3]=S,this.int16[B+4]=M,this.int16[B+5]=D,u},o}(ua);sc.prototype.bytesPerElement=12,hn("StructArrayLayout2i2i2i12",sc);var Ll=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S){var M=this.length;return this.resize(M+1),this.emplace(M,u,h,g,x,S)},o.prototype.emplace=function(u,h,g,x,S,M){var D=4*u,B=8*u;return this.float32[D+0]=h,this.float32[D+1]=g,this.float32[D+2]=x,this.int16[B+6]=S,this.int16[B+7]=M,u},o}(ua);Ll.prototype.bytesPerElement=16,hn("StructArrayLayout2f1f2i16",Ll);var Ef=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,x)},o.prototype.emplace=function(u,h,g,x,S){var M=12*u,D=3*u;return this.uint8[M+0]=h,this.uint8[M+1]=g,this.float32[D+1]=x,this.float32[D+2]=S,u},o}(ua);Ef.prototype.bytesPerElement=12,hn("StructArrayLayout2ub2f12",Ef);var ll=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,g)},o.prototype.emplace=function(u,h,g,x){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=g,this.uint16[S+2]=x,u},o}(ua);ll.prototype.bytesPerElement=6,hn("StructArrayLayout3ui6",ll);var cl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et){var mt=this.length;return this.resize(mt+1),this.emplace(mt,u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et)},o.prototype.emplace=function(u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et,mt){var Pt=24*u,Vt=12*u,nr=48*u;return this.int16[Pt+0]=h,this.int16[Pt+1]=g,this.uint16[Pt+2]=x,this.uint16[Pt+3]=S,this.uint32[Vt+2]=M,this.uint32[Vt+3]=D,this.uint32[Vt+4]=B,this.uint16[Pt+10]=Z,this.uint16[Pt+11]=j,this.uint16[Pt+12]=K,this.float32[Vt+7]=O,this.float32[Vt+8]=we,this.uint8[nr+36]=Pe,this.uint8[nr+37]=Ge,this.uint8[nr+38]=Be,this.uint32[Vt+10]=et,this.int16[Pt+22]=mt,u},o}(ua);cl.prototype.bytesPerElement=48,hn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cl);var uc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et,mt,Pt,Vt,nr,wr,Gr,Fn,sn,Un,fn,Ai){var Jn=this.length;return this.resize(Jn+1),this.emplace(Jn,u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et,mt,Pt,Vt,nr,wr,Gr,Fn,sn,Un,fn,Ai)},o.prototype.emplace=function(u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe,Ge,Be,et,mt,Pt,Vt,nr,wr,Gr,Fn,sn,Un,fn,Ai,Jn){var Pn=34*u,ki=17*u;return this.int16[Pn+0]=h,this.int16[Pn+1]=g,this.int16[Pn+2]=x,this.int16[Pn+3]=S,this.int16[Pn+4]=M,this.int16[Pn+5]=D,this.int16[Pn+6]=B,this.int16[Pn+7]=Z,this.uint16[Pn+8]=j,this.uint16[Pn+9]=K,this.uint16[Pn+10]=O,this.uint16[Pn+11]=we,this.uint16[Pn+12]=Pe,this.uint16[Pn+13]=Ge,this.uint16[Pn+14]=Be,this.uint16[Pn+15]=et,this.uint16[Pn+16]=mt,this.uint16[Pn+17]=Pt,this.uint16[Pn+18]=Vt,this.uint16[Pn+19]=nr,this.uint16[Pn+20]=wr,this.uint16[Pn+21]=Gr,this.uint16[Pn+22]=Fn,this.uint32[ki+12]=sn,this.float32[ki+13]=Un,this.float32[ki+14]=fn,this.float32[ki+15]=Ai,this.float32[ki+16]=Jn,u},o}(ua);uc.prototype.bytesPerElement=68,hn("StructArrayLayout8i15ui1ul4f68",uc);var ku=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(ua);ku.prototype.bytesPerElement=4,hn("StructArrayLayout1f4",ku);var Gs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,g)},o.prototype.emplace=function(u,h,g,x){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=g,this.int16[S+2]=x,u},o}(ua);Gs.prototype.bytesPerElement=6,hn("StructArrayLayout3i6",Gs);var zc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,g)},o.prototype.emplace=function(u,h,g,x){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=g,this.uint16[S+3]=x,u},o}(ua);zc.prototype.bytesPerElement=8,hn("StructArrayLayout1ul2ui8",zc);var Uc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var g=this.length;return this.resize(g+1),this.emplace(g,u,h)},o.prototype.emplace=function(u,h,g){var x=2*u;return this.uint16[x+0]=h,this.uint16[x+1]=g,u},o}(ua);Uc.prototype.bytesPerElement=4,hn("StructArrayLayout2ui4",Uc);var Gf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(ua);Gf.prototype.bytesPerElement=2,hn("StructArrayLayout1ui2",Gf);var lc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,g,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,g,x)},o.prototype.emplace=function(u,h,g,x,S){var M=4*u;return this.float32[M+0]=h,this.float32[M+1]=g,this.float32[M+2]=x,this.float32[M+3]=S,u},o}(ua);lc.prototype.bytesPerElement=16,hn("StructArrayLayout4f16",lc);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new he(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(bf);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(mo);hn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(bf);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(cl);hn("PlacedSymbolArray",d);var b=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(bf);b.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new b(this,u)},o}(uc);hn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(ku);hn("GlyphOffsetArray",P);var k=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Gs);hn("SymbolLineVertexArray",k);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(bf);U.prototype.size=8;var G=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(zc);hn("FeatureIndexArray",G);var ae=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(t){t===void 0&&(t=[]),this.segments=t};function re(t,o){return 256*(t=Jt(Math.floor(t),0,255))+Jt(Math.floor(o),0,255)}se.prototype.prepareSegment=function(t,o,u,h){var g=this.segments[this.segments.length-1];return t>se.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>se.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},se.simpleSegment=function(t,o,u,h){return new se([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hn("SegmentVector",se);var be=pa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Te=Oe(function(t){t.exports=function(o,u){var h,g,x,S,M,D,B,Z;for(g=o.length-(h=3&o.length),x=u,M=3432918353,D=461845907,Z=0;Z<g;)B=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,x=27492+(65535&(S=5*(65535&(x=(x^=B=(65535&(B=(B=(65535&B)*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(B=0,h){case 3:B^=(255&o.charCodeAt(Z+2))<<16;case 2:B^=(255&o.charCodeAt(Z+1))<<8;case 1:x^=B=(65535&(B=(B=(65535&(B^=255&o.charCodeAt(Z)))*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295}return x^=o.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),Ze=Oe(function(t){t.exports=function(o,u){for(var h,g=o.length,x=u^g,S=0;g>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:x^=(255&o.charCodeAt(S+2))<<16;case 2:x^=(255&o.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&o.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),xe=Te,Ve=Ze;xe.murmur3=Te,xe.murmur2=Ve;var qe=function(){this.ids=[],this.positions=[],this.indexed=!1};qe.prototype.add=function(t,o,u,h){this.ids.push(Gt(t)),this.positions.push(o,u,h)},qe.prototype.getPositions=function(t){for(var o=Gt(t),u=0,h=this.ids.length-1;u<h;){var g=u+h>>1;this.ids[g]>=o?h=g:u=g+1}for(var x=[];this.ids[u]===o;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x},qe.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function g(x,S,M,D){for(;M<D;){for(var B=x[M+D>>1],Z=M-1,j=D+1;;){do Z++;while(x[Z]<B);do j--;while(x[j]>B);if(Z>=j)break;Dt(x,Z,j),Dt(S,3*Z,3*j),Dt(S,3*Z+1,3*j+1),Dt(S,3*Z+2,3*j+2)}j-M<D-j?(g(x,S,M,j),M=j+1):(g(x,S,j+1,D),D=j)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},qe.deserialize=function(t){var o=new qe;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var dt=Math.pow(2,53)-1;function Gt(t){var o=+t;return!isNaN(o)&&o<=dt?o:xe(String(t))}function Dt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}hn("FeaturePositionMap",qe);var zt=function(t,o){this.gl=t.gl,this.location=o},pr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(zt),kr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(zt),Ir=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(zt),Kr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(zt),Dn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(zt),kn=function(t){function o(u,h){t.call(this,u,h),this.current=Di.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(zt),zn=new Float32Array(16),Pi=function(t){function o(u,h){t.call(this,u,h),this.current=zn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(zt);function en(t){return[re(255*t.r,255*t.g),re(255*t.b,255*t.a)]}var $n=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};$n.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},$n.prototype.getBinding=function(t,o,u){return this.type==="color"?new kn(t,o):new kr(t,o)};var ai=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ai.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},ai.prototype.setUniform=function(t,o,u,h){var g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},ai.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Dn(t,o):new kr(t,o)};var Qn=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(g){return{name:"a_"+g,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Qn.prototype.populatePaintArray=function(t,o,u,h,g){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Ei(0),o,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},Qn.prototype.updatePaintArray=function(t,o,u,h){var g=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,g)},Qn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=en(u),g=t;g<o;g++)this.paintVertexArray.emplace(g,h[0],h[1]);else{for(var x=t;x<o;x++)this.paintVertexArray.emplace(x,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Qn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Vn=function(t,o,u,h,g,x){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new x};Vn.prototype.populatePaintArray=function(t,o,u,h,g){var x=this.expression.evaluate(new Ei(this.zoom),o,{},h,[],g),S=this.expression.evaluate(new Ei(this.zoom+1),o,{},h,[],g),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,S)},Vn.prototype.updatePaintArray=function(t,o,u,h){var g=this.expression.evaluate({zoom:this.zoom},u,h),x=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,g,x)},Vn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var g=en(u),x=en(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1]);else{for(var M=t;M<o;M++)this.paintVertexArray.emplace(M,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Vn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Vn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Vn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Jt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Vn.prototype.getBinding=function(t,o,u){return new kr(t,o)};var ui=function(t,o,u,h,g,x){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=x,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};ui.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},ui.prototype.updatePaintArray=function(t,o,u,h,g){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],g)},ui.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var g=h[u.min],x=h[u.mid],S=h[u.max];if(g&&x&&S)for(var M=t;M<o;M++)this.zoomInPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],x.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},ui.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,be.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,be.members,this.expression.isStateDependent))},ui.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Wn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var g in t.paint._values)if(u(g)){var x=t.paint.get(g);if(x instanceof bs&&tu(x.property.specification)){var S=Sa(g,t.type),M=x.value,D=x.property.specification.type,B=x.property.useIntegerZoom,Z=x.property.specification["property-type"],j=Z==="cross-faded"||Z==="cross-faded-data-driven";if(M.kind==="constant")this.binders[g]=j?new ai(M.value,S):new $n(M.value,S,D),h.push("/u_"+g);else if(M.kind==="source"||j){var K=Ua(g,D,"source");this.binders[g]=j?new ui(M,D,B,o,K,t.id):new Qn(M,S,D,K),h.push("/a_"+g)}else{var O=Ua(g,D,"composite");this.binders[g]=new Vn(M,S,D,B,o,O),h.push("/z_"+g)}}}this.cacheKey=h.sort().join("")};Wn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Qn||o instanceof Vn?o.maxValue:0},Wn.prototype.populatePaintArrays=function(t,o,u,h,g){for(var x in this.binders){var S=this.binders[x];(S instanceof Qn||S instanceof Vn||S instanceof ui)&&S.populatePaintArray(t,o,u,h,g)}},Wn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof ai&&h.setConstantPatternPositions(t,o)}},Wn.prototype.updatePaintArrays=function(t,o,u,h,g){var x=!1;for(var S in t)for(var M=0,D=o.getPositions(S);M<D.length;M+=1){var B=D[M],Z=u.feature(B.index);for(var j in this.binders){var K=this.binders[j];if((K instanceof Qn||K instanceof Vn||K instanceof ui)&&K.expression.isStateDependent===!0){var O=h.paint.get(j);K.expression=O.value,K.updatePaintArray(B.start,B.end,Z,t[S],g),x=!0}}}return x},Wn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof $n||u instanceof ai)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Wn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Qn||u instanceof Vn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof ui)for(var g=0;g<be.members.length;g++)t.push(be.members[g].name)}return t},Wn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof $n||u instanceof ai||u instanceof Vn)for(var h=0,g=u.uniformNames;h<g.length;h+=1)t.push(g[h])}return t},Wn.prototype.getPaintVertexBuffers=function(){return this._buffers},Wn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof $n||g instanceof ai||g instanceof Vn)for(var x=0,S=g.uniformNames;x<S.length;x+=1){var M=S[x];if(o[M]){var D=g.getBinding(t,o[M],M);u.push({name:M,property:h,binding:D})}}}return u},Wn.prototype.setUniforms=function(t,o,u,h){for(var g=0,x=o;g<x.length;g+=1){var S=x[g],M=S.name,D=S.property;this.binders[D].setUniform(S.binding,h,u.get(D),M)}},Wn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof ui){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Qn||u instanceof Vn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Wn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Qn||u instanceof Vn||u instanceof ui)&&u.upload(t)}this.updatePaintBuffers()},Wn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Qn||o instanceof Vn||o instanceof ui)&&o.destroy()}};var jn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,g=t;h<g.length;h+=1){var x=g[h];this.programConfigurations[x.id]=new Wn(x,o,u)}this.needsUpload=!1,this._featureMap=new qe,this._bufferOffset=0};function Sa(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ua(t,o,u){var h={color:{source:Os,composite:lc},number:{source:ku,composite:Os}},g=function(x){return{"line-pattern":{source:js,composite:js},"fill-pattern":{source:js,composite:js},"fill-extrusion-pattern":{source:js,composite:js}}[x]}(t);return g&&g[u]||h[o][u]}jn.prototype.populatePaintArrays=function(t,o,u,h,g,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,g,x);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},jn.prototype.updatePaintArrays=function(t,o,u,h){for(var g=0,x=u;g<x.length;g+=1){var S=x[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},jn.prototype.get=function(t){return this.programConfigurations[t]},jn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},jn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},hn("ConstantBinder",$n),hn("CrossFadedConstantBinder",ai),hn("SourceExpressionBinder",Qn),hn("CrossFadedCompositeBinder",ui),hn("CompositeExpressionBinder",Vn),hn("ProgramConfiguration",Wn,{omit:["_buffers"]}),hn("ProgramConfigurationSet",jn);var Bo=Math.pow(2,14)-1,No=-Bo-1;function Xa(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var g=u[h],x=0;x<g.length;x++){var S=g[x],M=Math.round(S.x*o),D=Math.round(S.y*o);S.x=Jt(M,No,Bo),S.y=Jt(D,No,Bo),(M<S.x||M>S.x+1||D<S.y||D>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Xa(t):[]}}function Ts(t,o,u,h,g){t.emplaceBack(2*o+(h+1)/2,2*u+(g+1)/2)}var ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Xu,this.indexArray=new ll,this.segments=new se,this.programConfigurations=new jn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function ou(t,o){for(var u=0;u<t.length;u++)if(uu(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(uu(t,o[h]))return!0;return!!Dl(t,o)}function Za(t,o,u){return!!uu(t,o)||!!vu(o,t,u)}function su(t,o){if(t.length===1)return cc(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],g=0;g<h.length;g++)if(uu(t,h[g]))return!0;for(var x=0;x<t.length;x++)if(cc(o,t[x]))return!0;for(var S=0;S<o.length;S++)if(Dl(t,o[S]))return!0;return!1}function Hs(t,o,u){if(t.length>1){if(Dl(t,o))return!0;for(var h=0;h<o.length;h++)if(vu(o[h],t,u))return!0}for(var g=0;g<t.length;g++)if(vu(t[g],o,u))return!0;return!1}function Dl(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],g=t[u+1],x=0;x<o.length-1;x++)if(fl(h,g,o[x],o[x+1]))return!0;return!1}function fl(t,o,u,h){return Yt(t,u,h)!==Yt(o,u,h)&&Yt(t,o,u)!==Yt(t,o,h)}function vu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var g=1;g<o.length;g++)if(hl(t,o[g-1],o[g])<h)return!0;return!1}function hl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var g=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(g<0?o:g>1?u:u.sub(o)._mult(g)._add(o))}function cc(t,o){for(var u,h,g,x=!1,S=0;S<t.length;S++)for(var M=0,D=(u=t[S]).length-1;M<u.length;D=M++)(h=u[M]).y>o.y!=(g=u[D]).y>o.y&&o.x<(g.x-h.x)*(o.y-h.y)/(g.y-h.y)+h.x&&(x=!x);return x}function uu(t,o){for(var u=!1,h=0,g=t.length-1;h<t.length;g=h++){var x=t[h],S=t[g];x.y>o.y!=S.y>o.y&&o.x<(S.x-x.x)*(o.y-x.y)/(S.y-x.y)+x.x&&(u=!u)}return u}function Fl(t,o,u){var h=u[0],g=u[2];if(t.x<h.x&&o.x<h.x||t.x>g.x&&o.x>g.x||t.y<h.y&&o.y<h.y||t.y>g.y&&o.y>g.y)return!1;var x=Yt(t,o,u[0]);return x!==Yt(t,o,u[1])||x!==Yt(t,o,u[2])||x!==Yt(t,o,u[3])}function lu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function _o(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Lu(t,o,u,h,g){if(!o[0]&&!o[1])return t;var x=he.convert(o)._mult(g);u==="viewport"&&x._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(x));return S}ss.prototype.populate=function(t,o,u){var h=this.layers[0],g=[],x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var D=M[S],B=D.feature,Z=D.id,j=D.index,K=D.sourceLayerIndex,O=this.layers[0]._featureFilter.needGeometry,we=fo(B,O);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),we,u)){var Pe=x?x.evaluate(we,{},u):void 0,Ge={id:Z,properties:B.properties,type:B.type,sourceLayerIndex:K,index:j,geometry:O?we.geometry:Xa(B),patterns:{},sortKey:Pe};g.push(Ge)}}x&&g.sort(function(Gr,Fn){return Gr.sortKey-Fn.sortKey});for(var Be=0,et=g;Be<et.length;Be+=1){var mt=et[Be],Pt=mt.geometry,Vt=mt.index,nr=mt.sourceLayerIndex,wr=t[Vt].feature;this.addFeature(mt,Pt,Vt,u),o.featureIndex.insert(wr,Pt,Vt,nr,this.index)}},ss.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ae),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ss.prototype.addFeature=function(t,o,u,h){for(var g=0,x=o;g<x.length;g+=1)for(var S=0,M=x[g];S<M.length;S+=1){var D=M[S],B=D.x,Z=D.y;if(!(B<0||B>=8192||Z<0||Z>=8192)){var j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),K=j.vertexLength;Ts(this.layoutVertexArray,B,Z,-1,-1),Ts(this.layoutVertexArray,B,Z,1,-1),Ts(this.layoutVertexArray,B,Z,1,1),Ts(this.layoutVertexArray,B,Z,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),j.vertexLength+=4,j.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},hn("CircleBucket",ss,{omit:["layers"]});var Yu=new Fo({"circle-sort-key":new Sn(oe.layout_circle["circle-sort-key"])}),Du={paint:new Fo({"circle-radius":new Sn(oe.paint_circle["circle-radius"]),"circle-color":new Sn(oe.paint_circle["circle-color"]),"circle-blur":new Sn(oe.paint_circle["circle-blur"]),"circle-opacity":new Sn(oe.paint_circle["circle-opacity"]),"circle-translate":new On(oe.paint_circle["circle-translate"]),"circle-translate-anchor":new On(oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Sn(oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Sn(oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Sn(oe.paint_circle["circle-stroke-opacity"])}),layout:Yu},Yi=typeof Float32Array!="undefined"?Float32Array:Array;function Rs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function us(t,o,u){var h=o[0],g=o[1],x=o[2],S=o[3],M=o[4],D=o[5],B=o[6],Z=o[7],j=o[8],K=o[9],O=o[10],we=o[11],Pe=o[12],Ge=o[13],Be=o[14],et=o[15],mt=u[0],Pt=u[1],Vt=u[2],nr=u[3];return t[0]=mt*h+Pt*M+Vt*j+nr*Pe,t[1]=mt*g+Pt*D+Vt*K+nr*Ge,t[2]=mt*x+Pt*B+Vt*O+nr*Be,t[3]=mt*S+Pt*Z+Vt*we+nr*et,t[4]=(mt=u[4])*h+(Pt=u[5])*M+(Vt=u[6])*j+(nr=u[7])*Pe,t[5]=mt*g+Pt*D+Vt*K+nr*Ge,t[6]=mt*x+Pt*B+Vt*O+nr*Be,t[7]=mt*S+Pt*Z+Vt*we+nr*et,t[8]=(mt=u[8])*h+(Pt=u[9])*M+(Vt=u[10])*j+(nr=u[11])*Pe,t[9]=mt*g+Pt*D+Vt*K+nr*Ge,t[10]=mt*x+Pt*B+Vt*O+nr*Be,t[11]=mt*S+Pt*Z+Vt*we+nr*et,t[12]=(mt=u[12])*h+(Pt=u[13])*M+(Vt=u[14])*j+(nr=u[15])*Pe,t[13]=mt*g+Pt*D+Vt*K+nr*Ge,t[14]=mt*x+Pt*B+Vt*O+nr*Be,t[15]=mt*S+Pt*Z+Vt*we+nr*et,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var qu,Zc=us;function Vc(t,o,u){var h=o[0],g=o[1],x=o[2],S=o[3];return t[0]=u[0]*h+u[4]*g+u[8]*x+u[12]*S,t[1]=u[1]*h+u[5]*g+u[9]*x+u[13]*S,t[2]=u[2]*h+u[6]*g+u[10]*x+u[14]*S,t[3]=u[3]*h+u[7]*g+u[11]*x+u[15]*S,t}qu=new Yi(3),Yi!=Float32Array&&(qu[0]=0,qu[1]=0,qu[2]=0),function(){var t=new Yi(4);Yi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var jc=(function(){var t=new Yi(2);Yi!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Du)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ss(u)},o.prototype.queryRadius=function(u){var h=u;return lu("circle-radius",this,h)+lu("circle-stroke-width",this,h)+_o(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,x,S,M,D,B){for(var Z=Lu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),j=this.paint.get("circle-radius").evaluate(h,g)+this.paint.get("circle-stroke-width").evaluate(h,g),K=this.paint.get("circle-pitch-alignment")==="map",O=K?Z:function(wr,Gr){return wr.map(function(Fn){return Ws(Fn,Gr)})}(Z,B),we=K?j*D:j,Pe=0,Ge=x;Pe<Ge.length;Pe+=1)for(var Be=0,et=Ge[Pe];Be<et.length;Be+=1){var mt=et[Be],Pt=K?mt:Ws(mt,B),Vt=we,nr=Vc([],[mt.x,mt.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Vt*=nr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Vt*=M.cameraToCenterDistance/nr[3]),Za(O,Pt,Vt))return!0}return!1},o}(Ou));function Ws(t,o){var u=Vc([],[t.x,t.y,0,1],o);return new he(u[0]/u[3],u[1]/u[3])}var Bl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(ss);function ks(t,o,u,h){var g=o.width,x=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==g*x*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(g*x*u);return t.width=g,t.height=x,t.data=h,t}function pl(t,o,u){var h=o.width,g=o.height;if(h!==t.width||g!==t.height){var x=ks({},{width:h,height:g},u);Gc(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,g)},u),t.width=h,t.height=g,t.data=x.data}}function Gc(t,o,u,h,g,x){if(g.width===0||g.height===0)return o;if(g.width>t.width||g.height>t.height||u.x>t.width-g.width||u.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||h.x>o.width-g.width||h.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=o.data,D=0;D<g.height;D++)for(var B=((u.y+D)*t.width+u.x)*x,Z=((h.y+D)*o.width+h.x)*x,j=0;j<g.width*x;j++)M[Z+j]=S[B+j];return o}hn("HeatmapBucket",Bl,{omit:["layers"]});var mu=function(t,o){ks(this,t,1,o)};mu.prototype.resize=function(t){pl(this,t,1)},mu.prototype.clone=function(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))},mu.copy=function(t,o,u,h,g){Gc(t,o,u,h,g,1)};var zo=function(t,o){ks(this,t,4,o)};zo.prototype.resize=function(t){pl(this,t,4)},zo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},zo.prototype.clone=function(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))},zo.copy=function(t,o,u,h,g){Gc(t,o,u,h,g,4)},hn("AlphaImage",mu),hn("RGBAImage",zo);var Hc={paint:new Fo({"heatmap-radius":new Sn(oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Sn(oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new au(oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(oe.paint_heatmap["heatmap-opacity"])})};function Hf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,g=t.image||new zo({width:u,height:h}),x=function(we,Pe,Ge){o[t.evaluationKey]=Ge;var Be=t.expression.evaluate(o);g.data[we+Pe+0]=Math.floor(255*Be.r/Be.a),g.data[we+Pe+1]=Math.floor(255*Be.g/Be.a),g.data[we+Pe+2]=Math.floor(255*Be.b/Be.a),g.data[we+Pe+3]=Math.floor(255*Be.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*u)for(var D=0,B=0;D<u;D++,B+=4){var Z=D/(u-1),j=t.clips[S];x(M,B,j.start*(1-Z)+j.end*Z)}else for(var K=0,O=0;K<u;K++,O+=4)x(0,O,K/(u-1));return g}var Nl=function(t){function o(u){t.call(this,u,Hc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Bl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Hf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Ou),Wf={paint:new Fo({"hillshade-illumination-direction":new On(oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(oe.paint_hillshade["hillshade-accent-color"])})},rp=function(t){function o(u){t.call(this,u,Wf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Ou),np=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,fc=Xf,Wc=Xf;function Xf(t,o,u){u=u||2;var h,g,x,S,M,D,B,Z=o&&o.length,j=Z?o[0]*u:t.length,K=Gp(t,0,j,u,!0),O=[];if(!K||K.next===K.prev)return O;if(Z&&(K=function(Pe,Ge,Be,et){var mt,Pt,Vt,nr=[];for(mt=0,Pt=Ge.length;mt<Pt;mt++)(Vt=Gp(Pe,Ge[mt]*et,mt<Pt-1?Ge[mt+1]*et:Pe.length,et,!1))===Vt.next&&(Vt.steiner=!0),nr.push(wd(Vt));for(nr.sort(Ed),mt=0;mt<nr.length;mt++)Sd(nr[mt],Be),Be=zl(Be,Be.next);return Be}(t,o,K,u)),t.length>80*u){h=x=t[0],g=S=t[1];for(var we=u;we<j;we+=u)(M=t[we])<h&&(h=M),(D=t[we+1])<g&&(g=D),M>x&&(x=M),D>S&&(S=D);B=(B=Math.max(x-h,S-g))!==0?1/B:0}return Xc(K,O,u,h,g,B),O}function Gp(t,o,u,h,g){var x,S;if(g===wf(t,o,u,h)>0)for(x=o;x<u;x+=h)S=Kf(x,t[x],t[x+1],S);else for(x=u-h;x>=o;x-=h)S=Kf(x,t[x],t[x+1],S);return S&&Yf(S,S.next)&&(pc(S),S=S.next),S}function zl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Yf(h,h.next)&&Io(h.prev,h,h.next)!==0)h=h.next;else{if(pc(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function Xc(t,o,u,h,g,x,S){if(t){!S&&x&&function(Z,j,K,O){var we=Z;do we.z===null&&(we.z=Vr(we.x,we.y,j,K,O)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==Z);we.prevZ.nextZ=null,we.prevZ=null,function(Pe){var Ge,Be,et,mt,Pt,Vt,nr,wr,Gr=1;do{for(Be=Pe,Pe=null,Pt=null,Vt=0;Be;){for(Vt++,et=Be,nr=0,Ge=0;Ge<Gr&&(nr++,et=et.nextZ);Ge++);for(wr=Gr;nr>0||wr>0&&et;)nr!==0&&(wr===0||!et||Be.z<=et.z)?(mt=Be,Be=Be.nextZ,nr--):(mt=et,et=et.nextZ,wr--),Pt?Pt.nextZ=mt:Pe=mt,mt.prevZ=Pt,Pt=mt;Be=et}Pt.nextZ=null,Gr*=2}while(Vt>1)}(we)}(t,h,g,x);for(var M,D,B=t;t.prev!==t.next;)if(M=t.prev,D=t.next,x?bd(t,h,g,x):ip(t))o.push(M.i/u),o.push(t.i/u),o.push(D.i/u),pc(t),t=D.next,B=D.next;else if((t=D)===B){S?S===1?Xc(t=Sf(zl(t),o,u),o,u,h,g,x,2):S===2&&ap(t,o,u,h,g,x):Xc(zl(t),o,u,h,g,x,1);break}}}function ip(t){var o=t.prev,u=t,h=t.next;if(Io(o,u,h)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(Zt(o.x,o.y,u.x,u.y,h.x,h.y,g.x,g.y)&&Io(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function bd(t,o,u,h){var g=t.prev,x=t,S=t.next;if(Io(g,x,S)>=0)return!1;for(var M=g.x>x.x?g.x>S.x?g.x:S.x:x.x>S.x?x.x:S.x,D=g.y>x.y?g.y>S.y?g.y:S.y:x.y>S.y?x.y:S.y,B=Vr(g.x<x.x?g.x<S.x?g.x:S.x:x.x<S.x?x.x:S.x,g.y<x.y?g.y<S.y?g.y:S.y:x.y<S.y?x.y:S.y,o,u,h),Z=Vr(M,D,o,u,h),j=t.prevZ,K=t.nextZ;j&&j.z>=B&&K&&K.z<=Z;){if(j!==t.prev&&j!==t.next&&Zt(g.x,g.y,x.x,x.y,S.x,S.y,j.x,j.y)&&Io(j.prev,j,j.next)>=0||(j=j.prevZ,K!==t.prev&&K!==t.next&&Zt(g.x,g.y,x.x,x.y,S.x,S.y,K.x,K.y)&&Io(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;j&&j.z>=B;){if(j!==t.prev&&j!==t.next&&Zt(g.x,g.y,x.x,x.y,S.x,S.y,j.x,j.y)&&Io(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;K&&K.z<=Z;){if(K!==t.prev&&K!==t.next&&Zt(g.x,g.y,x.x,x.y,S.x,S.y,K.x,K.y)&&Io(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function Sf(t,o,u){var h=t;do{var g=h.prev,x=h.next.next;!Yf(g,x)&&op(g,h,h.next,x)&&Cf(g,x)&&Cf(x,g)&&(o.push(g.i/u),o.push(h.i/u),o.push(x.i/u),pc(h),pc(h.next),h=t=x),h=h.next}while(h!==t);return zl(h)}function ap(t,o,u,h,g,x){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Ad(S,M)){var D=hc(S,M);return S=zl(S,S.next),D=zl(D,D.next),Xc(S,o,u,h,g,x),void Xc(D,o,u,h,g,x)}M=M.next}S=S.next}while(S!==t)}function Ed(t,o){return t.x-o.x}function Sd(t,o){if(o=function(h,g){var x,S=g,M=h.x,D=h.y,B=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var Z=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=M&&Z>B){if(B=Z,Z===M){if(D===S.y)return S;if(D===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!x)return null;if(M===B)return x;var j,K=x,O=x.x,we=x.y,Pe=1/0;S=x;do M>=S.x&&S.x>=O&&M!==S.x&&Zt(D<we?M:B,D,O,we,D<we?B:M,D,S.x,S.y)&&(j=Math.abs(D-S.y)/(M-S.x),Cf(S,h)&&(j<Pe||j===Pe&&(S.x>x.x||S.x===x.x&&Cd(x,S)))&&(x=S,Pe=j)),S=S.next;while(S!==K);return x}(t,o)){var u=hc(o,t);zl(o,o.next),zl(u,u.next)}}function Cd(t,o){return Io(t.prev,t,o.prev)<0&&Io(o.next,t,t.next)<0}function Vr(t,o,u,h,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*g)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function wd(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Zt(t,o,u,h,g,x,S,M){return(g-S)*(o-M)-(t-S)*(x-M)>=0&&(t-S)*(h-M)-(u-S)*(o-M)>=0&&(u-S)*(x-M)-(g-S)*(h-M)>=0}function Ad(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var g=u;do{if(g.i!==u.i&&g.next.i!==u.i&&g.i!==h.i&&g.next.i!==h.i&&op(g,g.next,u,h))return!0;g=g.next}while(g!==u);return!1}(t,o)&&(Cf(t,o)&&Cf(o,t)&&function(u,h){var g=u,x=!1,S=(u.x+h.x)/2,M=(u.y+h.y)/2;do g.y>M!=g.next.y>M&&g.next.y!==g.y&&S<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==u);return x}(t,o)&&(Io(t.prev,t,o.prev)||Io(t,o.prev,o))||Yf(t,o)&&Io(t.prev,t,t.next)>0&&Io(o.prev,o,o.next)>0)}function Io(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Yf(t,o){return t.x===o.x&&t.y===o.y}function op(t,o,u,h){var g=Mh(Io(t,o,u)),x=Mh(Io(t,o,h)),S=Mh(Io(u,h,t)),M=Mh(Io(u,h,o));return g!==x&&S!==M||!(g!==0||!qf(t,u,o))||!(x!==0||!qf(t,h,o))||!(S!==0||!qf(u,t,h))||!(M!==0||!qf(u,o,h))}function qf(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Mh(t){return t>0?1:t<0?-1:0}function Cf(t,o){return Io(t.prev,t,t.next)<0?Io(t,o,t.next)>=0&&Io(t,t.prev,o)>=0:Io(t,o,t.prev)<0||Io(t,t.next,o)<0}function hc(t,o){var u=new Yc(t.i,t.x,t.y),h=new Yc(o.i,o.x,o.y),g=t.next,x=o.prev;return t.next=o,o.prev=t,u.next=g,g.prev=u,h.next=u,u.prev=h,x.next=h,h.prev=x,h}function Kf(t,o,u,h){var g=new Yc(t,o,u);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function pc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Yc(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wf(t,o,u,h){for(var g=0,x=o,S=u-h;x<u;x+=h)g+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return g}function $f(t,o,u,h,g){(function x(S,M,D,B,Z){for(;B>D;){if(B-D>600){var j=B-D+1,K=M-D+1,O=Math.log(j),we=.5*Math.exp(2*O/3),Pe=.5*Math.sqrt(O*we*(j-we)/j)*(K-j/2<0?-1:1);x(S,M,Math.max(D,Math.floor(M-K*we/j+Pe)),Math.min(B,Math.floor(M+(j-K)*we/j+Pe)),Z)}var Ge=S[M],Be=D,et=B;for(Ul(S,D,M),Z(S[B],Ge)>0&&Ul(S,D,B);Be<et;){for(Ul(S,Be,et),Be++,et--;Z(S[Be],Ge)<0;)Be++;for(;Z(S[et],Ge)>0;)et--}Z(S[D],Ge)===0?Ul(S,D,et):Ul(S,++et,B),et<=M&&(D=et+1),M<=et&&(B=et-1)}})(t,o,u||0,h||t.length-1,g||Qf)}function Ul(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function Qf(t,o){return t<o?-1:t>o?1:0}function Jf(t,o){var u=t.length;if(u<=1)return[t];for(var h,g,x=[],S=0;S<u;S++){var M=Er(t[S]);M!==0&&(t[S].area=Math.abs(M),g===void 0&&(g=M<0),g===M<0?(h&&x.push(h),h=[t[S]]):h.push(t[S]))}if(h&&x.push(h),o>1)for(var D=0;D<x.length;D++)x[D].length<=o||($f(x[D],o,1,x[D].length-1,eh),x[D]=x[D].slice(0,o));return x}function eh(t,o){return o.area-t.area}function qc(t,o,u){for(var h=u.patternDependencies,g=!1,x=0,S=o;x<S.length;x+=1){var M=S[x].paint.get(t+"-pattern");M.isConstant()||(g=!0);var D=M.constantOr(null);D&&(g=!0,h[D.to]=!0,h[D.from]=!0)}return g}function dc(t,o,u,h,g){for(var x=g.patternDependencies,S=0,M=o;S<M.length;S+=1){var D=M[S],B=D.paint.get(t+"-pattern").value;if(B.kind!=="constant"){var Z=B.evaluate({zoom:h-1},u,{},g.availableImages),j=B.evaluate({zoom:h},u,{},g.availableImages),K=B.evaluate({zoom:h+1},u,{},g.availableImages);j=j&&j.name?j.name:j,K=K&&K.name?K.name:K,x[Z=Z&&Z.name?Z.name:Z]=!0,x[j]=!0,x[K]=!0,u.patterns[D.id]={min:Z,mid:j,max:K}}}return u}Xf.deviation=function(t,o,u,h){var g=o&&o.length,x=Math.abs(wf(t,0,g?o[0]*u:t.length,u));if(g)for(var S=0,M=o.length;S<M;S++)x-=Math.abs(wf(t,o[S]*u,S<M-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<h.length;S+=3){var B=h[S]*u,Z=h[S+1]*u,j=h[S+2]*u;D+=Math.abs((t[B]-t[j])*(t[Z+1]-t[B+1])-(t[B]-t[Z])*(t[j+1]-t[B+1]))}return x===0&&D===0?0:Math.abs((D-x)/x)},Xf.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,g=0;g<t.length;g++){for(var x=0;x<t[g].length;x++)for(var S=0;S<o;S++)u.vertices.push(t[g][x][S]);g>0&&u.holes.push(h+=t[g-1].length)}return u},fc.default=Wc;var Xs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xu,this.indexArray=new ll,this.indexArray2=new Uc,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Xs.prototype.populate=function(t,o,u){this.hasPattern=qc("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var M=S[x],D=M.feature,B=M.id,Z=M.index,j=M.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,O=fo(D,K);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),O,u)){var we=h?h.evaluate(O,{},u,o.availableImages):void 0,Pe={id:B,properties:D.properties,type:D.type,sourceLayerIndex:j,index:Z,geometry:K?O.geometry:Xa(D),patterns:{},sortKey:we};g.push(Pe)}}h&&g.sort(function(wr,Gr){return wr.sortKey-Gr.sortKey});for(var Ge=0,Be=g;Ge<Be.length;Ge+=1){var et=Be[Ge],mt=et.geometry,Pt=et.index,Vt=et.sourceLayerIndex;if(this.hasPattern){var nr=dc("fill",this.layers,et,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(et,mt,Pt,u,{});o.featureIndex.insert(t[Pt].feature,mt,Pt,Vt,this.index)}},Xs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Xs.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var x=g[h];this.addFeature(x,x.geometry,x.index,o,u)}},Xs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Xs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,np),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Xs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Xs.prototype.addFeature=function(t,o,u,h,g){for(var x=0,S=Jf(o,500);x<S.length;x+=1){for(var M=S[x],D=0,B=0,Z=M;B<Z.length;B+=1)D+=Z[B].length;for(var j=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),K=j.vertexLength,O=[],we=[],Pe=0,Ge=M;Pe<Ge.length;Pe+=1){var Be=Ge[Pe];if(Be.length!==0){Be!==M[0]&&we.push(O.length/2);var et=this.segments2.prepareSegment(Be.length,this.layoutVertexArray,this.indexArray2),mt=et.vertexLength;this.layoutVertexArray.emplaceBack(Be[0].x,Be[0].y),this.indexArray2.emplaceBack(mt+Be.length-1,mt),O.push(Be[0].x),O.push(Be[0].y);for(var Pt=1;Pt<Be.length;Pt++)this.layoutVertexArray.emplaceBack(Be[Pt].x,Be[Pt].y),this.indexArray2.emplaceBack(mt+Pt-1,mt+Pt),O.push(Be[Pt].x),O.push(Be[Pt].y);et.vertexLength+=Be.length,et.primitiveLength+=Be.length}}for(var Vt=fc(O,we),nr=0;nr<Vt.length;nr+=3)this.indexArray.emplaceBack(K+Vt[nr],K+Vt[nr+1],K+Vt[nr+2]);j.vertexLength+=D,j.primitiveLength+=Vt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},hn("FillBucket",Xs,{omit:["layers","patternFeatures"]});var th=new Fo({"fill-sort-key":new Sn(oe.layout_fill["fill-sort-key"])}),rh={paint:new Fo({"fill-antialias":new On(oe.paint_fill["fill-antialias"]),"fill-opacity":new Sn(oe.paint_fill["fill-opacity"]),"fill-color":new Sn(oe.paint_fill["fill-color"]),"fill-outline-color":new Sn(oe.paint_fill["fill-outline-color"]),"fill-translate":new On(oe.paint_fill["fill-translate"]),"fill-translate-anchor":new On(oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nc(oe.paint_fill["fill-pattern"])}),layout:th},nh=function(t){function o(u){t.call(this,u,rh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Xs(u)},o.prototype.queryRadius=function(){return _o(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,x,S,M,D){return su(Lu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),x)},o.prototype.isTileClipped=function(){return!0},o}(Ou),ih=pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ph=dl;function dl(t,o,u,h,g){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=g,t.readFields(vc,this,o)}function vc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,g){for(var x=h.readVarint()+h.pos;h.pos<x;){var S=g._keys[h.readVarint()],M=g._values[h.readVarint()];g.properties[S]=M}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Hp(t){for(var o,u,h=0,g=0,x=t.length,S=x-1;g<x;S=g++)h+=((u=t[S]).x-(o=t[g]).x)*(o.y+u.y);return h}dl.types=["Unknown","Point","LineString","Polygon"],dl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,g=0,x=0,S=0,M=[];t.pos<u;){if(g<=0){var D=t.readVarint();h=7&D,g=D>>3}if(g--,h===1||h===2)x+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&M.push(o),o=[]),o.push(new he(x,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&M.push(o),M},dl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,g=0,x=0,S=1/0,M=-1/0,D=1/0,B=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(g+=t.readSVarint())<S&&(S=g),g>M&&(M=g),(x+=t.readSVarint())<D&&(D=x),x>B&&(B=x);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,M,B]},dl.prototype.toGeoJSON=function(t,o,u){var h,g,x=this.extent*Math.pow(2,u),S=this.extent*t,M=this.extent*o,D=this.loadGeometry(),B=dl.types[this.type];function Z(O){for(var we=0;we<O.length;we++){var Pe=O[we];O[we]=[360*(Pe.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Pe.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(h=0;h<D.length;h++)j[h]=D[h][0];Z(D=j);break;case 2:for(h=0;h<D.length;h++)Z(D[h]);break;case 3:for(D=function(O){var we=O.length;if(we<=1)return[O];for(var Pe,Ge,Be=[],et=0;et<we;et++){var mt=Hp(O[et]);mt!==0&&(Ge===void 0&&(Ge=mt<0),Ge===mt<0?(Pe&&Be.push(Pe),Pe=[O[et]]):Pe.push(O[et]))}return Pe&&Be.push(Pe),Be}(D),h=0;h<D.length;h++)for(g=0;g<D[h].length;g++)Z(D[h][g])}D.length===1?D=D[0]:B="Multi"+B;var K={type:"Feature",geometry:{type:B,coordinates:D},properties:this.properties};return"id"in this&&(K.id=this.id),K};var ah=Wp;function Wp(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(mv,this,o),this.length=this._features.length}function mv(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var g=null,x=h.readVarint()+h.pos;h.pos<x;){var S=h.readVarint()>>3;g=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return g}(u))}function Td(t,o,u){if(t===3){var h=new ah(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}Wp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Ph(this._pbf,o,this.extent,this._keys,this._values)};var cu={VectorTile:function(t,o){this.layers=t.readFields(Td,{},o)},VectorTileFeature:Ph,VectorTileLayer:ah},sp=cu.VectorTileFeature.types,Ih=Math.pow(2,13);function Kc(t,o,u,h,g,x,S,M){t.emplaceBack(o,u,2*Math.floor(h*Ih)+S,g*Ih*2,x*Ih*2,Math.round(M))}var Fu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Xi,this.indexArray=new ll,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Xp(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}Fu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=qc("fill-extrusion",this.layers,o);for(var h=0,g=t;h<g.length;h+=1){var x=g[h],S=x.feature,M=x.id,D=x.index,B=x.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,j=fo(S,Z);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),j,u)){var K={id:M,sourceLayerIndex:B,index:D,geometry:Z?j.geometry:Xa(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(dc("fill-extrusion",this.layers,K,this.zoom,o)):this.addFeature(K,K.geometry,D,u,{}),o.featureIndex.insert(S,K.geometry,D,B,this.index,!0)}}},Fu.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.features;h<g.length;h+=1){var x=g[h];this.addFeature(x,x.geometry,x.index,o,u)}},Fu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Fu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Fu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Fu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ih),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Fu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Fu.prototype.addFeature=function(t,o,u,h,g){for(var x=0,S=Jf(o,500);x<S.length;x+=1){for(var M=S[x],D=0,B=0,Z=M;B<Z.length;B+=1)D+=Z[B].length;for(var j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),K=0,O=M;K<O.length;K+=1){var we=O[K];if(we.length!==0&&!((ki=we).every(function(xi){return xi.x<0})||ki.every(function(xi){return xi.x>8192})||ki.every(function(xi){return xi.y<0})||ki.every(function(xi){return xi.y>8192})))for(var Pe=0,Ge=0;Ge<we.length;Ge++){var Be=we[Ge];if(Ge>=1){var et=we[Ge-1];if(!Xp(Be,et)){j.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var mt=Be.sub(et)._perp()._unit(),Pt=et.dist(Be);Pe+Pt>32768&&(Pe=0),Kc(this.layoutVertexArray,Be.x,Be.y,mt.x,mt.y,0,0,Pe),Kc(this.layoutVertexArray,Be.x,Be.y,mt.x,mt.y,0,1,Pe),Kc(this.layoutVertexArray,et.x,et.y,mt.x,mt.y,0,0,Pe+=Pt),Kc(this.layoutVertexArray,et.x,et.y,mt.x,mt.y,0,1,Pe);var Vt=j.vertexLength;this.indexArray.emplaceBack(Vt,Vt+2,Vt+1),this.indexArray.emplaceBack(Vt+1,Vt+2,Vt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+D>se.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),sp[t.type]==="Polygon"){for(var nr=[],wr=[],Gr=j.vertexLength,Fn=0,sn=M;Fn<sn.length;Fn+=1){var Un=sn[Fn];if(Un.length!==0){Un!==M[0]&&wr.push(nr.length/2);for(var fn=0;fn<Un.length;fn++){var Ai=Un[fn];Kc(this.layoutVertexArray,Ai.x,Ai.y,0,0,1,1,0),nr.push(Ai.x),nr.push(Ai.y)}}}for(var Jn=fc(nr,wr),Pn=0;Pn<Jn.length;Pn+=3)this.indexArray.emplaceBack(Gr+Jn[Pn],Gr+Jn[Pn+2],Gr+Jn[Pn+1]);j.primitiveLength+=Jn.length/3,j.vertexLength+=D}}var ki;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},hn("FillExtrusionBucket",Fu,{omit:["layers","features"]});var Md={paint:new Fo({"fill-extrusion-opacity":new On(oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nc(oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Sn(oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},vl=function(t){function o(u){t.call(this,u,Md)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Fu(u)},o.prototype.queryRadius=function(){return _o(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,g,x,S,M,D,B){var Z=Lu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),j=this.paint.get("fill-extrusion-height").evaluate(h,g),K=this.paint.get("fill-extrusion-base").evaluate(h,g),O=function(Pe,Ge,Be,et){for(var mt=[],Pt=0,Vt=Pe;Pt<Vt.length;Pt+=1){var nr=Vt[Pt],wr=[nr.x,nr.y,0,1];Vc(wr,wr,Ge),mt.push(new he(wr[0]/wr[3],wr[1]/wr[3]))}return mt}(Z,B),we=function(Pe,Ge,Be,et){for(var mt=[],Pt=[],Vt=et[8]*Ge,nr=et[9]*Ge,wr=et[10]*Ge,Gr=et[11]*Ge,Fn=et[8]*Be,sn=et[9]*Be,Un=et[10]*Be,fn=et[11]*Be,Ai=0,Jn=Pe;Ai<Jn.length;Ai+=1){for(var Pn=[],ki=[],xi=0,zi=Jn[Ai];xi<zi.length;xi+=1){var Zn=zi[xi],aa=Zn.x,qa=Zn.y,Eo=et[0]*aa+et[4]*qa+et[12],go=et[1]*aa+et[5]*qa+et[13],Ka=et[2]*aa+et[6]*qa+et[14],So=et[3]*aa+et[7]*qa+et[15],Co=Ka+wr,ts=So+Gr,wo=Eo+Fn,cs=go+sn,Ds=Ka+Un,oo=So+fn,rs=new he((Eo+Vt)/ts,(go+nr)/ts);rs.z=Co/ts,Pn.push(rs);var Ui=new he(wo/oo,cs/oo);Ui.z=Ds/oo,ki.push(Ui)}mt.push(Pn),Pt.push(ki)}return[mt,Pt]}(x,K,j,B);return function(Pe,Ge,Be){var et=1/0;su(Be,Ge)&&(et=Ku(Be,Ge[0]));for(var mt=0;mt<Ge.length;mt++)for(var Pt=Ge[mt],Vt=Pe[mt],nr=0;nr<Pt.length-1;nr++){var wr=Pt[nr],Gr=[wr,Pt[nr+1],Vt[nr+1],Vt[nr],wr];ou(Be,Gr)&&(et=Math.min(et,Ku(Be,Gr)))}return et!==1/0&&et}(we[0],we[1],O)},o}(Ou);function $c(t,o){return t.x*o.x+t.y*o.y}function Ku(t,o){if(t.length===1){for(var u,h=0,g=o[h++];!u||g.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var x=o[h],S=t[0],M=u.sub(g),D=x.sub(g),B=S.sub(g),Z=$c(M,M),j=$c(M,D),K=$c(D,D),O=$c(B,M),we=$c(B,D),Pe=Z*K-j*j,Ge=(K*O-j*we)/Pe,Be=(Z*we-j*O)/Pe,et=g.z*(1-Ge-Be)+u.z*Ge+x.z*Be;if(isFinite(et))return et}return 1/0}for(var mt=1/0,Pt=0,Vt=o;Pt<Vt.length;Pt+=1)mt=Math.min(mt,Vt[Pt].z);return mt}var mc=pa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,La=pa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ml=cu.VectorTileFeature.types,Oh=Math.cos(Math.PI/180*37.5),up=Math.pow(2,14)/.5,la=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new ro,this.layoutVertexArray2=new Os,this.indexArray=new ll,this.programConfigurations=new jn(t.layers,t.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};la.prototype.populate=function(t,o,u){this.hasPattern=qc("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),g=[],x=0,S=t;x<S.length;x+=1){var M=S[x],D=M.feature,B=M.id,Z=M.index,j=M.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,O=fo(D,K);if(this.layers[0]._featureFilter.filter(new Ei(this.zoom),O,u)){var we=h?h.evaluate(O,{},u):void 0,Pe={id:B,properties:D.properties,type:D.type,sourceLayerIndex:j,index:Z,geometry:K?O.geometry:Xa(D),patterns:{},sortKey:we};g.push(Pe)}}h&&g.sort(function(wr,Gr){return wr.sortKey-Gr.sortKey});for(var Ge=0,Be=g;Ge<Be.length;Ge+=1){var et=Be[Ge],mt=et.geometry,Pt=et.index,Vt=et.sourceLayerIndex;if(this.hasPattern){var nr=dc("line",this.layers,et,this.zoom,o);this.patternFeatures.push(nr)}else this.addFeature(et,mt,Pt,u,{});o.featureIndex.insert(t[Pt].feature,mt,Pt,Vt,this.index)}},la.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},la.prototype.addFeatures=function(t,o,u){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var x=g[h];this.addFeature(x,x.geometry,x.index,o,u)}},la.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},la.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},la.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,La)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},la.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},la.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},la.prototype.addFeature=function(t,o,u,h,g){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),D=x.get("line-miter-limit"),B=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,j=o;Z<j.length;Z+=1)this.addLine(j[Z],t,S,M,D,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,h)},la.prototype.addLine=function(t,o,u,h,g,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=ml[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var B=0;B<D-1&&t[B].equals(t[B+1]);)B++;if(!(D<(M?3:2))){u==="bevel"&&(g=1.05);var Z,j=this.overscaling<=16?122880/(512*this.overscaling):0,K=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),O=void 0,we=void 0,Pe=void 0,Ge=void 0;this.e1=this.e2=-1,M&&(Ge=t[B].sub(Z=t[D-2])._unit()._perp());for(var Be=B;Be<D;Be++)if(!(we=Be===D-1?M?t[B+1]:void 0:t[Be+1])||!t[Be].equals(we)){Ge&&(Pe=Ge),Z&&(O=Z),Z=t[Be],Ge=we?we.sub(Z)._unit()._perp():Pe;var et=(Pe=Pe||Ge).add(Ge);et.x===0&&et.y===0||et._unit();var mt=Pe.x*Ge.x+Pe.y*Ge.y,Pt=et.x*Ge.x+et.y*Ge.y,Vt=Pt!==0?1/Pt:1/0,nr=2*Math.sqrt(2-2*Pt),wr=Pt<Oh&&O&&we,Gr=Pe.x*Ge.y-Pe.y*Ge.x>0;if(wr&&Be>B){var Fn=Z.dist(O);if(Fn>2*j){var sn=Z.sub(Z.sub(O)._mult(j/Fn)._round());this.updateDistance(O,sn),this.addCurrentVertex(sn,Pe,0,0,K),O=sn}}var Un=O&&we,fn=Un?u:M?"butt":h;if(Un&&fn==="round"&&(Vt<x?fn="miter":Vt<=2&&(fn="fakeround")),fn==="miter"&&Vt>g&&(fn="bevel"),fn==="bevel"&&(Vt>2&&(fn="flipbevel"),Vt<g&&(fn="miter")),O&&this.updateDistance(O,Z),fn==="miter")et._mult(Vt),this.addCurrentVertex(Z,et,0,0,K);else if(fn==="flipbevel"){if(Vt>100)et=Ge.mult(-1);else{var Ai=Vt*Pe.add(Ge).mag()/Pe.sub(Ge).mag();et._perp()._mult(Ai*(Gr?-1:1))}this.addCurrentVertex(Z,et,0,0,K),this.addCurrentVertex(Z,et.mult(-1),0,0,K)}else if(fn==="bevel"||fn==="fakeround"){var Jn=-Math.sqrt(Vt*Vt-1),Pn=Gr?Jn:0,ki=Gr?0:Jn;if(O&&this.addCurrentVertex(Z,Pe,Pn,ki,K),fn==="fakeround")for(var xi=Math.round(180*nr/Math.PI/20),zi=1;zi<xi;zi++){var Zn=zi/xi;if(Zn!==.5){var aa=Zn-.5;Zn+=Zn*aa*(Zn-1)*((1.0904+mt*(mt*(3.55645-1.43519*mt)-3.2452))*aa*aa+(.848013+mt*(.215638*mt-1.06021)))}var qa=Ge.sub(Pe)._mult(Zn)._add(Pe)._unit()._mult(Gr?-1:1);this.addHalfVertex(Z,qa.x,qa.y,!1,Gr,0,K)}we&&this.addCurrentVertex(Z,Ge,-Pn,-ki,K)}else if(fn==="butt")this.addCurrentVertex(Z,et,0,0,K);else if(fn==="square"){var Eo=O?1:-1;this.addCurrentVertex(Z,et,Eo,Eo,K)}else fn==="round"&&(O&&(this.addCurrentVertex(Z,Pe,0,0,K),this.addCurrentVertex(Z,Pe,1,1,K,!0)),we&&(this.addCurrentVertex(Z,Ge,-1,-1,K,!0),this.addCurrentVertex(Z,Ge,0,0,K)));if(wr&&Be<D-1){var go=Z.dist(we);if(go>2*j){var Ka=Z.add(we.sub(Z)._mult(j/go)._round());this.updateDistance(Z,Ka),this.addCurrentVertex(Ka,Ge,0,0,K),Z=Ka}}}}},la.prototype.addCurrentVertex=function(t,o,u,h,g,x){x===void 0&&(x=!1);var S=o.y*h-o.x,M=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,x,!1,u,g),this.addHalfVertex(t,S,M,x,!0,-h,g),this.distance>up/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,g,x))},la.prototype.addHalfVertex=function(t,o,u,h,g,x,S){var M=.5*(this.lineClips?this.scaledDistance*(up-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),g?this.e2=D:this.e1=D},la.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},la.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},hn("LineBucket",la,{omit:["layers","patternFeatures"]});var gc=new Fo({"line-cap":new On(oe.layout_line["line-cap"]),"line-join":new Sn(oe.layout_line["line-join"]),"line-miter-limit":new On(oe.layout_line["line-miter-limit"]),"line-round-limit":new On(oe.layout_line["line-round-limit"]),"line-sort-key":new Sn(oe.layout_line["line-sort-key"])}),xo={paint:new Fo({"line-opacity":new Sn(oe.paint_line["line-opacity"]),"line-color":new Sn(oe.paint_line["line-color"]),"line-translate":new On(oe.paint_line["line-translate"]),"line-translate-anchor":new On(oe.paint_line["line-translate-anchor"]),"line-width":new Sn(oe.paint_line["line-width"]),"line-gap-width":new Sn(oe.paint_line["line-gap-width"]),"line-offset":new Sn(oe.paint_line["line-offset"]),"line-blur":new Sn(oe.paint_line["line-blur"]),"line-dasharray":new os(oe.paint_line["line-dasharray"]),"line-pattern":new Nc(oe.paint_line["line-pattern"]),"line-gradient":new au(oe.paint_line["line-gradient"])}),layout:gc},Ys=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Ei(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,g,x){return h=It({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,g,x)},o}(Sn))(xo.paint.properties["line-width"].specification);Ys.useIntegerZoom=!0;var oh=function(t){function o(u){t.call(this,u,xo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof gs,this.gradientVersion=(this.gradientVersion+1)%Je)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Ys.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new la(u)},o.prototype.queryRadius=function(u){var h=u,g=Yp(lu("line-width",this,h),lu("line-gap-width",this,h)),x=lu("line-offset",this,h);return g/2+Math.abs(x)+_o(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,g,x,S,M,D){var B=Lu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),Z=D/2*Yp(this.paint.get("line-width").evaluate(h,g),this.paint.get("line-gap-width").evaluate(h,g)),j=this.paint.get("line-offset").evaluate(h,g);return j&&(x=function(K,O){for(var we=[],Pe=new he(0,0),Ge=0;Ge<K.length;Ge++){for(var Be=K[Ge],et=[],mt=0;mt<Be.length;mt++){var Pt=Be[mt],Vt=Be[mt+1],nr=mt===0?Pe:Pt.sub(Be[mt-1])._unit()._perp(),wr=mt===Be.length-1?Pe:Vt.sub(Pt)._unit()._perp(),Gr=nr._add(wr)._unit();Gr._mult(1/(Gr.x*wr.x+Gr.y*wr.y)),et.push(Gr._mult(O)._add(Pt))}we.push(et)}return we}(x,j*D)),function(K,O,we){for(var Pe=0;Pe<O.length;Pe++){var Ge=O[Pe];if(K.length>=3){for(var Be=0;Be<Ge.length;Be++)if(uu(K,Ge[Be]))return!0}if(Hs(K,Ge,we))return!0}return!1}(B,x,Z)},o.prototype.isTileClipped=function(){return!0},o}(Ou);function Yp(t,o){return o>0?o+2*t:t}var Pd=pa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gl=pa([{name:"a_projected_pos",components:3,type:"Float32"}],4),sh=(pa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),pa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Qc=(pa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Id=pa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rh(t,o,u){return t.sections.forEach(function(h){h.text=function(g,x,S){var M=x.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?g=g.toLocaleUpperCase():M==="lowercase"&&(g=g.toLocaleLowerCase()),As.applyArabicShaping&&(g=As.applyArabicShaping(g)),g}(h.text,o,u)}),t}pa([{name:"triangle",components:3,type:"Uint16"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pa([{type:"Float32",name:"offsetX"}]),pa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Jc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},kh=function(t,o,u,h,g){var x,S,M=8*g-h-1,D=(1<<M)-1,B=D>>1,Z=-7,j=u?g-1:0,K=u?-1:1,O=t[o+j];for(j+=K,x=O&(1<<-Z)-1,O>>=-Z,Z+=M;Z>0;x=256*x+t[o+j],j+=K,Z-=8);for(S=x&(1<<-Z)-1,x>>=-Z,Z+=h;Z>0;S=256*S+t[o+j],j+=K,Z-=8);if(x===0)x=1-B;else{if(x===D)return S?NaN:1/0*(O?-1:1);S+=Math.pow(2,h),x-=B}return(O?-1:1)*S*Math.pow(2,x-h)},lp=function(t,o,u,h,g,x){var S,M,D,B=8*x-g-1,Z=(1<<B)-1,j=Z>>1,K=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=h?0:x-1,we=h?1:-1,Pe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(M=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+j>=1?K/D:K*Math.pow(2,1-j))*D>=2&&(S++,D/=2),S+j>=Z?(M=0,S=Z):S+j>=1?(M=(o*D-1)*Math.pow(2,g),S+=j):(M=o*Math.pow(2,j-1)*Math.pow(2,g),S=0));g>=8;t[u+O]=255&M,O+=we,M/=256,g-=8);for(S=S<<g|M,B+=g;B>0;t[u+O]=255&S,O+=we,S/=256,B-=8);t[u+O-we]|=128*Pe},uh=Ta;function Ta(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ta.Varint=0,Ta.Fixed64=1,Ta.Bytes=2,Ta.Fixed32=5;var cp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Zl(t){return t.type===Ta.Bytes?t.readVarint()+t.pos:t.pos+1}function Af(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function Lh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var g=u.pos-1;g>=t;g--)u.buf[g+h]=u.buf[g]}function Od(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function z(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ue(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function De(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Mt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function rr(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function At(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function qt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function sr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function dr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function mr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Sr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Cr(t,o,u){t===1&&u.readMessage(Ur,o)}function Ur(t,o,u){if(t===3){var h=u.readMessage(vr,{}),g=h.width,x=h.height,S=h.left,M=h.top,D=h.advance;o.push({id:h.id,bitmap:new mu({width:g+6,height:x+6},h.bitmap),metrics:{width:g,height:x,left:S,top:M,advance:D}})}}function vr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function br(t){for(var o=0,u=0,h=0,g=t;h<g.length;h+=1){var x=g[h];o+=x.w*x.h,u=Math.max(u,x.w)}t.sort(function(Pe,Ge){return Ge.h-Pe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],M=0,D=0,B=0,Z=t;B<Z.length;B+=1)for(var j=Z[B],K=S.length-1;K>=0;K--){var O=S[K];if(!(j.w>O.w||j.h>O.h)){if(j.x=O.x,j.y=O.y,D=Math.max(D,j.y+j.h),M=Math.max(M,j.x+j.w),j.w===O.w&&j.h===O.h){var we=S.pop();K<S.length&&(S[K]=we)}else j.h===O.h?(O.x+=j.w,O.w-=j.w):j.w===O.w?(O.y+=j.h,O.h-=j.h):(S.push({x:O.x+j.w,y:O.y,w:O.w-j.w,h:j.h}),O.y+=j.h,O.h-=j.h);break}}return{w:M,h:D,fill:o/(M*D)||0}}Ta.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),g=h>>3,x=this.pos;this.type=7&h,t(g,o,this),this.pos===x&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=dr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*dr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dr(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=kh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(g,x,S){var M,D,B=S.buf;if(M=(112&(D=B[S.pos++]))>>4,D<128||(M|=(127&(D=B[S.pos++]))<<3,D<128)||(M|=(127&(D=B[S.pos++]))<<10,D<128)||(M|=(127&(D=B[S.pos++]))<<17,D<128)||(M|=(127&(D=B[S.pos++]))<<24,D<128)||(M|=(1&(D=B[S.pos++]))<<31,D<128))return Af(g,M,x);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&cp?function(u,h,g){return cp.decode(u.subarray(h,g))}(this.buf,o,t):function(u,h,g){for(var x="",S=h;S<g;){var M,D,B,Z=u[S],j=null,K=Z>239?4:Z>223?3:Z>191?2:1;if(S+K>g)break;K===1?Z<128&&(j=Z):K===2?(192&(M=u[S+1]))==128&&(j=(31&Z)<<6|63&M)<=127&&(j=null):K===3?(D=u[S+2],(192&(M=u[S+1]))==128&&(192&D)==128&&((j=(15&Z)<<12|(63&M)<<6|63&D)<=2047||j>=55296&&j<=57343)&&(j=null)):K===4&&(D=u[S+2],B=u[S+3],(192&(M=u[S+1]))==128&&(192&D)==128&&(192&B)==128&&((j=(15&Z)<<18|(63&M)<<12|(63&D)<<6|63&B)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,K=1):j>65535&&(j-=65536,x+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),x+=String.fromCharCode(j),S+=K}return x}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ta.Bytes)return t.push(this.readVarint(o));var u=Zl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ta.Bytes)return t.push(this.readSVarint());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ta.Bytes)return t.push(this.readBoolean());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ta.Bytes)return t.push(this.readFloat());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ta.Bytes)return t.push(this.readDouble());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ta.Bytes)return t.push(this.readFixed32());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ta.Bytes)return t.push(this.readSFixed32());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ta.Bytes)return t.push(this.readFixed64());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ta.Bytes)return t.push(this.readSFixed64());var o=Zl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ta.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ta.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ta.Fixed32)this.pos+=4;else{if(o!==Ta.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),mr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),mr(this.buf,-1&t,this.pos),mr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,g;if(o>=0?(h=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,S,M){M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7)}(h,0,u),function(x,S){var M=(7&x)<<4;S.buf[S.pos++]|=M|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(g,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,g,x){for(var S,M,D=0;D<g.length;D++){if((S=g.charCodeAt(D))>55295&&S<57344){if(!M){S>56319||D+1===g.length?(h[x++]=239,h[x++]=191,h[x++]=189):M=S;continue}if(S<56320){h[x++]=239,h[x++]=191,h[x++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[x++]=239,h[x++]=191,h[x++]=189,M=null);S<128?h[x++]=S:(S<2048?h[x++]=S>>6|192:(S<65536?h[x++]=S>>12|224:(h[x++]=S>>18|240,h[x++]=S>>12&63|128),h[x++]=S>>6&63|128),h[x++]=63&S|128)}return x}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&Lh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),lp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&Lh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Ta.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Od,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,z,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Mt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ue,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,De,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,rr,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,At,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,qt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,sr,o)},writeBytesField:function(t,o){this.writeTag(t,Ta.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ta.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ta.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ta.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ta.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ta.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ta.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ta.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ta.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ta.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var rt=function(t,o){var u=o.pixelRatio,h=o.version,g=o.stretchX,x=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=g,this.stretchY=x,this.content=S,this.version=h},Ut={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Ut.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Ut.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Ut.tlbr.get=function(){return this.tl.concat(this.br)},Ut.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(rt.prototype,Ut);var gr=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,u,g),this.addImages(o,h,g);var x=br(g),S=new zo({width:x.w||1,height:x.h||1});for(var M in t){var D=t[M],B=u[M].paddedRect;zo.copy(D.data,S,{x:0,y:0},{x:B.x+1,y:B.y+1},D.data)}for(var Z in o){var j=o[Z],K=h[Z].paddedRect,O=K.x+1,we=K.y+1,Pe=j.data.width,Ge=j.data.height;zo.copy(j.data,S,{x:0,y:0},{x:O,y:we},j.data),zo.copy(j.data,S,{x:0,y:Ge-1},{x:O,y:we-1},{width:Pe,height:1}),zo.copy(j.data,S,{x:0,y:0},{x:O,y:we+Ge},{width:Pe,height:1}),zo.copy(j.data,S,{x:Pe-1,y:0},{x:O-1,y:we},{width:1,height:Ge}),zo.copy(j.data,S,{x:0,y:0},{x:O+Pe,y:we},{width:1,height:Ge})}this.image=S,this.iconPositions=u,this.patternPositions=h};gr.prototype.addImages=function(t,o,u){for(var h in t){var g=t[h],x={x:0,y:0,w:g.data.width+2,h:g.data.height+2};u.push(x),o[h]=new rt(x,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},gr.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},gr.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},hn("ImagePosition",rt),hn("ImageAtlas",gr);var Dr={horizontal:1,vertical:2,horizontalOnly:3},or=function(){this.scale=1,this.fontStack="",this.imageName=null};or.forText=function(t,o){var u=new or;return u.scale=t||1,u.fontStack=o,u},or.forImage=function(t){var o=new or;return o.imageName=t,o};var Mr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,h,g,x,S,M,D,B,Z,j,K,O,we,Pe){var Ge,Be=Mr.fromFeature(t,g);j===Dr.vertical&&Be.verticalizePunctuation();var et=As.processBidirectionalText,mt=As.processStyledBidirectionalText;if(et&&Be.sections.length===1){Ge=[];for(var Pt=0,Vt=et(Be.toString(),Yr(Be,B,x,o,h,O,we));Pt<Vt.length;Pt+=1){var nr=Vt[Pt],wr=new Mr;wr.text=nr,wr.sections=Be.sections;for(var Gr=0;Gr<nr.length;Gr++)wr.sectionIndex.push(0);Ge.push(wr)}}else if(mt){Ge=[];for(var Fn=0,sn=mt(Be.text,Be.sectionIndex,Yr(Be,B,x,o,h,O,we));Fn<sn.length;Fn+=1){var Un=sn[Fn],fn=new Mr;fn.text=Un[0],fn.sectionIndex=Un[1],fn.sections=Be.sections,Ge.push(fn)}}else Ge=function(Pn,ki){for(var xi=[],zi=Pn.text,Zn=0,aa=0,qa=ki;aa<qa.length;aa+=1){var Eo=qa[aa];xi.push(Pn.substring(Zn,Eo)),Zn=Eo}return Zn<zi.length&&xi.push(Pn.substring(Zn,zi.length)),xi}(Be,Yr(Be,B,x,o,h,O,we));var Ai=[],Jn={positionedLines:Ai,text:Be.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Pn,ki,xi,zi,Zn,aa,qa,Eo,go,Ka,So,Co){for(var ts=0,wo=-17,cs=0,Ds=0,oo=Eo==="right"?1:Eo==="left"?0:.5,rs=0,Ui=0,Ma=Zn;Ui<Ma.length;Ui+=1){var ga=Ma[Ui];ga.trim();var Ki=ga.getMaxScale(),Fs=24*(Ki-1),fs={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[rs]=fs;var so=fs.positionedGlyphs,Vo=0;if(ga.length()){for(var Ms=0;Ms<ga.length();Ms++){var oa=ga.getSection(Ms),xc=ga.getSectionIndex(Ms),gu=ga.getCharCode(Ms),Gl=0,Ao=null,Hl=null,$u=null,ch=24,Mf=!(go===Dr.horizontal||!So&&!gf(gu)||So&&(Bn[gu]||(Ec=gu,zr.Arabic(Ec)||zr["Arabic Supplement"](Ec)||zr["Arabic Extended-A"](Ec)||zr["Arabic Presentation Forms-A"](Ec)||zr["Arabic Presentation Forms-B"](Ec))));if(oa.imageName){var fh=zi[oa.imageName];if(!fh)continue;$u=oa.imageName,Pn.iconsInText=Pn.iconsInText||!0,Hl=fh.paddedRect;var bc=fh.displaySize;oa.scale=24*oa.scale/Co,Gl=Fs+(24-bc[1]*oa.scale),ch=(Ao={width:bc[0],height:bc[1],left:1,top:-3,advance:Mf?bc[1]:bc[0]}).advance;var hh=Mf?bc[0]*oa.scale-24*Ki:bc[1]*oa.scale-24*Ki;hh>0&&hh>Vo&&(Vo=hh)}else{var vp=xi[oa.fontStack],ph=vp&&vp[gu];if(ph&&ph.rect)Hl=ph.rect,Ao=ph.metrics;else{var Dh=ki[oa.fontStack],mp=Dh&&Dh[gu];if(!mp)continue;Ao=mp.metrics}Gl=24*(Ki-oa.scale)}Mf?(Pn.verticalizable=!0,so.push({glyph:gu,imageName:$u,x:ts,y:wo+Gl,vertical:Mf,scale:oa.scale,fontStack:oa.fontStack,sectionIndex:xc,metrics:Ao,rect:Hl}),ts+=ch*oa.scale+Ka):(so.push({glyph:gu,imageName:$u,x:ts,y:wo+Gl,vertical:Mf,scale:oa.scale,fontStack:oa.fontStack,sectionIndex:xc,metrics:Ao,rect:Hl}),ts+=Ao.advance*oa.scale+Ka)}so.length!==0&&(cs=Math.max(ts-Ka,cs),pi(so,0,so.length-1,oo,Vo)),ts=0;var gp=aa*Ki+Vo;fs.lineOffset=Math.max(Vo,Fs),wo+=gp,Ds=Math.max(gp,Ds),++rs}else wo+=aa,++rs}var Ec,Fh=wo- -17,ns=qr(qa),rf=ns.horizontalAlign,dh=ns.verticalAlign;(function(yp,_p,Bh,Nh,xp,zh,Uh,Zh,bp){var vh,Ep=(_p-Bh)*xp;vh=zh!==Uh?-Zh*Nh- -17:(-Nh*bp+.5)*Uh;for(var mh=0,Vh=yp;mh<Vh.length;mh+=1)for(var gh=0,Sp=Vh[mh].positionedGlyphs;gh<Sp.length;gh+=1){var jh=Sp[gh];jh.x+=Ep,jh.y+=vh}})(Pn.positionedLines,oo,rf,dh,cs,Ds,aa,Fh,Zn.length),Pn.top+=-dh*Fh,Pn.bottom=Pn.top+Fh,Pn.left+=-rf*cs,Pn.right=Pn.left+cs}(Jn,o,u,h,Ge,S,M,D,j,B,K,Pe),!function(Pn){for(var ki=0,xi=Pn;ki<xi.length;ki+=1)if(xi[ki].positionedGlyphs.length!==0)return!1;return!0}(Ai)&&Jn}Mr.fromFeature=function(t,o){for(var u=new Mr,h=0;h<t.sections.length;h++){var g=t.sections[h];g.image?u.addImageSection(g):u.addTextSection(g,o)}return u},Mr.prototype.length=function(){return this.text.length},Mr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Mr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Mr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Mr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,g=t.charCodeAt(u-1)||null;o+=h&&al(h)&&!Jc[t[u+1]]||g&&al(g)&&!Jc[t[u-1]]||!Jc[t[u]]?t[u]:Jc[t[u]]}return o}(this.text)},Mr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Bn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Mr.prototype.substring=function(t,o){var u=new Mr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Mr.prototype.toString=function(){return this.text},Mr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Mr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(or.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Mr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(or.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Mr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wt={};function Qt(t,o,u,h,g,x){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/x+g:0}var M=u[o.fontStack],D=M&&M[t];return D?D.metrics.advance*o.scale+g:0}function yn(t,o,u,h){var g=Math.pow(t-o,2);return h?t<o?g/2:2*g:g+Math.abs(u)*u}function jr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function yr(t,o,u,h,g,x){for(var S=null,M=yn(o,u,g,x),D=0,B=h;D<B.length;D+=1){var Z=B[D],j=yn(o-Z.x,u,g,x)+Z.badness;j<=M&&(S=Z,M=j)}return{index:t,x:o,priorBreak:S,badness:M}}function Yr(t,o,u,h,g,x,S){if(x!=="point")return[];if(!t)return[];for(var M,D=[],B=function(Ge,Be,et,mt,Pt,Vt){for(var nr=0,wr=0;wr<Ge.length();wr++){var Gr=Ge.getSection(wr);nr+=Qt(Ge.getCharCode(wr),Gr,mt,Pt,Be,Vt)}return nr/Math.max(1,Math.ceil(nr/et))}(t,o,u,h,g,S),Z=t.text.indexOf("\u200B")>=0,j=0,K=0;K<t.length();K++){var O=t.getSection(K),we=t.getCharCode(K);if(Bn[we]||(j+=Qt(we,O,h,g,o,S)),K<t.length()-1){var Pe=!((M=we)<11904||!(zr["Bopomofo Extended"](M)||zr.Bopomofo(M)||zr["CJK Compatibility Forms"](M)||zr["CJK Compatibility Ideographs"](M)||zr["CJK Compatibility"](M)||zr["CJK Radicals Supplement"](M)||zr["CJK Strokes"](M)||zr["CJK Symbols and Punctuation"](M)||zr["CJK Unified Ideographs Extension A"](M)||zr["CJK Unified Ideographs"](M)||zr["Enclosed CJK Letters and Months"](M)||zr["Halfwidth and Fullwidth Forms"](M)||zr.Hiragana(M)||zr["Ideographic Description Characters"](M)||zr["Kangxi Radicals"](M)||zr["Katakana Phonetic Extensions"](M)||zr.Katakana(M)||zr["Vertical Forms"](M)||zr["Yi Radicals"](M)||zr["Yi Syllables"](M)));(Wt[we]||Pe||O.imageName)&&D.push(yr(K+1,j,B,D,jr(we,t.getCharCode(K+1),Pe&&Z),!1))}}return function Ge(Be){return Be?Ge(Be.priorBreak).concat(Be.index):[]}(yr(t.length(),j,B,D,0,!0))}function qr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function pi(t,o,u,h,g){if(h||g)for(var x=t[u],S=(t[u].x+x.metrics.advance*x.scale)*h,M=o;M<=u;M++)t[M].x-=S,t[M].y+=g}function ti(t,o,u,h,g,x){var S,M=t.image;if(M.content){var D=M.content,B=M.pixelRatio||1;S=[D[0]/B,D[1]/B,M.displaySize[0]-D[2]/B,M.displaySize[1]-D[3]/B]}var Z,j,K,O,we=o.left*x,Pe=o.right*x;u==="width"||u==="both"?(O=g[0]+we-h[3],j=g[0]+Pe+h[1]):j=(O=g[0]+(we+Pe-M.displaySize[0])/2)+M.displaySize[0];var Ge=o.top*x,Be=o.bottom*x;return u==="height"||u==="both"?(Z=g[1]+Ge-h[0],K=g[1]+Be+h[2]):K=(Z=g[1]+(Ge+Be-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:Z,right:j,bottom:K,left:O,collisionPadding:S}}Wt[10]=!0,Wt[32]=!0,Wt[38]=!0,Wt[40]=!0,Wt[41]=!0,Wt[43]=!0,Wt[45]=!0,Wt[47]=!0,Wt[173]=!0,Wt[183]=!0,Wt[8203]=!0,Wt[8208]=!0,Wt[8211]=!0,Wt[8231]=!0;var Xr=function(t){function o(u,h,g,x){t.call(this,u,h),this.angle=g,x!==void 0&&(this.segment=x)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(he);function tn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ei(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,g=u.interpolationType,x=0;x<h.length&&h[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[x],D=h[S];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:D,minSize:u.evaluate(new Ei(M)),maxSize:u.evaluate(new Ei(D)),interpolationType:g}}function Xn(t,o,u){var h=o.uSize,g=u.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?ha(g/128,u.upperSize/128,o.uSizeT):h}function oi(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,x=g?Jt(ve.interpolationFactor(g,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ha(t.minSize,t.maxSize,x):u=x}return{uSizeT:u,uSize:h}}hn("Anchor",Xr);var Ri=Object.freeze({__proto__:null,getSizeData:tn,evaluateSizeForFeature:Xn,evaluateSizeForZoom:oi,SIZE_PACK_FACTOR:128});function no(t,o,u,h,g){if(o.segment===void 0)return!0;for(var x=o,S=o.segment+1,M=0;M>-u/2;){if(--S<0)return!1;M-=t[S].dist(x),x=t[S]}M+=t[S].dist(t[S+1]),S++;for(var D=[],B=0;M<u/2;){var Z=t[S],j=t[S+1];if(!j)return!1;var K=t[S-1].angleTo(Z)-Z.angleTo(j);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:K}),B+=K;M-D[0].distance>h;)B-=D.shift().angleDelta;if(B>g)return!1;S++,M+=Z.dist(j)}return!0}function io(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Ii(t,o,u){return t?.6*o*u:0}function Qo(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Va(t,o,u,h,g,x){for(var S=Ii(u,g,x),M=Qo(u,h)*x,D=0,B=io(t)/2,Z=0;Z<t.length-1;Z++){var j=t[Z],K=t[Z+1],O=j.dist(K);if(D+O>B){var we=(B-D)/O,Pe=ha(j.x,K.x,we),Ge=ha(j.y,K.y,we),Be=new Xr(Pe,Ge,K.angleTo(j),Z);return Be._round(),!S||no(t,Be,M,S,o)?Be:void 0}D+=O}}function Uo(t,o,u,h,g,x,S,M,D){var B=Ii(h,x,S),Z=Qo(h,g),j=Z*S,K=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-j<o/4&&(o=j+o/4),function O(we,Pe,Ge,Be,et,mt,Pt,Vt,nr){for(var wr=mt/2,Gr=io(we),Fn=0,sn=Pe-Ge,Un=[],fn=0;fn<we.length-1;fn++){for(var Ai=we[fn],Jn=we[fn+1],Pn=Ai.dist(Jn),ki=Jn.angleTo(Ai);sn+Ge<Fn+Pn;){var xi=((sn+=Ge)-Fn)/Pn,zi=ha(Ai.x,Jn.x,xi),Zn=ha(Ai.y,Jn.y,xi);if(zi>=0&&zi<nr&&Zn>=0&&Zn<nr&&sn-wr>=0&&sn+wr<=Gr){var aa=new Xr(zi,Zn,ki,fn);aa._round(),Be&&!no(we,aa,mt,Be,et)||Un.push(aa)}}Fn+=Pn}return Vt||Un.length||Pt||(Un=O(we,Fn/2,Ge,Be,et,mt,Pt,!0,nr)),Un}(t,K?o/2*M%o:(Z/2+2*x)*S*M%o,o,B,u,j,K,!1,D)}function bo(t,o,u,h,g){for(var x=[],S=0;S<t.length;S++)for(var M=t[S],D=void 0,B=0;B<M.length-1;B++){var Z=M[B],j=M[B+1];Z.x<o&&j.x<o||(Z.x<o?Z=new he(o,Z.y+(o-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round():j.x<o&&(j=new he(o,Z.y+(o-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round()),Z.y<u&&j.y<u||(Z.y<u?Z=new he(Z.x+(u-Z.y)/(j.y-Z.y)*(j.x-Z.x),u)._round():j.y<u&&(j=new he(Z.x+(u-Z.y)/(j.y-Z.y)*(j.x-Z.x),u)._round()),Z.x>=h&&j.x>=h||(Z.x>=h?Z=new he(h,Z.y+(h-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round():j.x>=h&&(j=new he(h,Z.y+(h-Z.x)/(j.x-Z.x)*(j.y-Z.y))._round()),Z.y>=g&&j.y>=g||(Z.y>=g?Z=new he(Z.x+(g-Z.y)/(j.y-Z.y)*(j.x-Z.x),g)._round():j.y>=g&&(j=new he(Z.x+(g-Z.y)/(j.y-Z.y)*(j.x-Z.x),g)._round()),D&&Z.equals(D[D.length-1])||x.push(D=[Z]),D.push(j)))))}return x}function Yo(t,o,u,h){var g=[],x=t.image,S=x.pixelRatio,M=x.paddedRect.w-2,D=x.paddedRect.h-2,B=t.right-t.left,Z=t.bottom-t.top,j=x.stretchX||[[0,M]],K=x.stretchY||[[0,D]],O=function(zi,Zn){return zi+Zn[1]-Zn[0]},we=j.reduce(O,0),Pe=K.reduce(O,0),Ge=M-we,Be=D-Pe,et=0,mt=we,Pt=0,Vt=Pe,nr=0,wr=Ge,Gr=0,Fn=Be;if(x.content&&h){var sn=x.content;et=Oo(j,0,sn[0]),Pt=Oo(K,0,sn[1]),mt=Oo(j,sn[0],sn[2]),Vt=Oo(K,sn[1],sn[3]),nr=sn[0]-et,Gr=sn[1]-Pt,wr=sn[2]-sn[0]-mt,Fn=sn[3]-sn[1]-Vt}var Un=function(zi,Zn,aa,qa){var Eo=ao(zi.stretch-et,mt,B,t.left),go=li(zi.fixed-nr,wr,zi.stretch,we),Ka=ao(Zn.stretch-Pt,Vt,Z,t.top),So=li(Zn.fixed-Gr,Fn,Zn.stretch,Pe),Co=ao(aa.stretch-et,mt,B,t.left),ts=li(aa.fixed-nr,wr,aa.stretch,we),wo=ao(qa.stretch-Pt,Vt,Z,t.top),cs=li(qa.fixed-Gr,Fn,qa.stretch,Pe),Ds=new he(Eo,Ka),oo=new he(Co,Ka),rs=new he(Co,wo),Ui=new he(Eo,wo),Ma=new he(go/S,So/S),ga=new he(ts/S,cs/S),Ki=o*Math.PI/180;if(Ki){var Fs=Math.sin(Ki),fs=Math.cos(Ki),so=[fs,-Fs,Fs,fs];Ds._matMult(so),oo._matMult(so),Ui._matMult(so),rs._matMult(so)}var Vo=zi.stretch+zi.fixed,Ms=Zn.stretch+Zn.fixed;return{tl:Ds,tr:oo,bl:Ui,br:rs,tex:{x:x.paddedRect.x+1+Vo,y:x.paddedRect.y+1+Ms,w:aa.stretch+aa.fixed-Vo,h:qa.stretch+qa.fixed-Ms},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ma,pixelOffsetBR:ga,minFontScaleX:wr/S/B,minFontScaleY:Fn/S/Z,isSDF:u}};if(h&&(x.stretchX||x.stretchY))for(var fn=Jo(j,Ge,we),Ai=Jo(K,Be,Pe),Jn=0;Jn<fn.length-1;Jn++)for(var Pn=fn[Jn],ki=fn[Jn+1],xi=0;xi<Ai.length-1;xi++)g.push(Un(Pn,Ai[xi],ki,Ai[xi+1]));else g.push(Un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return g}function Oo(t,o,u){for(var h=0,g=0,x=t;g<x.length;g+=1){var S=x[g];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function Jo(t,o,u){for(var h=[{fixed:-1,stretch:0}],g=0,x=t;g<x.length;g+=1){var S=x[g],M=S[0],D=S[1],B=h[h.length-1];h.push({fixed:M-B.stretch,stretch:B.stretch}),h.push({fixed:M-B.stretch,stretch:B.stretch+(D-M)})}return h.push({fixed:o+1,stretch:u}),h}function ao(t,o,u,h){return t/o*u+h}function li(t,o,u,h){return t-o*u/h}var Zo=function(t,o,u,h,g,x,S,M,D,B){if(this.boxStartIndex=t.length,D){var Z=x.top,j=x.bottom,K=x.collisionPadding;K&&(Z-=K[1],j+=K[3]);var O=j-Z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{var we=x.top*S-M,Pe=x.bottom*S+M,Ge=x.left*S-M,Be=x.right*S+M,et=x.collisionPadding;if(et&&(Ge-=et[0]*S,we-=et[1]*S,Be+=et[2]*S,Pe+=et[3]*S),B){var mt=new he(Ge,we),Pt=new he(Be,we),Vt=new he(Ge,Pe),nr=new he(Be,Pe),wr=B*Math.PI/180;mt._rotate(wr),Pt._rotate(wr),Vt._rotate(wr),nr._rotate(wr),Ge=Math.min(mt.x,Pt.x,Vt.x,nr.x),Be=Math.max(mt.x,Pt.x,Vt.x,nr.x),we=Math.min(mt.y,Pt.y,Vt.y,nr.y),Pe=Math.max(mt.y,Pt.y,Vt.y,nr.y)}t.emplaceBack(o.x,o.y,Ge,we,Be,Pe,u,h,g)}this.boxEndIndex=t.length},qi=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=es),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function es(t,o){return t<o?-1:t>o?1:0}function Or(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,g=1/0,x=-1/0,S=-1/0,M=t[0],D=0;D<M.length;D++){var B=M[D];(!D||B.x<h)&&(h=B.x),(!D||B.y<g)&&(g=B.y),(!D||B.x>x)&&(x=B.x),(!D||B.y>S)&&(S=B.y)}var Z=Math.min(x-h,S-g),j=Z/2,K=new qi([],rn);if(Z===0)return new he(h,g);for(var O=h;O<x;O+=Z)for(var we=g;we<S;we+=Z)K.push(new ia(O+j,we+j,j,t));for(var Pe=function(et){for(var mt=0,Pt=0,Vt=0,nr=et[0],wr=0,Gr=nr.length,Fn=Gr-1;wr<Gr;Fn=wr++){var sn=nr[wr],Un=nr[Fn],fn=sn.x*Un.y-Un.x*sn.y;Pt+=(sn.x+Un.x)*fn,Vt+=(sn.y+Un.y)*fn,mt+=3*fn}return new ia(Pt/mt,Vt/mt,0,et)}(t),Ge=K.length;K.length;){var Be=K.pop();(Be.d>Pe.d||!Pe.d)&&(Pe=Be,u&&console.log("found best %d after %d probes",Math.round(1e4*Be.d)/1e4,Ge)),Be.max-Pe.d<=o||(K.push(new ia(Be.p.x-(j=Be.h/2),Be.p.y-j,j,t)),K.push(new ia(Be.p.x+j,Be.p.y-j,j,t)),K.push(new ia(Be.p.x-j,Be.p.y+j,j,t)),K.push(new ia(Be.p.x+j,Be.p.y+j,j,t)),Ge+=4)}return u&&(console.log("num probes: "+Ge),console.log("best distance: "+Pe.d)),Pe.p}function rn(t,o){return o.max-t.max}function ia(t,o,u,h){this.p=new he(t,o),this.h=u,this.d=function(g,x){for(var S=!1,M=1/0,D=0;D<x.length;D++)for(var B=x[D],Z=0,j=B.length,K=j-1;Z<j;K=Z++){var O=B[Z],we=B[K];O.y>g.y!=we.y>g.y&&g.x<(we.x-O.x)*(g.y-O.y)/(we.y-O.y)+O.x&&(S=!S),M=Math.min(M,hl(g,O,we))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}qi.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},qi.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},qi.prototype.peek=function(){return this.data[0]},qi.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var g=t-1>>1,x=o[g];if(u(h,x)>=0)break;o[t]=x,t=g}o[t]=h},qi.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,g=o[t];t<h;){var x=1+(t<<1),S=o[x],M=x+1;if(M<this.length&&u(o[M],S)<0&&(x=M,S=o[M]),u(S,g)>=0)break;o[t]=S,t=x}o[t]=g};var Ro=Number.POSITIVE_INFINITY;function yl(t,o){return o[1]!==Ro?function(u,h,g){var x=0,S=0;switch(h=Math.abs(h),g=Math.abs(g),u){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(u){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,S]}(t,o[0],o[1]):function(u,h){var g=0,x=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(u){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=h;break;case"right":g=-h}return[g,x]}(t,o[0])}function Ce(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ft(t,o,u,h,g,x,S,M,D,B,Z,j,K,O,we){var Pe=function(Pt,Vt,nr,wr,Gr,Fn,sn,Un){for(var fn=wr.layout.get("text-rotate").evaluate(Fn,{})*Math.PI/180,Ai=[],Jn=0,Pn=Vt.positionedLines;Jn<Pn.length;Jn+=1)for(var ki=Pn[Jn],xi=0,zi=ki.positionedGlyphs;xi<zi.length;xi+=1){var Zn=zi[xi];if(Zn.rect){var aa=Zn.rect||{},qa=4,Eo=!0,go=1,Ka=0,So=(Gr||Un)&&Zn.vertical,Co=Zn.metrics.advance*Zn.scale/2;if(Un&&Vt.verticalizable&&(Ka=ki.lineOffset/2-(Zn.imageName?-(24-Zn.metrics.width*Zn.scale)/2:24*(Zn.scale-1))),Zn.imageName){var ts=sn[Zn.imageName];Eo=ts.sdf,qa=1/(go=ts.pixelRatio)}var wo=Gr?[Zn.x+Co,Zn.y]:[0,0],cs=Gr?[0,0]:[Zn.x+Co+nr[0],Zn.y+nr[1]-Ka],Ds=[0,0];So&&(Ds=cs,cs=[0,0]);var oo=(Zn.metrics.left-qa)*Zn.scale-Co+cs[0],rs=(-Zn.metrics.top-qa)*Zn.scale+cs[1],Ui=oo+aa.w*Zn.scale/go,Ma=rs+aa.h*Zn.scale/go,ga=new he(oo,rs),Ki=new he(Ui,rs),Fs=new he(oo,Ma),fs=new he(Ui,Ma);if(So){var so=new he(-Co,Co- -17),Vo=-Math.PI/2,Ms=12-Co,oa=new he(22-Ms,-(Zn.imageName?Ms:0)),xc=new(Function.prototype.bind.apply(he,[null].concat(Ds)));ga._rotateAround(Vo,so)._add(oa)._add(xc),Ki._rotateAround(Vo,so)._add(oa)._add(xc),Fs._rotateAround(Vo,so)._add(oa)._add(xc),fs._rotateAround(Vo,so)._add(oa)._add(xc)}if(fn){var gu=Math.sin(fn),Gl=Math.cos(fn),Ao=[Gl,-gu,gu,Gl];ga._matMult(Ao),Ki._matMult(Ao),Fs._matMult(Ao),fs._matMult(Ao)}var Hl=new he(0,0),$u=new he(0,0);Ai.push({tl:ga,tr:Ki,bl:Fs,br:fs,tex:aa,writingMode:Vt.writingMode,glyphOffset:wo,sectionIndex:Zn.sectionIndex,isSDF:Eo,pixelOffsetTL:Hl,pixelOffsetBR:$u,minFontScaleX:0,minFontScaleY:0})}}return Ai}(0,u,M,g,x,S,h,t.allowVerticalPlacement),Ge=t.textSizeData,Be=null;Ge.kind==="source"?(Be=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ge.kind==="composite"&&((Be=[128*O.compositeTextSizes[0].evaluate(S,{},we),128*O.compositeTextSizes[1].evaluate(S,{},we)])[0]>32640||Be[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Pe,Be,M,x,S,B,o,D.lineStartIndex,D.lineLength,K,we);for(var et=0,mt=Z;et<mt.length;et+=1)j[mt[et]]=t.text.placedSymbolArray.length-1;return 4*Pe.length}function gt(t){for(var o in t)return t[o];return null}function pn(t,o,u,h){var g=t.compareText;if(o in g){for(var x=g[o],S=x.length-1;S>=0;S--)if(h.dist(x[S])<u)return!0}else g[o]=[];return g[o].push(h),!1}var Ni=cu.VectorTileFeature.types,_e=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,h,g,x,S,M,D,B,Z,j,K){var O=M?Math.min(32640,Math.round(M[0])):0,we=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*g),x,S,(O<<1)+(D?1:0),we,16*B,16*Z,256*j,256*K)}function ze(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function nt(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(yf(u[o].text))return!0;return!1}var St=function(t){this.layoutVertexArray=new ul,this.indexArray=new ll,this.programConfigurations=t,this.segments=new se,this.dynamicLayoutVertexArray=new Ru,this.opacityVertexArray=new kl,this.placedSymbolArray=new d};St.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},St.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Pd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,gl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_e,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},St.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},hn("SymbolBuffers",St);var We=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new se,this.collisionVertexArray=new Ef};We.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,sh.members,!0)},We.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},hn("CollisionBuffers",We);var Le=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=tn(this.zoom,o["text-size"]),this.iconSizeData=tn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(x){return Dr[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Le.prototype.createArrays=function(){this.text=new St(new jn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new St(new jn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new k,this.symbolInstances=new w},Le.prototype.calculateGlyphDependencies=function(t,o,u,h,g){for(var x=0;x<t.length;x++)if(o[t.charCodeAt(x)]=!0,(u||h)&&g){var S=Jc[t.charAt(x)];S&&(o[S.charCodeAt(0)]=!0)}},Le.prototype.populate=function(t,o,u){var h=this.layers[0],g=h.layout,x=g.get("text-font"),S=g.get("text-field"),M=g.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof Ct&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Z=g.get("symbol-sort-key");if(this.features=[],D||B){for(var j=o.iconDependencies,K=o.glyphDependencies,O=o.availableImages,we=new Ei(this.zoom),Pe=0,Ge=t;Pe<Ge.length;Pe+=1){var Be=Ge[Pe],et=Be.feature,mt=Be.id,Pt=Be.index,Vt=Be.sourceLayerIndex,nr=h._featureFilter.needGeometry,wr=fo(et,nr);if(h._featureFilter.filter(we,wr,u)){nr||(wr.geometry=Xa(et));var Gr=void 0;if(D){var Fn=h.getValueAndResolveTokens("text-field",wr,u,O),sn=Ct.factory(Fn);nt(sn)&&(this.hasRTLText=!0),(!this.hasRTLText||_f()==="unavailable"||this.hasRTLText&&As.isParsed())&&(Gr=Rh(sn,h,wr))}var Un=void 0;if(B){var fn=h.getValueAndResolveTokens("icon-image",wr,u,O);Un=fn instanceof Ji?fn:Ji.fromString(fn)}if(Gr||Un){var Ai=this.sortFeaturesByKey?Z.evaluate(wr,{},u):void 0;if(this.features.push({id:mt,text:Gr,icon:Un,index:Pt,sourceLayerIndex:Vt,geometry:wr.geometry,properties:et.properties,type:Ni[et.type],sortKey:Ai}),Un&&(j[Un.name]=!0),Gr){var Jn=x.evaluate(wr,{},u).join(","),Pn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dr.vertical)>=0;for(var ki=0,xi=Gr.sections;ki<xi.length;ki+=1){var zi=xi[ki];if(zi.image)j[zi.image.name]=!0;else{var Zn=oc(Gr.toString()),aa=zi.fontStack||Jn,qa=K[aa]=K[aa]||{};this.calculateGlyphDependencies(zi.text,qa,Pn,this.allowVerticalPlacement,Zn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(Eo){var go={},Ka={},So=[],Co=0;function ts(so){So.push(Eo[so]),Co++}function wo(so,Vo,Ms){var oa=Ka[so];return delete Ka[so],Ka[Vo]=oa,So[oa].geometry[0].pop(),So[oa].geometry[0]=So[oa].geometry[0].concat(Ms[0]),oa}function cs(so,Vo,Ms){var oa=go[Vo];return delete go[Vo],go[so]=oa,So[oa].geometry[0].shift(),So[oa].geometry[0]=Ms[0].concat(So[oa].geometry[0]),oa}function Ds(so,Vo,Ms){var oa=Ms?Vo[0][Vo[0].length-1]:Vo[0][0];return so+":"+oa.x+":"+oa.y}for(var oo=0;oo<Eo.length;oo++){var rs=Eo[oo],Ui=rs.geometry,Ma=rs.text?rs.text.toString():null;if(Ma){var ga=Ds(Ma,Ui),Ki=Ds(Ma,Ui,!0);if(ga in Ka&&Ki in go&&Ka[ga]!==go[Ki]){var Fs=cs(ga,Ki,Ui),fs=wo(ga,Ki,So[Fs].geometry);delete go[ga],delete Ka[Ki],Ka[Ds(Ma,So[fs].geometry,!0)]=fs,So[Fs].geometry=null}else ga in Ka?wo(ga,Ki,Ui):Ki in go?cs(ga,Ki,Ui):(ts(oo),go[ga]=Co-1,Ka[Ki]=Co-1)}else ts(oo)}return So.filter(function(so){return so.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Eo,go){return Eo.sortKey-go.sortKey})}},Le.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Le.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Le.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Le.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Le.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Le.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Le.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),g=t.dist(o[t.segment]),x={},S=t.segment+1;S<o.length;S++)x[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var M=t.segment||0;M>=0;M--)x[M]={x:o[M].x,y:o[M].y,tileUnitDistanceFromAnchor:g},M>0&&(g+=o[M-1].dist(o[M]));for(var D=0;D<o.length;D++){var B=x[D];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Le.prototype.addSymbols=function(t,o,u,h,g,x,S,M,D,B,Z,j){for(var K=t.indexArray,O=t.layoutVertexArray,we=t.segments.prepareSegment(4*o.length,O,K,this.canOverlap?x.sortKey:void 0),Pe=this.glyphOffsetArray.length,Ge=we.vertexLength,Be=this.allowVerticalPlacement&&S===Dr.vertical?Math.PI/2:0,et=x.text&&x.text.sections,mt=0;mt<o.length;mt++){var Pt=o[mt],Vt=Pt.tl,nr=Pt.tr,wr=Pt.bl,Gr=Pt.br,Fn=Pt.tex,sn=Pt.pixelOffsetTL,Un=Pt.pixelOffsetBR,fn=Pt.minFontScaleX,Ai=Pt.minFontScaleY,Jn=Pt.glyphOffset,Pn=Pt.isSDF,ki=Pt.sectionIndex,xi=we.vertexLength,zi=Jn[1];ie(O,M.x,M.y,Vt.x,zi+Vt.y,Fn.x,Fn.y,u,Pn,sn.x,sn.y,fn,Ai),ie(O,M.x,M.y,nr.x,zi+nr.y,Fn.x+Fn.w,Fn.y,u,Pn,Un.x,sn.y,fn,Ai),ie(O,M.x,M.y,wr.x,zi+wr.y,Fn.x,Fn.y+Fn.h,u,Pn,sn.x,Un.y,fn,Ai),ie(O,M.x,M.y,Gr.x,zi+Gr.y,Fn.x+Fn.w,Fn.y+Fn.h,u,Pn,Un.x,Un.y,fn,Ai),ze(t.dynamicLayoutVertexArray,M,Be),K.emplaceBack(xi,xi+1,xi+2),K.emplaceBack(xi+1,xi+2,xi+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jn[0]),mt!==o.length-1&&ki===o[mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(O.length,x,x.index,{},j,et&&et[ki])}t.placedSymbolArray.emplaceBack(M.x,M.y,Pe,this.glyphOffsetArray.length-Pe,Ge,D,B,M.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},Le.prototype._addCollisionDebugVertex=function(t,o,u,h,g,x){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,g,Math.round(x.x),Math.round(x.y))},Le.prototype.addCollisionDebugVertices=function(t,o,u,h,g,x,S){var M=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),D=M.vertexLength,B=g.layoutVertexArray,Z=g.collisionVertexArray,j=S.anchorX,K=S.anchorY;this._addCollisionDebugVertex(B,Z,x,j,K,new he(t,o)),this._addCollisionDebugVertex(B,Z,x,j,K,new he(u,o)),this._addCollisionDebugVertex(B,Z,x,j,K,new he(u,h)),this._addCollisionDebugVertex(B,Z,x,j,K,new he(t,h)),M.vertexLength+=4;var O=g.indexArray;O.emplaceBack(D,D+1),O.emplaceBack(D+1,D+2),O.emplaceBack(D+2,D+3),O.emplaceBack(D+3,D),M.primitiveLength+=4},Le.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var g=t;g<o;g++){var x=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,h?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}},Le.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new We(sc,Qc.members,Uc),this.iconCollisionBox=new We(sc,Qc.members,Uc);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Le.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,g,x,S,M,D){for(var B={},Z=o;Z<u;Z++){var j=t.get(Z);B.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},B.textFeatureIndex=j.featureIndex;break}for(var K=h;K<g;K++){var O=t.get(K);B.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},B.verticalTextFeatureIndex=O.featureIndex;break}for(var we=x;we<S;we++){var Pe=t.get(we);B.iconBox={x1:Pe.x1,y1:Pe.y1,x2:Pe.x2,y2:Pe.y2,anchorPointX:Pe.anchorPointX,anchorPointY:Pe.anchorPointY},B.iconFeatureIndex=Pe.featureIndex;break}for(var Ge=M;Ge<D;Ge++){var Be=t.get(Ge);B.verticalIconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},B.verticalIconFeatureIndex=Be.featureIndex;break}return B},Le.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Le.prototype.hasTextData=function(){return this.text.segments.get().length>0},Le.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Le.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Le.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Le.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Le.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,g=u.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},Le.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],g=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(o*M.anchorX+u*M.anchorY)),g.push(M.featureIndex)}return x.sort(function(D,B){return h[D]-h[B]||g[B]-g[D]}),x},Le.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Le.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var g=this.symbolInstances.get(h[u]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(x,S,M){x>=0&&M.indexOf(x)===S&&o.addIndicesForPlacedSymbol(o.text,x)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},hn("SymbolBucket",Le,{omit:["layers","collisionBoxArray","features","compareText"]}),Le.MAX_GLYPHS=65535,Le.addDynamicAttributes=ze;var Qe=new Fo({"symbol-placement":new On(oe.layout_symbol["symbol-placement"]),"symbol-spacing":new On(oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Sn(oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Sn(oe.layout_symbol["icon-size"]),"icon-text-fit":new On(oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Sn(oe.layout_symbol["icon-image"]),"icon-rotate":new Sn(oe.layout_symbol["icon-rotate"]),"icon-padding":new On(oe.layout_symbol["icon-padding"]),"icon-keep-upright":new On(oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Sn(oe.layout_symbol["icon-offset"]),"icon-anchor":new Sn(oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(oe.layout_symbol["text-rotation-alignment"]),"text-field":new Sn(oe.layout_symbol["text-field"]),"text-font":new Sn(oe.layout_symbol["text-font"]),"text-size":new Sn(oe.layout_symbol["text-size"]),"text-max-width":new Sn(oe.layout_symbol["text-max-width"]),"text-line-height":new On(oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Sn(oe.layout_symbol["text-letter-spacing"]),"text-justify":new Sn(oe.layout_symbol["text-justify"]),"text-radial-offset":new Sn(oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Sn(oe.layout_symbol["text-anchor"]),"text-max-angle":new On(oe.layout_symbol["text-max-angle"]),"text-writing-mode":new On(oe.layout_symbol["text-writing-mode"]),"text-rotate":new Sn(oe.layout_symbol["text-rotate"]),"text-padding":new On(oe.layout_symbol["text-padding"]),"text-keep-upright":new On(oe.layout_symbol["text-keep-upright"]),"text-transform":new Sn(oe.layout_symbol["text-transform"]),"text-offset":new Sn(oe.layout_symbol["text-offset"]),"text-allow-overlap":new On(oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(oe.layout_symbol["text-ignore-placement"]),"text-optional":new On(oe.layout_symbol["text-optional"])}),pe={paint:new Fo({"icon-opacity":new Sn(oe.paint_symbol["icon-opacity"]),"icon-color":new Sn(oe.paint_symbol["icon-color"]),"icon-halo-color":new Sn(oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Sn(oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Sn(oe.paint_symbol["icon-halo-blur"]),"icon-translate":new On(oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Sn(oe.paint_symbol["text-opacity"]),"text-color":new Sn(oe.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Sn(oe.paint_symbol["text-halo-color"]),"text-halo-width":new Sn(oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Sn(oe.paint_symbol["text-halo-blur"]),"text-translate":new On(oe.paint_symbol["text-translate"]),"text-translate-anchor":new On(oe.paint_symbol["text-translate-anchor"])}),layout:Qe},Ne=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t};Ne.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ne.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ne.prototype.outputDefined=function(){return!1},Ne.prototype.serialize=function(){return null},hn("FormatSectionOverride",Ne,{omit:["defaultValue"]});var Ee=function(t){function o(u){t.call(this,u,pe)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var x=[],S=0,M=g;S<M.length;S+=1){var D=M[S];x.indexOf(D)<0&&x.push(D)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,g,x){var S=this.layout.get(u).evaluate(h,{},g,x),M=this._unevaluatedLayout._values[u];return M.isDataDriven()||Jl(M.value)||!S?S:function(D,B){return B.replace(/{([^{}]+)}/g,function(Z,j){return j in D?String(D[j]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new Le(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=pe.paint.overridableProperties;u<h.length;u+=1){var g=h[u];if(o.hasPaintOverride(this.layout,g)){var x,S=this.paint.get(g),M=new Ne(S),D=new kc(M,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new wl("source",D):new il("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new bs(S.property,x,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,g){return!(!this.layout||h.isDataDriven()||g.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var g=u.get("text-field"),x=pe.paint.properties[h],S=!1,M=function(Z){for(var j=0,K=Z;j<K.length;j+=1)if(x.overrides&&x.overrides.hasOverride(K[j]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Ct)M(g.value.value.sections);else if(g.value.kind==="source"){var D=function(Z){S||(Z instanceof Fa&&Wi(Z.value)===Zi?M(Z.value.sections):Z instanceof Mo?M(Z.sections):Z.eachChild(D))},B=g.value;B._styleExpression&&D(B._styleExpression.expression)}return S},o}(Ou),it={paint:new Fo({"background-color":new On(oe.paint_background["background-color"]),"background-pattern":new os(oe.paint_background["background-pattern"]),"background-opacity":new On(oe.paint_background["background-opacity"])})},yt=function(t){function o(u){t.call(this,u,it)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ou),lr={paint:new Fo({"raster-opacity":new On(oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(oe.paint_raster["raster-brightness-max"]),"raster-saturation":new On(oe.paint_raster["raster-saturation"]),"raster-contrast":new On(oe.paint_raster["raster-contrast"]),"raster-resampling":new On(oe.paint_raster["raster-resampling"]),"raster-fade-duration":new On(oe.paint_raster["raster-fade-duration"])})},Br=function(t){function o(u){t.call(this,u,lr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ou),Nr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Ou),an={circle:jc,heatmap:Nl,hillshade:rp,fill:nh,"fill-extrusion":vl,line:oh,symbol:Ee,background:yt,raster:Br},Rr=ye.HTMLImageElement,Cn=ye.HTMLCanvasElement,on=ye.HTMLVideoElement,bn=ye.ImageData,_n=ye.ImageBitmap,dn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};dn.prototype.update=function(t,o,u){var h=t.width,g=t.height,x=!(this.size&&this.size[0]===h&&this.size[1]===g||u),S=this.context,M=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!o||o.premultiply!==!1)),x)this.size=[h,g],t instanceof Rr||t instanceof Cn||t instanceof on||t instanceof bn||_n&&t instanceof _n?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,g,0,this.format,M.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},B=D.x,Z=D.y;t instanceof Rr||t instanceof Cn||t instanceof on||t instanceof bn||_n&&t instanceof _n?M.texSubImage2D(M.TEXTURE_2D,0,B,Z,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,B,Z,h,g,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},dn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},dn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},dn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Yn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Yn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Yn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var xa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ir(["receive","process"],this),this.invoker=new Yn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Hr()?t:ye};function ls(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}xa.prototype.send=function(t,o,u,h,g){var x=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var M=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Zs(o,M)},M),{cancel:function(){u&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:x.mapId})}}},xa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Hr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},xa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},xa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(ws(o.error)):h(null,ws(o.data)))}else{var g=!1,x=Se(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,j){g=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?Zs(Z):null,data:Zs(j,x)},x)}:function(Z){g=!0},M=null,D=ws(o.data);if(this.parent[o.type])M=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var B=o.type.split(".");M=this.parent.getWorkerSource(o.sourceMapId,B[0],D.source)[B[1]](D,S)}else S(new Error("Could not find function "+o.type));!g&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},xa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var za=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};za.prototype.setNorthEast=function(t){return this._ne=t instanceof da?new da(t.lng,t.lat):da.convert(t),this},za.prototype.setSouthWest=function(t){return this._sw=t instanceof da?new da(t.lng,t.lat):da.convert(t),this},za.prototype.extend=function(t){var o,u,h=this._sw,g=this._ne;if(t instanceof da)o=t,u=t;else{if(!(t instanceof za))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(za.convert(t)):this.extend(da.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||g?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),g.lng=Math.max(u.lng,g.lng),g.lat=Math.max(u.lat,g.lat)):(this._sw=new da(o.lng,o.lat),this._ne=new da(u.lng,u.lat)),this},za.prototype.getCenter=function(){return new da((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},za.prototype.getSouthWest=function(){return this._sw},za.prototype.getNorthEast=function(){return this._ne},za.prototype.getNorthWest=function(){return new da(this.getWest(),this.getNorth())},za.prototype.getSouthEast=function(){return new da(this.getEast(),this.getSouth())},za.prototype.getWest=function(){return this._sw.lng},za.prototype.getSouth=function(){return this._sw.lat},za.prototype.getEast=function(){return this._ne.lng},za.prototype.getNorth=function(){return this._ne.lat},za.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},za.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},za.prototype.isEmpty=function(){return!(this._sw&&this._ne)},za.prototype.contains=function(t){var o=da.convert(t),u=o.lng,h=o.lat,g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g},za.convert=function(t){return!t||t instanceof za?t:new za(t)};var da=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};da.prototype.wrap=function(){return new da(ur(this.lng,-180,180),this.lat)},da.prototype.toArray=function(){return[this.lng,this.lat]},da.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},da.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(g,1))},da.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new za(new da(this.lng-u,this.lat-o),new da(this.lng+u,this.lat+o))},da.convert=function(t){if(t instanceof da)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new da(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new da(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Vl=2*Math.PI*63710088e-1;function Ls(t){return Vl*Math.cos(t*Math.PI/180)}function _l(t){return(180+t)/360}function Bu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function qp(t,o){return t/Ls(o)}function qs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var yc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};yc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=da.convert(t);return new yc(_l(u.lng),Bu(u.lat),qp(o,u.lat))},yc.prototype.toLngLat=function(){return new da(360*this.x-180,qs(this.y))},yc.prototype.toAltitude=function(){return this.z*Ls(qs(this.y))},yc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Vl*(t=qs(this.y),1/Math.cos(t*Math.PI/180));var t};var Tf=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=jl(0,t,t,o,u)};Tf.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Tf.prototype.url=function(t,o){var u,h,g,x,S,M=(h=this.y,g=this.z,x=ls(256*(u=this.x),256*(h=Math.pow(2,g)-h-1),g),S=ls(256*(u+1),256*(h+1),g),x[0]+","+x[1]+","+S[0]+","+S[1]),D=function(B,Z,j){for(var K,O="",we=B;we>0;we--)O+=(Z&(K=1<<we-1)?1:0)+(j&K?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",M)},Tf.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new he(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Tf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Rd=function(t,o){this.wrap=t,this.canonical=o,this.key=jl(t,o.z,o.z,o.x,o.y)},Ya=function(t,o,u,h,g){this.overscaledZ=t,this.wrap=o,this.canonical=new Tf(u,+h,+g),this.key=jl(o,t,u,h,g)};function jl(t,o,u,h,g){(t*=2)<0&&(t=-1*t-1);var x=1<<u;return(x*x*t+x*g+h).toString(36)+u.toString(36)+o.toString(36)}Ya.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Ya.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Ya(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ya(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Ya.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?jl(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):jl(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Ya.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Ya.prototype.children=function(t){if(this.overscaledZ>=t)return[new Ya(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Ya(o,this.wrap,o,u,h),new Ya(o,this.wrap,o,u+1,h),new Ya(o,this.wrap,o,u,h+1),new Ya(o,this.wrap,o,u+1,h+1)]},Ya.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Ya.prototype.wrapped=function(){return new Ya(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ya.prototype.unwrapTo=function(t){return new Ya(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Ya.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ya.prototype.toUnwrapped=function(){return new Rd(this.wrap,this.canonical)},Ya.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ya.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new yc(t.x-this.wrap,t.y))},hn("CanonicalTileID",Tf),hn("OverscaledTileID",Ya,{omit:["posMatrix"]});var _c=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var g=0;g<h;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(h,g)]=this.data[this._idx(h-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,h)]=this.data[this._idx(g,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};_c.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},_c.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},_c.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},_c.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},_c.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},_c.prototype.getPixels=function(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},_c.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,g=o*this.dim+this.dim,x=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:x=S-1;break;case 1:S=x+1}for(var M=-o*this.dim,D=-u*this.dim,B=x;B<S;B++)for(var Z=h;Z<g;Z++)this.data[this._idx(Z,B)]=t.data[this._idx(Z+M,B+D)]},hn("DEMData",_c);var fp=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};fp.prototype.encode=function(t){return this._stringToNumber[t]},fp.prototype.decode=function(t){return this._numberToString[t]};var hp=function(t,o,u,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=g},pp={geometry:{configurable:!0}};pp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},pp.geometry.set=function(t){this._geometry=t},hp.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(hp.prototype,pp);var lh=function(){this.state={},this.stateChanges={},this.deletedStates={}};lh.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},It(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==h&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var x in this.deletedStates[t][h]={},this.state[t][h])u[x]||(this.deletedStates[t][h][x]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},lh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},lh.prototype.getState=function(t,o){var u=String(o),h=It({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][o];if(g===null)return{};for(var x in g)delete h[x]}return h},lh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},lh.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var g={};for(var x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),It(this.state[h][x],this.stateChanges[h][x]),g[x]=this.state[h][x];u[h]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var D in this.state[S])M[D]={},this.state[S][D]={};else for(var B in this.deletedStates[S]){if(this.deletedStates[S][B]===null)this.state[S][B]={};else for(var Z=0,j=Object.keys(this.deletedStates[S][B]);Z<j.length;Z+=1)delete this.state[S][B][j[Z]];M[B]=this.state[S][B]}u[S]=u[S]||{},It(u[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var K in t)t[K].setFeatureState(u,o)};var ef=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Tu(8192,16,0),this.grid3D=new Tu(8192,16,0),this.featureIndexArray=new G,this.promoteId=o};function gv(t,o,u,h,g){return Xt(t,function(x,S){var M=o instanceof pu?o.get(S):null;return M&&M.evaluate?M.evaluate(u,h,g):M})}function yv(t){for(var o=1/0,u=1/0,h=-1/0,g=-1/0,x=0,S=t;x<S.length;x+=1){var M=S[x];o=Math.min(o,M.x),u=Math.min(u,M.y),h=Math.max(h,M.x),g=Math.max(g,M.y)}return{minX:o,minY:u,maxX:h,maxY:g}}function dp(t,o){return o-t}ef.prototype.insert=function(t,o,u,h,g,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g);for(var M=x?this.grid3D:this.grid,D=0;D<o.length;D++){for(var B=o[D],Z=[1/0,1/0,-1/0,-1/0],j=0;j<B.length;j++){var K=B[j];Z[0]=Math.min(Z[0],K.x),Z[1]=Math.min(Z[1],K.y),Z[2]=Math.max(Z[2],K.x),Z[3]=Math.max(Z[3],K.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&M.insert(S,Z[0],Z[1],Z[2],Z[3])}},ef.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new cu.VectorTile(new uh(this.rawTileData)).layers,this.sourceLayerCoder=new fp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ef.prototype.query=function(t,o,u,h){var g=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,M=Tl(x.filter),D=t.queryGeometry,B=t.queryPadding*S,Z=yv(D),j=this.grid.query(Z.minX-B,Z.minY-B,Z.maxX+B,Z.maxY+B),K=yv(t.cameraQueryGeometry),O=this.grid3D.query(K.minX-B,K.minY-B,K.maxX+B,K.maxY+B,function(Pt,Vt,nr,wr){return function(Gr,Fn,sn,Un,fn){for(var Ai=0,Jn=Gr;Ai<Jn.length;Ai+=1){var Pn=Jn[Ai];if(Fn<=Pn.x&&sn<=Pn.y&&Un>=Pn.x&&fn>=Pn.y)return!0}var ki=[new he(Fn,sn),new he(Fn,fn),new he(Un,fn),new he(Un,sn)];if(Gr.length>2){for(var xi=0,zi=ki;xi<zi.length;xi+=1)if(uu(Gr,zi[xi]))return!0}for(var Zn=0;Zn<Gr.length-1;Zn++)if(Fl(Gr[Zn],Gr[Zn+1],ki))return!0;return!1}(t.cameraQueryGeometry,Pt-B,Vt-B,nr+B,wr+B)}),we=0,Pe=O;we<Pe.length;we+=1)j.push(Pe[we]);j.sort(dp);for(var Ge,Be={},et=function(Pt){var Vt=j[Pt];if(Vt!==Ge){Ge=Vt;var nr=g.featureIndexArray.get(Vt),wr=null;g.loadMatchingFeature(Be,nr.bucketIndex,nr.sourceLayerIndex,nr.featureIndex,M,x.layers,x.availableImages,o,u,h,function(Gr,Fn,sn){return wr||(wr=Xa(Gr)),Fn.queryIntersectsFeature(D,Gr,sn,wr,g.z,t.transform,S,t.pixelPosMatrix)})}},mt=0;mt<j.length;mt++)et(mt);return Be},ef.prototype.loadMatchingFeature=function(t,o,u,h,g,x,S,M,D,B,Z){var j=this.bucketLayerIDs[o];if(!x||function(Gr,Fn){for(var sn=0;sn<Gr.length;sn++)if(Fn.indexOf(Gr[sn])>=0)return!0;return!1}(x,j)){var K=this.sourceLayerCoder.decode(u),O=this.vtLayers[K].feature(h);if(g.needGeometry){var we=fo(O,!0);if(!g.filter(new Ei(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!g.filter(new Ei(this.tileID.overscaledZ),O))return;for(var Pe=this.getId(O,K),Ge=0;Ge<j.length;Ge++){var Be=j[Ge];if(!(x&&x.indexOf(Be)<0)){var et=M[Be];if(et){var mt={};Pe!==void 0&&B&&(mt=B.getState(et.sourceLayer||"_geojsonTileLayer",Pe));var Pt=It({},D[Be]);Pt.paint=gv(Pt.paint,et.paint,O,mt,S),Pt.layout=gv(Pt.layout,et.layout,O,mt,S);var Vt=!Z||Z(O,et,mt);if(Vt){var nr=new hp(O,this.z,this.x,this.y,Pe);nr.layer=Pt;var wr=t[Be];wr===void 0&&(wr=t[Be]=[]),wr.push({featureIndex:h,feature:nr,intersectionZ:Vt})}}}}}},ef.prototype.lookupSymbolFeatures=function(t,o,u,h,g,x,S,M){var D={};this.loadVTLayers();for(var B=Tl(g),Z=0,j=t;Z<j.length;Z+=1)this.loadMatchingFeature(D,u,h,j[Z],B,x,S,M,o);return D},ef.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,g=u[o];h<g.length;h+=1)if(t===g[h])return!0;return!1},ef.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},hn("FeatureIndex",ef,{omit:["rawTileData","sourceLayerCoder"]});var ma=function(t,o){this.tileID=t,this.uid=jt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ma.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<di.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ma.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ma.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(B,Z){var j={};if(!Z)return j;for(var K=function(){var Pe=we[O],Ge=Pe.layerIds.map(function(mt){return Z.getLayer(mt)}).filter(Boolean);if(Ge.length!==0){Pe.layers=Ge,Pe.stateDependentLayerIds&&(Pe.stateDependentLayers=Pe.stateDependentLayerIds.map(function(mt){return Ge.filter(function(Pt){return Pt.id===mt})[0]}));for(var Be=0,et=Ge;Be<et.length;Be+=1)j[et[Be].id]=Pe}},O=0,we=B;O<we.length;O+=1)K();return j}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[h];if(g instanceof Le){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Le&&S.hasRTLText){this.hasRTLText=!0,As.isLoading()||As.isLoaded()||_f()!=="deferred"||nu();break}}for(var M in this.queryPadding=0,this.buckets){var D=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(M).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},ma.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ma.prototype.getBucket=function(t){return this.buckets[t.id]},ma.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},ma.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ma.prototype.queryRenderedFeatures=function(t,o,u,h,g,x,S,M,D,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},ma.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),g=o?o.sourceLayer:"",x=h._geojsonTileLayer||h[g];if(x)for(var S=Tl(o&&o.filter),M=this.tileID.canonical,D=M.z,B=M.x,Z=M.y,j={z:D,x:B,y:Z},K=0;K<x.length;K++){var O=x.feature(K);if(S.needGeometry){var we=fo(O,!0);if(!S.filter(new Ei(this.tileID.overscaledZ),we,this.tileID.canonical))continue}else if(!S.filter(new Ei(this.tileID.overscaledZ),O))continue;var Pe=u.getId(O,g),Ge=new hp(O,D,B,Z,Pe);Ge.tile=j,t.push(Ge)}}},ma.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ma.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ma.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=nn(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),g=!1;if(this.expirationTime>h)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{var x=this.expirationTime-o;x?this.expirationTime=h+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ma.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ma.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var g=this.buckets[h],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],M=t[x];if(S&&M&&Object.keys(M).length!==0){g.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(h);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}}},ma.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ma.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<di.now()},ma.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ma.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=di.now()+t},ma.prototype.setDependencies=function(t,o){for(var u={},h=0,g=o;h<g.length;h+=1)u[g[h]]=!0;this.dependencies[t]=u},ma.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var g=this.dependencies[h[u]];if(g){for(var x=0,S=o;x<S.length;x+=1)if(g[S[x]])return!0}}return!1};var tf=ye.performance,kd=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},tf.mark(this._marks.start)};kd.prototype.finish=function(){tf.mark(this._marks.end);var t=tf.getEntriesByName(this._marks.measure);return t.length===0&&(tf.measure(this._marks.measure,this._marks.start,this._marks.end),t=tf.getEntriesByName(this._marks.measure),tf.clearMarks(this._marks.start),tf.clearMarks(this._marks.end),tf.clearMeasures(this._marks.measure)),t},v.Actor=xa,v.AlphaImage=mu,v.CanonicalTileID=Tf,v.CollisionBoxArray=f,v.Color=Di,v.DEMData=_c,v.DataConstantProperty=On,v.DictionaryCoder=fp,v.EXTENT=8192,v.ErrorEvent=Ue,v.EvaluationParameters=Ei,v.Event=Me,v.Evented=Ke,v.FeatureIndex=ef,v.FillBucket=Xs,v.FillExtrusionBucket=Fu,v.ImageAtlas=gr,v.ImagePosition=rt,v.LineBucket=la,v.LngLat=da,v.LngLatBounds=za,v.MercatorCoordinate=yc,v.ONE_EM=24,v.OverscaledTileID=Ya,v.Point=he,v.Point$1=he,v.Properties=Fo,v.Protobuf=uh,v.RGBAImage=zo,v.RequestManager=Gi,v.RequestPerformance=kd,v.ResourceType=En,v.SegmentVector=se,v.SourceFeatureState=lh,v.StructArrayLayout1ui2=Gf,v.StructArrayLayout2f1f2i16=Ll,v.StructArrayLayout2i4=Xu,v.StructArrayLayout3ui6=ll,v.StructArrayLayout4i8=du,v.SymbolBucket=Le,v.Texture=dn,v.Tile=ma,v.Transitionable=Xo,v.Uniform1f=kr,v.Uniform1i=pr,v.Uniform2f=Ir,v.Uniform3f=Kr,v.Uniform4f=Dn,v.UniformColor=kn,v.UniformMatrix4f=Pi,v.UnwrappedTileID=Rd,v.ValidationError=Re,v.WritingMode=Dr,v.ZoomHistory=mf,v.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},v.addDynamicAttributes=ze,v.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,g=new Array(t.length),x=null;t.forEach(function(S,M){o(S,function(D,B){D&&(x=D),g[M]=B,--h==0&&u(x,g)})})},v.bezier=ft,v.bindAll=ir,v.browser=di,v.cacheEntryPossiblyAdded=function(t){++_i>Pr&&(t.getActor().send("enforceCacheSizeLimit",$t),_i=0)},v.clamp=Jt,v.clearTileCache=function(t){var o=ye.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},v.clipLine=bo,v.clone=function(t){var o=new Yi(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},v.clone$1=Ye,v.clone$2=function(t){var o=new Yi(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},v.collisionCircleLayout=Id,v.config=Gn,v.create=function(){var t=new Yi(16);return Yi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new Yi(9);return Yi!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new Yi(4);return Yi!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=Oe,v.createExpression=ec,v.createLayout=pa,v.createStyleLayer=function(t){return t.type==="custom"?new Nr(t):new an[t.type](t)},v.cross=function(t,o,u){var h=o[0],g=o[1],x=o[2],S=u[0],M=u[1],D=u[2];return t[0]=g*D-x*M,t[1]=x*S-h*D,t[2]=h*M-g*S,t},v.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var g in o)if(!t(o[g],u[g]))return!1;return!0}return o===u},v.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},v.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},v.ease=xt,v.emitValidationErrors=Bc,v.endsWith=Y,v.enforceCacheSizeLimit=function(t){ln(),Qi&&Qi.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},v.evaluateSizeForFeature=Xn,v.evaluateSizeForZoom=oi,v.evaluateVariableOffset=yl,v.evented=jf,v.extend=It,v.featureFilter=Tl,v.filterObject=st,v.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=qr,v.getAnchorJustification=Ce,v.getArrayBuffer=Da,v.getImage=q,v.getJSON=function(t,o){return Go(It(t,{type:"json"}),o)},v.getRTLTextPluginStatus=_f,v.getReferrer=Ti,v.getVideo=function(t,o){var u,h,g=ye.document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(var x=0;x<t.length;x++){var S=ye.document.createElement("source");u=t[x],h=void 0,(h=ye.document.createElement("a")).href=u,(h.protocol!==ye.document.location.protocol||h.host!==ye.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[x],g.appendChild(S)}return{cancel:function(){}}},v.identity=Rs,v.invert=function(t,o){var u=o[0],h=o[1],g=o[2],x=o[3],S=o[4],M=o[5],D=o[6],B=o[7],Z=o[8],j=o[9],K=o[10],O=o[11],we=o[12],Pe=o[13],Ge=o[14],Be=o[15],et=u*M-h*S,mt=u*D-g*S,Pt=u*B-x*S,Vt=h*D-g*M,nr=h*B-x*M,wr=g*B-x*D,Gr=Z*Pe-j*we,Fn=Z*Ge-K*we,sn=Z*Be-O*we,Un=j*Ge-K*Pe,fn=j*Be-O*Pe,Ai=K*Be-O*Ge,Jn=et*Ai-mt*fn+Pt*Un+Vt*sn-nr*Fn+wr*Gr;return Jn?(t[0]=(M*Ai-D*fn+B*Un)*(Jn=1/Jn),t[1]=(g*fn-h*Ai-x*Un)*Jn,t[2]=(Pe*wr-Ge*nr+Be*Vt)*Jn,t[3]=(K*nr-j*wr-O*Vt)*Jn,t[4]=(D*sn-S*Ai-B*Fn)*Jn,t[5]=(u*Ai-g*sn+x*Fn)*Jn,t[6]=(Ge*Pt-we*wr-Be*mt)*Jn,t[7]=(Z*wr-K*Pt+O*mt)*Jn,t[8]=(S*fn-M*sn+B*Gr)*Jn,t[9]=(h*sn-u*fn-x*Gr)*Jn,t[10]=(we*nr-Pe*Pt+Be*et)*Jn,t[11]=(j*Pt-Z*nr-O*et)*Jn,t[12]=(M*Fn-S*Un-D*Gr)*Jn,t[13]=(u*Un-h*Fn+g*Gr)*Jn,t[14]=(Pe*mt-we*Vt-Ge*et)*Jn,t[15]=(Z*Vt-j*mt+K*et)*Jn,t):null},v.isChar=zr,v.isMapboxURL=Li,v.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},v.makeRequest=Go,v.mapObject=Xt,v.mercatorXfromLng=_l,v.mercatorYfromLat=Bu,v.mercatorZfromAltitude=qp,v.mul=Zc,v.multiply=us,v.mvt=cu,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,o){var u=o[0],h=o[1],g=o[2],x=u*u+h*h+g*g;return x>0&&(x=1/Math.sqrt(x)),t[0]=o[0]*x,t[1]=o[1]*x,t[2]=o[2]*x,t},v.number=ha,v.offscreenCanvasSupported=fi,v.ortho=function(t,o,u,h,g,x,S){var M=1/(o-u),D=1/(h-g),B=1/(x-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*B,t[11]=0,t[12]=(o+u)*M,t[13]=(g+h)*D,t[14]=(S+x)*B,t[15]=1,t},v.parseGlyphPBF=function(t){return new uh(t).readFields(Cr,[])},v.pbf=uh,v.performSymbolLayout=function(t,o,u,h,g,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,B={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,j=Z.maxZoom;B.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ei(Z.minZoom),S),D["text-size"].possiblyEvaluate(new Ei(j),S)]}if(t.iconSizeData.kind==="composite"){var K=t.iconSizeData,O=K.maxZoom;B.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ei(K.minZoom),S),D["icon-size"].possiblyEvaluate(new Ei(O),S)]}B.layoutTextSize=D["text-size"].possiblyEvaluate(new Ei(t.zoom+1),S),B.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ei(t.zoom+1),S),B.textMaxSize=D["text-size"].possiblyEvaluate(new Ei(18));for(var we=24*M.get("text-line-height"),Pe=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ge=M.get("text-keep-upright"),Be=M.get("text-size"),et=function(){var Vt=Pt[mt],nr=M.get("text-font").evaluate(Vt,{},S).join(","),wr=Be.evaluate(Vt,{},S),Gr=B.layoutTextSize.evaluate(Vt,{},S),Fn=B.layoutIconSize.evaluate(Vt,{},S),sn={horizontal:{},vertical:void 0},Un=Vt.text,fn=[0,0];if(Un){var Ai=Un.toString(),Jn=24*M.get("text-letter-spacing").evaluate(Vt,{},S),Pn=function(Ui){for(var Ma=0,ga=Ui;Ma<ga.length;Ma+=1)if(Ki=ga[Ma].charCodeAt(0),zr.Arabic(Ki)||zr["Arabic Supplement"](Ki)||zr["Arabic Extended-A"](Ki)||zr["Arabic Presentation Forms-A"](Ki)||zr["Arabic Presentation Forms-B"](Ki))return!1;var Ki;return!0}(Ai)?Jn:0,ki=M.get("text-anchor").evaluate(Vt,{},S),xi=M.get("text-variable-anchor");if(!xi){var zi=M.get("text-radial-offset").evaluate(Vt,{},S);fn=zi?yl(ki,[24*zi,Ro]):M.get("text-offset").evaluate(Vt,{},S).map(function(Ui){return 24*Ui})}var Zn=Pe?"center":M.get("text-justify").evaluate(Vt,{},S),aa=M.get("symbol-placement"),qa=aa==="point"?24*M.get("text-max-width").evaluate(Vt,{},S):0,Eo=function(){t.allowVerticalPlacement&&oc(Ai)&&(sn.vertical=$r(Un,o,u,g,nr,qa,we,ki,"left",Pn,fn,Dr.vertical,!0,aa,Gr,wr))};if(!Pe&&xi){for(var go=Zn==="auto"?xi.map(function(Ui){return Ce(Ui)}):[Zn],Ka=!1,So=0;So<go.length;So++){var Co=go[So];if(!sn.horizontal[Co])if(Ka)sn.horizontal[Co]=sn.horizontal[0];else{var ts=$r(Un,o,u,g,nr,qa,we,"center",Co,Pn,fn,Dr.horizontal,!1,aa,Gr,wr);ts&&(sn.horizontal[Co]=ts,Ka=ts.positionedLines.length===1)}}Eo()}else{Zn==="auto"&&(Zn=Ce(ki));var wo=$r(Un,o,u,g,nr,qa,we,ki,Zn,Pn,fn,Dr.horizontal,!1,aa,Gr,wr);wo&&(sn.horizontal[Zn]=wo),Eo(),oc(Ai)&&Pe&&Ge&&(sn.vertical=$r(Un,o,u,g,nr,qa,we,ki,Zn,Pn,fn,Dr.vertical,!1,aa,Gr,wr))}}var cs=void 0,Ds=!1;if(Vt.icon&&Vt.icon.name){var oo=h[Vt.icon.name];oo&&(cs=function(Ui,Ma,ga){var Ki=qr(ga),Fs=Ma[0]-Ui.displaySize[0]*Ki.horizontalAlign,fs=Ma[1]-Ui.displaySize[1]*Ki.verticalAlign;return{image:Ui,top:fs,bottom:fs+Ui.displaySize[1],left:Fs,right:Fs+Ui.displaySize[0]}}(g[Vt.icon.name],M.get("icon-offset").evaluate(Vt,{},S),M.get("icon-anchor").evaluate(Vt,{},S)),Ds=oo.sdf,t.sdfIcons===void 0?t.sdfIcons=oo.sdf:t.sdfIcons!==oo.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oo.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var rs=gt(sn.horizontal)||sn.vertical;t.iconsInText=!!rs&&rs.iconsInText,(rs||cs)&&function(Ui,Ma,ga,Ki,Fs,fs,so,Vo,Ms,oa,xc){var gu=fs.textMaxSize.evaluate(Ma,{});gu===void 0&&(gu=so);var Gl,Ao=Ui.layers[0].layout,Hl=Ao.get("icon-offset").evaluate(Ma,{},xc),$u=gt(ga.horizontal),ch=so/24,Mf=Ui.tilePixelRatio*ch,fh=Ui.tilePixelRatio*gu/24,bc=Ui.tilePixelRatio*Vo,hh=Ui.tilePixelRatio*Ao.get("symbol-spacing"),vp=Ao.get("text-padding")*Ui.tilePixelRatio,ph=Ao.get("icon-padding")*Ui.tilePixelRatio,Dh=Ao.get("text-max-angle")/180*Math.PI,mp=Ao.get("text-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",gp=Ao.get("icon-rotation-alignment")==="map"&&Ao.get("symbol-placement")!=="point",Ec=Ao.get("symbol-placement"),Fh=hh/2,ns=Ao.get("icon-text-fit");Ki&&ns!=="none"&&(Ui.allowVerticalPlacement&&ga.vertical&&(Gl=ti(Ki,ga.vertical,ns,Ao.get("icon-text-fit-padding"),Hl,ch)),$u&&(Ki=ti(Ki,$u,ns,Ao.get("icon-text-fit-padding"),Hl,ch)));var rf=function(xv,Gh){Gh.x<0||Gh.x>=8192||Gh.y<0||Gh.y>=8192||function(To,yu,bv,Pf,Bd,Ev,$p,Sc,Qp,Cp,Jp,ed,Nd,Sv,wp,Cv,wv,Av,Tv,Mv,Ks,Wl,zd,Xl,td){var Ud,If,Hh,Wh,Xh,yh=To.addToLineVertexArray(yu,bv),Zd=0,Vd=0,rd=0,jd=0,Gd=-1,Hd=-1,Cc={},Pv=xe(""),nd=0,id=0;if(Sc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(nd=(Ud=Sc.layout.get("text-offset").evaluate(Ks,{},Xl).map(function(Pp){return 24*Pp}))[0],id=Ud[1]):(nd=24*Sc.layout.get("text-radial-offset").evaluate(Ks,{},Xl),id=Ro),To.allowVerticalPlacement&&Pf.vertical){var Wd=Sc.layout.get("text-rotate").evaluate(Ks,{},Xl)+90;Wh=new Zo(Qp,yu,Cp,Jp,ed,Pf.vertical,Nd,Sv,wp,Wd),$p&&(Xh=new Zo(Qp,yu,Cp,Jp,ed,$p,wv,Av,wp,Wd))}if(Bd){var ad=Sc.layout.get("icon-rotate").evaluate(Ks,{}),Iv=Sc.layout.get("icon-text-fit")!=="none",Ov=Yo(Bd,ad,zd,Iv),Xd=$p?Yo($p,ad,zd,Iv):void 0;Hh=new Zo(Qp,yu,Cp,Jp,ed,Bd,wv,Av,!1,ad),Zd=4*Ov.length;var Rv=To.iconSizeData,Ap=null;Rv.kind==="source"?(Ap=[128*Sc.layout.get("icon-size").evaluate(Ks,{})])[0]>32640&&$e(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Rv.kind==="composite"&&((Ap=[128*Wl.compositeIconSizes[0].evaluate(Ks,{},Xl),128*Wl.compositeIconSizes[1].evaluate(Ks,{},Xl)])[0]>32640||Ap[1]>32640)&&$e(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),To.addSymbols(To.icon,Ov,Ap,Mv,Tv,Ks,!1,yu,yh.lineStartIndex,yh.lineLength,-1,Xl),Gd=To.icon.placedSymbolArray.length-1,Xd&&(Vd=4*Xd.length,To.addSymbols(To.icon,Xd,Ap,Mv,Tv,Ks,Dr.vertical,yu,yh.lineStartIndex,yh.lineLength,-1,Xl),Hd=To.icon.placedSymbolArray.length-1)}for(var kv in Pf.horizontal){var od=Pf.horizontal[kv];if(!If){Pv=xe(od.text);var Lv=Sc.layout.get("text-rotate").evaluate(Ks,{},Xl);If=new Zo(Qp,yu,Cp,Jp,ed,od,Nd,Sv,wp,Lv)}var Yd=od.positionedLines.length===1;if(rd+=Ft(To,yu,od,Ev,Sc,wp,Ks,Cv,yh,Pf.vertical?Dr.horizontal:Dr.horizontalOnly,Yd?Object.keys(Pf.horizontal):[kv],Cc,Gd,Wl,Xl),Yd)break}Pf.vertical&&(jd+=Ft(To,yu,Pf.vertical,Ev,Sc,wp,Ks,Cv,yh,Dr.vertical,["vertical"],Cc,Hd,Wl,Xl));var Dv=If?If.boxStartIndex:To.collisionBoxArray.length,qd=If?If.boxEndIndex:To.collisionBoxArray.length,Fv=Wh?Wh.boxStartIndex:To.collisionBoxArray.length,Bv=Wh?Wh.boxEndIndex:To.collisionBoxArray.length,Tp=Hh?Hh.boxStartIndex:To.collisionBoxArray.length,Sm=Hh?Hh.boxEndIndex:To.collisionBoxArray.length,nf=Xh?Xh.boxStartIndex:To.collisionBoxArray.length,Nv=Xh?Xh.boxEndIndex:To.collisionBoxArray.length,Yl=-1,Mp=function(Pp,zv){return Pp&&Pp.circleDiameter?Math.max(Pp.circleDiameter,zv):zv};Yl=Mp(If,Yl),Yl=Mp(Wh,Yl),Yl=Mp(Hh,Yl);var Kd=(Yl=Mp(Xh,Yl))>-1?1:0;Kd&&(Yl*=td/24),To.glyphOffsetArray.length>=Le.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ks.sortKey!==void 0&&To.addToSortKeyRanges(To.symbolInstances.length,Ks.sortKey),To.symbolInstances.emplaceBack(yu.x,yu.y,Cc.right>=0?Cc.right:-1,Cc.center>=0?Cc.center:-1,Cc.left>=0?Cc.left:-1,Cc.vertical||-1,Gd,Hd,Pv,Dv,qd,Fv,Bv,Tp,Sm,nf,Nv,Cp,rd,jd,Zd,Vd,Kd,0,Nd,nd,id,Yl)}(Ui,Gh,xv,ga,Ki,Fs,Gl,Ui.layers[0],Ui.collisionBoxArray,Ma.index,Ma.sourceLayerIndex,Ui.index,Mf,vp,mp,Ms,bc,ph,gp,Hl,Ma,fs,oa,xc,so)};if(Ec==="line")for(var dh=0,yp=bo(Ma.geometry,0,0,8192,8192);dh<yp.length;dh+=1)for(var _p=yp[dh],Bh=0,Nh=Uo(_p,hh,Dh,ga.vertical||$u,Ki,24,fh,Ui.overscaling,8192);Bh<Nh.length;Bh+=1){var xp=Nh[Bh];$u&&pn(Ui,$u.text,Fh,xp)||rf(_p,xp)}else if(Ec==="line-center")for(var zh=0,Uh=Ma.geometry;zh<Uh.length;zh+=1){var Zh=Uh[zh];if(Zh.length>1){var bp=Va(Zh,Dh,ga.vertical||$u,Ki,24,fh);bp&&rf(Zh,bp)}}else if(Ma.type==="Polygon")for(var vh=0,Ep=Jf(Ma.geometry,0);vh<Ep.length;vh+=1){var mh=Ep[vh],Vh=Or(mh,16);rf(mh[0],new Xr(Vh.x,Vh.y,0))}else if(Ma.type==="LineString")for(var gh=0,Sp=Ma.geometry;gh<Sp.length;gh+=1){var jh=Sp[gh];rf(jh,new Xr(jh[0].x,jh[0].y,0))}else if(Ma.type==="Point")for(var Ld=0,Dd=Ma.geometry;Ld<Dd.length;Ld+=1)for(var Fd=0,_v=Dd[Ld];Fd<_v.length;Fd+=1){var Kp=_v[Fd];rf([Kp],new Xr(Kp.x,Kp.y,0))}}(t,Vt,sn,cs,h,B,Gr,Fn,fn,Ds,S)},mt=0,Pt=t.features;mt<Pt.length;mt+=1)et();x&&t.generateCollisionDebugBuffers()},v.perspective=function(t,o,u,h,g){var x,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+h)*(x=1/(h-g)),t[14]=2*g*h*x):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var g=o[h];g in t&&(u[g]=t[g])}return u},v.plugin=As,v.polygonIntersectsPolygon=ou,v.postMapLoadEvent=Bt,v.postTurnstileEvent=yo,v.potpack=br,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=hn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Is,pluginURL:Pu}),jf.on("pluginStateChange",t),t},v.renderColorRamp=Hf,v.rotate=function(t,o,u){var h=o[0],g=o[1],x=o[2],S=o[3],M=Math.sin(u),D=Math.cos(u);return t[0]=h*D+x*M,t[1]=g*D+S*M,t[2]=h*-M+x*D,t[3]=g*-M+S*D,t},v.rotateX=function(t,o,u){var h=Math.sin(u),g=Math.cos(u),x=o[4],S=o[5],M=o[6],D=o[7],B=o[8],Z=o[9],j=o[10],K=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=x*g+B*h,t[5]=S*g+Z*h,t[6]=M*g+j*h,t[7]=D*g+K*h,t[8]=B*g-x*h,t[9]=Z*g-S*h,t[10]=j*g-M*h,t[11]=K*g-D*h,t},v.rotateZ=function(t,o,u){var h=Math.sin(u),g=Math.cos(u),x=o[0],S=o[1],M=o[2],D=o[3],B=o[4],Z=o[5],j=o[6],K=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=x*g+B*h,t[1]=S*g+Z*h,t[2]=M*g+j*h,t[3]=D*g+K*h,t[4]=B*g-x*h,t[5]=Z*g-S*h,t[6]=j*g-M*h,t[7]=K*g-D*h,t},v.scale=function(t,o,u){var h=u[0],g=u[1],x=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*g,t[5]=o[5]*g,t[6]=o[6]*g,t[7]=o[7]*g,t[8]=o[8]*x,t[9]=o[9]*x,t[10]=o[10]*x,t[11]=o[11]*x,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},v.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},v.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},v.setCacheLimits=function(t,o){$t=t,Pr=o},v.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Is==="deferred"||Is==="loading"||Is==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Pu=di.resolveURL(t),Is="deferred",Mu=o,ol(),u||nu()},v.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},v.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},v.styleSpec=oe,v.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},v.symbolSize=Ri,v.transformMat3=function(t,o,u){var h=o[0],g=o[1],x=o[2];return t[0]=h*u[0]+g*u[3]+x*u[6],t[1]=h*u[1]+g*u[4]+x*u[7],t[2]=h*u[2]+g*u[5]+x*u[8],t},v.transformMat4=Vc,v.translate=function(t,o,u){var h,g,x,S,M,D,B,Z,j,K,O,we,Pe=u[0],Ge=u[1],Be=u[2];return o===t?(t[12]=o[0]*Pe+o[4]*Ge+o[8]*Be+o[12],t[13]=o[1]*Pe+o[5]*Ge+o[9]*Be+o[13],t[14]=o[2]*Pe+o[6]*Ge+o[10]*Be+o[14],t[15]=o[3]*Pe+o[7]*Ge+o[11]*Be+o[15]):(g=o[1],x=o[2],S=o[3],M=o[4],D=o[5],B=o[6],Z=o[7],j=o[8],K=o[9],O=o[10],we=o[11],t[0]=h=o[0],t[1]=g,t[2]=x,t[3]=S,t[4]=M,t[5]=D,t[6]=B,t[7]=Z,t[8]=j,t[9]=K,t[10]=O,t[11]=we,t[12]=h*Pe+M*Ge+j*Be+o[12],t[13]=g*Pe+D*Ge+K*Be+o[13],t[14]=x*Pe+B*Ge+O*Be+o[14],t[15]=S*Pe+Z*Ge+we*Be+o[15]),t},v.triggerPluginCompletionEvent=Vf,v.uniqueId=jt,v.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=ic,v.validateStyle=Na,v.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},v.vectorTile=cu,v.version="1.13.2",v.warnOnce=$e,v.webpSupported=ni,v.window=ye,v.wrap=ur}),ge(["./shared"],function(v){"use strict";function Oe(V){var q=typeof V;if(q==="number"||q==="boolean"||q==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var ee="[",fe=0,Me=V;fe<Me.length;fe+=1)ee+=Oe(Me[fe])+",";return ee+"]"}for(var Ue=Object.keys(V).sort(),Ke="{",oe=0;oe<Ue.length;oe++)Ke+=JSON.stringify(Ue[oe])+":"+Oe(V[Ue[oe]])+",";return Ke+"}"}function H(V){for(var q="",ee=0,fe=v.refProperties;ee<fe.length;ee+=1)q+="/"+Oe(V[fe[ee]]);return q}var ce=function(V){this.keyCache={},V&&this.replace(V)};ce.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},ce.prototype.update=function(V,q){for(var ee=this,fe=0,Me=V;fe<Me.length;fe+=1){var Ue=Me[fe];this._layerConfigs[Ue.id]=Ue;var Ke=this._layers[Ue.id]=v.createStyleLayer(Ue);Ke._featureFilter=v.featureFilter(Ke.filter),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id]}for(var oe=0,Re=q;oe<Re.length;oe+=1){var ut=Re[oe];delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut]}this.familiesBySource={};for(var cr=0,Tt=function(Lr,Wr){for(var hi={},Jr=0;Jr<Lr.length;Jr++){var Tn=Wr&&Wr[Lr[Jr].id]||H(Lr[Jr]);Wr&&(Wr[Lr[Jr].id]=Tn);var Zi=hi[Tn];Zi||(Zi=hi[Tn]=[]),Zi.push(Lr[Jr])}var si=[];for(var Si in hi)si.push(hi[Si]);return si}(v.values(this._layerConfigs),this.keyCache);cr<Tt.length;cr+=1){var Rt=Tt[cr].map(function(Lr){return ee._layers[Lr.id]}),hr=Rt[0];if(hr.visibility!=="none"){var gn=hr.source||"",cn=this.familiesBySource[gn];cn||(cn=this.familiesBySource[gn]={});var Et=hr.sourceLayer||"_geojsonTileLayer",Qr=cn[Et];Qr||(Qr=cn[Et]=[]),Qr.push(Rt)}}};var he=function(V){var q={},ee=[];for(var fe in V){var Me=V[fe],Ue=q[fe]={};for(var Ke in Me){var oe=Me[+Ke];if(oe&&oe.bitmap.width!==0&&oe.bitmap.height!==0){var Re={x:0,y:0,w:oe.bitmap.width+2,h:oe.bitmap.height+2};ee.push(Re),Ue[Ke]={rect:Re,metrics:oe.metrics}}}}var ut=v.potpack(ee),cr=new v.AlphaImage({width:ut.w||1,height:ut.h||1});for(var Tt in V){var Rt=V[Tt];for(var hr in Rt){var gn=Rt[+hr];if(gn&&gn.bitmap.width!==0&&gn.bitmap.height!==0){var cn=q[Tt][hr].rect;v.AlphaImage.copy(gn.bitmap,cr,{x:0,y:0},{x:cn.x+1,y:cn.y+1},gn.bitmap)}}}this.image=cr,this.positions=q};v.register("GlyphAtlas",he);var Fe=function(V){this.tileID=new v.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function ye(V,q,ee){for(var fe=new v.EvaluationParameters(q),Me=0,Ue=V;Me<Ue.length;Me+=1)Ue[Me].recalculate(fe,ee)}function Je(V,q){var ee=v.getArrayBuffer(V.request,function(fe,Me,Ue,Ke){fe?q(fe):Me&&q(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Me)),rawData:Me,cacheControl:Ue,expires:Ke})});return function(){ee.cancel(),q()}}Fe.prototype.parse=function(V,q,ee,fe,Me){var Ue=this;this.status="parsing",this.data=V,this.collisionBoxArray=new v.CollisionBoxArray;var Ke=new v.DictionaryCoder(Object.keys(V.layers).sort()),oe=new v.FeatureIndex(this.tileID,this.promoteId);oe.bucketLayerIDs=[];var Re,ut,cr,Tt,Rt={},hr={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},gn=q.familiesBySource[this.source];for(var cn in gn){var Et=V.layers[cn];if(Et){Et.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Qr=Ke.encode(cn),Lr=[],Wr=0;Wr<Et.length;Wr++){var hi=Et.feature(Wr),Jr=oe.getId(hi,cn);Lr.push({feature:hi,id:Jr,index:Wr,sourceLayerIndex:Qr})}for(var Tn=0,Zi=gn[cn];Tn<Zi.length;Tn+=1){var si=Zi[Tn],Si=si[0];Si.minzoom&&this.zoom<Math.floor(Si.minzoom)||Si.maxzoom&&this.zoom>=Si.maxzoom||Si.visibility!=="none"&&(ye(si,this.zoom,ee),(Rt[Si.id]=Si.createBucket({index:oe.bucketLayerIDs.length,layers:si,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qr,sourceID:this.source})).populate(Lr,hr,this.tileID.canonical),oe.bucketLayerIDs.push(si.map(function(bi){return bi.id})))}}}var gi=v.mapObject(hr.glyphDependencies,function(bi){return Object.keys(bi).map(Number)});Object.keys(gi).length?fe.send("getGlyphs",{uid:this.uid,stacks:gi},function(bi,Ci){Re||(Re=bi,ut=Ci,Ca.call(Ue))}):ut={};var vt=Object.keys(hr.iconDependencies);vt.length?fe.send("getImages",{icons:vt,source:this.source,tileID:this.tileID,type:"icons"},function(bi,Ci){Re||(Re=bi,cr=Ci,Ca.call(Ue))}):cr={};var kt=Object.keys(hr.patternDependencies);function Ca(){if(Re)return Me(Re);if(ut&&cr&&Tt){var bi=new he(ut),Ci=new v.ImageAtlas(cr,Tt);for(var Di in Rt){var Fr=Rt[Di];Fr instanceof v.SymbolBucket?(ye(Fr.layers,this.zoom,ee),v.performSymbolLayout(Fr,ut,bi.positions,cr,Ci.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Fr.hasPattern&&(Fr instanceof v.LineBucket||Fr instanceof v.FillBucket||Fr instanceof v.FillExtrusionBucket)&&(ye(Fr.layers,this.zoom,ee),Fr.addFeatures(hr,this.tileID.canonical,Ci.patternPositions))}this.status="done",Me(null,{buckets:v.values(Rt).filter(function(xn){return!xn.isEmpty()}),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,imageAtlas:Ci,glyphMap:this.returnDependencies?ut:null,iconMap:this.returnDependencies?cr:null,glyphPositions:this.returnDependencies?bi.positions:null})}}kt.length?fe.send("getImages",{icons:kt,source:this.source,tileID:this.tileID,type:"patterns"},function(bi,Ci){Re||(Re=bi,Tt=Ci,Ca.call(Ue))}):Tt={},Ca.call(this)};var ft=function(V,q,ee,fe){this.actor=V,this.layerIndex=q,this.availableImages=ee,this.loadVectorData=fe||Je,this.loading={},this.loaded={}};ft.prototype.loadTile=function(V,q){var ee=this,fe=V.uid;this.loading||(this.loading={});var Me=!!(V&&V.request&&V.request.collectResourceTiming)&&new v.RequestPerformance(V.request),Ue=this.loading[fe]=new Fe(V);Ue.abort=this.loadVectorData(V,function(Ke,oe){if(delete ee.loading[fe],Ke||!oe)return Ue.status="done",ee.loaded[fe]=Ue,q(Ke);var Re=oe.rawData,ut={};oe.expires&&(ut.expires=oe.expires),oe.cacheControl&&(ut.cacheControl=oe.cacheControl);var cr={};if(Me){var Tt=Me.finish();Tt&&(cr.resourceTiming=JSON.parse(JSON.stringify(Tt)))}Ue.vectorTile=oe.vectorTile,Ue.parse(oe.vectorTile,ee.layerIndex,ee.availableImages,ee.actor,function(Rt,hr){if(Rt||!hr)return q(Rt);q(null,v.extend({rawTileData:Re.slice(0)},hr,ut,cr))}),ee.loaded=ee.loaded||{},ee.loaded[fe]=Ue})},ft.prototype.reloadTile=function(V,q){var ee=this,fe=this.loaded,Me=V.uid,Ue=this;if(fe&&fe[Me]){var Ke=fe[Me];Ke.showCollisionBoxes=V.showCollisionBoxes;var oe=function(Re,ut){var cr=Ke.reloadCallback;cr&&(delete Ke.reloadCallback,Ke.parse(Ke.vectorTile,Ue.layerIndex,ee.availableImages,Ue.actor,cr)),q(Re,ut)};Ke.status==="parsing"?Ke.reloadCallback=oe:Ke.status==="done"&&(Ke.vectorTile?Ke.parse(Ke.vectorTile,this.layerIndex,this.availableImages,this.actor,oe):oe())}},ft.prototype.abortTile=function(V,q){var ee=this.loading,fe=V.uid;ee&&ee[fe]&&ee[fe].abort&&(ee[fe].abort(),delete ee[fe]),q()},ft.prototype.removeTile=function(V,q){var ee=this.loaded,fe=V.uid;ee&&ee[fe]&&delete ee[fe],q()};var xt=v.window.ImageBitmap,Jt=function(){this.loaded={}};function ur(V,q){if(V.length!==0){It(V[0],q);for(var ee=1;ee<V.length;ee++)It(V[ee],!q)}}function It(V,q){for(var ee=0,fe=0,Me=V.length,Ue=Me-1;fe<Me;Ue=fe++)ee+=(V[fe][0]-V[Ue][0])*(V[Ue][1]+V[fe][1]);ee>=0!=!!q&&V.reverse()}Jt.prototype.loadTile=function(V,q){var ee=V.uid,fe=V.encoding,Me=V.rawImageData,Ue=xt&&Me instanceof xt?this.getImageData(Me):Me,Ke=new v.DEMData(ee,Ue,fe);this.loaded=this.loaded||{},this.loaded[ee]=Ke,q(null,Ke)},Jt.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var q=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:q.width,height:q.height},q.data)},Jt.prototype.removeTile=function(V){var q=this.loaded,ee=V.uid;q&&q[ee]&&delete q[ee]};var er=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,jt=function(V){this._feature=V,this.extent=v.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],q=0,ee=this._feature.geometry;q<ee.length;q+=1){var fe=ee[q];V.push([new v.Point$1(fe[0],fe[1])])}return V}for(var Me=[],Ue=0,Ke=this._feature.geometry;Ue<Ke.length;Ue+=1){for(var oe=[],Re=0,ut=Ke[Ue];Re<ut.length;Re+=1){var cr=ut[Re];oe.push(new v.Point$1(cr[0],cr[1]))}Me.push(oe)}return Me},jt.prototype.toGeoJSON=function(V,q,ee){return er.call(this,V,q,ee)};var ct=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=V.length,this._features=V};ct.prototype.feature=function(V){return new jt(this._features[V])};var pt=v.vectorTile.VectorTileFeature,ir=Y;function Y(V,q){this.options=q||{},this.features=V,this.length=V.length}function Xt(V,q){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=q||4096}Y.prototype.feature=function(V){return new Xt(this.features[V],this.options.extent)},Xt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var q=0;q<V.length;q++){for(var ee=V[q],fe=[],Me=0;Me<ee.length;Me++)fe.push(new v.Point$1(ee[Me][0],ee[Me][1]));this.geometry.push(fe)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,q=1/0,ee=-1/0,fe=1/0,Me=-1/0,Ue=0;Ue<V.length;Ue++)for(var Ke=V[Ue],oe=0;oe<Ke.length;oe++){var Re=Ke[oe];q=Math.min(q,Re.x),ee=Math.max(ee,Re.x),fe=Math.min(fe,Re.y),Me=Math.max(Me,Re.y)}return[q,fe,ee,Me]},Xt.prototype.toGeoJSON=pt.prototype.toGeoJSON;var st=bt,Ye=ir;function bt(V){var q=new v.pbf;return function(ee,fe){for(var Me in ee.layers)fe.writeMessage(3,$e,ee.layers[Me])}(V,q),q.finish()}function $e(V,q){var ee;q.writeVarintField(15,V.version||1),q.writeStringField(1,V.name||""),q.writeVarintField(5,V.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<V.length;ee++)fe.feature=V.feature(ee),q.writeMessage(2,Yt,fe);var Me=fe.keys;for(ee=0;ee<Me.length;ee++)q.writeStringField(3,Me[ee]);var Ue=fe.values;for(ee=0;ee<Ue.length;ee++)q.writeMessage(4,Se,Ue[ee])}function Yt(V,q){var ee=V.feature;ee.id!==void 0&&q.writeVarintField(1,ee.id),q.writeMessage(2,Er,V),q.writeVarintField(3,ee.type),q.writeMessage(4,C,ee)}function Er(V,q){var ee=V.feature,fe=V.keys,Me=V.values,Ue=V.keycache,Ke=V.valuecache;for(var oe in ee.properties){var Re=Ue[oe];Re===void 0&&(fe.push(oe),Ue[oe]=Re=fe.length-1),q.writeVarint(Re);var ut=ee.properties[oe],cr=typeof ut;cr!=="string"&&cr!=="boolean"&&cr!=="number"&&(ut=JSON.stringify(ut));var Tt=cr+":"+ut,Rt=Ke[Tt];Rt===void 0&&(Me.push(ut),Ke[Tt]=Rt=Me.length-1),q.writeVarint(Rt)}}function Hr(V,q){return(q<<3)+(7&V)}function nn(V){return V<<1^V>>31}function C(V,q){for(var ee=V.loadGeometry(),fe=V.type,Me=0,Ue=0,Ke=ee.length,oe=0;oe<Ke;oe++){var Re=ee[oe],ut=1;fe===1&&(ut=Re.length),q.writeVarint(Hr(1,ut));for(var cr=fe===3?Re.length-1:Re.length,Tt=0;Tt<cr;Tt++){Tt===1&&fe!==1&&q.writeVarint(Hr(2,cr-1));var Rt=Re[Tt].x-Me,hr=Re[Tt].y-Ue;q.writeVarint(nn(Rt)),q.writeVarint(nn(hr)),Me+=Rt,Ue+=hr}fe===3&&q.writeVarint(Hr(7,1))}}function Se(V,q){var ee=typeof V;ee==="string"?q.writeStringField(1,V):ee==="boolean"?q.writeBooleanField(7,V):ee==="number"&&(V%1!=0?q.writeDoubleField(3,V):V<0?q.writeSVarintField(6,V):q.writeVarintField(5,V))}function ke(V,q,ee,fe){_t(V,ee,fe),_t(q,2*ee,2*fe),_t(q,2*ee+1,2*fe+1)}function _t(V,q,ee){var fe=V[q];V[q]=V[ee],V[ee]=fe}function ht(V,q,ee,fe){var Me=V-ee,Ue=q-fe;return Me*Me+Ue*Ue}st.fromVectorTileJs=bt,st.fromGeojsonVt=function(V,q){q=q||{};var ee={};for(var fe in V)ee[fe]=new ir(V[fe].features,q),ee[fe].name=fe,ee[fe].version=q.version,ee[fe].extent=q.extent;return bt({layers:ee})},st.GeoJSONWrapper=Ye;var Lt=function(V){return V[0]},Ht=function(V){return V[1]},xr=function(V,q,ee,fe,Me){q===void 0&&(q=Lt),ee===void 0&&(ee=Ht),fe===void 0&&(fe=64),Me===void 0&&(Me=Float64Array),this.nodeSize=fe,this.points=V;for(var Ue=V.length<65536?Uint16Array:Uint32Array,Ke=this.ids=new Ue(V.length),oe=this.coords=new Me(2*V.length),Re=0;Re<V.length;Re++)Ke[Re]=Re,oe[2*Re]=q(V[Re]),oe[2*Re+1]=ee(V[Re]);(function ut(cr,Tt,Rt,hr,gn,cn){if(!(gn-hr<=Rt)){var Et=hr+gn>>1;(function Qr(Lr,Wr,hi,Jr,Tn,Zi){for(;Tn>Jr;){if(Tn-Jr>600){var si=Tn-Jr+1,Si=hi-Jr+1,gi=Math.log(si),vt=.5*Math.exp(2*gi/3),kt=.5*Math.sqrt(gi*vt*(si-vt)/si)*(Si-si/2<0?-1:1);Qr(Lr,Wr,hi,Math.max(Jr,Math.floor(hi-Si*vt/si+kt)),Math.min(Tn,Math.floor(hi+(si-Si)*vt/si+kt)),Zi)}var Ca=Wr[2*hi+Zi],bi=Jr,Ci=Tn;for(ke(Lr,Wr,Jr,hi),Wr[2*Tn+Zi]>Ca&&ke(Lr,Wr,Jr,Tn);bi<Ci;){for(ke(Lr,Wr,bi,Ci),bi++,Ci--;Wr[2*bi+Zi]<Ca;)bi++;for(;Wr[2*Ci+Zi]>Ca;)Ci--}Wr[2*Jr+Zi]===Ca?ke(Lr,Wr,Jr,Ci):ke(Lr,Wr,++Ci,Tn),Ci<=hi&&(Jr=Ci+1),hi<=Ci&&(Tn=Ci-1)}})(cr,Tt,Et,hr,gn,cn%2),ut(cr,Tt,Rt,hr,Et-1,cn+1),ut(cr,Tt,Rt,Et+1,gn,cn+1)}})(Ke,oe,fe,0,Ke.length-1,0)};xr.prototype.range=function(V,q,ee,fe){return function(Me,Ue,Ke,oe,Re,ut,cr){for(var Tt,Rt,hr=[0,Me.length-1,0],gn=[];hr.length;){var cn=hr.pop(),Et=hr.pop(),Qr=hr.pop();if(Et-Qr<=cr)for(var Lr=Qr;Lr<=Et;Lr++)Rt=Ue[2*Lr+1],(Tt=Ue[2*Lr])>=Ke&&Tt<=Re&&Rt>=oe&&Rt<=ut&&gn.push(Me[Lr]);else{var Wr=Math.floor((Qr+Et)/2);Rt=Ue[2*Wr+1],(Tt=Ue[2*Wr])>=Ke&&Tt<=Re&&Rt>=oe&&Rt<=ut&&gn.push(Me[Wr]);var hi=(cn+1)%2;(cn===0?Ke<=Tt:oe<=Rt)&&(hr.push(Qr),hr.push(Wr-1),hr.push(hi)),(cn===0?Re>=Tt:ut>=Rt)&&(hr.push(Wr+1),hr.push(Et),hr.push(hi))}}return gn}(this.ids,this.coords,V,q,ee,fe,this.nodeSize)},xr.prototype.within=function(V,q,ee){return function(fe,Me,Ue,Ke,oe,Re){for(var ut=[0,fe.length-1,0],cr=[],Tt=oe*oe;ut.length;){var Rt=ut.pop(),hr=ut.pop(),gn=ut.pop();if(hr-gn<=Re)for(var cn=gn;cn<=hr;cn++)ht(Me[2*cn],Me[2*cn+1],Ue,Ke)<=Tt&&cr.push(fe[cn]);else{var Et=Math.floor((gn+hr)/2),Qr=Me[2*Et],Lr=Me[2*Et+1];ht(Qr,Lr,Ue,Ke)<=Tt&&cr.push(fe[Et]);var Wr=(Rt+1)%2;(Rt===0?Ue-oe<=Qr:Ke-oe<=Lr)&&(ut.push(gn),ut.push(Et-1),ut.push(Wr)),(Rt===0?Ue+oe>=Qr:Ke+oe>=Lr)&&(ut.push(Et+1),ut.push(hr),ut.push(Wr))}}return cr}(this.ids,this.coords,V,q,ee,this.nodeSize)};var Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},mn=function(V){this.options=ca(Object.create(Kn),V),this.trees=new Array(this.options.maxZoom+1)};function di(V,q,ee,fe,Me){return{x:V,y:q,zoom:1/0,id:ee,parentId:-1,numPoints:fe,properties:Me}}function Gn(V,q){var ee=V.geometry.coordinates,fe=ee[1];return{x:Hn(ee[0]),y:mi(fe),zoom:1/0,index:q,parentId:-1}}function ni(V){return{type:"Feature",id:V.id,properties:vi(V),geometry:{type:"Point",coordinates:[(fe=V.x,360*(fe-.5)),(q=V.y,ee=(180-360*q)*Math.PI/180,360*Math.atan(Math.exp(ee))/Math.PI-90)]}};var q,ee,fe}function vi(V){var q=V.numPoints,ee=q>=1e4?Math.round(q/1e3)+"k":q>=1e3?Math.round(q/100)/10+"k":q;return ca(ca({},V.properties),{cluster:!0,cluster_id:V.id,point_count:q,point_count_abbreviated:ee})}function Hn(V){return V/360+.5}function mi(V){var q=Math.sin(V*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function ca(V,q){for(var ee in q)V[ee]=q[ee];return V}function Gi(V){return V.x}function Li(V){return V.y}function $i(V,q,ee,fe,Me,Ue){var Ke=Me-ee,oe=Ue-fe;if(Ke!==0||oe!==0){var Re=((V-ee)*Ke+(q-fe)*oe)/(Ke*Ke+oe*oe);Re>1?(ee=Me,fe=Ue):Re>0&&(ee+=Ke*Re,fe+=oe*Re)}return(Ke=V-ee)*Ke+(oe=q-fe)*oe}function fa(V,q,ee,fe){var Me={id:V===void 0?null:V,type:q,geometry:ee,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ue){var Ke=Ue.geometry,oe=Ue.type;if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")ko(Ue,Ke);else if(oe==="Polygon"||oe==="MultiLineString")for(var Re=0;Re<Ke.length;Re++)ko(Ue,Ke[Re]);else if(oe==="MultiPolygon")for(Re=0;Re<Ke.length;Re++)for(var ut=0;ut<Ke[Re].length;ut++)ko(Ue,Ke[Re][ut])}(Me),Me}function ko(V,q){for(var ee=0;ee<q.length;ee+=3)V.minX=Math.min(V.minX,q[ee]),V.minY=Math.min(V.minY,q[ee+1]),V.maxX=Math.max(V.maxX,q[ee]),V.maxY=Math.max(V.maxY,q[ee+1])}function Oa(V,q,ee,fe){if(q.geometry){var Me=q.geometry.coordinates,Ue=q.geometry.type,Ke=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2),oe=[],Re=q.id;if(ee.promoteId?Re=q.properties[ee.promoteId]:ee.generateId&&(Re=fe||0),Ue==="Point")ya(Me,oe);else if(Ue==="MultiPoint")for(var ut=0;ut<Me.length;ut++)ya(Me[ut],oe);else if(Ue==="LineString")Fi(Me,oe,Ke,!1);else if(Ue==="MultiLineString"){if(ee.lineMetrics){for(ut=0;ut<Me.length;ut++)Fi(Me[ut],oe=[],Ke,!1),V.push(fa(Re,"LineString",oe,q.properties));return}ra(Me,oe,Ke,!1)}else if(Ue==="Polygon")ra(Me,oe,Ke,!0);else{if(Ue!=="MultiPolygon"){if(Ue==="GeometryCollection"){for(ut=0;ut<q.geometry.geometries.length;ut++)Oa(V,{id:Re,geometry:q.geometry.geometries[ut],properties:q.properties},ee,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ut=0;ut<Me.length;ut++){var cr=[];ra(Me[ut],cr,Ke,!0),oe.push(cr)}}V.push(fa(Re,Ue,oe,q.properties))}}function ya(V,q){q.push(Qi(V[0])),q.push(Es(V[1])),q.push(0)}function Fi(V,q,ee,fe){for(var Me,Ue,Ke=0,oe=0;oe<V.length;oe++){var Re=Qi(V[oe][0]),ut=Es(V[oe][1]);q.push(Re),q.push(ut),q.push(0),oe>0&&(Ke+=fe?(Me*ut-Re*Ue)/2:Math.sqrt(Math.pow(Re-Me,2)+Math.pow(ut-Ue,2))),Me=Re,Ue=ut}var cr=q.length-3;q[2]=1,function Tt(Rt,hr,gn,cn){for(var Et,Qr=cn,Lr=gn-hr>>1,Wr=gn-hr,hi=Rt[hr],Jr=Rt[hr+1],Tn=Rt[gn],Zi=Rt[gn+1],si=hr+3;si<gn;si+=3){var Si=$i(Rt[si],Rt[si+1],hi,Jr,Tn,Zi);if(Si>Qr)Et=si,Qr=Si;else if(Si===Qr){var gi=Math.abs(si-Lr);gi<Wr&&(Et=si,Wr=gi)}}Qr>cn&&(Et-hr>3&&Tt(Rt,hr,Et,cn),Rt[Et+2]=Qr,gn-Et>3&&Tt(Rt,Et,gn,cn))}(q,0,cr,ee),q[cr+2]=1,q.size=Math.abs(Ke),q.start=0,q.end=q.size}function ra(V,q,ee,fe){for(var Me=0;Me<V.length;Me++){var Ue=[];Fi(V[Me],Ue,ee,fe),q.push(Ue)}}function Qi(V){return V/360+.5}function Es(V){var q=Math.sin(V*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function le(V,q,ee,fe,Me,Ue,Ke,oe){if(fe/=q,Ue>=(ee/=q)&&Ke<fe)return V;if(Ke<ee||Ue>=fe)return null;for(var Re=[],ut=0;ut<V.length;ut++){var cr=V[ut],Tt=cr.geometry,Rt=cr.type,hr=Me===0?cr.minX:cr.minY,gn=Me===0?cr.maxX:cr.maxY;if(hr>=ee&&gn<fe)Re.push(cr);else if(!(gn<ee||hr>=fe)){var cn=[];if(Rt==="Point"||Rt==="MultiPoint")ii(Tt,cn,ee,fe,Me);else if(Rt==="LineString")yo(Tt,cn,ee,fe,Me,!1,oe.lineMetrics);else if(Rt==="MultiLineString")Bt(Tt,cn,ee,fe,Me,!1);else if(Rt==="Polygon")Bt(Tt,cn,ee,fe,Me,!0);else if(Rt==="MultiPolygon")for(var Et=0;Et<Tt.length;Et++){var Qr=[];Bt(Tt[Et],Qr,ee,fe,Me,!0),Qr.length&&cn.push(Qr)}if(cn.length){if(oe.lineMetrics&&Rt==="LineString"){for(Et=0;Et<cn.length;Et++)Re.push(fa(cr.id,Rt,cn[Et],cr.tags));continue}Rt!=="LineString"&&Rt!=="MultiLineString"||(cn.length===1?(Rt="LineString",cn=cn[0]):Rt="MultiLineString"),Rt!=="Point"&&Rt!=="MultiPoint"||(Rt=cn.length===3?"Point":"MultiPoint"),Re.push(fa(cr.id,Rt,cn,cr.tags))}}}return Re.length?Re:null}function ii(V,q,ee,fe,Me){for(var Ue=0;Ue<V.length;Ue+=3){var Ke=V[Ue+Me];Ke>=ee&&Ke<=fe&&(q.push(V[Ue]),q.push(V[Ue+1]),q.push(V[Ue+2]))}}function yo(V,q,ee,fe,Me,Ue,Ke){for(var oe,Re,ut=Qs(V),cr=Me===0?Pr:ln,Tt=V.start,Rt=0;Rt<V.length-3;Rt+=3){var hr=V[Rt],gn=V[Rt+1],cn=V[Rt+2],Et=V[Rt+3],Qr=V[Rt+4],Lr=Me===0?hr:gn,Wr=Me===0?Et:Qr,hi=!1;Ke&&(oe=Math.sqrt(Math.pow(hr-Et,2)+Math.pow(gn-Qr,2))),Lr<ee?Wr>ee&&(Re=cr(ut,hr,gn,Et,Qr,ee),Ke&&(ut.start=Tt+oe*Re)):Lr>fe?Wr<fe&&(Re=cr(ut,hr,gn,Et,Qr,fe),Ke&&(ut.start=Tt+oe*Re)):$t(ut,hr,gn,cn),Wr<ee&&Lr>=ee&&(Re=cr(ut,hr,gn,Et,Qr,ee),hi=!0),Wr>fe&&Lr<=fe&&(Re=cr(ut,hr,gn,Et,Qr,fe),hi=!0),!Ue&&hi&&(Ke&&(ut.end=Tt+oe*Re),q.push(ut),ut=Qs(V)),Ke&&(Tt+=oe)}var Jr=V.length-3;hr=V[Jr],gn=V[Jr+1],cn=V[Jr+2],(Lr=Me===0?hr:gn)>=ee&&Lr<=fe&&$t(ut,hr,gn,cn),Jr=ut.length-3,Ue&&Jr>=3&&(ut[Jr]!==ut[0]||ut[Jr+1]!==ut[1])&&$t(ut,ut[0],ut[1],ut[2]),ut.length&&q.push(ut)}function Qs(V){var q=[];return q.size=V.size,q.start=V.start,q.end=V.end,q}function Bt(V,q,ee,fe,Me,Ue){for(var Ke=0;Ke<V.length;Ke++)yo(V[Ke],q,ee,fe,Me,Ue,!1)}function $t(V,q,ee,fe){V.push(q),V.push(ee),V.push(fe)}function Pr(V,q,ee,fe,Me,Ue){var Ke=(Ue-q)/(fe-q);return V.push(Ue),V.push(ee+(Me-ee)*Ke),V.push(1),Ke}function ln(V,q,ee,fe,Me,Ue){var Ke=(Ue-ee)/(Me-ee);return V.push(q+(fe-q)*Ke),V.push(Ue),V.push(1),Ke}function An(V,q){for(var ee=[],fe=0;fe<V.length;fe++){var Me,Ue=V[fe],Ke=Ue.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")Me=Nn(Ue.geometry,q);else if(Ke==="MultiLineString"||Ke==="Polygon"){Me=[];for(var oe=0;oe<Ue.geometry.length;oe++)Me.push(Nn(Ue.geometry[oe],q))}else if(Ke==="MultiPolygon")for(Me=[],oe=0;oe<Ue.geometry.length;oe++){for(var Re=[],ut=0;ut<Ue.geometry[oe].length;ut++)Re.push(Nn(Ue.geometry[oe][ut],q));Me.push(Re)}ee.push(fa(Ue.id,Ke,Me,Ue.tags))}return ee}function Nn(V,q){var ee=[];ee.size=V.size,V.start!==void 0&&(ee.start=V.start,ee.end=V.end);for(var fe=0;fe<V.length;fe+=3)ee.push(V[fe]+q,V[fe+1],V[fe+2]);return ee}function _i(V,q){if(V.transformed)return V;var ee,fe,Me,Ue=1<<V.z,Ke=V.x,oe=V.y;for(ee=0;ee<V.features.length;ee++){var Re=V.features[ee],ut=Re.geometry,cr=Re.type;if(Re.geometry=[],cr===1)for(fe=0;fe<ut.length;fe+=2)Re.geometry.push(fi(ut[fe],ut[fe+1],q,Ue,Ke,oe));else for(fe=0;fe<ut.length;fe++){var Tt=[];for(Me=0;Me<ut[fe].length;Me+=2)Tt.push(fi(ut[fe][Me],ut[fe][Me+1],q,Ue,Ke,oe));Re.geometry.push(Tt)}}return V.transformed=!0,V}function fi(V,q,ee,fe,Me,Ue){return[Math.round(ee*(V*fe-Me)),Math.round(ee*(q*fe-Ue))]}function En(V,q,ee,fe,Me){for(var Ue=q===Me.maxZoom?0:Me.tolerance/((1<<q)*Me.extent),Ke={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ee,y:fe,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<V.length;oe++){Ke.numFeatures++,Mi(Ke,V[oe],Ue,Me);var Re=V[oe].minX,ut=V[oe].minY,cr=V[oe].maxX,Tt=V[oe].maxY;Re<Ke.minX&&(Ke.minX=Re),ut<Ke.minY&&(Ke.minY=ut),cr>Ke.maxX&&(Ke.maxX=cr),Tt>Ke.maxY&&(Ke.maxY=Tt)}return Ke}function Mi(V,q,ee,fe){var Me=q.geometry,Ue=q.type,Ke=[];if(Ue==="Point"||Ue==="MultiPoint")for(var oe=0;oe<Me.length;oe+=3)Ke.push(Me[oe]),Ke.push(Me[oe+1]),V.numPoints++,V.numSimplified++;else if(Ue==="LineString")Ti(Ke,Me,V,ee,!1,!1);else if(Ue==="MultiLineString"||Ue==="Polygon")for(oe=0;oe<Me.length;oe++)Ti(Ke,Me[oe],V,ee,Ue==="Polygon",oe===0);else if(Ue==="MultiPolygon")for(var Re=0;Re<Me.length;Re++){var ut=Me[Re];for(oe=0;oe<ut.length;oe++)Ti(Ke,ut[oe],V,ee,!0,oe===0)}if(Ke.length){var cr=q.tags||null;if(Ue==="LineString"&&fe.lineMetrics){for(var Tt in cr={},q.tags)cr[Tt]=q.tags[Tt];cr.mapbox_clip_start=Me.start/Me.size,cr.mapbox_clip_end=Me.end/Me.size}var Rt={geometry:Ke,type:Ue==="Polygon"||Ue==="MultiPolygon"?3:Ue==="LineString"||Ue==="MultiLineString"?2:1,tags:cr};q.id!==null&&(Rt.id=q.id),V.features.push(Rt)}}function Ti(V,q,ee,fe,Me,Ue){var Ke=fe*fe;if(fe>0&&q.size<(Me?Ke:fe))ee.numPoints+=q.length/3;else{for(var oe=[],Re=0;Re<q.length;Re+=3)(fe===0||q[Re+2]>Ke)&&(ee.numSimplified++,oe.push(q[Re]),oe.push(q[Re+1])),ee.numPoints++;Me&&function(ut,cr){for(var Tt=0,Rt=0,hr=ut.length,gn=hr-2;Rt<hr;gn=Rt,Rt+=2)Tt+=(ut[Rt]-ut[gn])*(ut[Rt+1]+ut[gn+1]);if(Tt>0===cr)for(Rt=0,hr=ut.length;Rt<hr/2;Rt+=2){var cn=ut[Rt],Et=ut[Rt+1];ut[Rt]=ut[hr-2-Rt],ut[Rt+1]=ut[hr-1-Rt],ut[hr-2-Rt]=cn,ut[hr-1-Rt]=Et}}(oe,Ue),V.push(oe)}}function eo(V,q){var ee=(q=this.options=function(Me,Ue){for(var Ke in Ue)Me[Ke]=Ue[Ke];return Me}(Object.create(this.options),q)).debug;if(ee&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var fe=function(Me,Ue){var Ke=[];if(Me.type==="FeatureCollection")for(var oe=0;oe<Me.features.length;oe++)Oa(Ke,Me.features[oe],Ue,oe);else Oa(Ke,Me.type==="Feature"?Me:{geometry:Me},Ue);return Ke}(V,q);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(fe=function(Me,Ue){var Ke=Ue.buffer/Ue.extent,oe=Me,Re=le(Me,1,-1-Ke,Ke,0,-1,2,Ue),ut=le(Me,1,1-Ke,2+Ke,0,-1,2,Ue);return(Re||ut)&&(oe=le(Me,1,-Ke,1+Ke,0,-1,2,Ue)||[],Re&&(oe=An(Re,1).concat(oe)),ut&&(oe=oe.concat(An(ut,-1)))),oe}(fe,q)).length&&this.splitTile(fe,0,0,0),ee&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ps(V,q,ee){return 32*((1<<V)*ee+q)+V}function Go(V,q){var ee=V.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);var fe=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!fe)return q(null,null);var Me=new ct(fe.features),Ue=st(Me);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),q(null,{vectorTile:Me,rawData:Ue.buffer})}mn.prototype.load=function(V){var q=this.options,ee=q.log,fe=q.minZoom,Me=q.maxZoom,Ue=q.nodeSize;ee&&console.time("total time");var Ke="prepare "+V.length+" points";ee&&console.time(Ke),this.points=V;for(var oe=[],Re=0;Re<V.length;Re++)V[Re].geometry&&oe.push(Gn(V[Re],Re));this.trees[Me+1]=new xr(oe,Gi,Li,Ue,Float32Array),ee&&console.timeEnd(Ke);for(var ut=Me;ut>=fe;ut--){var cr=+Date.now();oe=this._cluster(oe,ut),this.trees[ut]=new xr(oe,Gi,Li,Ue,Float32Array),ee&&console.log("z%d: %d clusters in %dms",ut,oe.length,+Date.now()-cr)}return ee&&console.timeEnd("total time"),this},mn.prototype.getClusters=function(V,q){var ee=((V[0]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,V[1])),Me=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ue=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ee=-180,Me=180;else if(ee>Me){var Ke=this.getClusters([ee,fe,180,Ue],q),oe=this.getClusters([-180,fe,Me,Ue],q);return Ke.concat(oe)}for(var Re=this.trees[this._limitZoom(q)],ut=[],cr=0,Tt=Re.range(Hn(ee),mi(Ue),Hn(Me),mi(fe));cr<Tt.length;cr+=1){var Rt=Re.points[Tt[cr]];ut.push(Rt.numPoints?ni(Rt):this.points[Rt.index])}return ut},mn.prototype.getChildren=function(V){var q=this._getOriginId(V),ee=this._getOriginZoom(V),fe="No cluster with the specified id.",Me=this.trees[ee];if(!Me)throw new Error(fe);var Ue=Me.points[q];if(!Ue)throw new Error(fe);for(var Ke=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),oe=[],Re=0,ut=Me.within(Ue.x,Ue.y,Ke);Re<ut.length;Re+=1){var cr=Me.points[ut[Re]];cr.parentId===V&&oe.push(cr.numPoints?ni(cr):this.points[cr.index])}if(oe.length===0)throw new Error(fe);return oe},mn.prototype.getLeaves=function(V,q,ee){var fe=[];return this._appendLeaves(fe,V,q=q||10,ee=ee||0,0),fe},mn.prototype.getTile=function(V,q,ee){var fe=this.trees[this._limitZoom(V)],Me=Math.pow(2,V),Ue=this.options,Ke=Ue.radius/Ue.extent,oe=(ee-Ke)/Me,Re=(ee+1+Ke)/Me,ut={features:[]};return this._addTileFeatures(fe.range((q-Ke)/Me,oe,(q+1+Ke)/Me,Re),fe.points,q,ee,Me,ut),q===0&&this._addTileFeatures(fe.range(1-Ke/Me,oe,1,Re),fe.points,Me,ee,Me,ut),q===Me-1&&this._addTileFeatures(fe.range(0,oe,Ke/Me,Re),fe.points,-1,ee,Me,ut),ut.features.length?ut:null},mn.prototype.getClusterExpansionZoom=function(V){for(var q=this._getOriginZoom(V)-1;q<=this.options.maxZoom;){var ee=this.getChildren(V);if(q++,ee.length!==1)break;V=ee[0].properties.cluster_id}return q},mn.prototype._appendLeaves=function(V,q,ee,fe,Me){for(var Ue=0,Ke=this.getChildren(q);Ue<Ke.length;Ue+=1){var oe=Ke[Ue],Re=oe.properties;if(Re&&Re.cluster?Me+Re.point_count<=fe?Me+=Re.point_count:Me=this._appendLeaves(V,Re.cluster_id,ee,fe,Me):Me<fe?Me++:V.push(oe),V.length===ee)break}return Me},mn.prototype._addTileFeatures=function(V,q,ee,fe,Me,Ue){for(var Ke=0,oe=V;Ke<oe.length;Ke+=1){var Re=q[oe[Ke]],ut=Re.numPoints,cr={type:1,geometry:[[Math.round(this.options.extent*(Re.x*Me-ee)),Math.round(this.options.extent*(Re.y*Me-fe))]],tags:ut?vi(Re):this.points[Re.index].properties},Tt=void 0;ut?Tt=Re.id:this.options.generateId?Tt=Re.index:this.points[Re.index].id&&(Tt=this.points[Re.index].id),Tt!==void 0&&(cr.id=Tt),Ue.features.push(cr)}},mn.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},mn.prototype._cluster=function(V,q){for(var ee=[],fe=this.options,Me=fe.reduce,Ue=fe.minPoints,Ke=fe.radius/(fe.extent*Math.pow(2,q)),oe=0;oe<V.length;oe++){var Re=V[oe];if(!(Re.zoom<=q)){Re.zoom=q;for(var ut=this.trees[q+1],cr=ut.within(Re.x,Re.y,Ke),Tt=Re.numPoints||1,Rt=Tt,hr=0,gn=cr;hr<gn.length;hr+=1){var cn=ut.points[gn[hr]];cn.zoom>q&&(Rt+=cn.numPoints||1)}if(Rt>=Ue){for(var Et=Re.x*Tt,Qr=Re.y*Tt,Lr=Me&&Tt>1?this._map(Re,!0):null,Wr=(oe<<5)+(q+1)+this.points.length,hi=0,Jr=cr;hi<Jr.length;hi+=1){var Tn=ut.points[Jr[hi]];if(!(Tn.zoom<=q)){Tn.zoom=q;var Zi=Tn.numPoints||1;Et+=Tn.x*Zi,Qr+=Tn.y*Zi,Tn.parentId=Wr,Me&&(Lr||(Lr=this._map(Re,!0)),Me(Lr,this._map(Tn)))}}Re.parentId=Wr,ee.push(di(Et/Rt,Qr/Rt,Wr,Rt,Lr))}else if(ee.push(Re),Rt>1)for(var si=0,Si=cr;si<Si.length;si+=1){var gi=ut.points[Si[si]];gi.zoom<=q||(gi.zoom=q,ee.push(gi))}}}return ee},mn.prototype._getOriginId=function(V){return V-this.points.length>>5},mn.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},mn.prototype._map=function(V,q){if(V.numPoints)return q?ca({},V.properties):V.properties;var ee=this.points[V.index].properties,fe=this.options.map(ee);return q&&fe===ee?ca({},fe):fe},eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(V,q,ee,fe,Me,Ue,Ke){for(var oe=[V,q,ee,fe],Re=this.options,ut=Re.debug;oe.length;){fe=oe.pop(),ee=oe.pop(),q=oe.pop(),V=oe.pop();var cr=1<<q,Tt=ps(q,ee,fe),Rt=this.tiles[Tt];if(!Rt&&(ut>1&&console.time("creation"),Rt=this.tiles[Tt]=En(V,q,ee,fe,Re),this.tileCoords.push({z:q,x:ee,y:fe}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,ee,fe,Rt.numFeatures,Rt.numPoints,Rt.numSimplified),console.timeEnd("creation"));var hr="z"+q;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(Rt.source=V,Me){if(q===Re.maxZoom||q===Me)continue;var gn=1<<Me-q;if(ee!==Math.floor(Ue/gn)||fe!==Math.floor(Ke/gn))continue}else if(q===Re.indexMaxZoom||Rt.numPoints<=Re.indexMaxPoints)continue;if(Rt.source=null,V.length!==0){ut>1&&console.time("clipping");var cn,Et,Qr,Lr,Wr,hi,Jr=.5*Re.buffer/Re.extent,Tn=.5-Jr,Zi=.5+Jr,si=1+Jr;cn=Et=Qr=Lr=null,Wr=le(V,cr,ee-Jr,ee+Zi,0,Rt.minX,Rt.maxX,Re),hi=le(V,cr,ee+Tn,ee+si,0,Rt.minX,Rt.maxX,Re),V=null,Wr&&(cn=le(Wr,cr,fe-Jr,fe+Zi,1,Rt.minY,Rt.maxY,Re),Et=le(Wr,cr,fe+Tn,fe+si,1,Rt.minY,Rt.maxY,Re),Wr=null),hi&&(Qr=le(hi,cr,fe-Jr,fe+Zi,1,Rt.minY,Rt.maxY,Re),Lr=le(hi,cr,fe+Tn,fe+si,1,Rt.minY,Rt.maxY,Re),hi=null),ut>1&&console.timeEnd("clipping"),oe.push(cn||[],q+1,2*ee,2*fe),oe.push(Et||[],q+1,2*ee,2*fe+1),oe.push(Qr||[],q+1,2*ee+1,2*fe),oe.push(Lr||[],q+1,2*ee+1,2*fe+1)}}},eo.prototype.getTile=function(V,q,ee){var fe=this.options,Me=fe.extent,Ue=fe.debug;if(V<0||V>24)return null;var Ke=1<<V,oe=ps(V,q=(q%Ke+Ke)%Ke,ee);if(this.tiles[oe])return _i(this.tiles[oe],Me);Ue>1&&console.log("drilling down to z%d-%d-%d",V,q,ee);for(var Re,ut=V,cr=q,Tt=ee;!Re&&ut>0;)ut--,cr=Math.floor(cr/2),Tt=Math.floor(Tt/2),Re=this.tiles[ps(ut,cr,Tt)];return Re&&Re.source?(Ue>1&&console.log("found parent tile z%d-%d-%d",ut,cr,Tt),Ue>1&&console.time("drilling down"),this.splitTile(Re.source,ut,cr,Tt,V,q,ee),Ue>1&&console.timeEnd("drilling down"),this.tiles[oe]?_i(this.tiles[oe],Me):null):null};var Da=function(V){function q(ee,fe,Me,Ue){V.call(this,ee,fe,Me,Go),Ue&&(this.loadGeoJSON=Ue)}return V&&(q.__proto__=V),(q.prototype=Object.create(V&&V.prototype)).constructor=q,q.prototype.loadData=function(ee,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=fe,this._pendingLoadDataParams=ee,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},q.prototype._loadData=function(){var ee=this;if(this._pendingCallback&&this._pendingLoadDataParams){var fe=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ue=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new v.RequestPerformance(Me.request);this.loadGeoJSON(Me,function(Ke,oe){if(Ke||!oe)return fe(Ke);if(typeof oe!="object")return fe(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function Rt(hr,gn){var cn,Et=hr&&hr.type;if(Et==="FeatureCollection")for(cn=0;cn<hr.features.length;cn++)Rt(hr.features[cn],gn);else if(Et==="GeometryCollection")for(cn=0;cn<hr.geometries.length;cn++)Rt(hr.geometries[cn],gn);else if(Et==="Feature")Rt(hr.geometry,gn);else if(Et==="Polygon")ur(hr.coordinates,gn);else if(Et==="MultiPolygon")for(cn=0;cn<hr.coordinates.length;cn++)ur(hr.coordinates[cn],gn);return hr})(oe,!0);try{if(Me.filter){var Re=v.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(function(Rt){return Rt.key+": "+Rt.message}).join(", "));var ut=oe.features.filter(function(Rt){return Re.value.evaluate({zoom:0},Rt)});oe={type:"FeatureCollection",features:ut}}ee._geoJSONIndex=Me.cluster?new mn(function(Rt){var hr=Rt.superclusterOptions,gn=Rt.clusterProperties;if(!gn||!hr)return hr;for(var cn={},Et={},Qr={accumulated:null,zoom:0},Lr={properties:null},Wr=Object.keys(gn),hi=0,Jr=Wr;hi<Jr.length;hi+=1){var Tn=Jr[hi],Zi=gn[Tn],si=Zi[0],Si=v.createExpression(Zi[1]),gi=v.createExpression(typeof si=="string"?[si,["accumulated"],["get",Tn]]:si);cn[Tn]=Si.value,Et[Tn]=gi.value}return hr.map=function(vt){Lr.properties=vt;for(var kt={},Ca=0,bi=Wr;Ca<bi.length;Ca+=1){var Ci=bi[Ca];kt[Ci]=cn[Ci].evaluate(Qr,Lr)}return kt},hr.reduce=function(vt,kt){Lr.properties=kt;for(var Ca=0,bi=Wr;Ca<bi.length;Ca+=1){var Ci=bi[Ca];Qr.accumulated=vt[Ci],vt[Ci]=Et[Ci].evaluate(Qr,Lr)}},hr}(Me)).load(oe.features):function(Rt,hr){return new eo(Rt,hr)}(oe,Me.geojsonVtOptions)}catch(Rt){return fe(Rt)}ee.loaded={};var cr={};if(Ue){var Tt=Ue.finish();Tt&&(cr.resourceTiming={},cr.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Tt)))}fe(null,cr)})}},q.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},q.prototype.reloadTile=function(ee,fe){var Me=this.loaded;return Me&&Me[ee.uid]?V.prototype.reloadTile.call(this,ee,fe):this.loadTile(ee,fe)},q.prototype.loadGeoJSON=function(ee,fe){if(ee.request)v.getJSON(ee.request,fe);else{if(typeof ee.data!="string")return fe(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."));try{return fe(null,JSON.parse(ee.data))}catch(Me){return fe(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."))}}},q.prototype.removeSource=function(ee,fe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),fe()},q.prototype.getClusterExpansionZoom=function(ee,fe){try{fe(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(Me){fe(Me)}},q.prototype.getClusterChildren=function(ee,fe){try{fe(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(Me){fe(Me)}},q.prototype.getClusterLeaves=function(ee,fe){try{fe(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(Me){fe(Me)}},q}(ft),_a=function(V){var q=this;this.self=V,this.actor=new v.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ft,geojson:Da},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ee,fe){if(q.workerSourceTypes[ee])throw new Error('Worker source with name "'+ee+'" already registered.');q.workerSourceTypes[ee]=fe},this.self.registerRTLTextPlugin=function(ee){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=ee.applyArabicShaping,v.plugin.processBidirectionalText=ee.processBidirectionalText,v.plugin.processStyledBidirectionalText=ee.processStyledBidirectionalText}};return _a.prototype.setReferrer=function(V,q){this.referrer=q},_a.prototype.setImages=function(V,q,ee){for(var fe in this.availableImages[V]=q,this.workerSources[V]){var Me=this.workerSources[V][fe];for(var Ue in Me)Me[Ue].availableImages=q}ee()},_a.prototype.setLayers=function(V,q,ee){this.getLayerIndex(V).replace(q),ee()},_a.prototype.updateLayers=function(V,q,ee){this.getLayerIndex(V).update(q.layers,q.removedIds),ee()},_a.prototype.loadTile=function(V,q,ee){this.getWorkerSource(V,q.type,q.source).loadTile(q,ee)},_a.prototype.loadDEMTile=function(V,q,ee){this.getDEMWorkerSource(V,q.source).loadTile(q,ee)},_a.prototype.reloadTile=function(V,q,ee){this.getWorkerSource(V,q.type,q.source).reloadTile(q,ee)},_a.prototype.abortTile=function(V,q,ee){this.getWorkerSource(V,q.type,q.source).abortTile(q,ee)},_a.prototype.removeTile=function(V,q,ee){this.getWorkerSource(V,q.type,q.source).removeTile(q,ee)},_a.prototype.removeDEMTile=function(V,q){this.getDEMWorkerSource(V,q.source).removeTile(q)},_a.prototype.removeSource=function(V,q,ee){if(this.workerSources[V]&&this.workerSources[V][q.type]&&this.workerSources[V][q.type][q.source]){var fe=this.workerSources[V][q.type][q.source];delete this.workerSources[V][q.type][q.source],fe.removeSource!==void 0?fe.removeSource(q,ee):ee()}},_a.prototype.loadWorkerSource=function(V,q,ee){try{this.self.importScripts(q.url),ee()}catch(fe){ee(fe.toString())}},_a.prototype.syncRTLPluginState=function(V,q,ee){try{v.plugin.setState(q);var fe=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);var Me=v.plugin.isParsed();ee(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+fe),Me)}}catch(Ue){ee(Ue.toString())}},_a.prototype.getAvailableImages=function(V){var q=this.availableImages[V];return q||(q=[]),q},_a.prototype.getLayerIndex=function(V){var q=this.layerIndexes[V];return q||(q=this.layerIndexes[V]=new ce),q},_a.prototype.getWorkerSource=function(V,q,ee){var fe=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][q]||(this.workerSources[V][q]={}),this.workerSources[V][q][ee]||(this.workerSources[V][q][ee]=new this.workerSourceTypes[q]({send:function(Me,Ue,Ke){fe.actor.send(Me,Ue,Ke,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][q][ee]},_a.prototype.getDEMWorkerSource=function(V,q){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][q]||(this.demWorkerSources[V][q]=new Jt),this.demWorkerSources[V][q]},_a.prototype.enforceCacheSizeLimit=function(V,q){v.enforceCacheSizeLimit(q)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new _a(self)),_a}),ge(["./shared"],function(v){"use strict";var Oe=v.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,k,U=new Blob([""],{type:"text/javascript"}),G=URL.createObjectURL(U);try{k=new Worker(G),P=!0}catch(ae){P=!1}return k&&k.terminate(),URL.revokeObjectURL(G),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var k=P.getContext("2d");if(!k)return!1;var U=k.getImageData(0,0,1,1);return U&&U.width===P.width}()?(d[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var k=function(G){var ae=document.createElement("canvas"),se=Object.create(f.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=G,ae.probablySupportsContext?ae.probablySupportsContext("webgl",se)||ae.probablySupportsContext("experimental-webgl",se):ae.supportsContext?ae.supportsContext("webgl",se)||ae.supportsContext("experimental-webgl",se):ae.getContext("webgl",se)||ae.getContext("experimental-webgl",se)}(P);if(!k)return!1;var U=k.createShader(k.VERTEX_SHADER);return!(!U||k.isContextLost())&&(k.shaderSource(U,"void main() {}"),k.compileShader(U),k.getShaderParameter(U,k.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),H={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},ce=v.window.document&&v.window.document.documentElement.style;function he(l){if(!ce)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ce)return l[f];return l[0]}var Fe,ye=he(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);H.disableDrag=function(){ce&&ye&&(Fe=ce[ye],ce[ye]="none")},H.enableDrag=function(){ce&&ye&&(ce[ye]=Fe)};var Je=he(["transform","WebkitTransform"]);H.setTransform=function(l,f){l.style[Je]=f};var ft=!1;try{var xt=Object.defineProperty({},"passive",{get:function(){ft=!0}});v.window.addEventListener("test",xt,xt),v.window.removeEventListener("test",xt,xt)}catch(l){ft=!1}H.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&ft?d:d.capture)},H.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&ft?d:d.capture)};var Jt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Jt,!0)};function ur(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}H.suppressClick=function(){v.window.addEventListener("click",Jt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Jt,!0)},0)},H.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},H.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],b=0;b<f.length;b++)d.push(new v.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return d},H.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},H.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var It=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,b=this.requestors;d<b.length;d+=1){var w=b[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var b=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var b=0,w=0,P=c;w<P.length;w+=1){var k=P[w];if(k[0]<b||k[1]<k[0]||d<k[1])return!1;b=k[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var b=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(b=!1);this.isLoaded()||b?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var b={},w=0,P=c;w<P.length;w+=1){var k=P[w];this.images[k]||this.fire(new v.Event("styleimagemissing",{id:k}));var U=this.images[k];U?b[k]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:v.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],b=this.getImage(c);if(!b)return null;if(d&&d.position.version===b.version)return d.position;if(d)d.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},P=new v.ImagePosition(w,b);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var b=v.potpack(c),w=b.w,P=b.h,k=this.atlasImage;for(var U in k.resize({width:w||1,height:P||1}),this.patterns){var G=this.patterns[U].bin,ae=G.x+1,se=G.y+1,re=this.images[U].data,be=re.width,Te=re.height;v.RGBAImage.copy(re,k,{x:0,y:0},{x:ae,y:se},{width:be,height:Te}),v.RGBAImage.copy(re,k,{x:0,y:Te-1},{x:ae,y:se-1},{width:be,height:1}),v.RGBAImage.copy(re,k,{x:0,y:0},{x:ae,y:se+Te},{width:be,height:1}),v.RGBAImage.copy(re,k,{x:be-1,y:0},{x:ae-1,y:se},{width:1,height:Te}),v.RGBAImage.copy(re,k,{x:0,y:0},{x:ae+be,y:se},{width:1,height:Te})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,b=c;d<b.length;d+=1){var w=b[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];ur(P)&&this.updateImage(w,P)}}},f}(v.Evented),er=pt,jt=pt,ct=1e20;function pt(l,f,c,d,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ir(l,f,c,d,b,w,P){for(var k=0;k<f;k++){for(var U=0;U<c;U++)d[U]=l[U*f+k];for(Y(d,b,w,P,c),U=0;U<c;U++)l[U*f+k]=b[U]}for(U=0;U<c;U++){for(k=0;k<f;k++)d[k]=l[U*f+k];for(Y(d,b,w,P,f),k=0;k<f;k++)l[U*f+k]=Math.sqrt(b[k])}}function Y(l,f,c,d,b){c[0]=0,d[0]=-ct,d[1]=+ct;for(var w=1,P=0;w<b;w++){for(var k=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);k<=d[P];)P--,k=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=k,d[P+1]=+ct}for(w=0,P=0;w<b;w++){for(;d[P+1]<w;)P++;f[w]=(w-c[P])*(w-c[P])+l[c[P]]}}pt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var b=f.data[4*d+3]/255;this.gridOuter[d]=b===1?0:b===0?ct:Math.pow(Math.max(0,.5-b),2),this.gridInner[d]=b===1?ct:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(ir(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),ir(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},er.default=jt;var Xt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var b in l)for(var w=0,P=l[b];w<P.length;w+=1)d.push({stack:b,id:P[w]});v.asyncAll(d,function(k,U){var G=k.stack,ae=k.id,se=c.entries[G];se||(se=c.entries[G]={glyphs:{},requests:{},ranges:{}});var re=se.glyphs[ae];if(re===void 0){if(re=c._tinySDF(se,G,ae))return se.glyphs[ae]=re,void U(null,{stack:G,id:ae,glyph:re});var be=Math.floor(ae/256);if(256*be>65535)U(new Error("glyphs > 65535 not supported"));else if(se.ranges[be])U(null,{stack:G,id:ae,glyph:re});else{var Te=se.requests[be];Te||(Te=se.requests[be]=[],Xt.loadGlyphRange(G,be,c.url,c.requestManager,function(Ze,xe){if(xe){for(var Ve in xe)c._doesCharSupportLocalGlyph(+Ve)||(se.glyphs[+Ve]=xe[+Ve]);se.ranges[be]=!0}for(var qe=0,dt=Te;qe<dt.length;qe+=1)(0,dt[qe])(Ze,xe);delete se.requests[be]})),Te.push(function(Ze,xe){Ze?U(Ze):xe&&U(null,{stack:G,id:ae,glyph:xe[ae]||null})})}}else U(null,{stack:G,id:ae,glyph:re})},function(k,U){if(k)f(k);else if(U){for(var G={},ae=0,se=U;ae<se.length;ae+=1){var re=se[ae],be=re.stack,Te=re.id,Ze=re.glyph;(G[be]||(G[be]={}))[Te]=Ze&&{id:Ze.id,bitmap:Ze.bitmap.clone(),metrics:Ze.metrics}}f(null,G)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,f,c,d,b){var w=256*f,P=w+255,k=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),v.ResourceType.Glyphs);v.getArrayBuffer(k,function(U,G){if(U)b(U);else if(G){for(var ae={},se=0,re=v.parseGlyphPBF(G);se<re.length;se+=1){var be=re[se];ae[be.id]=be}b(null,ae)}})},Xt.TinySDF=er;var st=function(){this.specification=v.styleSpec.light.position};st.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},st.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var Ye=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new st,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),bt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(Ye),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var b in c){var w=c[b];v.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,b){return(!b||b.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:b,right:w,isDash:P,zeroLength:l[0]===0});for(var k=l[0],U=1;U<l.length;U++){var G=l[U];d.push({left:b=k*c,right:w=(k+=G)*c,isDash:P=!P,zeroLength:G===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),P=0,k=l[P],U=0;U<this.width;U++){U/k.right>1&&(k=l[++P]);var G=Math.abs(U-k.left),ae=Math.abs(U-k.right),se=Math.min(G,ae),re=void 0,be=b/c*(d+1);if(k.isDash){var Te=d-Math.abs(be);re=Math.sqrt(se*se+Te*Te)}else re=d-Math.sqrt(se*se+be*be);this.data[w+U]=Math.max(0,Math.min(255,re+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var P=this.width*this.nextRow,k=0,U=l[k],G=0;G<this.width;G++){G/U.right>1&&(U=l[++k]);var ae=Math.abs(G-U.left),se=Math.abs(G-U.right),re=Math.min(ae,se);this.data[P+G]=Math.max(0,Math.min(255,(U.isDash?re:-re)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var P=this.width/b,k=this.getDashRanges(l,this.width,P);f?this.addRoundDash(k,P,c):this.addRegularDash(k)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=d,this.dirty=!0,U},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Yt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),b=0;b<d.length;b++){var w=new l.Actor(d[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function Er(l,f,c){var d=function(b,w){if(b)return c(b);if(w){var P=v.pick(v.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(k){return k.id})),P.tiles=f.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}Yt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,b){d.send(l,f,b)},c=c||function(){})},Yt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Yt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Yt.Actor=v.Actor;var Hr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Hr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Hr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=d&&l.y<w};var nn=function(l){function f(c,d,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Hr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(k,U){return delete c.request,c.aborted?d(null):k&&k.status!==404?d(k):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),C=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Er(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Hr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(w,v.ResourceType.Tile),function(P,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(k){b.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var U=b.map.painter.context,G=U.gl;c.texture=b.map.painter.getTileTexture(k.width),c.texture?c.texture.update(k,{useMipmap:!0}):(c.texture=new v.Texture(U,k,G.RGBA,{useMipmap:!0}),c.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&G.texParameterf(G.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(b.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Se=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,k){P&&(c.state="errored",d(P)),k&&(c.dem=k,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(b,v.ResourceType.Tile),function(P,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(k){this.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var U=v.window.ImageBitmap&&k instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?k:v.browser.getImageData(k,1),G={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",G,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,b=Math.pow(2,d.z),w=(d.x-1+b)%b,P=d.x===0?c.wrap-1:c.wrap,k=(d.x+1+b)%b,U=d.x+1===b?c.wrap+1:c.wrap,G={};return G[new v.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},G[new v.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y).key]={backfilled:!1},d.y>0&&(G[new v.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},G[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},G[new v.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y-1).key]={backfilled:!1}),d.y+1<b&&(G[new v.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},G[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},G[new v.OverscaledTileID(c.overscaledZ,U,d.z,k,d.y+1).key]={backfilled:!1}),G},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(C),ke=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)d.fire(new v.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:b},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var b=v.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(v.browser.resolveURL(w),v.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(P,k){d._removed||k&&k.abandoned||(d._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[d.id]&&(d._resourceTiming=k.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:b.source},null),c(P))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,k){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(k,b.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),_t=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ht=function(l){function f(c,d,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var b=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(w,P){b._loaded=!0,w?b.fire(new v.ErrorEvent(w)):P&&(b.image=P,c&&(b.coordinates=c),d&&d(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var b=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var k=1/0,U=1/0,G=-1/0,ae=-1/0,se=0,re=P;se<re.length;se+=1){var be=re[se];k=Math.min(k,be.x),U=Math.min(U,be.y),G=Math.max(G,be.x),ae=Math.max(ae,be.y)}var Te=Math.max(G-k,ae-U),Ze=Math.max(0,Math.floor(-Math.log(Te)/Math.LN2)),xe=Math.pow(2,Ze);return new v.CanonicalTileID(Ze,Math.floor((k+G)/2*xe),Math.floor((U+ae)/2*xe))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Lt=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var b=0,w=d.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],v.ResourceType.Source).url);v.getVideo(this.urls,function(P,k){c._loaded=!0,P?c.fire(new v.ErrorEvent(P)):k&&(c.video=k,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ht),Ht=function(l){function f(c,d,b,w){l.call(this,c,d,b,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(k){return typeof k!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,b=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var b=d[c];if(isNaN(b)||b<=0)return!0}return!1},f}(ht),xr={vector:nn,raster:C,"raster-dem":Se,geojson:ke,video:Lt,image:ht,canvas:Ht};function Kn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function mn(l,f,c,d,b,w){var P=function(Ze,xe,Ve){if(Ze)for(var qe=0,dt=Ze;qe<dt.length;qe+=1){var Gt=xe[dt[qe]];if(Gt&&Gt.source===Ve&&Gt.type==="fill-extrusion")return!0}else for(var Dt in xe){var zt=xe[Dt];if(zt.source===Ve&&zt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),k=w.maxPitchScaleFactor(),U=l.tilesIn(d,k,P);U.sort(di);for(var G=[],ae=0,se=U;ae<se.length;ae+=1){var re=se[ae];G.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(f,c,l._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,b,w,k,Kn(l.transform,re.tileID))})}var be=function(Ze){for(var xe={},Ve={},qe=0,dt=Ze;qe<dt.length;qe+=1){var Gt=dt[qe],Dt=Gt.queryResults,zt=Gt.wrappedTileID,pr=Ve[zt]=Ve[zt]||{};for(var kr in Dt)for(var Ir=Dt[kr],Kr=pr[kr]=pr[kr]||{},Dn=xe[kr]=xe[kr]||[],kn=0,zn=Ir;kn<zn.length;kn+=1){var Pi=zn[kn];Kr[Pi.featureIndex]||(Kr[Pi.featureIndex]=!0,Dn.push(Pi))}}return xe}(G);for(var Te in be)be[Te].forEach(function(Ze){var xe=Ze.feature,Ve=l.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=Ve});return be}function di(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Gn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Gn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Gn.prototype.add=function(l,f,c){var d=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Gn.prototype.has=function(l){return l.wrapped().key in this.data},Gn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Gn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Gn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Gn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Gn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][d];return this.data[c].splice(d,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Gn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Gn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,b=this.data[c];d<b.length;d+=1){var w=b[d];l(w.value)||f.push(w)}for(var P=0,k=f;P<k.length;P+=1){var U=k[P];this.remove(U.value.tileID,U)}};var ni=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ni.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ni.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ni.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var vi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Hn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Hn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Hn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Hn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Hn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var b=this.attributes[d],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[vi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};mi.prototype.get=function(){return this.current},mi.prototype.set=function(l){},mi.prototype.getDefault=function(){return this.default},mi.prototype.setDefault=function(){this.set(this.default)};var ca=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(mi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(mi),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),fa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(mi),ko=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(mi),Oa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(mi),ya=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(mi),Fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(mi),ra=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(mi),Es=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(mi),le=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(mi),ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(mi),yo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(mi),Qs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(mi),Bt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(mi),$t=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(mi),Pr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(mi),ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(mi),An=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(mi),Nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(mi),_i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(mi),En=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(mi),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(mi),Ti=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(mi),eo=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(mi),ps=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(mi),Go=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),Da=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(mi),_a=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(mi),V=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(_a),q=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(_a),ee=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,b),d&&(this.depthAttachment=new q(l,b))};ee.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var fe=function(l,f,c){this.func=l,this.mask=f,this.range=c};fe.ReadOnly=!1,fe.ReadWrite=!0,fe.disabled=new fe(519,fe.ReadOnly,[0,1]);var Me=function(l,f,c,d,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=b,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var Ue=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ue.disabled=new Ue(Ue.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ue.unblended=new Ue(Ue.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ue.alphaBlended=new Ue([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Ke=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};Ke.disabled=new Ke(!1,1029,2305),Ke.backCCW=new Ke(!0,1029,2305);var oe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ca(this),this.clearDepth=new Gi(this),this.clearStencil=new Li(this),this.colorMask=new $i(this),this.depthMask=new fa(this),this.stencilMask=new ko(this),this.stencilFunc=new Oa(this),this.stencilOp=new ya(this),this.stencilTest=new Fi(this),this.depthRange=new ra(this),this.depthTest=new Qi(this),this.depthFunc=new Es(this),this.blend=new le(this),this.blendFunc=new ii(this),this.blendColor=new yo(this),this.blendEquation=new Qs(this),this.cullFace=new Bt(this),this.cullFaceSide=new $t(this),this.frontFace=new Pr(this),this.program=new ln(this),this.activeTexture=new An(this),this.viewport=new Nn(this),this.bindFramebuffer=new _i(this),this.bindRenderbuffer=new fi(this),this.bindTexture=new En(this),this.bindVertexBuffer=new Mi(this),this.bindElementBuffer=new Ti(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new eo(this),this.pixelStoreUnpack=new ps(this),this.pixelStoreUnpackPremultiplyAlpha=new Go(this),this.pixelStoreUnpackFlipY=new Da(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};oe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},oe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},oe.prototype.createIndexBuffer=function(l,f){return new ni(this,l,f)},oe.prototype.createVertexBuffer=function(l,f,c){return new Hn(this,l,f,c)},oe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,b=d.createRenderbuffer();return this.bindRenderbuffer.set(b),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},oe.prototype.createFramebuffer=function(l,f,c){return new ee(this,l,f,c)},oe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,b=0;f&&(b|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(b)},oe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},oe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},oe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},oe.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ue.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},oe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Re=function(l){function f(c,d,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,k,U,G){var ae=new xr[k.type](P,k,U,G);if(ae.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ae.id);return v.bindAll(["load","abort","unload","serialize","prepare"],ae),ae}(c,d,b,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[d];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(ut).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(P,k){var U=P.tileID,G=k.tileID,ae=new v.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),se=new v.Point(G.canonical.x,G.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-G.overscaledZ||se.y-ae.y||se.x-ae.x}).map(function(P){return P.tileID.key}):b.map(function(P){return P.tileID}).sort(ut).map(function(P){return P.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=d),this._loadTile(b,this._tileLoaded.bind(this,b,c,d)))},f.prototype._tileLoaded=function(c,d,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new v.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),b=0;b<d.length;b++){var w=d[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);k(c,P),k(P,c)}}function k(U,G){U.needsHillshadePrepare=!0;var ae=G.tileID.canonical.x-U.tileID.canonical.x,se=G.tileID.canonical.y-U.tileID.canonical.y,re=Math.pow(2,U.tileID.canonical.z),be=G.tileID.key;ae===0&&se===0||Math.abs(se)>1||(Math.abs(ae)>1&&(Math.abs(ae+re)===1?ae+=re:Math.abs(ae-re)===1&&(ae-=re)),G.dem&&U.dem&&(U.dem.backfillBorder(G.dem,ae,se),U.neighboringTiles&&U.neighboringTiles[be]&&(U.neighboringTiles[be].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,b,w){for(var P in this._tiles){var k=this._tiles[P];if(!(w[P]||!k.hasData()||k.tileID.overscaledZ<=d||k.tileID.overscaledZ>b)){for(var U=k.tileID;k&&k.tileID.overscaledZ>d+1;){var G=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[G.key])&&k.hasData()&&(U=G)}for(var ae=U;ae.overscaledZ>d;)if(c[(ae=ae.scaledTo(ae.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=d?b:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),k=this._getLoadedTile(P);if(k)return k}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*b*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var b={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),b[P.tileID.key]=P}for(var k in this._tiles=b,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pr){return new v.OverscaledTileID(pr.canonical.z,pr.wrap,pr.canonical.z,pr.canonical.x,pr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(pr){return d._source.hasTile(pr)}))):b=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-f.maxOverzooming,this._source.minzoom),k=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(b,w);if(cr(this._source.type)){for(var G={},ae={},se=0,re=Object.keys(U);se<re.length;se+=1){var be=re[se],Te=U[be],Ze=this._tiles[be];if(Ze&&!(Ze.fadeEndTime&&Ze.fadeEndTime<=v.browser.now())){var xe=this.findLoadedParent(Te,P);xe&&(this._addTile(xe.tileID),G[xe.tileID.key]=xe.tileID),ae[be]=Te}}for(var Ve in this._retainLoadedChildren(ae,w,k,U),G)U[Ve]||(this._coveredTiles[Ve]=!0,U[Ve]=G[Ve])}for(var qe in U)this._tiles[qe].clearFadeHold();for(var dt=0,Gt=v.keysDifference(this._tiles,U);dt<Gt.length;dt+=1){var Dt=Gt[dt],zt=this._tiles[Dt];zt.hasSymbolBuckets&&!zt.holdingForFade()?zt.setHoldDuration(this.map._fadeDuration):zt.hasSymbolBuckets&&!zt.symbolFadeFinished()||this._removeTile(Dt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var b={},w={},P=Math.max(d-f.maxOverzooming,this._source.minzoom),k=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},G=0,ae=c;G<ae.length;G+=1){var se=ae[G],re=this._addTile(se);b[se.key]=se,re.hasData()||d<this._source.maxzoom&&(U[se.key]=se)}this._retainLoadedChildren(U,d,k,b);for(var be=0,Te=c;be<Te.length;be+=1){var Ze=Te[be],xe=this._tiles[Ze.key];if(!xe.hasData()){if(d+1>this._source.maxzoom){var Ve=Ze.children(this._source.maxzoom)[0],qe=this.getTile(Ve);if(qe&&qe.hasData()){b[Ve.key]=Ve;continue}}else{var dt=Ze.children(this._source.maxzoom);if(b[dt[0].key]&&b[dt[1].key]&&b[dt[2].key]&&b[dt[3].key])continue}for(var Gt=xe.wasRequested(),Dt=Ze.overscaledZ-1;Dt>=P;--Dt){var zt=Ze.scaledTo(Dt);if(w[zt.key]||(w[zt.key]=!0,!(xe=this.getTile(zt))&&Gt&&(xe=this._addTile(zt)),xe&&(b[zt.key]=zt,Gt=xe.wasRequested(),xe.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(P))break;w=P}for(var k=0,U=d;k<U.length;k+=1)this._loadedParentTiles[U[k]]=b}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var b=Boolean(d);return b||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,b||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,b){var w=this,P=[],k=this.transform;if(!k)return P;for(var U=b?k.getCameraQueryGeometry(c):c,G=c.map(function(Dt){return k.pointCoordinate(Dt)}),ae=U.map(function(Dt){return k.pointCoordinate(Dt)}),se=this.getIds(),re=1/0,be=1/0,Te=-1/0,Ze=-1/0,xe=0,Ve=ae;xe<Ve.length;xe+=1){var qe=Ve[xe];re=Math.min(re,qe.x),be=Math.min(be,qe.y),Te=Math.max(Te,qe.x),Ze=Math.max(Ze,qe.y)}for(var dt=function(Dt){var zt=w._tiles[se[Dt]];if(!zt.holdingForFade()){var pr=zt.tileID,kr=Math.pow(2,k.zoom-zt.tileID.overscaledZ),Ir=d*zt.queryPadding*v.EXTENT/zt.tileSize/kr,Kr=[pr.getTilePoint(new v.MercatorCoordinate(re,be)),pr.getTilePoint(new v.MercatorCoordinate(Te,Ze))];if(Kr[0].x-Ir<v.EXTENT&&Kr[0].y-Ir<v.EXTENT&&Kr[1].x+Ir>=0&&Kr[1].y+Ir>=0){var Dn=G.map(function(zn){return pr.getTilePoint(zn)}),kn=ae.map(function(zn){return pr.getTilePoint(zn)});P.push({tile:zt,tileID:pr,queryGeometry:Dn,cameraQueryGeometry:kn,scale:kr})}}},Gt=0;Gt<se.length;Gt++)dt(Gt);return P},f.prototype.getVisibleCoordinates=function(c){for(var d=this,b=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),w=0,P=b;w<P.length;w+=1){var k=P[w];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(cr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,b){this._state.updateState(c=c||"_geojsonTileLayer",d,b)},f.prototype.removeFeatureState=function(c,d,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,b)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,b){var w=this._tiles[c];w&&w.setDependencies(d,b)},f.prototype.reloadTilesForDependencies=function(c,d){for(var b in this._tiles)this._tiles[b].hasDependency(c,d)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(v.Evented);function ut(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function cr(l){return l==="raster"||l==="image"||l==="video"}function Tt(){return new v.window.Worker(lc.workerUrl)}Re.maxOverzooming=10,Re.maxUnderzooming=3;var Rt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new Tt);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[Rt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var gn,cn=Math.floor(v.browser.hardwareConcurrency/2);function Et(){return gn||(gn=new hr),gn}function Qr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Lr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Qr(l[d],f[l[d].ref]));return l}hr.workerCount=Math.max(Math.min(cn,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function hi(l,f,c){c.push({command:Wr.addSource,args:[l,f[l]]})}function Jr(l,f,c){f.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function Tn(l,f,c,d){Jr(l,c,d),hi(l,f,c)}function Zi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function si(l,f,c,d,b,w){var P;for(P in f=f||{},l=l||{})l.hasOwnProperty(P)&&(v.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],b]}));for(P in f)f.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(v.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],b]}))}function Si(l){return l.id}function gi(l,f){return l[f.id]=f,l}var vt=function(l,f){this.reset(l,f)};vt.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},vt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],P=c-w,k=P>0?(d-w)/P:0;return this.points[b].mult(1-k).add(this.points[f].mult(k))};var kt=function(l,f,c){var d=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ca(l,f,c,d,b){var w=v.create();return f?(v.scale(w,w,[1/b,1/b,1]),c||v.rotateZ(w,w,d.angle)):v.multiply(w,d.labelPlaneMatrix,l),w}function bi(l,f,c,d,b){if(f){var w=v.clone(l);return v.scale(w,w,[b,b,1]),c||v.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ci(l,f){var c=[l.x,l.y,0,1];wa(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Di(l,f){return .5+l/f*.5}function Fr(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function xn(l,f,c,d,b,w,P,k){var U=d?l.textSizeData:l.iconSizeData,G=v.evaluateSizeForZoom(U,c.transform.zoom),ae=[256/c.width*2+1,256/c.height*2+1],se=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;se.clear();for(var re=l.lineVertexArray,be=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Te=c.transform.width/c.transform.height,Ze=!1,xe=0;xe<be.length;xe++){var Ve=be.get(xe);if(Ve.hidden||Ve.writingMode===v.WritingMode.vertical&&!Ze)Fa(Ve.numGlyphs,se);else{Ze=!1;var qe=[Ve.anchorX,Ve.anchorY,0,1];if(v.transformMat4(qe,qe,f),Fr(qe,ae)){var dt=Di(c.transform.cameraToCenterDistance,qe[3]),Gt=v.evaluateSizeForFeature(U,G,Ve),Dt=P?Gt/dt:Gt*dt,zt=new v.Point(Ve.anchorX,Ve.anchorY),pr=Ci(zt,b).point,kr={},Ir=de(Ve,Dt,!1,k,f,b,w,l.glyphOffsetArray,re,se,pr,zt,kr,Te);Ze=Ir.useVertical,(Ir.notEnoughRoom||Ze||Ir.needsFlipping&&de(Ve,Dt,!0,k,f,b,w,l.glyphOffsetArray,re,se,pr,zt,kr,Te).notEnoughRoom)&&Fa(Ve.numGlyphs,se)}else Fa(Ve.numGlyphs,se)}}d?l.text.dynamicLayoutVertexBuffer.updateData(se):l.icon.dynamicLayoutVertexBuffer.updateData(se)}function Ct(l,f,c,d,b,w,P,k,U,G,ae){var se=k.glyphStartIndex+k.numGlyphs,re=k.lineStartIndex,be=k.lineStartIndex+k.lineLength,Te=f.getoffsetX(k.glyphStartIndex),Ze=f.getoffsetX(se-1),xe=Wi(l*Te,c,d,b,w,P,k.segment,re,be,U,G,ae);if(!xe)return null;var Ve=Wi(l*Ze,c,d,b,w,P,k.segment,re,be,U,G,ae);return Ve?{first:xe,last:Ve}:null}function Ji(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function de(l,f,c,d,b,w,P,k,U,G,ae,se,re,be){var Te,Ze=f/24,xe=l.lineOffsetX*Ze,Ve=l.lineOffsetY*Ze;if(l.numGlyphs>1){var qe=l.glyphStartIndex+l.numGlyphs,dt=l.lineStartIndex,Gt=l.lineStartIndex+l.lineLength,Dt=Ct(Ze,k,xe,Ve,c,ae,se,l,U,w,re);if(!Dt)return{notEnoughRoom:!0};var zt=Ci(Dt.first.point,P).point,pr=Ci(Dt.last.point,P).point;if(d&&!c){var kr=Ji(l.writingMode,zt,pr,be);if(kr)return kr}Te=[Dt.first];for(var Ir=l.glyphStartIndex+1;Ir<qe-1;Ir++)Te.push(Wi(Ze*k.getoffsetX(Ir),xe,Ve,c,ae,se,l.segment,dt,Gt,U,w,re));Te.push(Dt.last)}else{if(d&&!c){var Kr=Ci(se,b).point,Dn=l.lineStartIndex+l.segment+1,kn=new v.Point(U.getx(Dn),U.gety(Dn)),zn=Ci(kn,b),Pi=zn.signedDistanceFromCamera>0?zn.point:Ko(se,kn,Kr,1,b),en=Ji(l.writingMode,Kr,Pi,be);if(en)return en}var $n=Wi(Ze*k.getoffsetX(l.glyphStartIndex),xe,Ve,c,ae,se,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,re);if(!$n)return{notEnoughRoom:!0};Te=[$n]}for(var ai=0,Qn=Te;ai<Qn.length;ai+=1){var Vn=Qn[ai];v.addDynamicAttributes(G,Vn.point,Vn.angle)}return{}}function Ko(l,f,c,d,b){var w=Ci(l.add(l.sub(f)._unit()),b).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function Wi(l,f,c,d,b,w,P,k,U,G,ae,se){var re=d?l-f:l+f,be=re>0?1:-1,Te=0;d&&(be*=-1,Te=Math.PI),be<0&&(Te+=Math.PI);for(var Ze=be>0?k+P:k+P+1,xe=b,Ve=b,qe=0,dt=0,Gt=Math.abs(re),Dt=[];qe+dt<=Gt;){if((Ze+=be)<k||Ze>=U)return null;if(Ve=xe,Dt.push(xe),(xe=se[Ze])===void 0){var zt=new v.Point(G.getx(Ze),G.gety(Ze)),pr=Ci(zt,ae);if(pr.signedDistanceFromCamera>0)xe=se[Ze]=pr.point;else{var kr=Ze-be;xe=Ko(qe===0?w:new v.Point(G.getx(kr),G.gety(kr)),zt,Ve,Gt-qe+1,ae)}}qe+=dt,dt=Ve.dist(xe)}var Ir=(Gt-qe)/dt,Kr=xe.sub(Ve),Dn=Kr.mult(Ir)._add(Ve);Dn._add(Kr._unit()._perp()._mult(c*be));var kn=Te+Math.atan2(xe.y-Ve.y,xe.x-Ve.x);return Dt.push(Dn),{point:Dn,angle:kn,path:Dt}}kt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},kt.prototype.insert=function(l,f,c,d,b){this._forEachCell(f,c,d,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(b)},kt.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},kt.prototype._insertBoxCell=function(l,f,c,d,b,w){this.boxCells[b].push(w)},kt.prototype._insertCircleCell=function(l,f,c,d,b,w){this.circleCells[b].push(w)},kt.prototype._query=function(l,f,c,d,b,w){if(c<0||l>this.width||d<0||f>this.height)return!b&&[];var P=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(b)return!0;for(var k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var U=0;U<this.circleKeys.length;U++){var G=this.circles[3*U],ae=this.circles[3*U+1],se=this.circles[3*U+2];P.push({key:this.circleKeys[U],x1:G-se,y1:ae-se,x2:G+se,y2:ae+se})}return w?P.filter(w):P}return this._forEachCell(l,f,c,d,this._queryCell,P,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?P.length>0:P},kt.prototype._queryCircle=function(l,f,c,d,b){var w=l-c,P=l+c,k=f-c,U=f+c;if(P<0||w>this.width||U<0||k>this.height)return!d&&[];var G=[];return this._forEachCell(w,k,P,U,this._queryCellCircle,G,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),d?G.length>0:G},kt.prototype.query=function(l,f,c,d,b){return this._query(l,f,c,d,!1,b)},kt.prototype.hitTest=function(l,f,c,d,b){return this._query(l,f,c,d,!0,b)},kt.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},kt.prototype._queryCell=function(l,f,c,d,b,w,P,k){var U=P.seenUids,G=this.boxCells[b];if(G!==null)for(var ae=this.bboxes,se=0,re=G;se<re.length;se+=1){var be=re[se];if(!U.box[be]){U.box[be]=!0;var Te=4*be;if(l<=ae[Te+2]&&f<=ae[Te+3]&&c>=ae[Te+0]&&d>=ae[Te+1]&&(!k||k(this.boxKeys[be]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[be],x1:ae[Te],y1:ae[Te+1],x2:ae[Te+2],y2:ae[Te+3]})}}}var Ze=this.circleCells[b];if(Ze!==null)for(var xe=this.circles,Ve=0,qe=Ze;Ve<qe.length;Ve+=1){var dt=qe[Ve];if(!U.circle[dt]){U.circle[dt]=!0;var Gt=3*dt;if(this._circleAndRectCollide(xe[Gt],xe[Gt+1],xe[Gt+2],l,f,c,d)&&(!k||k(this.circleKeys[dt]))){if(P.hitTest)return w.push(!0),!0;var Dt=xe[Gt],zt=xe[Gt+1],pr=xe[Gt+2];w.push({key:this.circleKeys[dt],x1:Dt-pr,y1:zt-pr,x2:Dt+pr,y2:zt+pr})}}}},kt.prototype._queryCellCircle=function(l,f,c,d,b,w,P,k){var U=P.circle,G=P.seenUids,ae=this.boxCells[b];if(ae!==null)for(var se=this.bboxes,re=0,be=ae;re<be.length;re+=1){var Te=be[re];if(!G.box[Te]){G.box[Te]=!0;var Ze=4*Te;if(this._circleAndRectCollide(U.x,U.y,U.radius,se[Ze+0],se[Ze+1],se[Ze+2],se[Ze+3])&&(!k||k(this.boxKeys[Te])))return w.push(!0),!0}}var xe=this.circleCells[b];if(xe!==null)for(var Ve=this.circles,qe=0,dt=xe;qe<dt.length;qe+=1){var Gt=dt[qe];if(!G.circle[Gt]){G.circle[Gt]=!0;var Dt=3*Gt;if(this._circlesCollide(Ve[Dt],Ve[Dt+1],Ve[Dt+2],U.x,U.y,U.radius)&&(!k||k(this.circleKeys[Gt])))return w.push(!0),!0}}},kt.prototype._forEachCell=function(l,f,c,d,b,w,P,k){for(var U=this._convertToXCellCoord(l),G=this._convertToYCellCoord(f),ae=this._convertToXCellCoord(c),se=this._convertToYCellCoord(d),re=U;re<=ae;re++)for(var be=G;be<=se;be++)if(b.call(this,l,f,c,d,this.xCellCount*be+re,w,P,k))return},kt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},kt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},kt.prototype._circlesCollide=function(l,f,c,d,b,w){var P=d-l,k=b-f,U=c+w;return U*U>P*P+k*k},kt.prototype._circleAndRectCollide=function(l,f,c,d,b,w,P){var k=(w-d)/2,U=Math.abs(l-(d+k));if(U>k+c)return!1;var G=(P-b)/2,ae=Math.abs(f-(b+G));if(ae>G+c)return!1;if(U<=k||ae<=G)return!0;var se=U-k,re=ae-G;return se*se+re*re<=c*c};var hu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fa(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(hu,3*d)}}function wa(l,f,c){var d=f[0],b=f[1];return l[0]=c[0]*d+c[4]*b+c[12],l[1]=c[1]*d+c[5]*b+c[13],l[3]=c[3]*d+c[7]*b+c[15],l}var Ga=function(l,f,c){f===void 0&&(f=new kt(l.width+200,l.height+200,25)),c===void 0&&(c=new kt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ea(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ga.prototype.placeCollisionBox=function(l,f,c,d,b){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,k=l.x1*P+w.point.x,U=l.y1*P+w.point.y,G=l.x2*P+w.point.x,ae=l.y2*P+w.point.y;return!this.isInsideGrid(k,U,G,ae)||!f&&this.grid.hitTest(k,U,G,ae,b)?{box:[],offscreen:!1}:{box:[k,U,G,ae],offscreen:this.isOffscreen(k,U,G,ae)}},Ga.prototype.placeCollisionCircles=function(l,f,c,d,b,w,P,k,U,G,ae,se,re){var be=[],Te=new v.Point(f.anchorX,f.anchorY),Ze=Ci(Te,w),xe=Di(this.transform.cameraToCenterDistance,Ze.signedDistanceFromCamera),Ve=(G?b/xe:b*xe)/v.ONE_EM,qe=Ci(Te,P).point,dt=Ct(Ve,d,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,qe,Te,f,c,P,{}),Gt=!1,Dt=!1,zt=!0;if(dt){for(var pr=.5*se*xe+re,kr=new v.Point(-100,-100),Ir=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),Kr=new vt,Dn=dt.first,kn=dt.last,zn=[],Pi=Dn.path.length-1;Pi>=1;Pi--)zn.push(Dn.path[Pi]);for(var en=1;en<kn.path.length;en++)zn.push(kn.path[en]);var $n=2.5*pr;if(k){var ai=zn.map(function(Hs){return Ci(Hs,k)});zn=ai.some(function(Hs){return Hs.signedDistanceFromCamera<=0})?[]:ai.map(function(Hs){return Hs.point})}var Qn=[];if(zn.length>0){for(var Vn=zn[0].clone(),ui=zn[0].clone(),Wn=1;Wn<zn.length;Wn++)Vn.x=Math.min(Vn.x,zn[Wn].x),Vn.y=Math.min(Vn.y,zn[Wn].y),ui.x=Math.max(ui.x,zn[Wn].x),ui.y=Math.max(ui.y,zn[Wn].y);Qn=Vn.x>=kr.x&&ui.x<=Ir.x&&Vn.y>=kr.y&&ui.y<=Ir.y?[zn]:ui.x<kr.x||Vn.x>Ir.x||ui.y<kr.y||Vn.y>Ir.y?[]:v.clipLine([zn],kr.x,kr.y,Ir.x,Ir.y)}for(var jn=0,Sa=Qn;jn<Sa.length;jn+=1){var Ua;Kr.reset(Sa[jn],.25*pr),Ua=Kr.length<=.5*pr?1:Math.ceil(Kr.paddedLength/$n)+1;for(var Bo=0;Bo<Ua;Bo++){var No=Bo/Math.max(Ua-1,1),Xa=Kr.lerp(No),fo=Xa.x+100,Ts=Xa.y+100;be.push(fo,Ts,pr,0);var ss=fo-pr,ou=Ts-pr,Za=fo+pr,su=Ts+pr;if(zt=zt&&this.isOffscreen(ss,ou,Za,su),Dt=Dt||this.isInsideGrid(ss,ou,Za,su),!l&&this.grid.hitTestCircle(fo,Ts,pr,ae)&&(Gt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Gt}}}}return{circles:!U&&Gt||!Dt?[]:be,offscreen:zt,collisionDetected:Gt}},Ga.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,b=-1/0,w=-1/0,P=0,k=l;P<k.length;P+=1){var U=k[P],G=new v.Point(U.x+100,U.y+100);c=Math.min(c,G.x),d=Math.min(d,G.y),b=Math.max(b,G.x),w=Math.max(w,G.y),f.push(G)}for(var ae={},se={},re=0,be=this.grid.query(c,d,b,w).concat(this.ignoredGrid.query(c,d,b,w));re<be.length;re+=1){var Te=be[re],Ze=Te.key;if(ae[Ze.bucketInstanceId]===void 0&&(ae[Ze.bucketInstanceId]={}),!ae[Ze.bucketInstanceId][Ze.featureIndex]){var xe=[new v.Point(Te.x1,Te.y1),new v.Point(Te.x2,Te.y1),new v.Point(Te.x2,Te.y2),new v.Point(Te.x1,Te.y2)];v.polygonIntersectsPolygon(f,xe)&&(ae[Ze.bucketInstanceId][Ze.featureIndex]=!0,se[Ze.bucketInstanceId]===void 0&&(se[Ze.bucketInstanceId]=[]),se[Ze.bucketInstanceId].push(Ze.featureIndex))}}return se},Ga.prototype.insertCollisionBox=function(l,f,c,d,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:b},l[0],l[1],l[2],l[3])},Ga.prototype.insertCollisionCircles=function(l,f,c,d,b){for(var w=f?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:b},k=0;k<l.length;k+=4)w.insertCircle(P,l[k],l[k+1],l[k+2])},Ga.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return wa(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ga.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Ga.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Ga.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Mo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Mo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ho=function(l,f,c,d,b){this.text=new Mo(l?l.text:null,f,c,b),this.icon=new Mo(l?l.icon:null,f,d,b)};Ho.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},ho=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Lo=function(l,f,c,d,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=b},ta=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Ha(l,f,c,d,b){var w=v.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*f,k=-(w.verticalAlign-.5)*c,U=v.evaluateVariableOffset(l,d);return new v.Point(P+U[0]*b,k+U[1]*b)}function Do(l,f,c,d,b,w){var P=l.x1,k=l.x2,U=l.y1,G=l.y2,ae=l.anchorPointX,se=l.anchorPointY,re=new v.Point(f,c);return d&&re._rotate(b?w:-w),{x1:P+re.x,y1:U+re.y,x2:k+re.x,y2:G+re.y,anchorPointX:ae,anchorPointY:se}}ta.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Wa=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Ga(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ta(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Ss(l,f,c,d,b){l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0)}Wa.prototype.getBucketParts=function(l,f,c,d){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var P=c.collisionBoxArray,k=b.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),G=c.tileSize/v.EXTENT,ae=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),se=k.get("text-pitch-alignment")==="map",re=k.get("text-rotation-alignment")==="map",be=ea(c,1,this.transform.zoom),Te=Ca(ae,se,re,this.transform,be),Ze=null;if(se){var xe=bi(ae,se,re,this.transform,be);Ze=v.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[b.bucketInstanceId]=new Lo(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var Ve={bucket:b,layout:k,posMatrix:ae,textLabelPlaneMatrix:Te,labelToScreenMatrix:Ze,scale:U,textPixelRatio:G,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(d)for(var qe=0,dt=b.sortKeyRanges;qe<dt.length;qe+=1){var Gt=dt[qe];l.push({sortKey:Gt.sortKey,symbolInstanceStart:Gt.symbolInstanceStart,symbolInstanceEnd:Gt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ve})}},Wa.prototype.attemptAnchorPlacement=function(l,f,c,d,b,w,P,k,U,G,ae,se,re,be,Te){var Ze,xe=[se.textOffset0,se.textOffset1],Ve=Ha(l,c,d,xe,b),qe=this.collisionIndex.placeCollisionBox(Do(f,Ve.x,Ve.y,w,P,this.transform.angle),ae,k,U,G.predicate);if(!Te||this.collisionIndex.placeCollisionBox(Do(Te,Ve.x,Ve.y,w,P,this.transform.angle),ae,k,U,G.predicate).box.length!==0)return qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:xe,width:c,height:d,anchor:l,textBoxScale:b,prevAnchor:Ze},this.markUsedJustification(re,l,se,be),re.allowVerticalPlacement&&(this.markUsedOrientation(re,be,se),this.placedOrientations[se.crossTileID]=be),{shift:Ve,placedGlyphBoxes:qe}):void 0},Wa.prototype.placeLayerBucketPart=function(l,f,c){var d=this,b=l.parameters,w=b.bucket,P=b.layout,k=b.posMatrix,U=b.textLabelPlaneMatrix,G=b.labelToScreenMatrix,ae=b.textPixelRatio,se=b.holdingForFade,re=b.collisionBoxArray,be=b.partiallyEvaluatedTextSize,Te=b.collisionGroup,Ze=P.get("text-optional"),xe=P.get("icon-optional"),Ve=P.get("text-allow-overlap"),qe=P.get("icon-allow-overlap"),dt=P.get("text-rotation-alignment")==="map",Gt=P.get("text-pitch-alignment")==="map",Dt=P.get("icon-text-fit")!=="none",zt=P.get("symbol-z-order")==="viewport-y",pr=Ve&&(qe||!w.hasIconData()||xe),kr=qe&&(Ve||!w.hasTextData()||Ze);!w.collisionArrays&&re&&w.deserializeCollisionBoxes(re);var Ir=function(en,$n){if(!f[en.crossTileID])if(se)d.placements[en.crossTileID]=new bu(!1,!1,!1);else{var ai,Qn=!1,Vn=!1,ui=!0,Wn=null,jn={box:null,offscreen:null},Sa={box:null,offscreen:null},Ua=null,Bo=null,No=0,Xa=0,fo=0;$n.textFeatureIndex?No=$n.textFeatureIndex:en.useRuntimeCollisionCircles&&(No=en.featureIndex),$n.verticalTextFeatureIndex&&(Xa=$n.verticalTextFeatureIndex);var Ts=$n.textBox;if(Ts){var ss=function(Yi){var Rs=v.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Yi&&d.prevPlacement){var us=d.prevPlacement.placedOrientations[en.crossTileID];us&&(d.placedOrientations[en.crossTileID]=us,d.markUsedOrientation(w,Rs=us,en))}return Rs},ou=function(Yi,Rs){if(w.allowVerticalPlacement&&en.numVerticalGlyphVertices>0&&$n.verticalTextBox)for(var us=0,qu=w.writingModes;us<qu.length&&(qu[us]===v.WritingMode.vertical?(jn=Rs(),Sa=jn):jn=Yi(),!(jn&&jn.box&&jn.box.length));us+=1);else jn=Yi()};if(P.get("text-variable-anchor")){var Za=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[en.crossTileID]){var su=d.prevPlacement.variableOffsets[en.crossTileID];Za.indexOf(su.anchor)>0&&(Za=Za.filter(function(Yi){return Yi!==su.anchor})).unshift(su.anchor)}var Hs=function(Yi,Rs,us){for(var qu=Yi.x2-Yi.x1,Zc=Yi.y2-Yi.y1,Vc=en.textBoxScale,jc=Dt&&!qe?Rs:null,Ws={box:[],offscreen:!1},Bl=Ve?2*Za.length:Za.length,ks=0;ks<Bl;++ks){var pl=d.attemptAnchorPlacement(Za[ks%Za.length],Yi,qu,Zc,Vc,dt,Gt,ae,k,Te,ks>=Za.length,en,w,us,jc);if(pl&&(Ws=pl.placedGlyphBoxes)&&Ws.box&&Ws.box.length){Qn=!0,Wn=pl.shift;break}}return Ws};ou(function(){return Hs(Ts,$n.iconBox,v.WritingMode.horizontal)},function(){var Yi=$n.verticalTextBox;return w.allowVerticalPlacement&&!(jn&&jn.box&&jn.box.length)&&en.numVerticalGlyphVertices>0&&Yi?Hs(Yi,$n.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),jn&&(Qn=jn.box,ui=jn.offscreen);var Dl=ss(jn&&jn.box);if(!Qn&&d.prevPlacement){var fl=d.prevPlacement.variableOffsets[en.crossTileID];fl&&(d.variableOffsets[en.crossTileID]=fl,d.markUsedJustification(w,fl.anchor,en,Dl))}}else{var vu=function(Yi,Rs){var us=d.collisionIndex.placeCollisionBox(Yi,Ve,ae,k,Te.predicate);return us&&us.box&&us.box.length&&(d.markUsedOrientation(w,Rs,en),d.placedOrientations[en.crossTileID]=Rs),us};ou(function(){return vu(Ts,v.WritingMode.horizontal)},function(){var Yi=$n.verticalTextBox;return w.allowVerticalPlacement&&en.numVerticalGlyphVertices>0&&Yi?vu(Yi,v.WritingMode.vertical):{box:null,offscreen:null}}),ss(jn&&jn.box&&jn.box.length)}}if(Qn=(ai=jn)&&ai.box&&ai.box.length>0,ui=ai&&ai.offscreen,en.useRuntimeCollisionCircles){var hl=w.text.placedSymbolArray.get(en.centerJustifiedTextSymbolIndex),cc=v.evaluateSizeForFeature(w.textSizeData,be,hl),uu=P.get("text-padding");Ua=d.collisionIndex.placeCollisionCircles(Ve,hl,w.lineVertexArray,w.glyphOffsetArray,cc,k,U,G,c,Gt,Te.predicate,en.collisionCircleDiameter,uu),Qn=Ve||Ua.circles.length>0&&!Ua.collisionDetected,ui=ui&&Ua.offscreen}if($n.iconFeatureIndex&&(fo=$n.iconFeatureIndex),$n.iconBox){var Fl=function(Yi){var Rs=Dt&&Wn?Do(Yi,Wn.x,Wn.y,dt,Gt,d.transform.angle):Yi;return d.collisionIndex.placeCollisionBox(Rs,qe,ae,k,Te.predicate)};Vn=Sa&&Sa.box&&Sa.box.length&&$n.verticalIconBox?(Bo=Fl($n.verticalIconBox)).box.length>0:(Bo=Fl($n.iconBox)).box.length>0,ui=ui&&Bo.offscreen}var lu=Ze||en.numHorizontalGlyphVertices===0&&en.numVerticalGlyphVertices===0,_o=xe||en.numIconVertices===0;if(lu||_o?_o?lu||(Vn=Vn&&Qn):Qn=Vn&&Qn:Vn=Qn=Vn&&Qn,Qn&&ai&&ai.box&&d.collisionIndex.insertCollisionBox(ai.box,P.get("text-ignore-placement"),w.bucketInstanceId,Sa&&Sa.box&&Xa?Xa:No,Te.ID),Vn&&Bo&&d.collisionIndex.insertCollisionBox(Bo.box,P.get("icon-ignore-placement"),w.bucketInstanceId,fo,Te.ID),Ua&&(Qn&&d.collisionIndex.insertCollisionCircles(Ua.circles,P.get("text-ignore-placement"),w.bucketInstanceId,No,Te.ID),c)){var Lu=w.bucketInstanceId,Yu=d.collisionCircleArrays[Lu];Yu===void 0&&(Yu=d.collisionCircleArrays[Lu]=new ho);for(var Du=0;Du<Ua.circles.length;Du+=4)Yu.circles.push(Ua.circles[Du+0]),Yu.circles.push(Ua.circles[Du+1]),Yu.circles.push(Ua.circles[Du+2]),Yu.circles.push(Ua.collisionDetected?1:0)}d.placements[en.crossTileID]=new bu(Qn||pr,Vn||kr,ui||w.justReloaded),f[en.crossTileID]=!0}};if(zt)for(var Kr=w.getSortedSymbolIndexes(this.transform.angle),Dn=Kr.length-1;Dn>=0;--Dn){var kn=Kr[Dn];Ir(w.symbolInstances.get(kn),w.collisionArrays[kn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Ir(w.symbolInstances.get(zn),w.collisionArrays[zn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Pi=this.collisionCircleArrays[w.bucketInstanceId];v.invert(Pi.invProjMatrix,k),Pi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Wa.prototype.markUsedJustification=function(l,f,c,d){var b;b=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var k=P[w];k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=b>=0&&k!==b?0:c.crossTileID)}},Wa.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,b=f===v.WritingMode.vertical?f:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Wa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(var k in this.placements){var U=this.placements[k],G=b[k];G?(this.opacities[k]=new Ho(G,d,U.text,U.icon),c=c||U.text!==G.text.placed||U.icon!==G.icon.placed):(this.opacities[k]=new Ho(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var ae in b){var se=b[ae];if(!this.opacities[ae]){var re=new Ho(se,d,!1,!1);re.isHidden()||(this.opacities[ae]=re,c=c||se.text.placed||se.icon.placed)}}for(var be in w)this.variableOffsets[be]||!this.opacities[be]||this.opacities[be].isHidden()||(this.variableOffsets[be]=w[be]);for(var Te in P)this.placedOrientations[Te]||!this.opacities[Te]||this.opacities[Te].isHidden()||(this.placedOrientations[Te]=P[Te]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Wa.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,b=f;d<b.length;d+=1){var w=b[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Wa.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Ho(null,0,!1,!1,!0),P=b.get("text-allow-overlap"),k=b.get("icon-allow-overlap"),U=b.get("text-variable-anchor"),G=b.get("text-rotation-alignment")==="map",ae=b.get("text-pitch-alignment")==="map",se=b.get("icon-text-fit")!=="none",re=new Ho(null,0,P&&(k||!l.hasIconData()||b.get("icon-optional")),k&&(P||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var be=function(Ve,qe,dt){for(var Gt=0;Gt<qe/4;Gt++)Ve.opacityVertexArray.emplaceBack(dt)},Te=function(Ve){var qe=l.symbolInstances.get(Ve),dt=qe.numHorizontalGlyphVertices,Gt=qe.numVerticalGlyphVertices,Dt=qe.crossTileID,zt=d.opacities[Dt];f[Dt]?zt=w:zt||(d.opacities[Dt]=zt=re),f[Dt]=!0;var pr=qe.numIconVertices>0,kr=d.placedOrientations[qe.crossTileID],Ir=kr===v.WritingMode.vertical,Kr=kr===v.WritingMode.horizontal||kr===v.WritingMode.horizontalOnly;if(dt>0||Gt>0){var Dn=In(zt.text);be(l.text,dt,Ir?wi:Dn),be(l.text,Gt,Kr?wi:Dn);var kn=zt.text.isHidden();[qe.rightJustifiedTextSymbolIndex,qe.centerJustifiedTextSymbolIndex,qe.leftJustifiedTextSymbolIndex].forEach(function(jn){jn>=0&&(l.text.placedSymbolArray.get(jn).hidden=kn||Ir?1:0)}),qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(qe.verticalPlacedTextSymbolIndex).hidden=kn||Kr?1:0);var zn=d.variableOffsets[qe.crossTileID];zn&&d.markUsedJustification(l,zn.anchor,qe,kr);var Pi=d.placedOrientations[qe.crossTileID];Pi&&(d.markUsedJustification(l,"left",qe,Pi),d.markUsedOrientation(l,Pi,qe))}if(pr){var en=In(zt.icon),$n=!(se&&qe.verticalPlacedIconSymbolIndex&&Ir);qe.placedIconSymbolIndex>=0&&(be(l.icon,qe.numIconVertices,$n?en:wi),l.icon.placedSymbolArray.get(qe.placedIconSymbolIndex).hidden=zt.icon.isHidden()),qe.verticalPlacedIconSymbolIndex>=0&&(be(l.icon,qe.numVerticalIconVertices,$n?wi:en),l.icon.placedSymbolArray.get(qe.verticalPlacedIconSymbolIndex).hidden=zt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ai=l.collisionArrays[Ve];if(ai){var Qn=new v.Point(0,0);if(ai.textBox||ai.verticalTextBox){var Vn=!0;if(U){var ui=d.variableOffsets[Dt];ui?(Qn=Ha(ui.anchor,ui.width,ui.height,ui.textOffset,ui.textBoxScale),G&&Qn._rotate(ae?d.transform.angle:-d.transform.angle)):Vn=!1}ai.textBox&&Ss(l.textCollisionBox.collisionVertexArray,zt.text.placed,!Vn||Ir,Qn.x,Qn.y),ai.verticalTextBox&&Ss(l.textCollisionBox.collisionVertexArray,zt.text.placed,!Vn||Kr,Qn.x,Qn.y)}var Wn=Boolean(!Kr&&ai.verticalIconBox);ai.iconBox&&Ss(l.iconCollisionBox.collisionVertexArray,zt.icon.placed,Wn,se?Qn.x:0,se?Qn.y:0),ai.verticalIconBox&&Ss(l.iconCollisionBox.collisionVertexArray,zt.icon.placed,!Wn,se?Qn.x:0,se?Qn.y:0)}}},Ze=0;Ze<l.symbolInstances.length;Ze++)Te(Ze);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var xe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=xe.invProjMatrix,l.placementViewportMatrix=xe.viewportMatrix,l.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Wa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Wa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Wa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Wa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Wa.prototype.setStale=function(){this.stale=!0};var bl=Math.pow(2,25),ds=Math.pow(2,24),Q=Math.pow(2,17),me=Math.pow(2,16),He=Math.pow(2,9),wt=Math.pow(2,8),Tr=Math.pow(2,1);function In(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*bl+f*ds+c*Q+f*me+c*He+f*wt+c*Tr+f}var wi=0,to=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};to.prototype.continuePlacement=function(l,f,c,d,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,k){return P.sortKey-k.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var Ra=function(l,f,c,d,b,w,P){this.placement=new Wa(l,b,w,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,f,c){for(var d=this,b=v.browser.now(),w=function(){var U=v.browser.now()-b;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var P=f[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=k)&&(!P.maxzoom||P.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new to(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ba=512/v.EXTENT/2,Wo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var b=f.get(d),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};Wo.prototype.getScaledCoordinates=function(l,f){var c=Ba/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},Wo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var k=this.getScaledCoordinates(w,f),U=0,G=P;U<G.length;U+=1){var ae=G[U];if(Math.abs(ae.coord.x-k.x)<=d&&Math.abs(ae.coord.y-k.y)<=d&&!c[ae.crossTileID]){c[ae.crossTileID]=!0,w.crossTileID=ae.crossTileID;break}}}}};var vs=function(){this.maxCrossTileID=0};vs.prototype.generate=function(){return++this.maxCrossTileID};var uo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};uo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],b={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),b[P.tileID.key]=P}this.indexes[c]=b}this.lng=l},uo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var k in P){var U=P[k];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,b)}else{var G=P[l.scaledTo(Number(w)).key];G&&G.findMatches(f.symbolInstances,l,b)}}for(var ae=0;ae<f.symbolInstances.length;ae++){var se=f.symbolInstances.get(ae);se.crossTileID||(se.crossTileID=c.generate(),b[se.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Wo(l,f.symbolInstances,f.bucketInstanceId),!0},uo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,b=f.indexedSymbolInstances[c];d<b.length;d+=1)delete this.usedCrossTileIDs[l][b[d].crossTileID]},uo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var b in d)l[d[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[b]),delete d[b],f=!0)}return f};var Po=function(){this.layerIndexes={},this.crossTileIDs=new vs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Po.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new uo);var b=!1,w={};d.handleWrapJump(c);for(var P=0,k=f;P<k.length;P+=1){var U=k[P],G=U.getBucket(l);G&&l.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,G,this.crossTileIDs)&&(b=!0),w[G.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(b=!0),b},Po.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ms=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Cs=v.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ps=v.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),Js=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,b=v.styleSpec.$root[c];b.required&&(d=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),gs=function(l){function f(c,d){var b=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Yt(Et(),this),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Po,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(k,U){if(v.triggerPluginCompletionEvent(k),U&&U.every(function(ae){return ae}))for(var G in w.sourceCaches)w.sourceCaches[G].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var k=b.sourceCaches[P.sourceId];if(k){var U=k.getSource();if(U&&U.vectorLayerIds)for(var G in b._layers){var ae=b._layers[G];ae.source===U.id&&b._validateLayer(ae)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(P,function(k,U){b._request=null,k?b.fire(new v.ErrorEvent(k)):U&&b._load(U,w)})},f.prototype.loadJSON=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){b._request=null,b._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Js,!1)},f.prototype._load=function(c,d){if(!d||!ms(this,v.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Lr(this.stylesheet.layers);this._order=w.map(function(G){return G.id}),this._layers={},this._serializedLayers={};for(var P=0,k=w;P<k.length;P+=1){var U=k[P];(U=v.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(b,w,P){var k,U,G,ae=v.browser.devicePixelRatio>1?"@2x":"",se=v.getJSON(w.transformRequest(w.normalizeSpriteURL(b,ae,".json"),v.ResourceType.SpriteJSON),function(Te,Ze){se=null,G||(G=Te,k=Ze,be())}),re=v.getImage(w.transformRequest(w.normalizeSpriteURL(b,ae,".png"),v.ResourceType.SpriteImage),function(Te,Ze){re=null,G||(G=Te,U=Ze,be())});function be(){if(G)P(G);else if(k&&U){var Te=v.browser.getImageData(U),Ze={};for(var xe in k){var Ve=k[xe],qe=Ve.width,dt=Ve.height,Gt=Ve.x,Dt=Ve.y,zt=Ve.sdf,pr=Ve.pixelRatio,kr=Ve.stretchX,Ir=Ve.stretchY,Kr=Ve.content,Dn=new v.RGBAImage({width:qe,height:dt});v.RGBAImage.copy(Te,Dn,{x:Gt,y:Dt},{x:0,y:0},{width:qe,height:dt}),Ze[xe]={data:Dn,pixelRatio:pr,sdf:zt,stretchX:kr,stretchY:Ir,content:Kr}}P(null,Ze)}}return{cancel:function(){se&&(se.cancel(),se=null),re&&(re.cancel(),re=null)}}}(c,this.map._requestManager,function(b,w){if(d._spriteRequest=null,b)d.fire(new v.ErrorEvent(b));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var b=c.sourceLayer;if(b){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],b=0,w=c;b<w.length;b+=1){var P=this._layers[w[b]];P.type!=="custom"&&d.push(P.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var k=this._updatedSources[P];k==="reload"?this._reloadSource(P):k==="clear"&&this._clearSource(P)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var G={};for(var ae in this.sourceCaches){var se=this.sourceCaches[ae];G[ae]=se.used,se.used=!1}for(var re=0,be=this._order;re<be.length;re+=1){var Te=this._layers[be[re]];Te.recalculate(c,this._availableImages),!Te.isHidden(c.zoom)&&Te.source&&(this.sourceCaches[Te.source].used=!0)}for(var Ze in G){var xe=this.sourceCaches[Ze];G[Ze]!==xe.used&&xe.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ze}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ms(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Lr(c.layers);var b=function(P,k){if(!P)return[{command:Wr.setStyle,args:[k]}];var U=[];try{if(!v.deepEqual(P.version,k.version))return[{command:Wr.setStyle,args:[k]}];v.deepEqual(P.center,k.center)||U.push({command:Wr.setCenter,args:[k.center]}),v.deepEqual(P.zoom,k.zoom)||U.push({command:Wr.setZoom,args:[k.zoom]}),v.deepEqual(P.bearing,k.bearing)||U.push({command:Wr.setBearing,args:[k.bearing]}),v.deepEqual(P.pitch,k.pitch)||U.push({command:Wr.setPitch,args:[k.pitch]}),v.deepEqual(P.sprite,k.sprite)||U.push({command:Wr.setSprite,args:[k.sprite]}),v.deepEqual(P.glyphs,k.glyphs)||U.push({command:Wr.setGlyphs,args:[k.glyphs]}),v.deepEqual(P.transition,k.transition)||U.push({command:Wr.setTransition,args:[k.transition]}),v.deepEqual(P.light,k.light)||U.push({command:Wr.setLight,args:[k.light]});var G={},ae=[];(function(re,be,Te,Ze){var xe;for(xe in be=be||{},re=re||{})re.hasOwnProperty(xe)&&(be.hasOwnProperty(xe)||Jr(xe,Te,Ze));for(xe in be)be.hasOwnProperty(xe)&&(re.hasOwnProperty(xe)?v.deepEqual(re[xe],be[xe])||(re[xe].type==="geojson"&&be[xe].type==="geojson"&&Zi(re,be,xe)?Te.push({command:Wr.setGeoJSONSourceData,args:[xe,be[xe].data]}):Tn(xe,be,Te,Ze)):hi(xe,be,Te))})(P.sources,k.sources,ae,G);var se=[];P.layers&&P.layers.forEach(function(re){G[re.source]?U.push({command:Wr.removeLayer,args:[re.id]}):se.push(re)}),U=U.concat(ae),function(re,be,Te){be=be||[];var Ze,xe,Ve,qe,dt,Gt,Dt,zt=(re=re||[]).map(Si),pr=be.map(Si),kr=re.reduce(gi,{}),Ir=be.reduce(gi,{}),Kr=zt.slice(),Dn=Object.create(null);for(Ze=0,xe=0;Ze<zt.length;Ze++)Ir.hasOwnProperty(Ve=zt[Ze])?xe++:(Te.push({command:Wr.removeLayer,args:[Ve]}),Kr.splice(Kr.indexOf(Ve,xe),1));for(Ze=0,xe=0;Ze<pr.length;Ze++)Kr[Kr.length-1-Ze]!==(Ve=pr[pr.length-1-Ze])&&(kr.hasOwnProperty(Ve)?(Te.push({command:Wr.removeLayer,args:[Ve]}),Kr.splice(Kr.lastIndexOf(Ve,Kr.length-xe),1)):xe++,Te.push({command:Wr.addLayer,args:[Ir[Ve],Gt=Kr[Kr.length-Ze]]}),Kr.splice(Kr.length-Ze,0,Ve),Dn[Ve]=!0);for(Ze=0;Ze<pr.length;Ze++)if(qe=kr[Ve=pr[Ze]],dt=Ir[Ve],!Dn[Ve]&&!v.deepEqual(qe,dt))if(v.deepEqual(qe.source,dt.source)&&v.deepEqual(qe["source-layer"],dt["source-layer"])&&v.deepEqual(qe.type,dt.type)){for(Dt in si(qe.layout,dt.layout,Te,Ve,null,Wr.setLayoutProperty),si(qe.paint,dt.paint,Te,Ve,null,Wr.setPaintProperty),v.deepEqual(qe.filter,dt.filter)||Te.push({command:Wr.setFilter,args:[Ve,dt.filter]}),v.deepEqual(qe.minzoom,dt.minzoom)&&v.deepEqual(qe.maxzoom,dt.maxzoom)||Te.push({command:Wr.setLayerZoomRange,args:[Ve,dt.minzoom,dt.maxzoom]}),qe)qe.hasOwnProperty(Dt)&&Dt!=="layout"&&Dt!=="paint"&&Dt!=="filter"&&Dt!=="metadata"&&Dt!=="minzoom"&&Dt!=="maxzoom"&&(Dt.indexOf("paint.")===0?si(qe[Dt],dt[Dt],Te,Ve,Dt.slice(6),Wr.setPaintProperty):v.deepEqual(qe[Dt],dt[Dt])||Te.push({command:Wr.setLayerProperty,args:[Ve,Dt,dt[Dt]]}));for(Dt in dt)dt.hasOwnProperty(Dt)&&!qe.hasOwnProperty(Dt)&&Dt!=="layout"&&Dt!=="paint"&&Dt!=="filter"&&Dt!=="metadata"&&Dt!=="minzoom"&&Dt!=="maxzoom"&&(Dt.indexOf("paint.")===0?si(qe[Dt],dt[Dt],Te,Ve,Dt.slice(6),Wr.setPaintProperty):v.deepEqual(qe[Dt],dt[Dt])||Te.push({command:Wr.setLayerProperty,args:[Ve,Dt,dt[Dt]]}))}else Te.push({command:Wr.removeLayer,args:[Ve]}),Gt=Kr[Kr.lastIndexOf(Ve)+1],Te.push({command:Wr.addLayer,args:[dt,Gt]})}(se,k.layers,U)}catch(re){console.warn("Unable to compute style diff:",re),U=[{command:Wr.setStyle,args:[k]}]}return U}(this.serialize(),c).filter(function(P){return!(P.command in Ps)});if(b.length===0)return!1;var w=b.filter(function(P){return!(P.command in Cs)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return b.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,b))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Re(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new v.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(ms(this,v.validateCustomStyleLayer(c)))return;P=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=v.clone$1(c),c=v.extend(c,{source:w})),this._validate(v.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;P=v.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var k=d?this._order.indexOf(d):this._order.length;if(d&&k===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(k,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var b=this._order.indexOf(c);this._order.splice(b,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===b||(d!=null&&(w.minzoom=d),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!v.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(v.validateStyle.filter,"layers."+w.id+".filter",d,null,b)||(w.filter=v.clone$1(d),this._updateLayer(w)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,b,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?v.deepEqual(P.getLayoutProperty(d),b)||(P.setLayoutProperty(d,b,w),this._updateLayer(P)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var b=this.getLayer(c);if(b)return b.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,b,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?v.deepEqual(P.getPaintProperty(d),b)||(P.setPaintProperty(d,b,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var b=c.source,w=c.sourceLayer,P=this.sourceCaches[b];if(P!==void 0){var k=P.getSource().type;k==="geojson"&&w?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||w?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var P=w.getSource().type,k=P==="vector"?c.sourceLayer:void 0;P!=="vector"||k?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(k,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,b=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,b=function(kr){return d._layers[kr].type==="fill-extrusion"},w={},P=[],k=this._order.length-1;k>=0;k--){var U=this._order[k];if(b(U)){w[U]=k;for(var G=0,ae=c;G<ae.length;G+=1){var se=ae[G][U];if(se)for(var re=0,be=se;re<be.length;re+=1)P.push(be[re])}}}P.sort(function(kr,Ir){return Ir.intersectionZ-kr.intersectionZ});for(var Te=[],Ze=this._order.length-1;Ze>=0;Ze--){var xe=this._order[Ze];if(b(xe))for(var Ve=P.length-1;Ve>=0;Ve--){var qe=P[Ve].feature;if(w[qe.layer.id]<Ze)break;Te.push(qe),P.pop()}else for(var dt=0,Gt=c;dt<Gt.length;dt+=1){var Dt=Gt[dt][xe];if(Dt)for(var zt=0,pr=Dt;zt<pr.length;zt+=1)Te.push(pr[zt].feature)}}return Te},f.prototype.queryRenderedFeatures=function(c,d,b){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,k=d.layers;P<k.length;P+=1){var U=k[P],G=this._layers[U];if(!G)return this.fire(new v.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[G.source]=!0}}var ae=[];for(var se in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[se]||ae.push(mn(this.sourceCaches[se],this._layers,this._serializedLayers,c,d,b));return this.placement&&ae.push(function(re,be,Te,Ze,xe,Ve,qe){for(var dt={},Gt=Ve.queryRenderedSymbols(Ze),Dt=[],zt=0,pr=Object.keys(Gt).map(Number);zt<pr.length;zt+=1)Dt.push(qe[pr[zt]]);Dt.sort(di);for(var kr=function(){var zn=Kr[Ir],Pi=zn.featureIndex.lookupSymbolFeatures(Gt[zn.bucketInstanceId],be,zn.bucketIndex,zn.sourceLayerIndex,xe.filter,xe.layers,xe.availableImages,re);for(var en in Pi){var $n=dt[en]=dt[en]||[],ai=Pi[en];ai.sort(function(ui,Wn){var jn=zn.featureSortOrder;if(jn){var Sa=jn.indexOf(ui.featureIndex);return jn.indexOf(Wn.featureIndex)-Sa}return Wn.featureIndex-ui.featureIndex});for(var Qn=0,Vn=ai;Qn<Vn.length;Qn+=1)$n.push(Vn[Qn])}},Ir=0,Kr=Dt;Ir<Kr.length;Ir+=1)kr();var Dn=function(zn){dt[zn].forEach(function(Pi){var en=Pi.feature,$n=Te[re[zn].source].getFeatureState(en.layer["source-layer"],en.id);en.source=en.layer.source,en.layer["source-layer"]&&(en.sourceLayer=en.layer["source-layer"]),en.state=$n})};for(var kn in dt)Dn(kn);return dt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ae)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var b=this.sourceCaches[c];return b?function(w,P){for(var k=w.getRenderableIds().map(function(be){return w.getTileByID(be)}),U=[],G={},ae=0;ae<k.length;ae++){var se=k[ae],re=se.tileID.canonical.key;G[re]||(G[re]=!0,se.querySourceFeatures(U,P))}return U}(b,d):[]},f.prototype.addSourceType=function(c,d,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var P in c)if(!v.deepEqual(c[P],b[P])){w=!0;break}if(w){var k={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(k)}},f.prototype._validate=function(c,d,b,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ms(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:b,styleSpec:v.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,b,w,P){P===void 0&&(P=!1);for(var k=!1,U=!1,G={},ae=0,se=this._order;ae<se.length;ae+=1){var re=this._layers[se[ae]];if(re.type==="symbol"){if(!G[re.source]){var be=this.sourceCaches[re.source];G[re.source]=be.getRenderableIds(!0).map(function(qe){return be.getTileByID(qe)}).sort(function(qe,dt){return dt.tileID.overscaledZ-qe.tileID.overscaledZ||(qe.tileID.isLessThan(dt.tileID)?-1:1)})}var Te=this.crossTileSymbolIndex.addLayer(re,G[re.source],c.center.lng);k=k||Te}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),U=!0),k&&this.pauseablePlacement.placement.setStale()),U||k)for(var Ze=0,xe=this._order;Ze<xe.length;Ze+=1){var Ve=this._layers[xe[Ze]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,G[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,b){this.imageManager.getImages(d.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,b){this.glyphManager.getGlyphs(d.stacks,b)},f.prototype.getResource=function(c,d,b){return v.makeRequest(d,b)},f}(v.Evented);gs.getSourceType=function(l){return xr[l]},gs.setSourceType=function(l,f){xr[l]=f},gs.registerForPluginStateChange=v.registerForPluginStateChange;var ha=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),va=Bi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),is=Bi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),sf=Bi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),El=Bi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Ns=Bi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ql=Bi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zu=Bi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),zs=Bi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),tl=Bi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Bi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Bi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=Bi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Bi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),X=Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ve=Bi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),je=Bi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),at=Bi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ot=Bi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),tr=Bi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ar=Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Mn=Bi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ei=Bi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Rn=Bi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Vi=Bi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),sa=Bi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ba=Bi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Bi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(b):b,k={};return{fragmentSource:l=l.replace(c,function(U,G,ae,se,re){return k[re]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
varying `+ae+" "+se+" "+re+`;
#else
uniform `+ae+" "+se+" u_"+re+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+re+`
    `+ae+" "+se+" "+re+" = u_"+re+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,G,ae,se,re){var be=se==="float"?"vec2":"vec4",Te=re.match(/color/)?"color":be;return k[re]?G==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+ae+" "+be+" a_"+re+`;
varying `+ae+" "+se+" "+re+`;
#else
uniform `+ae+" "+se+" u_"+re+`;
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = a_"+re+`;
#else
    `+ae+" "+se+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+re+" = unpack_mix_"+Te+"(a_"+re+", u_"+re+`_t);
#else
    `+ae+" "+se+" "+re+" = u_"+re+`;
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_`+re+`
uniform lowp float u_`+re+`_t;
attribute `+ae+" "+be+" a_"+re+`;
#else
uniform `+ae+" "+se+" u_"+re+`;
#endif
`:Te==="vec4"?`
#ifndef HAS_UNIFORM_u_`+re+`
    `+ae+" "+se+" "+re+" = a_"+re+`;
#else
    `+ae+" "+se+" "+re+" = u_"+re+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+re+`
    `+ae+" "+se+" "+re+" = unpack_mix_"+Te+"(a_"+re+", u_"+re+`_t);
#else
    `+ae+" "+se+" "+re+" = u_"+re+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var ys=Object.freeze({__proto__:null,prelude:va,background:is,backgroundPattern:sf,circle:El,clippingMask:Ns,heatmap:Ql,heatmapTexture:Zu,collisionBox:zs,collisionCircle:tl,debug:_,fill:T,fillOutline:N,fillOutlinePattern:R,fillPattern:X,fillExtrusion:ve,fillExtrusionPattern:je,hillshadePrepare:at,hillshade:ot,line:tr,lineGradient:ar,linePattern:Mn,lineSDF:ei,raster:Rn,symbolIcon:Vi,symbolSDF:sa,symbolTextAndIcon:ba}),eu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Vu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}eu.prototype.bind=function(l,f,c,d,b,w,P,k){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,G=0;!U&&G<d.length;G++)this.boundPaintVertexBuffers[G]!==d[G]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===k?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind()):this.freshBind(f,c,d,b,w,P,k)},eu.prototype.freshBind=function(l,f,c,d,b,w,P){var k,U=l.numAttributes,G=this.context,ae=G.gl;if(G.extVertexArrayObject)this.vao&&this.destroy(),this.vao=G.extVertexArrayObject.createVertexArrayOES(),G.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{k=G.currentNumAttributes||0;for(var se=U;se<k;se++)ae.disableVertexAttribArray(se)}f.enableAttributes(ae,l);for(var re=0,be=c;re<be.length;re+=1)be[re].enableAttributes(ae,l);w&&w.enableAttributes(ae,l),P&&P.enableAttributes(ae,l),f.bind(),f.setVertexAttribPointers(ae,l,b);for(var Te=0,Ze=c;Te<Ze.length;Te+=1){var xe=Ze[Te];xe.bind(),xe.setVertexAttribPointers(ae,l,b)}w&&(w.bind(),w.setVertexAttribPointers(ae,l,b)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(ae,l,b)),G.currentNumAttributes=U},eu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var uf=function(l,f,c,d,b,w){var P=l.gl;this.program=P.createProgram();for(var k=Vu(c.staticAttributes),U=d?d.getBinderAttributes():[],G=k.concat(U),ae=c.staticUniforms?Vu(c.staticUniforms):[],se=d?d.getBinderUniforms():[],re=[],be=0,Te=ae.concat(se);be<Te.length;be+=1){var Ze=Te[be];re.indexOf(Ze)<0&&re.push(Ze)}var xe=d?d.defines():[];w&&xe.push("#define OVERDRAW_INSPECTOR;");var Ve=xe.concat(va.fragmentSource,c.fragmentSource).join(`
`),qe=xe.concat(va.vertexSource,c.vertexSource).join(`
`),dt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(dt,Ve),P.compileShader(dt),P.attachShader(this.program,dt);var Gt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Gt,qe),P.compileShader(Gt),P.attachShader(this.program,Gt),this.attributes={};var Dt={};this.numAttributes=G.length;for(var zt=0;zt<this.numAttributes;zt++)G[zt]&&(P.bindAttribLocation(this.program,zt,G[zt]),this.attributes[G[zt]]=zt);P.linkProgram(this.program),P.deleteShader(Gt),P.deleteShader(dt);for(var pr=0;pr<re.length;pr++){var kr=re[pr];if(kr&&!Dt[kr]){var Ir=P.getUniformLocation(this.program,kr);Ir&&(Dt[kr]=Ir)}}this.fixedUniforms=b(l,Dt),this.binderUniforms=d?d.getUniforms(l,Dt):[]}}};function rl(l,f,c){var d=1/ea(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,P=w*(c.tileID.canonical.x+c.tileID.wrap*b),k=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,k>>16],u_pixel_coord_lower:[65535&P,65535&k]}}uf.prototype.draw=function(l,f,c,d,b,w,P,k,U,G,ae,se,re,be,Te,Ze){var xe,Ve=l.gl;if(!this.failedToCreate){for(var qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[qe].set(P[qe]);be&&be.setUniforms(l,this.binderUniforms,se,{zoom:re});for(var dt=(xe={},xe[Ve.LINES]=2,xe[Ve.TRIANGLES]=3,xe[Ve.LINE_STRIP]=1,xe)[f],Gt=0,Dt=ae.get();Gt<Dt.length;Gt+=1){var zt=Dt[Gt],pr=zt.vaos||(zt.vaos={});(pr[k]||(pr[k]=new eu)).bind(l,this,U,be?be.getPaintVertexBuffers():[],G,zt.vertexOffset,Te,Ze),Ve.drawElements(f,zt.primitiveLength*dt,Ve.UNSIGNED_SHORT,zt.primitiveOffset*dt*2)}}};var Ic=function(l,f,c,d){var b=f.style.light,w=b.properties.get("position"),P=[w.x,w.y,w.z],k=v.create$1();b.properties.get("anchor")==="viewport"&&v.fromRotation(k,-f.transform.angle),v.transformMat3(P,P,k);var U=b.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Eu=function(l,f,c,d,b,w,P){return v.extend(Ic(l,f,c,d),rl(w,f,P),{u_height_factor:-Math.pow(2,b.overscaledZ)/P.tileSize/8})},Su=function(l){return{u_matrix:l}},Cu=function(l,f,c,d){return v.extend(Su(l),rl(c,f,d))},lo=function(l,f){return{u_matrix:l,u_world:f}},Bf=function(l,f,c,d,b){return v.extend(Cu(l,f,c,d),{u_world:b})},Nf=function(l,f,c,d){var b,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var k=ea(c,1,P.zoom);b=!0,w=[k,k]}else b=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,f,c){var d=ea(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*b),f.pixelsToGLUnits[1]/(d*b)],u_overscale_factor:w}},Oc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},wu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},tu=function(l){return{u_matrix:l}},lf=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ea(f,1,c),u_intensity:d}},Sl=function(l,f,c){var d=l.transform;return{u_matrix:Rc(l,f,c),u_ratio:1/ea(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Oi=function(l,f,c,d){return v.extend(Sl(l,f,c),{u_image:0,u_image_height:d})},Cl=function(l,f,c,d){var b=l.transform,w=nl(f,b);return{u_matrix:Rc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ea(f,1,b.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Eh=function(l,f,c,d,b){var w=l.lineAtlas,P=nl(f,l.transform),k=c.layout.get("line-cap")==="round",U=w.getDash(d.from,k),G=w.getDash(d.to,k),ae=U.width*b.fromScale,se=G.width*b.toScale;return v.extend(Sl(l,f,c),{u_patternscale_a:[P/ae,-U.height/2],u_patternscale_b:[P/se,-G.height/2],u_sdfgamma:w.width/(256*Math.min(ae,se)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:G.y,u_mix:b.t})};function nl(l,f){return 1/ea(l,1,f.tileZoom)}function Rc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var zf=function(l,f,c,d,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(P=b.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Sh(b.paint.get("raster-hue-rotate"))};var w,P};function Sh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Uf,kc=function(l,f,c,d,b,w,P,k,U,G){var ae=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_pitch:ae.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ae.width/ae.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:k,u_is_text:+U,u_pitch_with_map:+d,u_texsize:G,u_texture:0}},Jl=function(l,f,c,d,b,w,P,k,U,G,ae){var se=b.transform;return v.extend(kc(l,f,c,d,b,w,P,k,U,G),{u_gamma_scale:d?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+ae})},ec=function(l,f,c,d,b,w,P,k,U,G){return v.extend(Jl(l,f,c,d,b,w,P,k,!0,U,!0),{u_texsize_icon:G,u_texture_icon:1})},wl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},il=function(l,f,c,d,b,w){return v.extend(function(P,k,U,G){var ae=U.imageManager.getPattern(P.from.toString()),se=U.imageManager.getPattern(P.to.toString()),re=U.imageManager.getPixelSize(),be=re.width,Te=re.height,Ze=Math.pow(2,G.tileID.overscaledZ),xe=G.tileSize*Math.pow(2,U.transform.tileZoom)/Ze,Ve=xe*(G.tileID.canonical.x+G.tileID.wrap*Ze),qe=xe*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ae.tl,u_pattern_br_a:ae.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[be,Te],u_mix:k.t,u_pattern_size_a:ae.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/ea(G,1,U.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,qe>>16],u_pixel_coord_lower:[65535&Ve,65535&qe]}}(d,w,c,b),{u_matrix:l,u_opacity:f})},Al={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function ju(l,f,c,d,b,w,P){for(var k=l.context,U=k.gl,G=l.useProgram("collisionBox"),ae=[],se=0,re=0,be=0;be<d.length;be++){var Te=d[be],Ze=f.getTile(Te),xe=Ze.getBucket(c);if(xe){var Ve=Te.posMatrix;b[0]===0&&b[1]===0||(Ve=l.translatePosMatrix(Te.posMatrix,Ze,b,w));var qe=P?xe.textCollisionBox:xe.iconCollisionBox,dt=xe.collisionCircleArray;if(dt.length>0){var Gt=v.create(),Dt=Ve;v.mul(Gt,xe.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Gt,Gt,xe.placementViewportMatrix),ae.push({circleArray:dt,circleOffset:re,transform:Dt,invTransform:Gt}),re=se+=dt.length/4}qe&&G.draw(k,U.LINES,fe.disabled,Me.disabled,l.colorModeForRenderPass(),Ke.disabled,$o(Ve,l.transform,Ze),c.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,null,l.transform.zoom,null,null,qe.collisionVertexBuffer)}}if(P&&ae.length){var zt=l.useProgram("collisionCircle"),pr=new v.StructArrayLayout2f1f2i16;pr.resize(4*se),pr._trim();for(var kr=0,Ir=0,Kr=ae;Ir<Kr.length;Ir+=1)for(var Dn=Kr[Ir],kn=0;kn<Dn.circleArray.length/4;kn++){var zn=4*kn,Pi=Dn.circleArray[zn+0],en=Dn.circleArray[zn+1],$n=Dn.circleArray[zn+2],ai=Dn.circleArray[zn+3];pr.emplace(kr++,Pi,en,$n,ai,0),pr.emplace(kr++,Pi,en,$n,ai,1),pr.emplace(kr++,Pi,en,$n,ai,2),pr.emplace(kr++,Pi,en,$n,ai,3)}(!Uf||Uf.length<2*se)&&(Uf=function(Ua){var Bo=2*Ua,No=new v.StructArrayLayout3ui6;No.resize(Bo),No._trim();for(var Xa=0;Xa<Bo;Xa++){var fo=6*Xa;No.uint16[fo+0]=4*Xa+0,No.uint16[fo+1]=4*Xa+1,No.uint16[fo+2]=4*Xa+2,No.uint16[fo+3]=4*Xa+2,No.uint16[fo+4]=4*Xa+3,No.uint16[fo+5]=4*Xa+0}return No}(se));for(var Qn=k.createIndexBuffer(Uf,!0),Vn=k.createVertexBuffer(pr,v.collisionCircleLayout.members,!0),ui=0,Wn=ae;ui<Wn.length;ui+=1){var jn=Wn[ui],Sa=Oc(jn.transform,jn.invTransform,l.transform);zt.draw(k,U.TRIANGLES,fe.disabled,Me.disabled,l.colorModeForRenderPass(),Ke.disabled,Sa,c.id,Vn,Qn,v.SegmentVector.simpleSegment(0,2*jn.circleOffset,jn.circleArray.length,jn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Vn.destroy(),Qn.destroy()}}var Us=v.identity(new Float32Array(16));function cf(l,f,c,d,b,w){var P=v.getAnchorAlignment(l),k=-(P.horizontalAlign-.5)*f,U=-(P.verticalAlign-.5)*c,G=v.evaluateVariableOffset(l,d);return new v.Point((k/b+G[0])*w,(U/b+G[1])*w)}function ff(l,f,c,d,b,w,P,k,U,G,ae){var se=l.text.placedSymbolArray,re=l.text.dynamicLayoutVertexArray,be=l.icon.dynamicLayoutVertexArray,Te={};re.clear();for(var Ze=0;Ze<se.length;Ze++){var xe=se.get(Ze),Ve=xe.hidden||!xe.crossTileID||l.allowVerticalPlacement&&!xe.placedOrientation?null:d[xe.crossTileID];if(Ve){var qe=new v.Point(xe.anchorX,xe.anchorY),dt=Ci(qe,c?k:P),Gt=Di(w.cameraToCenterDistance,dt.signedDistanceFromCamera),Dt=b.evaluateSizeForFeature(l.textSizeData,G,xe)*Gt/v.ONE_EM;c&&(Dt*=l.tilePixelRatio/U);for(var zt=cf(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,Dt),pr=c?Ci(qe.add(zt),P).point:dt.point.add(f?zt.rotate(-w.angle):zt),kr=l.allowVerticalPlacement&&xe.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Ir=0;Ir<xe.numGlyphs;Ir++)v.addDynamicAttributes(re,pr,kr);ae&&xe.associatedIconIndex>=0&&(Te[xe.associatedIconIndex]={shiftedAnchor:pr,angle:kr})}else Fa(xe.numGlyphs,re)}if(ae){be.clear();for(var Kr=l.icon.placedSymbolArray,Dn=0;Dn<Kr.length;Dn++){var kn=Kr.get(Dn);if(kn.hidden)Fa(kn.numGlyphs,be);else{var zn=Te[Dn];if(zn)for(var Pi=0;Pi<kn.numGlyphs;Pi++)v.addDynamicAttributes(be,zn.shiftedAnchor,zn.angle);else Fa(kn.numGlyphs,be)}}l.icon.dynamicLayoutVertexBuffer.updateData(be)}l.text.dynamicLayoutVertexBuffer.updateData(re)}function Zf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ru(l,f,c,d,b,w,P,k,U,G,ae,se){for(var re=l.context,be=re.gl,Te=l.transform,Ze=k==="map",xe=U==="map",Ve=Ze&&c.layout.get("symbol-placement")!=="point",qe=Ze&&!xe&&!Ve,dt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Gt=!1,Dt=l.depthModeForSublayer(0,fe.ReadOnly),zt=c.layout.get("text-variable-anchor"),pr=[],kr=0,Ir=d;kr<Ir.length;kr+=1){var Kr=Ir[kr],Dn=f.getTile(Kr),kn=Dn.getBucket(c);if(kn){var zn=b?kn.text:kn.icon;if(zn&&zn.segments.get().length){var Pi=zn.programConfigurations.get(c.id),en=b||kn.sdfIcons,$n=b?kn.textSizeData:kn.iconSizeData,ai=xe||Te.pitch!==0,Qn=l.useProgram(Zf(en,b,kn),Pi),Vn=v.evaluateSizeForZoom($n,Te.zoom),ui=void 0,Wn=[0,0],jn=void 0,Sa=void 0,Ua=null,Bo=void 0;if(b)jn=Dn.glyphAtlasTexture,Sa=be.LINEAR,ui=Dn.glyphAtlasTexture.size,kn.iconsInText&&(Wn=Dn.imageAtlasTexture.size,Ua=Dn.imageAtlasTexture,Bo=ai||l.options.rotating||l.options.zooming||$n.kind==="composite"||$n.kind==="camera"?be.LINEAR:be.NEAREST);else{var No=c.layout.get("icon-size").constantOr(0)!==1||kn.iconsNeedLinear;jn=Dn.imageAtlasTexture,Sa=en||l.options.rotating||l.options.zooming||No||ai?be.LINEAR:be.NEAREST,ui=Dn.imageAtlasTexture.size}var Xa=ea(Dn,1,l.transform.zoom),fo=Ca(Kr.posMatrix,xe,Ze,l.transform,Xa),Ts=bi(Kr.posMatrix,xe,Ze,l.transform,Xa),ss=zt&&kn.hasTextData(),ou=c.layout.get("icon-text-fit")!=="none"&&ss&&kn.hasIconData();Ve&&xn(kn,Kr.posMatrix,l,b,fo,Ts,xe,G);var Za=l.translatePosMatrix(Kr.posMatrix,Dn,w,P),su=Ve||b&&zt||ou?Us:fo,Hs=l.translatePosMatrix(Ts,Dn,w,P,!0),Dl=en&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,fl={program:Qn,buffers:zn,uniformValues:en?kn.iconsInText?ec($n.kind,Vn,qe,xe,l,Za,su,Hs,ui,Wn):Jl($n.kind,Vn,qe,xe,l,Za,su,Hs,b,ui,!0):kc($n.kind,Vn,qe,xe,l,Za,su,Hs,b,ui),atlasTexture:jn,atlasTextureIcon:Ua,atlasInterpolation:Sa,atlasInterpolationIcon:Bo,isSDF:en,hasHalo:Dl};if(dt&&kn.canOverlap){Gt=!0;for(var vu=0,hl=zn.segments.get();vu<hl.length;vu+=1){var cc=hl[vu];pr.push({segments:new v.SegmentVector([cc]),sortKey:cc.sortKey,state:fl})}}else pr.push({segments:zn.segments,sortKey:0,state:fl})}}}Gt&&pr.sort(function(Yu,Du){return Yu.sortKey-Du.sortKey});for(var uu=0,Fl=pr;uu<Fl.length;uu+=1){var lu=Fl[uu],_o=lu.state;if(re.activeTexture.set(be.TEXTURE0),_o.atlasTexture.bind(_o.atlasInterpolation,be.CLAMP_TO_EDGE),_o.atlasTextureIcon&&(re.activeTexture.set(be.TEXTURE1),_o.atlasTextureIcon&&_o.atlasTextureIcon.bind(_o.atlasInterpolationIcon,be.CLAMP_TO_EDGE)),_o.isSDF){var Lu=_o.uniformValues;_o.hasHalo&&(Lu.u_is_halo=1,tc(_o.buffers,lu.segments,c,l,_o.program,Dt,ae,se,Lu)),Lu.u_is_halo=0}tc(_o.buffers,lu.segments,c,l,_o.program,Dt,ae,se,_o.uniformValues)}}function tc(l,f,c,d,b,w,P,k,U){var G=d.context;b.draw(G,G.gl.TRIANGLES,w,P,k,Ke.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Lc(l,f,c,d,b,w,P){var k,U,G,ae,se,re=l.context.gl,be=c.paint.get("fill-pattern"),Te=be&&be.constantOr(1),Ze=c.getCrossfadeParameters();P?(U=Te&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=re.LINES):(U=Te?"fillPattern":"fill",k=re.TRIANGLES);for(var xe=0,Ve=d;xe<Ve.length;xe+=1){var qe=Ve[xe],dt=f.getTile(qe);if(!Te||dt.patternsLoaded()){var Gt=dt.getBucket(c);if(Gt){var Dt=Gt.programConfigurations.get(c.id),zt=l.useProgram(U,Dt);Te&&(l.context.activeTexture.set(re.TEXTURE0),dt.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Dt.updatePaintBuffers(Ze));var pr=be.constantOr(null);if(pr&&dt.imageAtlas){var kr=dt.imageAtlas,Ir=kr.patternPositions[pr.to.toString()],Kr=kr.patternPositions[pr.from.toString()];Ir&&Kr&&Dt.setConstantPatternPositions(Ir,Kr)}var Dn=l.translatePosMatrix(qe.posMatrix,dt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){ae=Gt.indexBuffer2,se=Gt.segments2;var kn=[re.drawingBufferWidth,re.drawingBufferHeight];G=U==="fillOutlinePattern"&&Te?Bf(Dn,l,Ze,dt,kn):lo(Dn,kn)}else ae=Gt.indexBuffer,se=Gt.segments,G=Te?Cu(Dn,l,Ze,dt):Su(Dn);zt.draw(l.context,k,b,l.stencilModeForClipping(qe),w,Ke.disabled,G,c.id,Gt.layoutVertexBuffer,ae,se,c.paint,l.transform.zoom,Dt)}}}}function hf(l,f,c,d,b,w,P){for(var k=l.context,U=k.gl,G=c.paint.get("fill-extrusion-pattern"),ae=G.constantOr(1),se=c.getCrossfadeParameters(),re=c.paint.get("fill-extrusion-opacity"),be=0,Te=d;be<Te.length;be+=1){var Ze=Te[be],xe=f.getTile(Ze),Ve=xe.getBucket(c);if(Ve){var qe=Ve.programConfigurations.get(c.id),dt=l.useProgram(ae?"fillExtrusionPattern":"fillExtrusion",qe);ae&&(l.context.activeTexture.set(U.TEXTURE0),xe.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),qe.updatePaintBuffers(se));var Gt=G.constantOr(null);if(Gt&&xe.imageAtlas){var Dt=xe.imageAtlas,zt=Dt.patternPositions[Gt.to.toString()],pr=Dt.patternPositions[Gt.from.toString()];zt&&pr&&qe.setConstantPatternPositions(zt,pr)}var kr=l.translatePosMatrix(Ze.posMatrix,xe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ir=c.paint.get("fill-extrusion-vertical-gradient"),Kr=ae?Eu(kr,l,Ir,re,Ze,se,xe):Ic(kr,l,Ir,re);dt.draw(k,k.gl.TRIANGLES,b,w,P,Ke.backCCW,Kr,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,qe)}}}function Tl(l,f,c,d,b,w){var P=l.context,k=P.gl,U=f.fbo;if(U){var G=l.useProgram("hillshade");P.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,U.colorAttachment.get());var ae=function(se,re,be){var Te=be.paint.get("hillshade-shadow-color"),Ze=be.paint.get("hillshade-highlight-color"),xe=be.paint.get("hillshade-accent-color"),Ve=be.paint.get("hillshade-illumination-direction")*(Math.PI/180);be.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=se.transform.angle);var qe,dt,Gt,Dt=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(re.tileID.toUnwrapped(),Dt),u_image:0,u_latrange:(qe=re.tileID,dt=Math.pow(2,qe.canonical.z),Gt=qe.canonical.y,[new v.MercatorCoordinate(0,Gt/dt).toLngLat().lat,new v.MercatorCoordinate(0,(Gt+1)/dt).toLngLat().lat]),u_light:[be.paint.get("hillshade-exaggeration"),Ve],u_shadow:Te,u_highlight:Ze,u_accent:xe}}(l,f,c);G.draw(P,k.TRIANGLES,d,b,w,Ke.disabled,ae,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function tp(l,f,c,d,b,w){var P=l.context,k=P.gl,U=f.dem;if(U&&U.data){var G=U.dim,ae=U.stride,se=U.getPixels();if(P.activeTexture.set(k.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(ae),f.demTexture){var re=f.demTexture;re.update(se,{premultiply:!1}),re.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(P,se,k.RGBA,{premultiply:!1}),f.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);P.activeTexture.set(k.TEXTURE0);var be=f.fbo;if(!be){var Te=new v.Texture(P,{width:G,height:G,data:null},k.RGBA);Te.bind(k.LINEAR,k.CLAMP_TO_EDGE),(be=f.fbo=P.createFramebuffer(G,G,!0)).colorAttachment.set(Te.texture)}P.bindFramebuffer.set(be.framebuffer),P.viewport.set([0,0,G,G]),l.useProgram("hillshadePrepare").draw(P,k.TRIANGLES,d,b,w,Ke.disabled,function(Ze,xe){var Ve=xe.stride,qe=v.create();return v.ortho(qe,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(qe,qe,[0,-v.EXTENT,0]),{u_matrix:qe,u_image:1,u_dimension:[Ve,Ve],u_zoom:Ze.overscaledZ,u_unpack:xe.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function pf(l,f,c,d,b){var w=d.paint.get("raster-fade-duration");if(w>0){var P=v.browser.now(),k=(P-l.timeAdded)/w,U=f?(P-f.timeAdded)/w:-1,G=c.getSource(),ae=b.coveringZoomLevel({tileSize:G.tileSize,roundZoom:G.roundZoom}),se=!f||Math.abs(f.tileID.overscaledZ-ae)>Math.abs(l.tileID.overscaledZ-ae),re=se&&l.refreshedUponExpiration?1:v.clamp(se?k:1-U,0,1);return l.refreshedUponExpiration&&k>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-re}:{opacity:re,mix:0}}return{opacity:1,mix:0}}var Ml=new v.Color(1,0,0,1),df=new v.Color(0,1,0,1),vf=new v.Color(0,0,1,1),Pl=new v.Color(1,0,1,1),Dc=new v.Color(0,1,1,1);function Ch(l,f,c,d){rc(l,0,f+c/2,l.transform.width,c,d)}function wh(l,f,c,d){rc(l,f-c/2,0,c,l.transform.height,d)}function rc(l,f,c,d,b,w){var P=l.context,k=P.gl;k.enable(k.SCISSOR_TEST),k.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,b*v.browser.devicePixelRatio),P.clear({color:w}),k.disable(k.SCISSOR_TEST)}function Ah(l,f,c){var d=l.context,b=d.gl,w=c.posMatrix,P=l.useProgram("debug"),k=fe.disabled,U=Me.disabled,G=l.colorModeForRenderPass();d.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),P.draw(d,b.LINE_STRIP,k,U,G,Ke.disabled,wu(w,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ae=f.getTileByID(c.key).latestRawTileData,se=Math.floor((ae&&ae.byteLength||0)/1024),re=f.getTile(c).tileSize,be=512/Math.min(re,512)*(c.overscaledZ/l.transform.zoom)*.5,Te=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Te+=" => "+c.overscaledZ),function(Ze,xe){Ze.initDebugOverlayCanvas();var Ve=Ze.debugOverlayCanvas,qe=Ze.context.gl,dt=Ze.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,Ve.width,Ve.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(xe,5,5),dt.strokeText(xe,5,5),Ze.debugOverlayTexture.update(Ve),Ze.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(l,Te+" "+se+"kb"),P.draw(d,b.TRIANGLES,k,U,Ue.alphaBlended,Ke.disabled,wu(w,v.Color.transparent,be),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Il={symbol:function(l,f,c,d,b){if(l.renderPass==="translucent"){var w=Me.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(k,U,G,ae,se,re,be){for(var Te=U.transform,Ze=se==="map",xe=re==="map",Ve=0,qe=k;Ve<qe.length;Ve+=1){var dt=qe[Ve],Gt=ae.getTile(dt),Dt=Gt.getBucket(G);if(Dt&&Dt.text&&Dt.text.segments.get().length){var zt=v.evaluateSizeForZoom(Dt.textSizeData,Te.zoom),pr=ea(Gt,1,U.transform.zoom),kr=Ca(dt.posMatrix,xe,Ze,U.transform,pr),Ir=G.layout.get("icon-text-fit")!=="none"&&Dt.hasIconData();if(zt){var Kr=Math.pow(2,Te.zoom-Gt.tileID.overscaledZ);ff(Dt,Ze,xe,be,v.symbolSize,Te,kr,dt.posMatrix,Kr,zt,Ir)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&ru(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&ru(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),f.map.showCollisionBoxes&&(ju(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ju(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var U=l.context,G=U.gl,ae=l.depthModeForSublayer(0,fe.ReadOnly),se=Me.disabled,re=l.colorModeForRenderPass(),be=[],Te=0;Te<d.length;Te++){var Ze=d[Te],xe=f.getTile(Ze),Ve=xe.getBucket(c);if(Ve){var qe=Ve.programConfigurations.get(c.id),dt={programConfiguration:qe,program:l.useProgram("circle",qe),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Nf(l,Ze,xe,c)};if(k)for(var Gt=0,Dt=Ve.segments.get();Gt<Dt.length;Gt+=1){var zt=Dt[Gt];be.push({segments:new v.SegmentVector([zt]),sortKey:zt.sortKey,state:dt})}else be.push({segments:Ve.segments,sortKey:0,state:dt})}}k&&be.sort(function(Dn,kn){return Dn.sortKey-kn.sortKey});for(var pr=0,kr=be;pr<kr.length;pr+=1){var Ir=kr[pr],Kr=Ir.state;Kr.program.draw(U,G.TRIANGLES,ae,se,re,Ke.disabled,Kr.uniformValues,c.id,Kr.layoutVertexBuffer,Kr.indexBuffer,Ir.segments,c.paint,l.transform.zoom,Kr.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,P=Me.disabled,k=new Ue([w.ONE,w.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(be,Te,Ze){var xe=be.gl;be.activeTexture.set(xe.TEXTURE1),be.viewport.set([0,0,Te.width/4,Te.height/4]);var Ve=Ze.heatmapFbo;if(Ve)xe.bindTexture(xe.TEXTURE_2D,Ve.colorAttachment.get()),be.bindFramebuffer.set(Ve.framebuffer);else{var qe=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,qe),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),Ve=Ze.heatmapFbo=be.createFramebuffer(Te.width/4,Te.height/4,!1),function(dt,Gt,Dt,zt){var pr=dt.gl;pr.texImage2D(pr.TEXTURE_2D,0,pr.RGBA,Gt.width/4,Gt.height/4,0,pr.RGBA,dt.extRenderToTextureHalfFloat?dt.extTextureHalfFloat.HALF_FLOAT_OES:pr.UNSIGNED_BYTE,null),zt.colorAttachment.set(Dt)}(be,Te,qe,Ve)}})(b,l,c),b.clear({color:v.Color.transparent});for(var U=0;U<d.length;U++){var G=d[U];if(!f.hasRenderableParent(G)){var ae=f.getTile(G),se=ae.getBucket(c);if(se){var re=se.programConfigurations.get(c.id);l.useProgram("heatmap",re).draw(b,w.TRIANGLES,fe.disabled,P,k,Ke.disabled,lf(G.posMatrix,ae,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,l.transform.zoom,re)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(be,Te){var Ze=be.context,xe=Ze.gl,Ve=Te.heatmapFbo;if(Ve){Ze.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,Ve.colorAttachment.get()),Ze.activeTexture.set(xe.TEXTURE1);var qe=Te.colorRampTexture;qe||(qe=Te.colorRampTexture=new v.Texture(Ze,Te.colorRamp,xe.RGBA)),qe.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),be.useProgram("heatmapTexture").draw(Ze,xe.TRIANGLES,fe.disabled,Me.disabled,be.colorModeForRenderPass(),Ke.disabled,function(dt,Gt,Dt,zt){var pr=v.create();v.ortho(pr,0,dt.width,dt.height,0,0,1);var kr=dt.context.gl;return{u_matrix:pr,u_world:[kr.drawingBufferWidth,kr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Gt.paint.get("heatmap-opacity")}}(be,Te),Te.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments,Te.paint,be.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,fe.ReadOnly),k=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),G=c.paint.get("line-pattern"),ae=G.constantOr(1),se=c.paint.get("line-gradient"),re=c.getCrossfadeParameters(),be=ae?"linePattern":U?"lineSDF":se?"lineGradient":"line",Te=l.context,Ze=Te.gl,xe=!0,Ve=0,qe=d;Ve<qe.length;Ve+=1){var dt=qe[Ve],Gt=f.getTile(dt);if(!ae||Gt.patternsLoaded()){var Dt=Gt.getBucket(c);if(Dt){var zt=Dt.programConfigurations.get(c.id),pr=l.context.program.get(),kr=l.useProgram(be,zt),Ir=xe||kr.program!==pr,Kr=G.constantOr(null);if(Kr&&Gt.imageAtlas){var Dn=Gt.imageAtlas,kn=Dn.patternPositions[Kr.to.toString()],zn=Dn.patternPositions[Kr.from.toString()];kn&&zn&&zt.setConstantPatternPositions(kn,zn)}var Pi=ae?Cl(l,Gt,c,re):U?Eh(l,Gt,c,U,re):se?Oi(l,Gt,c,Dt.lineClipsArray.length):Sl(l,Gt,c);if(ae)Te.activeTexture.set(Ze.TEXTURE0),Gt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),zt.updatePaintBuffers(re);else if(U&&(Ir||l.lineAtlas.dirty))Te.activeTexture.set(Ze.TEXTURE0),l.lineAtlas.bind(Te);else if(se){var en=Dt.gradients[c.id],$n=en.texture;if(c.gradientVersion!==en.version){var ai=256;if(c.stepInterpolant){var Qn=f.getSource().maxzoom,Vn=dt.canonical.z===Qn?Math.ceil(1<<l.transform.maxZoom-dt.canonical.z):1;ai=v.clamp(v.nextPowerOfTwo(Dt.maxLineLength/v.EXTENT*1024*Vn),256,Te.maxTextureSize)}en.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ai,image:en.gradient||void 0,clips:Dt.lineClipsArray}),en.texture?en.texture.update(en.gradient):en.texture=new v.Texture(Te,en.gradient,Ze.RGBA),en.version=c.gradientVersion,$n=en.texture}Te.activeTexture.set(Ze.TEXTURE0),$n.bind(c.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}kr.draw(Te,Ze.TRIANGLES,P,l.stencilModeForClipping(dt),k,Ke.disabled,Pi,c.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,c.paint,l.transform.zoom,zt,Dt.layoutVertexBuffer2),xe=!1}}}}},fill:function(l,f,c,d){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),k=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!k.constantOr(1)&&b.constantOr(v.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var G=l.depthModeForSublayer(1,l.renderPass==="opaque"?fe.ReadWrite:fe.ReadOnly);Lc(l,f,c,d,G,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ae=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,fe.ReadOnly);Lc(l,f,c,d,ae,P,!0)}}},"fill-extrusion":function(l,f,c,d){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))hf(l,f,c,d,w,Me.disabled,Ue.disabled),hf(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();hf(l,f,c,d,w,Me.disabled,P)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,fe.ReadOnly),P=l.colorModeForRenderPass(),k=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=k[0],G=0,ae=k[1];G<ae.length;G+=1){var se=ae[G],re=f.getTile(se);re.needsHillshadePrepare&&l.renderPass==="offscreen"?tp(l,re,c,w,Me.disabled,P):l.renderPass==="translucent"&&Tl(l,re,c,w,U[se.overscaledZ],P)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var b=l.context,w=b.gl,P=f.getSource(),k=l.useProgram("raster"),U=l.colorModeForRenderPass(),G=P instanceof ht?[{},d]:l.stencilConfigForOverlap(d),ae=G[0],se=G[1],re=se[se.length-1].overscaledZ,be=!l.options.moving,Te=0,Ze=se;Te<Ze.length;Te+=1){var xe=Ze[Te],Ve=l.depthModeForSublayer(xe.overscaledZ-re,c.paint.get("raster-opacity")===1?fe.ReadWrite:fe.ReadOnly,w.LESS),qe=f.getTile(xe),dt=l.transform.calculatePosMatrix(xe.toUnwrapped(),be);qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Gt=f.findLoadedParent(xe,0),Dt=pf(qe,Gt,f,c,l.transform),zt=void 0,pr=void 0,kr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),qe.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Gt?(Gt.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),zt=Math.pow(2,Gt.tileID.overscaledZ-qe.tileID.overscaledZ),pr=[qe.tileID.canonical.x*zt%1,qe.tileID.canonical.y*zt%1]):qe.texture.bind(kr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Ir=zf(dt,pr||[0,0],zt||1,Dt,c);P instanceof ht?k.draw(b,w.TRIANGLES,Ve,Me.disabled,U,Ke.disabled,Ir,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):k.draw(b,w.TRIANGLES,Ve,ae[xe.overscaledZ],U,Ke.disabled,Ir,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,P=w.gl,k=l.transform,U=k.tileSize,G=c.paint.get("background-pattern");if(!l.isPatternMissing(G)){var ae=!G&&d.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ae){var se=Me.disabled,re=l.depthModeForSublayer(0,ae==="opaque"?fe.ReadWrite:fe.ReadOnly),be=l.colorModeForRenderPass(),Te=l.useProgram(G?"backgroundPattern":"background"),Ze=k.coveringTiles({tileSize:U});G&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var xe=c.getCrossfadeParameters(),Ve=0,qe=Ze;Ve<qe.length;Ve+=1){var dt=qe[Ve],Gt=l.transform.calculatePosMatrix(dt.toUnwrapped()),Dt=G?il(Gt,b,l,G,{tileID:dt,tileSize:U},xe):wl(Gt,b,d);Te.draw(w,P.TRIANGLES,re,se,be,Ke.disabled,Dt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Ah(l,f,c[d])},custom:function(l,f,c){var d=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(b,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Me.disabled);var P=b.renderingMode==="3d"?new fe(l.context.gl.LEQUAL,fe.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,fe.ReadOnly);d.setDepthMode(P),b.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Hi=function(l,f){this.context=new oe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Re.maxUnderzooming+Re.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Po,this.gpuTimers={}};Hi.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Hi.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ha.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ha.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,_t.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var b=new v.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,ha.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var w=new v.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new v.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Me({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},Hi.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,fe.disabled,this.stencilClearMode,Ue.disabled,Ke.disabled,tu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Hi.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ue.disabled),c.setDepthMode(fe.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=f;w<P.length;w+=1){var k=P[w],U=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;b.draw(c,d.TRIANGLES,fe.disabled,new Me({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ue.disabled,Ke.disabled,tu(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Hi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Me({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Hi.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Me({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Hi.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,G){return G.overscaledZ-U.overscaledZ}),b=d[d.length-1].overscaledZ,w=d[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},k=0;k<w;k++)P[k+b]=new Me({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(f={},f[b]=Me.disabled,f),d]},Hi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ue([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ue.unblended:Ue.alphaBlended},Hi.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return fe.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new fe(c||this.context.gl.LEQUAL,f,[d,d])},Hi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Hi.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,b=this.style.sourceCaches;for(var w in b){var P=b[w];P.used&&P.prepare(this.context)}var k,U,G={},ae={},se={};for(var re in b){var be=b[re];G[re]=be.getVisibleCoordinates(),ae[re]=G[re].slice().reverse(),se[re]=be.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Te=0;Te<d.length;Te++)if(this.style._layers[d[Te]].is3D()){this.opaquePassCutoff=Te;break}this.renderPass="offscreen";for(var Ze=0,xe=d;Ze<xe.length;Ze+=1){var Ve=this.style._layers[xe[Ze]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var qe=ae[Ve.source];(Ve.type==="custom"||qe.length)&&this.renderLayer(this,b[Ve.source],Ve,qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var dt=this.style._layers[d[this.currentLayer]],Gt=b[dt.source],Dt=G[dt.source];this._renderTileClippingMasks(dt,Dt),this.renderLayer(this,Gt,dt,Dt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var zt=this.style._layers[d[this.currentLayer]],pr=b[zt.source],kr=(zt.type==="symbol"?se:ae)[zt.source];this._renderTileClippingMasks(zt,G[zt.source]),this.renderLayer(this,pr,zt,kr)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Ir){Ir.source&&!Ir.isHidden(c.transform.zoom)&&(Ir.source!==(U&&U.id)&&(U=c.style.sourceCaches[Ir.source]),(!k||k.getSource().maxzoom<U.getSource().maxzoom)&&(k=U))}),k&&Il.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(Ir){var Kr=Ir.transform.padding;Ch(Ir,Ir.transform.height-(Kr.top||0),3,Ml),Ch(Ir,Kr.bottom||0,3,df),wh(Ir,Kr.left||0,3,vf),wh(Ir,Ir.transform.width-(Kr.right||0),3,Pl);var Dn=Ir.transform.centerPoint;(function(kn,zn,Pi,en){rc(kn,zn-1,Pi-10,2,20,en),rc(kn,zn-10,Pi-1,20,2,en)})(Ir,Dn.x,Ir.transform.height-Dn.y,Dc)}(this),this.context.setDefault()},Hi.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Il[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Hi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Hi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Hi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Hi.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(d.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(d.query),f[c]=w}return f},Hi.prototype.translatePosMatrix=function(l,f,c,d,b){if(!c[0]&&!c[1])return l;var w=b?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),k=Math.cos(w);c=[c[0]*k-c[1]*P,c[0]*P+c[1]*k]}var U=[b?c[0]:ea(f,c[0],this.transform.zoom),b?c[1]:ea(f,c[1],this.transform.zoom),0],G=new Float32Array(16);return v.translate(G,l,U),G},Hi.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Hi.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Hi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Hi.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new uf(this.context,l,ys[l],f,Al[l],this._showOverdrawInspector)),this.cache[c]},Hi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Hi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Hi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Hi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var nc=function(l,f){this.points=l,this.planes=f};nc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return v.transformMat4([],P,l)}).map(function(P){return v.scale$1([],P,1/P[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var k=v.sub([],b[P[0]],b[P[1]]),U=v.sub([],b[P[2]],b[P[1]]),G=v.normalize([],v.cross([],k,U)),ae=-v.dot(G,b[P[1]]);return G.concat(ae)});return new nc(b,w)};var na=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};na.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],d[b]=f[b]?this.center[b]:this.max[b];return d[2]=this.max[2],new na(c,d)},na.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},na.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},na.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var b=l.planes[d],w=0,P=0;P<f.length;P++)w+=v.dot$1(b,f[P])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var k=0;k<3;k++){for(var U=Number.MAX_VALUE,G=-Number.MAX_VALUE,ae=0;ae<l.points.length;ae++){var se=l.points[ae][k]-this.min[k];U=Math.min(U,se),G=Math.max(G,se)}if(G<0||U>this.max[k]-this.min[k])return 0}return 1};var Au=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Au.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},Au.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},Au.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Au.prototype.clone=function(){return new Au(this.top,this.bottom,this.left,this.right)},Au.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ji=function(l,f,c,d,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Au,this._posMatrixCache={},this._alignedPosMatrixCache={}},Aa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ji.prototype.clone=function(){var l=new ji(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Aa.minZoom.get=function(){return this._minZoom},Aa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Aa.maxZoom.get=function(){return this._maxZoom},Aa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Aa.minPitch.get=function(){return this._minPitch},Aa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Aa.maxPitch.get=function(){return this._maxPitch},Aa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Aa.renderWorldCopies.get=function(){return this._renderWorldCopies},Aa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Aa.worldSize.get=function(){return this.tileSize*this.scale},Aa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Aa.size.get=function(){return new v.Point(this.width,this.height)},Aa.bearing.get=function(){return-this.angle/Math.PI*180},Aa.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Aa.pitch.get=function(){return this._pitch/Math.PI*180},Aa.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Aa.fov.get=function(){return this._fov/Math.PI*180},Aa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Aa.zoom.get=function(){return this._zoom},Aa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Aa.center.get=function(){return this._center},Aa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Aa.padding.get=function(){return this._edgeInsets.toJSON()},Aa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Aa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ji.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},ji.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},ji.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},ji.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),b=this.pointCoordinate(new v.Point(this.width,this.height)),w=this.pointCoordinate(new v.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,b.x,w.x)),k=Math.floor(Math.max(c.x,d.x,b.x,w.x)),U=P-1;U<=k+1;U++)U!==0&&f.push(new v.UnwrappedTileID(U,l));return f},ji.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*d.x,b*d.y,0],P=nc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),k=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=f);var U=function(Ir){return{aabb:new na([Ir*b,0,0],[(Ir+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Ir,fullyVisible:!1}},G=[],ae=[],se=f,re=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var be=1;be<=3;be++)G.push(U(-be)),G.push(U(be));for(G.push(U(0));G.length>0;){var Te=G.pop(),Ze=Te.x,xe=Te.y,Ve=Te.fullyVisible;if(!Ve){var qe=Te.aabb.intersects(P);if(qe===0)continue;Ve=qe===2}var dt=Te.aabb.distanceX(w),Gt=Te.aabb.distanceY(w),Dt=Math.max(Math.abs(dt),Math.abs(Gt));if(Te.zoom===se||Dt>3+(1<<se-Te.zoom)-2&&Te.zoom>=k)ae.push({tileID:new v.OverscaledTileID(Te.zoom===se?re:Te.zoom,Te.wrap,Te.zoom,Ze,xe),distanceSq:v.sqrLen([w[0]-.5-Ze,w[1]-.5-xe])});else for(var zt=0;zt<4;zt++){var pr=(Ze<<1)+zt%2,kr=(xe<<1)+(zt>>1);G.push({aabb:Te.aabb.quadrant(zt),zoom:Te.zoom+1,x:pr,y:kr,wrap:Te.wrap,fullyVisible:Ve})}}return ae.sort(function(Ir,Kr){return Ir.distanceSq-Kr.distanceSq}).map(function(Ir){return Ir.tileID})},ji.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Aa.unmodified.get=function(){return this._unmodified},ji.prototype.zoomScale=function(l){return Math.pow(2,l)},ji.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},ji.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},ji.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Aa.point.get=function(){return this.project(this.center)},ji.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new v.MercatorCoordinate(b.x-(c.x-d.x),b.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},ji.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},ji.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},ji.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},ji.prototype.coordinateLocation=function(l){return l.toLngLat()},ji.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],b=c[3],w=f[1]/d,P=c[1]/b,k=f[2]/d,U=c[2]/b,G=k===U?0:(0-k)/(U-k);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/b,G)/this.worldSize,v.number(w,P,G)/this.worldSize)},ji.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},ji.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},ji.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ji.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ji.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),P=b.x+Math.pow(2,b.z)*l.wrap,k=v.identity(new Float64Array(16));return v.translate(k,k,[P*w,b.y*w,0]),v.scale(k,k,[w/v.EXTENT,w/v.EXTENT,1]),v.multiply(k,f?this.alignedProjMatrix:this.projMatrix,k),d[c]=new Float32Array(k),d[c]},ji.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ji.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,b=-90,w=90,P=-180,k=180,U=this.size,G=this._unmodified;if(this.latRange){var ae=this.latRange;b=v.mercatorYfromLat(ae[1])*this.worldSize,l=(w=v.mercatorYfromLat(ae[0])*this.worldSize)-b<U.y?U.y/(w-b):0}if(this.lngRange){var se=this.lngRange;P=v.mercatorXfromLng(se[0])*this.worldSize,f=(k=v.mercatorXfromLng(se[1])*this.worldSize)-P<U.x?U.x/(k-P):0}var re=this.point,be=Math.max(f||0,l||0);if(be)return this.center=this.unproject(new v.Point(f?(k+P)/2:re.x,l?(w+b)/2:re.y)),this.zoom+=this.scaleZoom(be),this._unmodified=G,void(this._constraining=!1);if(this.latRange){var Te=re.y,Ze=U.y/2;Te-Ze<b&&(d=b+Ze),Te+Ze>w&&(d=w-Ze)}if(this.lngRange){var xe=re.x,Ve=U.x/2;xe-Ve<P&&(c=P+Ve),xe+Ve>k&&(c=k-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:re.x,d!==void 0?d:re.y))),this._unmodified=G,this._constraining=!1}},ji.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,P=b.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,G=new Float64Array(16);v.perspective(G,this._fov,this.width/this.height,U,k),G[8]=2*-l.x/this.width,G[9]=2*l.y/this.height,v.scale(G,G,[1,-1,1]),v.translate(G,G,[0,0,-this.cameraToCenterDistance]),v.rotateX(G,G,this._pitch),v.rotateZ(G,G,this.angle),v.translate(G,G,[-w,-P,0]),this.mercatorMatrix=v.scale([],G,[this.worldSize,this.worldSize,this.worldSize]),v.scale(G,G,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=G,this.invProjMatrix=v.invert([],this.projMatrix);var ae=this.width%2/2,se=this.height%2/2,re=Math.cos(this.angle),be=Math.sin(this.angle),Te=w-Math.round(w)+re*ae+be*se,Ze=P-Math.round(P)+re*se+be*ae,xe=new Float64Array(G);if(v.translate(xe,xe,[Te>.5?Te-1:Te,Ze>.5?Ze-1:Ze,0]),this.alignedProjMatrix=xe,G=v.create(),v.scale(G,G,[this.width/2,-this.height/2,1]),v.translate(G,G,[1,-1,0]),this.labelPlaneMatrix=G,G=v.create(),v.scale(G,G,[1,-1,1]),v.translate(G,G,[-1,-1,0]),v.scale(G,G,[2/this.width,2/this.height,1]),this.glCoordMatrix=G,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(G=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=G,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ji.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},ji.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},ji.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,b=f.x,w=f.y,P=0,k=l;P<k.length;P+=1){var U=k[P];c=Math.min(c,U.x),d=Math.min(d,U.y),b=Math.max(b,U.x),w=Math.max(w,U.y)}return[new v.Point(c,d),new v.Point(b,d),new v.Point(b,w),new v.Point(c,w),new v.Point(c,d)]},Object.defineProperties(ji.prototype,Aa);var _s=function(l){var f,c,d,b;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,b=function(){d=null,c&&(f(),d=setTimeout(b,300),c=!1)},function(){return c=!0,d||b(),d})};_s.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},_s.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},_s.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,d),w=Math.round(f.lng*b)/b,P=Math.round(f.lat*b)/b,k=this._map.getBearing(),U=this._map.getPitch(),G="";if(G+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(k||U)&&(G+="/"+Math.round(10*k)/10),U&&(G+="/"+Math.round(U)),this._hashName){var ae=this._hashName,se=!1,re=v.window.location.hash.slice(1).split("&").map(function(be){var Te=be.split("=")[0];return Te===ae?(se=!0,Te+"="+G):be}).filter(function(be){return be});return se||re.push(ae+"="+G),"#"+re.join("&")}return"#"+G},_s.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},_s.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},_s.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var Fc={linearity:.3,easing:v.bezier(0,0,.3,1)},Gu=v.extend({deceleration:2500,maxSpeed:1400},Fc),Na=v.extend({deceleration:20,maxSpeed:1400},Fc),ic=v.extend({deceleration:1e3,maxSpeed:360},Fc),Ol=v.extend({deceleration:1e3,maxSpeed:90},Fc),Hu=function(l){this._map=l,this.clear()};function Bc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Tu(l,f,c){var d=c.maxSpeed,b=c.linearity,w=c.deceleration,P=v.clamp(l*b/(f/1e3),-d,d),k=Math.abs(P)/(w*b);return{easing:c.easing,duration:1e3*k,amount:P*(k/2)}}Hu.prototype.clear=function(){this._inertiaBuffer=[]},Hu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Hu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Hu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var b=d[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){var k=Tu(f.pan.mag(),w,v.extend({},Gu,l||{}));P.offset=f.pan.mult(k.amount/f.pan.mag()),P.center=this._map.transform.center,Bc(P,k)}if(f.zoom){var U=Tu(f.zoom,w,Na);P.zoom=this._map.transform.zoom+U.amount,Bc(P,U)}if(f.bearing){var G=Tu(f.bearing,w,ic);P.bearing=this._map.transform.bearing+v.clamp(G.amount,-179,179),Bc(P,G)}if(f.pitch){var ae=Tu(f.pitch,w,Ol);P.pitch=this._map.transform.pitch+ae.amount,Bc(P,ae)}if(P.zoom||P.bearing){var se=f.pinchAround===void 0?f.around:f.pinchAround;P.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),v.extend(P,{noMoveStart:!0})}};var po=function(l){function f(d,b,w,P){P===void 0&&(P={});var k=H.mousePos(b.getCanvasContainer(),w),U=b.unproject(k);l.call(this,d,v.extend({point:k,lngLat:U,originalEvent:w},P)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Rl=function(l){function f(d,b,w){var P=d==="touchend"?w.changedTouches:w.touches,k=H.touchPos(b.getCanvasContainer(),P),U=k.map(function(se){return b.unproject(se)}),G=k.reduce(function(se,re,be,Te){return se.add(re.div(Te.length))},new v.Point(0,0)),ae=b.unproject(G);l.call(this,d,{points:k,point:G,lngLats:U,lngLat:ae,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),ac=function(l){function f(d,b,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),vo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};vo.prototype.reset=function(){delete this._mousedownPos},vo.prototype.wheel=function(l){return this._firePreventable(new ac(l.type,this._map,l))},vo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new po(l.type,this._map,l))},vo.prototype.mouseup=function(l){this._map.fire(new po(l.type,this._map,l))},vo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new po(l.type,this._map,l))},vo.prototype.dblclick=function(l){return this._firePreventable(new po(l.type,this._map,l))},vo.prototype.mouseover=function(l){this._map.fire(new po(l.type,this._map,l))},vo.prototype.mouseout=function(l){this._map.fire(new po(l.type,this._map,l))},vo.prototype.touchstart=function(l){return this._firePreventable(new Rl(l.type,this._map,l))},vo.prototype.touchmove=function(l){this._map.fire(new Rl(l.type,this._map,l))},vo.prototype.touchend=function(l){this._map.fire(new Rl(l.type,this._map,l))},vo.prototype.touchcancel=function(l){this._map.fire(new Rl(l.type,this._map,l))},vo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},vo.prototype.isEnabled=function(){return!0},vo.prototype.isActive=function(){return!1},vo.prototype.enable=function(){},vo.prototype.disable=function(){};var hn=function(l){this._map=l};hn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},hn.prototype.mousemove=function(l){this._map.fire(new po(l.type,this._map,l))},hn.prototype.mousedown=function(){this._delayContextMenu=!0},hn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new po("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},hn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new po(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},hn.prototype.isEnabled=function(){return!0},hn.prototype.isActive=function(){return!1},hn.prototype.enable=function(){},hn.prototype.disable=function(){};var co=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Wu(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(H.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},co.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=H.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),k=Math.max(d.y,c.y);H.setTransform(this._box,"translate("+b+"px,"+P+"px)"),this._box.style.width=w-b+"px",this._box.style.height=k-P+"px"}}},co.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,b=f;if(this.reset(),H.suppressClick(),d.x!==b.x||d.y!==b.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(H.remove(this._box),this._box=null),H.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var b=new v.Point(0,0),w=0,P=d;w<P.length;w+=1)b._add(P[w]);return b.div(d.length)}(f),this.touches=Wu(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Wu(c,f);for(var b in this.touches){var w=d[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Zs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Zs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Zs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Zs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Zs.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var ws=function(){this._zoomIn=new Zs({numTouches:1,numTaps:2}),this._zoomOut=new Zs({numTouches:2,numTaps:1}),this.reset()};ws.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ws.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},ws.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},ws.prototype.touchend=function(l,f,c){var d=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},ws.prototype.touchcancel=function(){this.reset()},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var mf={0:1,2:2},zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},zr.prototype._correctButton=function(l,f){return!1},zr.prototype._move=function(l,f){return{}},zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=H.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,b){var w=mf[b];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},zr.prototype.mouseupWindow=function(l){this._lastPoint&&H.mouseButton(l)===this._eventButton&&(this._moved&&H.suppressClick(),this.reset())},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var oc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(zr),gf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=.8*(d.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),al=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=-.5*(d.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),Ea=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ea.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ea.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ea.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ea.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ea.prototype.touchcancel=function(){this.reset()},Ea.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Wu(c,f),b=new v.Point(0,0),w=new v.Point(0,0),P=0;for(var k in d){var U=d[k],G=this._touches[k];G&&(b._add(U),w._add(U.sub(G)),P++,d[k]=U)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var ae=w.div(P);if(this._sum._add(ae),!(this._sum.mag()<this._clickTolerance))return{around:b.div(P),panDelta:ae}}},Ea.prototype.enable=function(){this._enabled=!0},Ea.prototype.disable=function(){this._enabled=!1,this.reset()},Ea.prototype.isEnabled=function(){return this._enabled},Ea.prototype.isActive=function(){return this._active};var xs=function(){this.reset()};function yf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Mu(l,f){return Math.log(l/f)/Math.LN2}xs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},xs.prototype._start=function(l){},xs.prototype._move=function(l,f,c){return{}},xs.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},xs.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,b=d[1],w=yf(c,f,d[0]),P=yf(c,f,b);if(w&&P){var k=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],k,l)}}},xs.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,b=d[1],w=yf(c,f,d[0]),P=yf(c,f,b);w&&P||(this._active&&H.suppressClick(),this.reset())}},xs.prototype.touchcancel=function(){this.reset()},xs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},xs.prototype.disable=function(){this._enabled=!1,this.reset()},xs.prototype.isEnabled=function(){return this._enabled},xs.prototype.isActive=function(){return this._active};var Is=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,b),pinchAround:d}},f}(xs);function Pu(l,f){return 180*l.angleWith(f)/Math.PI}var Vf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pu(this._vector,b),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,b=Pu(c,this._startVector);return Math.abs(b)<d},f}(xs);function ol(l){return Math.abs(l.y)>Math.abs(l.x)}var jf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ol(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,b){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var k=c.y>0==d.y>0;return ol(c)&&ol(d)&&k}},f}(xs),_f={panStep:100,bearingStep:15,pitchStep:10},nu=function(){var l=_f;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function As(l){return l*(2-l)}nu.prototype.blur=function(){this.reset()},nu.prototype.reset=function(){this._active=!1},nu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,b=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,b=0),{cameraAnimation:function(k){var U=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:As,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:k.getBearing()+d*f._bearingStep,pitch:k.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-P*f._panStep],center:k.getCenter()},{originalEvent:l})}}}},nu.prototype.enable=function(){this._enabled=!0},nu.prototype.disable=function(){this._enabled=!1,this.reset()},nu.prototype.isEnabled=function(){return this._enabled},nu.prototype.isActive=function(){return this._active},nu.prototype.disableRotation=function(){this._rotationDisabled=!0},nu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ei=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Ei.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ei.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ei.prototype.isEnabled=function(){return!!this._enabled},Ei.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ei.prototype.isZooming=function(){return!!this._zooming},Ei.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ei.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ei.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ei.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ei.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=H.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ei.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,k=this._startZoom,U=this._easing,G=!1;if(this._type==="wheel"&&k&&U){var ae=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),se=U(ae);w=v.number(k,P,se),ae<1?this._frameId||(this._frameId=!0):G=!0}else w=P,G=!0;return this._active=!0,G&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!G,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ei.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,b=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(b*b+1e-4)*.01,P=Math.sqrt(.0729-w*w);f=v.bezier(w,P,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Ei.prototype.blur=function(){this.reset()},Ei.prototype.reset=function(){this._active=!1};var Iu=function(l,f){this._clickZoom=l,this._tapZoom=f};Iu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Iu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Iu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Iu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var iu=function(){this.reset()};iu.prototype.reset=function(){this._active=!1},iu.prototype.blur=function(){this.reset()},iu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},iu.prototype.enable=function(){this._enabled=!0},iu.prototype.disable=function(){this._enabled=!1,this.reset()},iu.prototype.isEnabled=function(){return this._enabled},iu.prototype.isActive=function(){return this._active};var Xo=function(){this._tap=new Zs({numTouches:1,numTaps:1}),this.reset()};Xo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Xo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Xo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],b=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},Xo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Xo.prototype.touchcancel=function(){this.reset()},Xo.prototype.enable=function(){this._enabled=!0},Xo.prototype.disable=function(){this._enabled=!1,this.reset()},Xo.prototype.isEnabled=function(){return this._enabled},Xo.prototype.isActive=function(){return this._active};var sl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};sl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},sl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},sl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},sl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var as=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};as.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},as.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},as.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},as.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Vs=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Vs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Vs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Vs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Vs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},pu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Sn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hu(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,b=this._listeners;d<b.length;d+=1){var w=b[d],P=w[0];H.addEventListener(P,w[1],P===v.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Sn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];H.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Sn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new vo(f,l));var d=f.boxZoom=new co(f,l);this._add("boxZoom",d);var b=new ws,w=new iu;f.doubleClickZoom=new Iu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var P=new Xo;this._add("tapDragZoom",P);var k=f.touchPitch=new jf;this._add("touchPitch",k);var U=new gf(l),G=new al(l);f.dragRotate=new as(l,U,G),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",G,["mouseRotate"]);var ae=new oc(l),se=new Ea(l);f.dragPan=new sl(c,ae,se),this._add("mousePan",ae),this._add("touchPan",se,["touchZoom","touchRotate"]);var re=new Vf,be=new Is;f.touchZoomRotate=new Vs(c,be,re,P),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]);var Te=f.scrollZoom=new Ei(f,this);this._add("scrollZoom",Te,["mousePan"]);var Ze=f.keyboard=new nu;this._add("keyboard",Ze),this._add("blockableMapEvent",new hn(f));for(var xe=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];xe<Ve.length;xe+=1){var qe=Ve[xe];l.interactive&&l[qe]&&f[qe].enable(l[qe])}},Sn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Sn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Sn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Sn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Sn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Sn.prototype.isMoving=function(){return Boolean(bs(this._eventsInProgress))||this.isZooming()},Sn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Sn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Sn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var b=d[c];this._el.contains(b.target)&&f.push(b)}return f},Sn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},b={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,k=P?H.touchPos(this._el,P):H.mousePos(this._el,l),U=0,G=this._handlers;U<G.length;U+=1){var ae=G[U],se=ae.handlerName,re=ae.handler,be=ae.allowed;if(re.isEnabled()){var Te=void 0;this._blockedByActive(w,be,se)?re.reset():re[f||l.type]&&(Te=re[f||l.type](l,k,P),this.mergeHandlerResult(d,b,Te,se,c),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()),(Te||re.isActive())&&(w[se]=re)}}var Ze={};for(var xe in this._previousActiveHandlers)w[xe]||(Ze[xe]=c);this._previousActiveHandlers=w,(Object.keys(Ze).length||On(d))&&(this._changes.push([d,b,Ze]),this._triggerRenderFrame()),(Object.keys(w).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},Sn.prototype.mergeHandlerResult=function(l,f,c,d,b){if(c){v.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},Sn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,b=this._changes;d<b.length;d+=1){var w=b[d],P=w[0],k=w[1],U=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),v.extend(f,k),v.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},Sn.prototype._updateMapTransform=function(l,f,c){var d=this._map,b=d.transform;if(!On(l))return this._fireEvents(f,c,!0);var w=l.panDelta,P=l.zoomDelta,k=l.bearingDelta,U=l.pitchDelta,G=l.around,ae=l.pinchAround;ae!==void 0&&(G=ae),d._stop(!0),G=G||d.transform.centerPoint;var se=b.pointLocation(w?G.sub(w):G);k&&(b.bearing+=k),U&&(b.pitch+=U),P&&(b.zoom+=P),b.setLocationAtPoint(se,G),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Sn.prototype._fireEvents=function(l,f,c){var d=this,b=bs(this._eventsInProgress),w=bs(l),P={};for(var k in l)this._eventsInProgress[k]||(P[k+"start"]=l[k].originalEvent),this._eventsInProgress[k]=l[k];for(var U in!b&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(U,P[U]);for(var G in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(G,l[G].originalEvent);var ae,se={};for(var re in this._eventsInProgress){var be=this._eventsInProgress[re],Te=be.handlerName,Ze=be.originalEvent;this._handlersById[Te].isActive()||(delete this._eventsInProgress[re],se[re+"end"]=ae=f[Te]||Ze)}for(var xe in se)this._fireEvent(xe,se[xe]);var Ve=bs(this._eventsInProgress);if(c&&(b||w)&&!Ve){this._updatingCamera=!0;var qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),dt=function(Gt){return Gt!==0&&-d._bearingSnap<Gt&&Gt<d._bearingSnap};qe?(dt(qe.bearing||this._map.getBearing())&&(qe.bearing=0),this._map.easeTo(qe,{originalEvent:ae})):(this._map.fire(new v.Event("moveend",{originalEvent:ae})),dt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Sn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},Sn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new pu("renderFrame",{timeStamp:f})),l._applyChanges()})},Sn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Nc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,b){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),b)},f.prototype.panTo=function(c,d,b){return this.easeTo(v.extend({center:c},d),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,b){return this.easeTo(v.extend({zoom:c},d),b)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,b){return this.easeTo(v.extend({bearing:c},d),b)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var b=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,d)},f.prototype._cameraForBoxAndBearing=function(c,d,b,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=v.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var k=w.padding;w.padding={top:k,bottom:k,right:k,left:k}}w.padding=v.extend(P,w.padding);var U=this.transform,G=U.padding,ae=U.project(v.LngLat.convert(c)),se=U.project(v.LngLat.convert(d)),re=ae.rotate(-b*Math.PI/180),be=se.rotate(-b*Math.PI/180),Te=new v.Point(Math.max(re.x,be.x),Math.max(re.y,be.y)),Ze=new v.Point(Math.min(re.x,be.x),Math.min(re.y,be.y)),xe=Te.sub(Ze),Ve=(U.width-(G.left+G.right+w.padding.left+w.padding.right))/xe.x,qe=(U.height-(G.top+G.bottom+w.padding.top+w.padding.bottom))/xe.y;if(!(qe<0||Ve<0)){var dt=Math.min(U.scaleZoom(U.scale*Math.min(Ve,qe)),w.maxZoom),Gt=typeof w.offset.x=="number"?new v.Point(w.offset.x,w.offset.y):v.Point.convert(w.offset),Dt=new v.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),zt=Gt.add(Dt).mult(U.scale/U.zoomScale(dt));return{center:U.unproject(ae.add(se).div(2).sub(zt)),zoom:dt,bearing:b}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,b){return this._fitInternal(this.cameraForBounds(c,d),d,b)},f.prototype.fitScreenCoordinates=function(c,d,b,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),b,w),w,P)},f.prototype._fitInternal=function(c,d,b){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,b):this.flyTo(d,b)):this},f.prototype.jumpTo=function(c,d){this.stop();var b=this.transform,w=!1,P=!1,k=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=v.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(P=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(k=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),w&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),P&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),k&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var b=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),k=this.getBearing(),U=this.getPitch(),G=this.getPadding(),ae="zoom"in c?+c.zoom:P,se="bearing"in c?this._normalizeBearing(c.bearing,k):k,re="pitch"in c?+c.pitch:U,be="padding"in c?c.padding:w.padding,Te=v.Point.convert(c.offset),Ze=w.centerPoint.add(Te),xe=w.pointLocation(Ze),Ve=v.LngLat.convert(c.center||xe);this._normalizeCenter(Ve);var qe,dt,Gt=w.project(xe),Dt=w.project(Ve).sub(Gt),zt=w.zoomScale(ae-P);c.around&&(qe=v.LngLat.convert(c.around),dt=w.locationPoint(qe));var pr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ae!==P,this._rotating=this._rotating||k!==se,this._pitching=this._pitching||re!==U,this._padding=!w.isPaddingEqual(be),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,pr),this._ease(function(kr){if(b._zooming&&(w.zoom=v.number(P,ae,kr)),b._rotating&&(w.bearing=v.number(k,se,kr)),b._pitching&&(w.pitch=v.number(U,re,kr)),b._padding&&(w.interpolatePadding(G,be,kr),Ze=w.centerPoint.add(Te)),qe)w.setLocationAtPoint(qe,dt);else{var Ir=w.zoomScale(w.zoom-P),Kr=ae>P?Math.min(2,zt):Math.max(.5,zt),Dn=Math.pow(Kr,1-kr),kn=w.unproject(Gt.add(Dt.mult(kr*Dn)).mult(Ir));w.setLocationAtPoint(w.renderWorldCopies?kn.wrap():kn,Ze)}b._fireMoveEvents(d)},function(kr){b._afterEase(d,kr)},c),this},f.prototype._prepareEase=function(c,d,b){b===void 0&&(b={}),this._moving=!0,d||b.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var b=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new v.Event("zoomend",c)),w&&this.fire(new v.Event("rotateend",c)),P&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var b=this;if(!c.essential&&v.browser.prefersReducedMotion){var w=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var P=this.transform,k=this.getZoom(),U=this.getBearing(),G=this.getPitch(),ae=this.getPadding(),se="zoom"in c?v.clamp(+c.zoom,P.minZoom,P.maxZoom):k,re="bearing"in c?this._normalizeBearing(c.bearing,U):U,be="pitch"in c?+c.pitch:G,Te="padding"in c?c.padding:P.padding,Ze=P.zoomScale(se-k),xe=v.Point.convert(c.offset),Ve=P.centerPoint.add(xe),qe=P.pointLocation(Ve),dt=v.LngLat.convert(c.center||qe);this._normalizeCenter(dt);var Gt=P.project(qe),Dt=P.project(dt).sub(Gt),zt=c.curve,pr=Math.max(P.width,P.height),kr=pr/Ze,Ir=Dt.mag();if("minZoom"in c){var Kr=v.clamp(Math.min(c.minZoom,k,se),P.minZoom,P.maxZoom),Dn=pr/P.zoomScale(Kr-k);zt=Math.sqrt(Dn/Ir*2)}var kn=zt*zt;function zn(Wn){var jn=(kr*kr-pr*pr+(Wn?-1:1)*kn*kn*Ir*Ir)/(2*(Wn?kr:pr)*kn*Ir);return Math.log(Math.sqrt(jn*jn+1)-jn)}function Pi(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function en(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}var $n=zn(0),ai=function(Wn){return en($n)/en($n+zt*Wn)},Qn=function(Wn){return pr*((en($n)*(Pi(jn=$n+zt*Wn)/en(jn))-Pi($n))/kn)/Ir;var jn},Vn=(zn(1)-$n)/zt;if(Math.abs(Ir)<1e-6||!isFinite(Vn)){if(Math.abs(pr-kr)<1e-6)return this.easeTo(c,d);var ui=kr<pr?-1:1;Vn=Math.abs(Math.log(kr/pr))/zt,Qn=function(){return 0},ai=function(Wn){return Math.exp(ui*zt*Wn)}}return c.duration="duration"in c?+c.duration:1e3*Vn/("screenSpeed"in c?+c.screenSpeed/zt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==re,this._pitching=be!==G,this._padding=!P.isPaddingEqual(Te),this._prepareEase(d,!1),this._ease(function(Wn){var jn=Wn*Vn,Sa=1/ai(jn);P.zoom=Wn===1?se:k+P.scaleZoom(Sa),b._rotating&&(P.bearing=v.number(U,re,Wn)),b._pitching&&(P.pitch=v.number(G,be,Wn)),b._padding&&(P.interpolatePadding(ae,Te,Wn),Ve=P.centerPoint.add(xe));var Ua=Wn===1?dt:P.unproject(Gt.add(Dt.mult(Qn(jn))).mult(Sa));P.setLocationAtPoint(P.renderWorldCopies?Ua.wrap():Ua,Ve),b._fireMoveEvents(d)},function(){return b._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,b){b.animate===!1||b.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var b=Math.abs(c-d);return Math.abs(c-360-d)<b&&(c-=360),Math.abs(c+360-d)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var b=c.lng-d.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(v.Evented),os=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};os.prototype.getDefaultPosition=function(){return"bottom-right"},os.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=H.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},os.prototype.onRemove=function(){H.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},os.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},os.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,b,w){return b.value&&(d+=b.key+"="+b.value+(w<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},os.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},os.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var b=c[d];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(k,U){return k.length-U.length});var P=(l=l.filter(function(k,U){for(var G=U+1;G<l.length;G++)if(l[G].indexOf(k)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var au=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};au.prototype.onAdd=function(l){this._map=l,this._container=H.create("div","mapboxgl-ctrl");var f=H.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},au.prototype.onRemove=function(){H.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},au.prototype.getDefaultPosition=function(){return"bottom-left"},au.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},au.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},au.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Fo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var b=d[c];if(b.id===l)return void(b.cancelled=!0)}},Fo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var b=d[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ou={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},xf=v.window.HTMLImageElement,bf=v.window.HTMLElement,ua=v.window.ImageBitmap,pa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Th=function(l){function f(d){var b=this;if((d=v.extend({},pa,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new ji(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Ou,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof bf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sn(this,d),this._hash=d.hash&&new _s(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new os({customAttribution:d.customAttribution})),this.addControl(new au,d.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(P){b._update(P.dataType==="style"),b.fire(new v.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){b.fire(new v.Event(P.dataType+"dataloading",P))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,b){if(b===void 0&&(b=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[b];return b.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(d);return b>-1&&this._controls.splice(b,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var b=this._containerDimensions(),w=b[0],P=b[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var k=!this._moving;return k&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),k&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,b,w){var P,k=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:b,listener:w,delegates:{mousemove:function(ae){var se=k.getLayer(b)?k.queryRenderedFeatures(ae.point,{layers:[b]}):[];se.length?U||(U=!0,w.call(k,new po(d,k,ae.originalEvent,{features:se}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var G=!1;return{layer:b,listener:w,delegates:{mousemove:function(ae){(k.getLayer(b)?k.queryRenderedFeatures(ae.point,{layers:[b]}):[]).length?G=!0:G&&(G=!1,w.call(k,new po(d,k,ae.originalEvent)))},mouseout:function(ae){G&&(G=!1,w.call(k,new po(d,k,ae.originalEvent)))}}}}return{layer:b,listener:w,delegates:(P={},P[d]=function(ae){var se=k.getLayer(b)?k.queryRenderedFeatures(ae.point,{layers:[b]}):[];se.length&&(ae.features=se,w.call(k,ae),delete ae.features)},P)}},f.prototype.on=function(d,b,w){if(w===void 0)return l.prototype.on.call(this,d,b);var P=this._createDelegatedListener(d,b,w);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(k,P.delegates[k]);return this},f.prototype.once=function(d,b,w){if(w===void 0)return l.prototype.once.call(this,d,b);var P=this._createDelegatedListener(d,b,w);for(var k in P.delegates)this.once(k,P.delegates[k]);return this},f.prototype.off=function(d,b,w){var P=this;return w===void 0?l.prototype.off.call(this,d,b):(this._delegatedListeners&&this._delegatedListeners[d]&&function(k){for(var U=k[d],G=0;G<U.length;G++){var ae=U[G];if(ae.layer===b&&ae.listener===w){for(var se in ae.delegates)P.off(se,ae.delegates[se]);return U.splice(G,1),P}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,b){if(!this.style)return[];var w;if(b!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(b=d,d=void 0),b=b||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")w=[v.Point.convert(d)];else{var P=v.Point.convert(d[0]),k=v.Point.convert(d[1]);w=[P,new v.Point(k.x,P.y),k,new v.Point(P.x,k.y),P]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(d,b){return this.style.querySourceFeatures(d,b)},f.prototype.setStyle=function(d,b){return(b=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(d,b))},f.prototype._getUIString=function(d){var b=this._locale[d];if(b==null)throw new Error("Missing UI string '"+d+"'");return b},f.prototype._updateStyle=function(d,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new gs(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,b){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),k=this._requestManager.transformRequest(P,v.ResourceType.Style);v.getJSON(k,function(U,G){U?w.fire(new v.ErrorEvent(U)):G&&w._updateDiff(G,b)})}else typeof d=="object"&&this._updateDiff(d,b)},f.prototype._updateDiff=function(d,b){try{this.style.setState(d)&&this._update(!0)}catch(w){v.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,b){return this._lazyInitEmptyStyle(),this.style.addSource(d,b),this._update(!0)},f.prototype.isSourceLoaded=function(d){var b=this.style&&this.style.sourceCaches[d];if(b!==void 0)return b.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var b in d){var w=d[b]._tiles;for(var P in w){var k=w[P];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,b,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,b,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var k=w.sdf;k===void 0&&(k=!1);var U=w.stretchX,G=w.stretchY,ae=w.content;if(this._lazyInitEmptyStyle(),b instanceof xf||ua&&b instanceof ua){var se=v.browser.getImageData(b);this.style.addImage(d,{data:new v.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:P,stretchX:U,stretchY:G,content:ae,sdf:k,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var re=b;this.style.addImage(d,{data:new v.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:P,stretchX:U,stretchY:G,content:ae,sdf:k,version:0,userImage:re}),re.onAdd&&re.onAdd(this,d)}},f.prototype.updateImage=function(d,b){var w=this.style.getImage(d);if(!w)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=b instanceof xf||ua&&b instanceof ua?v.browser.getImageData(b):b,k=P.width,U=P.height,G=P.data;return k===void 0||U===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==w.data.width||U!==w.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(G,!(b instanceof xf||ua&&b instanceof ua)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,b){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,b){return this._lazyInitEmptyStyle(),this.style.addLayer(d,b),this._update(!0)},f.prototype.moveLayer=function(d,b){return this.style.moveLayer(d,b),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,b,w){return this.style.setLayerZoomRange(d,b,w),this._update(!0)},f.prototype.setFilter=function(d,b,w){return w===void 0&&(w={}),this.style.setFilter(d,b,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,b,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,b,w,P),this._update(!0)},f.prototype.getPaintProperty=function(d,b){return this.style.getPaintProperty(d,b)},f.prototype.setLayoutProperty=function(d,b,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,b,w,P),this._update(!0)},f.prototype.getLayoutProperty=function(d,b){return this.style.getLayoutProperty(d,b)},f.prototype.setLight=function(d,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(d,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,b){return this.style.setFeatureState(d,b),this._update()},f.prototype.removeFeatureState=function(d,b){return this.style.removeFeatureState(d,b),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,b=0;return this._container&&(d=this._container.clientWidth||400,b=this._container.clientHeight||300),[d,b]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=H.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=H.create("div","mapboxgl-canvas-container",d);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=H.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=H.create("div","mapboxgl-control-container",d),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){k[U]=H.create("div","mapboxgl-ctrl-"+U,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,b){var w=v.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*b,this._canvas.style.width=d+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var d=v.extend({},Oe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);b?(this.painter=new Hi(b,this.transform),v.webpSupported.testSupport(b)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var b,w=this,P=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,b),P=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var G=this.transform.zoom,ae=v.browser.now();this.style.zoomHistory.update(G,ae);var se=new v.EvaluationParameters(G,{now:ae,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),re=se.crossFadingFactor();re===1&&re===this._crossFadingFactor||(U=!0,this._crossFadingFactor=re),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var be=v.browser.now()-P;k.endQueryEXT(k.TIME_ELAPSED_EXT,b),setTimeout(function(){var xe=k.getQueryObjectEXT(b,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(b),w.fire(new v.Event("gpu-timing-frame",{cpuTime:be,gpuTime:xe}))},50)}if(this.listens("gpu-timing-layer")){var Te=this.painter.collectGpuTimers();setTimeout(function(){var xe=w.painter.queryGpuTimers(Te);w.fire(new v.Event("gpu-timing-layer",{layerTimes:xe}))},50)}var Ze=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ze||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Ze||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,b=this._controls;d<b.length;d+=1)b[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Xu(this._canvasContainer),Xu(this._controlContainer),Xu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(b){d._frame=null,d._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,b){v.setCacheLimits(d,b)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(Nc);function Xu(l){l.parentNode&&l.parentNode.removeChild(l)}var du={showCompass:!0,showZoom:!0,visualizePitch:!1},Xi=function(l){var f=this;this.options=v.extend({},du,l),this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),H.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),H.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=H.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Xi.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Xi.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Xi.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ro(this._map,this._compass,this.options.visualizePitch)),this._container},Xi.prototype.onRemove=function(){H.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Xi.prototype._createButton=function(l,f){var c=H.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Xi.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var ro=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new gf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new al({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),H.addEventListener(f,"mousedown",this.mousedown),H.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),H.addEventListener(f,"touchmove",this.touchmove),H.addEventListener(f,"touchend",this.touchend),H.addEventListener(f,"touchcancel",this.reset)};function Os(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),b=new v.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}ro.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),H.disableDrag()},ro.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},ro.prototype.off=function(){var l=this.element;H.removeEventListener(l,"mousedown",this.mousedown),H.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),H.removeEventListener(l,"touchmove",this.touchmove),H.removeEventListener(l,"touchend",this.touchend),H.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},ro.prototype.offTemp=function(){H.enableDrag(),H.removeEventListener(v.window,"mousemove",this.mousemove),H.removeEventListener(v.window,"mouseup",this.mouseup)},ro.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),H.mousePos(this.element,l)),H.addEventListener(v.window,"mousemove",this.mousemove),H.addEventListener(v.window,"mouseup",this.mouseup)},ro.prototype.mousemove=function(l){this.move(l,H.mousePos(this.element,l))},ro.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},ro.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=H.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},ro.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=H.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},ro.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ro.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var js={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ul(l,f,c){var d=l.classList;for(var b in js)d.remove("mapboxgl-"+c+"-anchor-"+b);d.add("mapboxgl-"+c+"-anchor-"+f)}var Ru,kl=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=H.create("div"),this._element.setAttribute("aria-label","Map marker");var b=H.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=H.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=H.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var k=H.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var U=0,G=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<G.length;U+=1){var ae=G[U],se=H.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ae.rx),se.setAttributeNS(null,"ry",ae.ry),k.appendChild(se)}var re=H.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"fill",this._color);var be=H.createNS("http://www.w3.org/2000/svg","path");be.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),re.appendChild(be);var Te=H.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"fill","#000000");var Ze=H.createNS("http://www.w3.org/2000/svg","path");Ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Te.appendChild(Ze);var xe=H.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");var Ve=H.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var qe=H.createNS("http://www.w3.org/2000/svg","circle");qe.setAttributeNS(null,"fill","#000000"),qe.setAttributeNS(null,"opacity","0.25"),qe.setAttributeNS(null,"cx","5.5"),qe.setAttributeNS(null,"cy","5.5"),qe.setAttributeNS(null,"r","5.4999962");var dt=H.createNS("http://www.w3.org/2000/svg","circle");dt.setAttributeNS(null,"fill","#FFFFFF"),dt.setAttributeNS(null,"cx","5.5"),dt.setAttributeNS(null,"cy","5.5"),dt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild(qe),Ve.appendChild(dt),P.appendChild(k),P.appendChild(re),P.appendChild(Te),P.appendChild(xe),P.appendChild(Ve),b.appendChild(P),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Gt){Gt.preventDefault()}),this._element.addEventListener("mousedown",function(Gt){Gt.preventDefault()}),ul(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),H.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,b=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,b=this._element;this._popup&&(d===b||b.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),H.setTransform(this._element,js[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),mo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},sc=0,Ll=!1,Ef=function(l){function f(c){l.call(this),this.options=v.extend({},mo,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Ru!==void 0?d(Ru):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(b){d(Ru=b.state!=="denied")}):d(Ru=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),H.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,sc=0,Ll=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),b=c.coords;return d&&(b.longitude<d.getWest()||b.longitude>d.getEast()||b.latitude<d.getSouth()||b.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),P=v.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(b),P,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=d.distanceTo(b),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Ll)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=H.create("button","mapboxgl-ctrl-geolocate",this._container),H.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new kl(this._dotElement),this._circleElement=H.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new kl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":sc--,Ll=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++sc>1?(c={maximumAge:6e5,timeout:0},Ll=!0):(c=this.options.positionOptions,Ll=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),ll={maxWidth:100,unit:"metric"},cl=function(l){this.options=v.extend({},ll,l),v.bindAll(["_onMove","setUnit"],this)};function uc(l,f,c){var d=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),P=l.unproject([d,b]),k=w.distanceTo(P);if(c&&c.unit==="imperial"){var U=3.2808*k;U>5280?ku(f,d,U/5280,l._getUIString("ScaleControl.Miles")):ku(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?ku(f,d,k/1852,l._getUIString("ScaleControl.NauticalMiles")):k>=1e3?ku(f,d,k/1e3,l._getUIString("ScaleControl.Kilometers")):ku(f,d,k,l._getUIString("ScaleControl.Meters"))}function ku(l,f,c,d){var b,w,P,k=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(P=(P=b/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(U){var G=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*G)/G}(P)));l.style.width=f*(k/c)+"px",l.innerHTML=k+"&nbsp;"+d}cl.prototype.getDefaultPosition=function(){return"bottom-left"},cl.prototype._onMove=function(){uc(this._map,this._container,this.options)},cl.prototype.onAdd=function(l){return this._map=l,this._container=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},cl.prototype.onRemove=function(){H.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},cl.prototype.setUnit=function(l){this.options.unit=l,uc(this._map,this._container,this.options)};var Gs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Gs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=H.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Gs.prototype.onRemove=function(){H.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Gs.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Gs.prototype._setupUI=function(){var l=this._fullscreenButton=H.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Gs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Gs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Gs.prototype._isFullscreen=function(){return this._fullscreen},Gs.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Gs.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Gf=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(zc),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&H.remove(this._content),this._container&&(H.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,b=v.window.document.createDocumentFragment(),w=v.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)b.appendChild(d);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=H.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=H.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=H.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=H.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return d._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Os(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function se(re){if(re){if(typeof re=="number"){var be=Math.round(Math.sqrt(.5*Math.pow(re,2)));return{center:new v.Point(0,0),top:new v.Point(0,re),"top-left":new v.Point(be,be),"top-right":new v.Point(-be,be),bottom:new v.Point(0,-re),"bottom-left":new v.Point(be,-be),"bottom-right":new v.Point(-be,-be),left:new v.Point(re,0),right:new v.Point(-re,0)}}if(re instanceof v.Point||Array.isArray(re)){var Te=v.Point.convert(re);return{center:Te,top:Te,"top-left":Te,"top-right":Te,bottom:Te,"bottom-left":Te,"bottom-right":Te,left:Te,right:Te}}return{center:v.Point.convert(re.center||[0,0]),top:v.Point.convert(re.top||[0,0]),"top-left":v.Point.convert(re["top-left"]||[0,0]),"top-right":v.Point.convert(re["top-right"]||[0,0]),bottom:v.Point.convert(re.bottom||[0,0]),"bottom-left":v.Point.convert(re["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(re["bottom-right"]||[0,0]),left:v.Point.convert(re.left||[0,0]),right:v.Point.convert(re.right||[0,0])}}return se(new v.Point(0,0))}(this.options.offset);if(!w){var k,U=this._container.offsetWidth,G=this._container.offsetHeight;k=b.y+P.bottom.y<G?["top"]:b.y>this._map.transform.height-G?["bottom"]:[],b.x<U/2?k.push("left"):b.x>this._map.transform.width-U/2&&k.push("right"),w=k.length===0?"bottom":k.join("-")}var ae=b.add(P[w]).round();H.setTransform(this._container,js[w]+" translate("+ae.x+"px,"+ae.y+"px)"),ul(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Uc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),lc={version:v.version,supported:Oe,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Th,NavigationControl:Xi,GeolocateControl:Ef,AttributionControl:os,ScaleControl:cl,FullscreenControl:Gs,Popup:Gf,Marker:kl,Style:gs,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Et().acquire(Rt)},clearPrewarmedResources:function(){var l=gn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Rt),gn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return lc}),Ie})},28660:function(Ar,ne,J){var Ie=J(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ge;(function(v){(function(Oe){var H=typeof J.g=="object"?J.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ce=he(v);typeof H.Reflect=="undefined"?H.Reflect=v:ce=he(H.Reflect,ce),Oe(ce);function he(Fe,ye){return function(Je,ft){typeof Fe[Je]!="function"&&Object.defineProperty(Fe,Je,{configurable:!0,writable:!0,value:ft}),ye&&ye(Je,ft)}}})(function(Oe){var H=Object.prototype.hasOwnProperty,ce=typeof Symbol=="function",he=ce&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Fe=ce&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ye=typeof Object.create=="function",Je={__proto__:[]}instanceof Array,ft=!ye&&!Je,xt={create:ye?function(){return Qs(Object.create(null))}:Je?function(){return Qs({__proto__:null})}:function(){return Qs({})},has:ft?function(Bt,$t){return H.call(Bt,$t)}:function(Bt,$t){return $t in Bt},get:ft?function(Bt,$t){return H.call(Bt,$t)?Bt[$t]:void 0}:function(Bt,$t){return Bt[$t]}},Jt=Object.getPrototypeOf(Function),ur=typeof Ie=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",It=!ur&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:le(),er=!ur&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ii(),jt=!ur&&typeof WeakMap=="function"?WeakMap:yo(),ct=new jt;function pt(Bt,$t,Pr,ln){if(mn(Pr)){if(!Li(Bt))throw new TypeError;if(!fa($t))throw new TypeError;return Hr(Bt,$t)}else{if(!Li(Bt))throw new TypeError;if(!ni($t))throw new TypeError;if(!ni(ln)&&!mn(ln)&&!di(ln))throw new TypeError;return di(ln)&&(ln=void 0),Pr=Gi(Pr),nn(Bt,$t,Pr,ln)}}Oe("decorate",pt);function ir(Bt,$t){function Pr(ln,An){if(!ni(ln))throw new TypeError;if(!mn(An)&&!ko(An))throw new TypeError;Lt(Bt,$t,ln,An)}return Pr}Oe("metadata",ir);function Y(Bt,$t,Pr,ln){if(!ni(Pr))throw new TypeError;return mn(ln)||(ln=Gi(ln)),Lt(Bt,$t,Pr,ln)}Oe("defineMetadata",Y);function Xt(Bt,$t,Pr){if(!ni($t))throw new TypeError;return mn(Pr)||(Pr=Gi(Pr)),Se(Bt,$t,Pr)}Oe("hasMetadata",Xt);function st(Bt,$t,Pr){if(!ni($t))throw new TypeError;return mn(Pr)||(Pr=Gi(Pr)),ke(Bt,$t,Pr)}Oe("hasOwnMetadata",st);function Ye(Bt,$t,Pr){if(!ni($t))throw new TypeError;return mn(Pr)||(Pr=Gi(Pr)),_t(Bt,$t,Pr)}Oe("getMetadata",Ye);function bt(Bt,$t,Pr){if(!ni($t))throw new TypeError;return mn(Pr)||(Pr=Gi(Pr)),ht(Bt,$t,Pr)}Oe("getOwnMetadata",bt);function $e(Bt,$t){if(!ni(Bt))throw new TypeError;return mn($t)||($t=Gi($t)),Ht(Bt,$t)}Oe("getMetadataKeys",$e);function Yt(Bt,$t){if(!ni(Bt))throw new TypeError;return mn($t)||($t=Gi($t)),xr(Bt,$t)}Oe("getOwnMetadataKeys",Yt);function Er(Bt,$t,Pr){if(!ni($t))throw new TypeError;mn(Pr)||(Pr=Gi(Pr));var ln=C($t,Pr,!1);if(mn(ln)||!ln.delete(Bt))return!1;if(ln.size>0)return!0;var An=ct.get($t);return An.delete(Pr),An.size>0||ct.delete($t),!0}Oe("deleteMetadata",Er);function Hr(Bt,$t){for(var Pr=Bt.length-1;Pr>=0;--Pr){var ln=Bt[Pr],An=ln($t);if(!mn(An)&&!di(An)){if(!fa(An))throw new TypeError;$t=An}}return $t}function nn(Bt,$t,Pr,ln){for(var An=Bt.length-1;An>=0;--An){var Nn=Bt[An],_i=Nn($t,Pr,ln);if(!mn(_i)&&!di(_i)){if(!ni(_i))throw new TypeError;ln=_i}}return ln}function C(Bt,$t,Pr){var ln=ct.get(Bt);if(mn(ln)){if(!Pr)return;ln=new It,ct.set(Bt,ln)}var An=ln.get($t);if(mn(An)){if(!Pr)return;An=new It,ln.set($t,An)}return An}function Se(Bt,$t,Pr){var ln=ke(Bt,$t,Pr);if(ln)return!0;var An=Es($t);return di(An)?!1:Se(Bt,An,Pr)}function ke(Bt,$t,Pr){var ln=C($t,Pr,!1);return mn(ln)?!1:mi(ln.has(Bt))}function _t(Bt,$t,Pr){var ln=ke(Bt,$t,Pr);if(ln)return ht(Bt,$t,Pr);var An=Es($t);if(!di(An))return _t(Bt,An,Pr)}function ht(Bt,$t,Pr){var ln=C($t,Pr,!1);if(!mn(ln))return ln.get(Bt)}function Lt(Bt,$t,Pr,ln){var An=C(Pr,ln,!0);An.set(Bt,$t)}function Ht(Bt,$t){var Pr=xr(Bt,$t),ln=Es(Bt);if(ln===null)return Pr;var An=Ht(ln,$t);if(An.length<=0)return Pr;if(Pr.length<=0)return An;for(var Nn=new er,_i=[],fi=0,En=Pr;fi<En.length;fi++){var Mi=En[fi],Ti=Nn.has(Mi);Ti||(Nn.add(Mi),_i.push(Mi))}for(var eo=0,ps=An;eo<ps.length;eo++){var Mi=ps[eo],Ti=Nn.has(Mi);Ti||(Nn.add(Mi),_i.push(Mi))}return _i}function xr(Bt,$t){var Pr=[],ln=C(Bt,$t,!1);if(mn(ln))return Pr;for(var An=ln.keys(),Nn=ya(An),_i=0;;){var fi=ra(Nn);if(!fi)return Pr.length=_i,Pr;var En=Fi(fi);try{Pr[_i]=En}catch(Mi){try{Qi(Nn)}finally{throw Mi}}_i++}}function Kn(Bt){if(Bt===null)return 1;switch(typeof Bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Bt===null?1:6;default:return 6}}function mn(Bt){return Bt===void 0}function di(Bt){return Bt===null}function Gn(Bt){return typeof Bt=="symbol"}function ni(Bt){return typeof Bt=="object"?Bt!==null:typeof Bt=="function"}function vi(Bt,$t){switch(Kn(Bt)){case 0:return Bt;case 1:return Bt;case 2:return Bt;case 3:return Bt;case 4:return Bt;case 5:return Bt}var Pr=$t===3?"string":$t===5?"number":"default",ln=Oa(Bt,he);if(ln!==void 0){var An=ln.call(Bt,Pr);if(ni(An))throw new TypeError;return An}return Hn(Bt,Pr==="default"?"number":Pr)}function Hn(Bt,$t){if($t==="string"){var Pr=Bt.toString;if($i(Pr)){var ln=Pr.call(Bt);if(!ni(ln))return ln}var An=Bt.valueOf;if($i(An)){var ln=An.call(Bt);if(!ni(ln))return ln}}else{var An=Bt.valueOf;if($i(An)){var ln=An.call(Bt);if(!ni(ln))return ln}var Nn=Bt.toString;if($i(Nn)){var ln=Nn.call(Bt);if(!ni(ln))return ln}}throw new TypeError}function mi(Bt){return!!Bt}function ca(Bt){return""+Bt}function Gi(Bt){var $t=vi(Bt,3);return Gn($t)?$t:ca($t)}function Li(Bt){return Array.isArray?Array.isArray(Bt):Bt instanceof Object?Bt instanceof Array:Object.prototype.toString.call(Bt)==="[object Array]"}function $i(Bt){return typeof Bt=="function"}function fa(Bt){return typeof Bt=="function"}function ko(Bt){switch(Kn(Bt)){case 3:return!0;case 4:return!0;default:return!1}}function Oa(Bt,$t){var Pr=Bt[$t];if(Pr!=null){if(!$i(Pr))throw new TypeError;return Pr}}function ya(Bt){var $t=Oa(Bt,Fe);if(!$i($t))throw new TypeError;var Pr=$t.call(Bt);if(!ni(Pr))throw new TypeError;return Pr}function Fi(Bt){return Bt.value}function ra(Bt){var $t=Bt.next();return $t.done?!1:$t}function Qi(Bt){var $t=Bt.return;$t&&$t.call(Bt)}function Es(Bt){var $t=Object.getPrototypeOf(Bt);if(typeof Bt!="function"||Bt===Jt||$t!==Jt)return $t;var Pr=Bt.prototype,ln=Pr&&Object.getPrototypeOf(Pr);if(ln==null||ln===Object.prototype)return $t;var An=ln.constructor;return typeof An!="function"||An===Bt?$t:An}function le(){var Bt={},$t=[],Pr=function(){function _i(fi,En,Mi){this._index=0,this._keys=fi,this._values=En,this._selector=Mi}return _i.prototype["@@iterator"]=function(){return this},_i.prototype[Fe]=function(){return this},_i.prototype.next=function(){var fi=this._index;if(fi>=0&&fi<this._keys.length){var En=this._selector(this._keys[fi],this._values[fi]);return fi+1>=this._keys.length?(this._index=-1,this._keys=$t,this._values=$t):this._index++,{value:En,done:!1}}return{value:void 0,done:!0}},_i.prototype.throw=function(fi){throw this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),fi},_i.prototype.return=function(fi){return this._index>=0&&(this._index=-1,this._keys=$t,this._values=$t),{value:fi,done:!0}},_i}();return function(){function _i(){this._keys=[],this._values=[],this._cacheKey=Bt,this._cacheIndex=-2}return Object.defineProperty(_i.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),_i.prototype.has=function(fi){return this._find(fi,!1)>=0},_i.prototype.get=function(fi){var En=this._find(fi,!1);return En>=0?this._values[En]:void 0},_i.prototype.set=function(fi,En){var Mi=this._find(fi,!0);return this._values[Mi]=En,this},_i.prototype.delete=function(fi){var En=this._find(fi,!1);if(En>=0){for(var Mi=this._keys.length,Ti=En+1;Ti<Mi;Ti++)this._keys[Ti-1]=this._keys[Ti],this._values[Ti-1]=this._values[Ti];return this._keys.length--,this._values.length--,fi===this._cacheKey&&(this._cacheKey=Bt,this._cacheIndex=-2),!0}return!1},_i.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Bt,this._cacheIndex=-2},_i.prototype.keys=function(){return new Pr(this._keys,this._values,ln)},_i.prototype.values=function(){return new Pr(this._keys,this._values,An)},_i.prototype.entries=function(){return new Pr(this._keys,this._values,Nn)},_i.prototype["@@iterator"]=function(){return this.entries()},_i.prototype[Fe]=function(){return this.entries()},_i.prototype._find=function(fi,En){return this._cacheKey!==fi&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=fi)),this._cacheIndex<0&&En&&(this._cacheIndex=this._keys.length,this._keys.push(fi),this._values.push(void 0)),this._cacheIndex},_i}();function ln(_i,fi){return _i}function An(_i,fi){return fi}function Nn(_i,fi){return[_i,fi]}}function ii(){return function(){function Bt(){this._map=new It}return Object.defineProperty(Bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Bt.prototype.has=function($t){return this._map.has($t)},Bt.prototype.add=function($t){return this._map.set($t,$t),this},Bt.prototype.delete=function($t){return this._map.delete($t)},Bt.prototype.clear=function(){this._map.clear()},Bt.prototype.keys=function(){return this._map.keys()},Bt.prototype.values=function(){return this._map.values()},Bt.prototype.entries=function(){return this._map.entries()},Bt.prototype["@@iterator"]=function(){return this.keys()},Bt.prototype[Fe]=function(){return this.keys()},Bt}()}function yo(){var Bt=16,$t=xt.create(),Pr=ln();return function(){function En(){this._key=ln()}return En.prototype.has=function(Mi){var Ti=An(Mi,!1);return Ti!==void 0?xt.has(Ti,this._key):!1},En.prototype.get=function(Mi){var Ti=An(Mi,!1);return Ti!==void 0?xt.get(Ti,this._key):void 0},En.prototype.set=function(Mi,Ti){var eo=An(Mi,!0);return eo[this._key]=Ti,this},En.prototype.delete=function(Mi){var Ti=An(Mi,!1);return Ti!==void 0?delete Ti[this._key]:!1},En.prototype.clear=function(){this._key=ln()},En}();function ln(){var En;do En="@@WeakMap@@"+fi();while(xt.has($t,En));return $t[En]=!0,En}function An(En,Mi){if(!H.call(En,Pr)){if(!Mi)return;Object.defineProperty(En,Pr,{value:xt.create()})}return En[Pr]}function Nn(En,Mi){for(var Ti=0;Ti<Mi;++Ti)En[Ti]=Math.random()*255|0;return En}function _i(En){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(En)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(En)):Nn(new Uint8Array(En),En):Nn(new Array(En),En)}function fi(){var En=_i(Bt);En[6]=En[6]&79|64,En[8]=En[8]&191|128;for(var Mi="",Ti=0;Ti<Bt;++Ti){var eo=En[Ti];(Ti===4||Ti===6||Ti===8)&&(Mi+="-"),eo<16&&(Mi+="0"),Mi+=eo.toString(16).toLowerCase()}return Mi}}function Qs(Bt){return Bt.__=void 0,delete Bt.__,Bt}})})(ge||(ge={}))},69848:function(Ar){(function(ne,J){Ar.exports=J()})(this,function(){"use strict";function ne(st,Ye,bt,$e,Yt,Er){if(!(Yt-$e<=bt)){var Hr=$e+Yt>>1;J(st,Ye,Hr,$e,Yt,Er%2),ne(st,Ye,bt,$e,Hr-1,Er+1),ne(st,Ye,bt,Hr+1,Yt,Er+1)}}function J(st,Ye,bt,$e,Yt,Er){for(;Yt>$e;){if(Yt-$e>600){var Hr=Yt-$e+1,nn=bt-$e+1,C=Math.log(Hr),Se=.5*Math.exp(2*C/3),ke=.5*Math.sqrt(C*Se*(Hr-Se)/Hr)*(nn-Hr/2<0?-1:1),_t=Math.max($e,Math.floor(bt-nn*Se/Hr+ke)),ht=Math.min(Yt,Math.floor(bt+(Hr-nn)*Se/Hr+ke));J(st,Ye,bt,_t,ht,Er)}var Lt=Ye[2*bt+Er],Ht=$e,xr=Yt;for(Ie(st,Ye,$e,bt),Ye[2*Yt+Er]>Lt&&Ie(st,Ye,$e,Yt);Ht<xr;){for(Ie(st,Ye,Ht,xr),Ht++,xr--;Ye[2*Ht+Er]<Lt;)Ht++;for(;Ye[2*xr+Er]>Lt;)xr--}Ye[2*$e+Er]===Lt?Ie(st,Ye,$e,xr):(xr++,Ie(st,Ye,xr,Yt)),xr<=bt&&($e=xr+1),bt<=xr&&(Yt=xr-1)}}function Ie(st,Ye,bt,$e){ge(st,bt,$e),ge(Ye,2*bt,2*$e),ge(Ye,2*bt+1,2*$e+1)}function ge(st,Ye,bt){var $e=st[Ye];st[Ye]=st[bt],st[bt]=$e}function v(st,Ye,bt,$e,Yt,Er,Hr){for(var nn=[0,st.length-1,0],C=[],Se,ke;nn.length;){var _t=nn.pop(),ht=nn.pop(),Lt=nn.pop();if(ht-Lt<=Hr){for(var Ht=Lt;Ht<=ht;Ht++)Se=Ye[2*Ht],ke=Ye[2*Ht+1],Se>=bt&&Se<=Yt&&ke>=$e&&ke<=Er&&C.push(st[Ht]);continue}var xr=Math.floor((Lt+ht)/2);Se=Ye[2*xr],ke=Ye[2*xr+1],Se>=bt&&Se<=Yt&&ke>=$e&&ke<=Er&&C.push(st[xr]);var Kn=(_t+1)%2;(_t===0?bt<=Se:$e<=ke)&&(nn.push(Lt),nn.push(xr-1),nn.push(Kn)),(_t===0?Yt>=Se:Er>=ke)&&(nn.push(xr+1),nn.push(ht),nn.push(Kn))}return C}function Oe(st,Ye,bt,$e,Yt,Er){for(var Hr=[0,st.length-1,0],nn=[],C=Yt*Yt;Hr.length;){var Se=Hr.pop(),ke=Hr.pop(),_t=Hr.pop();if(ke-_t<=Er){for(var ht=_t;ht<=ke;ht++)H(Ye[2*ht],Ye[2*ht+1],bt,$e)<=C&&nn.push(st[ht]);continue}var Lt=Math.floor((_t+ke)/2),Ht=Ye[2*Lt],xr=Ye[2*Lt+1];H(Ht,xr,bt,$e)<=C&&nn.push(st[Lt]);var Kn=(Se+1)%2;(Se===0?bt-Yt<=Ht:$e-Yt<=xr)&&(Hr.push(_t),Hr.push(Lt-1),Hr.push(Kn)),(Se===0?bt+Yt>=Ht:$e+Yt>=xr)&&(Hr.push(Lt+1),Hr.push(ke),Hr.push(Kn))}return nn}function H(st,Ye,bt,$e){var Yt=st-bt,Er=Ye-$e;return Yt*Yt+Er*Er}var ce=function(st){return st[0]},he=function(st){return st[1]},Fe=function(Ye,bt,$e,Yt,Er){bt===void 0&&(bt=ce),$e===void 0&&($e=he),Yt===void 0&&(Yt=64),Er===void 0&&(Er=Float64Array),this.nodeSize=Yt,this.points=Ye;for(var Hr=Ye.length<65536?Uint16Array:Uint32Array,nn=this.ids=new Hr(Ye.length),C=this.coords=new Er(Ye.length*2),Se=0;Se<Ye.length;Se++)nn[Se]=Se,C[2*Se]=bt(Ye[Se]),C[2*Se+1]=$e(Ye[Se]);ne(nn,C,Yt,0,nn.length-1,0)};Fe.prototype.range=function(Ye,bt,$e,Yt){return v(this.ids,this.coords,Ye,bt,$e,Yt,this.nodeSize)},Fe.prototype.within=function(Ye,bt,$e){return Oe(this.ids,this.coords,Ye,bt,$e,this.nodeSize)};var ye={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(st){return st}},Je=Math.fround||function(st){return function(Ye){return st[0]=+Ye,st[0]}}(new Float32Array(1)),ft=function(Ye){this.options=ir(Object.create(ye),Ye),this.trees=new Array(this.options.maxZoom+1)};ft.prototype.load=function(Ye){var bt=this.options,$e=bt.log,Yt=bt.minZoom,Er=bt.maxZoom,Hr=bt.nodeSize;$e&&console.time("total time");var nn="prepare "+Ye.length+" points";$e&&console.time(nn),this.points=Ye;for(var C=[],Se=0;Se<Ye.length;Se++)!Ye[Se].geometry||C.push(Jt(Ye[Se],Se));this.trees[Er+1]=new Fe(C,Y,Xt,Hr,Float32Array),$e&&console.timeEnd(nn);for(var ke=Er;ke>=Yt;ke--){var _t=+Date.now();C=this._cluster(C,ke),this.trees[ke]=new Fe(C,Y,Xt,Hr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",ke,C.length,+Date.now()-_t)}return $e&&console.timeEnd("total time"),this},ft.prototype.getClusters=function(Ye,bt){var $e=((Ye[0]+180)%360+360)%360-180,Yt=Math.max(-90,Math.min(90,Ye[1])),Er=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,Hr=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)$e=-180,Er=180;else if($e>Er){var nn=this.getClusters([$e,Yt,180,Hr],bt),C=this.getClusters([-180,Yt,Er,Hr],bt);return nn.concat(C)}for(var Se=this.trees[this._limitZoom(bt)],ke=Se.range(er($e),jt(Hr),er(Er),jt(Yt)),_t=[],ht=0,Lt=ke;ht<Lt.length;ht+=1){var Ht=Lt[ht],xr=Se.points[Ht];_t.push(xr.numPoints?ur(xr):this.points[xr.index])}return _t},ft.prototype.getChildren=function(Ye){var bt=this._getOriginId(Ye),$e=this._getOriginZoom(Ye),Yt="No cluster with the specified id.",Er=this.trees[$e];if(!Er)throw new Error(Yt);var Hr=Er.points[bt];if(!Hr)throw new Error(Yt);for(var nn=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),C=Er.within(Hr.x,Hr.y,nn),Se=[],ke=0,_t=C;ke<_t.length;ke+=1){var ht=_t[ke],Lt=Er.points[ht];Lt.parentId===Ye&&Se.push(Lt.numPoints?ur(Lt):this.points[Lt.index])}if(Se.length===0)throw new Error(Yt);return Se},ft.prototype.getLeaves=function(Ye,bt,$e){bt=bt||10,$e=$e||0;var Yt=[];return this._appendLeaves(Yt,Ye,bt,$e,0),Yt},ft.prototype.getTile=function(Ye,bt,$e){var Yt=this.trees[this._limitZoom(Ye)],Er=Math.pow(2,Ye),Hr=this.options,nn=Hr.extent,C=Hr.radius,Se=C/nn,ke=($e-Se)/Er,_t=($e+1+Se)/Er,ht={features:[]};return this._addTileFeatures(Yt.range((bt-Se)/Er,ke,(bt+1+Se)/Er,_t),Yt.points,bt,$e,Er,ht),bt===0&&this._addTileFeatures(Yt.range(1-Se/Er,ke,1,_t),Yt.points,Er,$e,Er,ht),bt===Er-1&&this._addTileFeatures(Yt.range(0,ke,Se/Er,_t),Yt.points,-1,$e,Er,ht),ht.features.length?ht:null},ft.prototype.getClusterExpansionZoom=function(Ye){for(var bt=this._getOriginZoom(Ye)-1;bt<=this.options.maxZoom;){var $e=this.getChildren(Ye);if(bt++,$e.length!==1)break;Ye=$e[0].properties.cluster_id}return bt},ft.prototype._appendLeaves=function(Ye,bt,$e,Yt,Er){for(var Hr=this.getChildren(bt),nn=0,C=Hr;nn<C.length;nn+=1){var Se=C[nn],ke=Se.properties;if(ke&&ke.cluster?Er+ke.point_count<=Yt?Er+=ke.point_count:Er=this._appendLeaves(Ye,ke.cluster_id,$e,Yt,Er):Er<Yt?Er++:Ye.push(Se),Ye.length===$e)break}return Er},ft.prototype._addTileFeatures=function(Ye,bt,$e,Yt,Er,Hr){for(var nn=0,C=Ye;nn<C.length;nn+=1){var Se=C[nn],ke=bt[Se],_t=ke.numPoints,ht=void 0,Lt=void 0,Ht=void 0;if(_t)ht=It(ke),Lt=ke.x,Ht=ke.y;else{var xr=this.points[ke.index];ht=xr.properties,Lt=er(xr.geometry.coordinates[0]),Ht=jt(xr.geometry.coordinates[1])}var Kn={type:1,geometry:[[Math.round(this.options.extent*(Lt*Er-$e)),Math.round(this.options.extent*(Ht*Er-Yt))]],tags:ht},mn=void 0;_t?mn=ke.id:this.options.generateId?mn=ke.index:this.points[ke.index].id&&(mn=this.points[ke.index].id),mn!==void 0&&(Kn.id=mn),Hr.features.push(Kn)}},ft.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},ft.prototype._cluster=function(Ye,bt){for(var $e=[],Yt=this.options,Er=Yt.radius,Hr=Yt.extent,nn=Yt.reduce,C=Yt.minPoints,Se=Er/(Hr*Math.pow(2,bt)),ke=0;ke<Ye.length;ke++){var _t=Ye[ke];if(!(_t.zoom<=bt)){_t.zoom=bt;for(var ht=this.trees[bt+1],Lt=ht.within(_t.x,_t.y,Se),Ht=_t.numPoints||1,xr=Ht,Kn=0,mn=Lt;Kn<mn.length;Kn+=1){var di=mn[Kn],Gn=ht.points[di];Gn.zoom>bt&&(xr+=Gn.numPoints||1)}if(xr>Ht&&xr>=C){for(var ni=_t.x*Ht,vi=_t.y*Ht,Hn=nn&&Ht>1?this._map(_t,!0):null,mi=(ke<<5)+(bt+1)+this.points.length,ca=0,Gi=Lt;ca<Gi.length;ca+=1){var Li=Gi[ca],$i=ht.points[Li];if(!($i.zoom<=bt)){$i.zoom=bt;var fa=$i.numPoints||1;ni+=$i.x*fa,vi+=$i.y*fa,$i.parentId=mi,nn&&(Hn||(Hn=this._map(_t,!0)),nn(Hn,this._map($i)))}}_t.parentId=mi,$e.push(xt(ni/xr,vi/xr,mi,xr,Hn))}else if($e.push(_t),xr>1)for(var ko=0,Oa=Lt;ko<Oa.length;ko+=1){var ya=Oa[ko],Fi=ht.points[ya];Fi.zoom<=bt||(Fi.zoom=bt,$e.push(Fi))}}}return $e},ft.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},ft.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},ft.prototype._map=function(Ye,bt){if(Ye.numPoints)return bt?ir({},Ye.properties):Ye.properties;var $e=this.points[Ye.index].properties,Yt=this.options.map($e);return bt&&Yt===$e?ir({},Yt):Yt};function xt(st,Ye,bt,$e,Yt){return{x:Je(st),y:Je(Ye),zoom:Infinity,id:bt,parentId:-1,numPoints:$e,properties:Yt}}function Jt(st,Ye){var bt=st.geometry.coordinates,$e=bt[0],Yt=bt[1];return{x:Je(er($e)),y:Je(jt(Yt)),zoom:Infinity,index:Ye,parentId:-1}}function ur(st){return{type:"Feature",id:st.id,properties:It(st),geometry:{type:"Point",coordinates:[ct(st.x),pt(st.y)]}}}function It(st){var Ye=st.numPoints,bt=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return ir(ir({},st.properties),{cluster:!0,cluster_id:st.id,point_count:Ye,point_count_abbreviated:bt})}function er(st){return st/360+.5}function jt(st){var Ye=Math.sin(st*Math.PI/180),bt=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return bt<0?0:bt>1?1:bt}function ct(st){return(st-.5)*360}function pt(st){var Ye=(180-st*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function ir(st,Ye){for(var bt in Ye)st[bt]=Ye[bt];return st}function Y(st){return st.x}function Xt(st){return st.y}return ft})},75752:function(Ar){Ar.exports.RADIUS=6378137,Ar.exports.FLATTENING=1/298.257223563,Ar.exports.POLAR_RADIUS=63567523142e-4}}]);
